{"version":3,"file":"dev.app.js","sources":["../../src/lib/window.ts","../../src/lib/utils-roam-alpha-api.ts","../../src/v0.3.0/settings-page/types.ts","../../src/v0.3.0/settings-page/block-types.ts","../../src/v0.3.0/settings-page/shape.ts","../../src/v0.3.0/settings-page/keys.ts","../../src/lib/utils.ts","../../src/v0.3.0/settings-page/key-block-map.ts","../../src/v0.3.0/settings-page/utils.ts","../../src/v0.3.0/settings-page/block-creation.ts","../../src/v0.3.0/settings-page/read-warite.ts","../../src/v0.3.0/settings-page/index.ts","../../src/v0.3.0/init/config/paths.ts","../../src/v0.3.0/lib/backend-frontend/option.ts","../../src/v0.3.0/lib/types/Wild_Config.ts","../../src/v0.3.0/lib/utils.ts","../../src/v0.3.0/init/config/yt-gif-init.ts","../../src/v0.3.0/lib/types/video-types.ts","../../src/v0.3.0/lib/types/yt-types.ts","../../src/v0.3.0/lib/types/config.ts","../../src/v0.3.0/lib/backend-frontend/mutation.ts","../../src/v0.3.0/lib/dom/elements-yt-gif-parent.ts","../../src/v0.3.0/lib/dom/ytgif.ts","../../src/v0.3.0/api-ready/setup/url-result/composition.ts","../../src/v0.3.0/api-ready/setup/url-result/query.ts","../../src/v0.3.0/lib/backend-frontend/get-maps.ts","../../src/v0.3.0/lib/backend-frontend/map-query.ts","../../src/v0.3.0/api-ready/setup/url-result/flow.ts","../../src/v0.3.0/api-ready/setup/url-result/index.ts","../../src/v0.3.0/init/formatter/button/creation.ts","../../src/v0.3.0/init/formatter/Flow/url/Format.ts","../../src/v0.3.0/init/formatter/Flow/url/types.ts","../../src/v0.3.0/init/timestamp/utils.ts","../../src/v0.3.0/lib/helpers.ts","../../src/v0.3.0/init/formatter/query/regex.ts","../../src/v0.3.0/init/formatter/query/extract.ts","../../src/v0.3.0/init/formatter/query/match-info.ts","../../src/v0.3.0/init/formatter/Flow/url/filter.ts","../../src/v0.3.0/init/formatter/Flow/url/index.ts","../../src/v0.3.0/init/formatter/Flow/timestamp/query.ts","../../src/v0.3.0/init/formatter/Flow/timestamp/Format.ts","../../src/v0.3.0/init/formatter/update/query.ts","../../src/v0.3.0/init/formatter/update/index.ts","../../src/v0.3.0/init/formatter/types.ts","../../src/v0.3.0/init/formatter/Flow/timestamp/filter.ts","../../src/v0.3.0/init/formatter/Flow/timestamp/from.start-end.ts","../../src/v0.3.0/lib/backend-frontend/types.ts","../../src/v0.3.0/lib/backend-frontend/components.ts","../../src/v0.3.0/lib/backend-frontend/xxx-congif.ts","../../src/v0.3.0/init/formatter/Flow/timestamp/to.url-ytgif.ts","../../src/v0.3.0/init/formatter/Flow/timestamp/examine.ts","../../src/v0.3.0/init/formatter/Flow/timestamp/index.ts","../../src/v0.3.0/init/formatter/Flow/index.ts","../../src/v0.3.0/api-ready/setup/formatter/query.ts","../../src/v0.3.0/init/formatter/button/validation.ts","../../src/v0.3.0/api-ready/setup/formatter/index.ts","../../src/v0.3.0/lib/event/ClickOnTimestamp.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/flow/query.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/click.ts","../../src/v0.3.0/api-ready/deploy/async.ts","../../src/v0.3.0/lib/dom/select/isInputSelected.ts","../../src/v0.3.0/init/observer/performance/buffer.ts","../../src/v0.3.0/init/observer/performance/index.ts","../../src/v0.3.0/init/timestamp/hierarchy.ts","../../src/v0.3.0/player-ready/lib/IFR.ts","../../src/v0.3.0/player-ready/lib/anyValidInAndOutKey.ts","../../src/v0.3.0/player-ready/listener/parent/in-out-states.ts","../../src/v0.3.0/player-ready/setup/setupPreviousParams.ts","../../src/v0.3.0/player-ready/listener/toggle.ts","../../src/v0.3.0/player-ready/listener/control/time/ClearTimers.ts","../../src/v0.3.0/lib/event/TryReloadVideo.ts","../../src/v0.3.0/lib/dom/attr.ts","../../src/v0.3.0/player-ready/listener/control/reset-btn/OnCustomVideoEnded.ts","../../src/v0.3.0/player-ready/setup/GetElements.ts","../../src/v0.3.0/player-ready/observer/IframeRemmovedFromDom_callback.ts","../../src/v0.3.0/player-ready/observer/PauseOffscreen_callback.ts","../../src/v0.3.0/player-ready/finished/query.ts","../../src/v0.3.0/player-ready/finished/autoplay-flow.ts","../../src/v0.3.0/player-ready/lib/PlayIs.ts","../../src/v0.3.0/player-ready/listener/parent/HandleOthers.ts","../../src/v0.3.0/player-ready/setup/composition.ts","../../src/v0.3.0/player-ready/setup/GetQuery.ts","../../src/v0.3.0/player-ready/setup/SetupRecordID.ts","../../src/v0.3.0/player-ready/setup/Refurbish.ts","../../src/v0.3.0/player-ready/listener/iframe/fullscreen.ts","../../src/v0.3.0/player-ready/index.ts","../../src/v0.3.0/lib/event/ClickResetWrapper.ts","../../src/v0.3.0/player-change/TryToLoadNextTimestampSet.ts","../../src/v0.3.0/player-change/lib.ts","../../src/v0.3.0/player-change/HandleEndState.ts","../../src/v0.3.0/player-change/index.ts","../../src/v0.3.0/api-ready/deploy/config.ts","../../src/v0.3.0/lib/dom/roam.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/mutation.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/flow/reset.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/flow/restore.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/flow/cleanup.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/flow/index.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/index.ts","../../src/v0.3.0/api-ready/observer/timestamp-recovery/driver.ts","../../src/v0.3.0/api-ready/setup/query.ts","../../src/v0.3.0/api-ready/observer/removed/index.ts","../../src/v0.3.0/api-ready/index.ts","../../src/v0.3.0/init/observer/yt-gif/query.ts","../../src/v0.3.0/init/observer/yt-gif/index.ts","../../src/v0.3.0/init/config/driver/targets.ts","../../src/v0.3.0/init/config/driver/index.ts","../../src/v0.3.0/init/dom/ui/update.ts","../../src/v0.3.0/init/dom/ui/change.ts","../../src/v0.3.0/lib/dom/select/CustomSelect.ts","../../src/v0.3.0/init/dom/ui/transform.ts","../../src/v0.3.0/init/dom/listener/index.ts","../../src/v0.3.0/init/dom/flip-tooltip.ts","../../src/v0.3.0/init/dom/drop-down-menu/hover/query.ts","../../src/v0.3.0/init/dom/sidebar.ts","../../src/v0.3.0/init/dom/fetch.ts","../../src/v0.3.0/init/dom/theme.ts","../../src/v0.3.0/init/dom/attribute/bind.ts","../../src/v0.3.0/init/dom/thumbnail.ts","../../src/v0.3.0/init/dom/scroll.ts","../../src/v0.3.0/init/dom/drop-down-menu/hover/index.ts","../../src/v0.3.0/init/tutorial/deploy/query.ts","../../src/v0.3.0/init/tutorial/deploy/index.ts","../../src/v0.3.0/init/tutorial/query.ts","../../src/v0.3.0/init/tutorial/index.ts","../../src/v0.3.0/init/observer/anchor.ts","../../src/v0.3.0/init/observer/formatter/filter.ts","../../src/v0.3.0/init/observer/formatter/update.ts","../../src/v0.3.0/init/observer/formatter/index.ts","../../src/v0.3.0/init/observer/switch/InputGate.ts","../../src/v0.3.0/init/observer/switch/Label.ts","../../src/v0.3.0/init/observer/switch/Show.ts","../../src/v0.3.0/init/observer/switch/Check.ts","../../src/v0.3.0/init/observer/switch/index.ts","../../src/v0.3.0/init/tutorial/notification/index.ts","../../src/v0.3.0/init/index/reset.ts","../../src/v0.3.0/init/observer/formatter/confirmation.ts","../../src/v0.3.0/init/observer/formatter/toggle.ts","../../src/v0.3.0/lib/dom/options.ts","../../src/v0.3.0/init/index/observer/formatter.ts","../../src/v0.3.0/init/timestamp/formats.ts","../../src/v0.3.0/init/observer/timestamp/replace.ts","../../src/v0.3.0/init/observer/timestamp/shortcut.ts","../../src/v0.3.0/init/observer/timestamp/types.ts","../../src/v0.3.0/init/observer/timestamp/emulation/setup/types.ts","../../src/v0.3.0/init/observer/timestamp/emulation/setup/guard-clause.ts","../../src/v0.3.0/init/observer/timestamp/emulation/setup/Local.ts","../../src/v0.3.0/init/observer/timestamp/emulation/setup/query/objects.ts","../../src/v0.3.0/init/observer/timestamp/emulation/setup/node.ts","../../src/v0.3.0/init/observer/timestamp/emulation/setup/query/timestamp-set.ts","../../src/v0.3.0/init/observer/timestamp/emulation/setup/index.ts","../../src/v0.3.0/lib/backend-frontend/url-duration.ts","../../src/v0.3.0/init/observer/timestamp/emulation/durationObj.ts","../../src/v0.3.0/init/observer/timestamp/emulation/sortObjByKey.ts","../../src/v0.3.0/init/observer/timestamp/emulation/deploy/query.ts","../../src/v0.3.0/init/timestamp/lib.ts","../../src/v0.3.0/init/observer/timestamp/query.ts","../../src/v0.3.0/init/observer/timestamp/click/query.ts","../../src/v0.3.0/init/observer/timestamp/click/simulation.ts","../../src/v0.3.0/init/observer/timestamp/click/Flow/play-pause.ts","../../src/v0.3.0/init/observer/timestamp/click/Flow/play/query.ts","../../src/v0.3.0/init/observer/timestamp/click/Flow/play/index.ts","../../src/v0.3.0/init/observer/timestamp/click/record/tmestamp.ts","../../src/v0.3.0/init/observer/timestamp/click/record/query.ts","../../src/v0.3.0/init/observer/timestamp/click/record/record.ts","../../src/v0.3.0/init/observer/timestamp/click/Flow/cross-page.ts","../../src/v0.3.0/init/observer/timestamp/click/Flow/index.ts","../../src/v0.3.0/init/observer/timestamp/click/index.ts","../../src/v0.3.0/init/observer/timestamp/emulation/SetUpUrlFormatter.ts","../../src/v0.3.0/init/observer/timestamp/emulation/deploy/callback.ts","../../src/v0.3.0/init/observer/timestamp/emulation/deploy/assign.ts","../../src/v0.3.0/init/observer/timestamp/emulation/deploy/index.ts","../../src/v0.3.0/init/observer/timestamp/emulation/index.ts","../../src/v0.3.0/init/observer/timestamp/mutation/toggle.ts","../../src/v0.3.0/init/observer/timestamp/display.ts","../../src/v0.3.0/init/observer/timestamp/mutation/index.ts","../../src/v0.3.0/init/index/observer/timestamp.ts","../../src/v0.3.0/init/index/observer/ytgif.ts","../../src/v0.3.0/init/index/fetch.ts","../../src/v0.3.0/init/dom/drop-down-menu/open-close.ts","../../src/v0.3.0/init/index/observer/tutorial.ts","../../src/v0.3.0/init/index/index.ts","../../src/v0.3.0/index.ts"],"sourcesContent":["window.kauderk = <typeof window.kauderk>{}\r\nwindow.AvoidCircularDependency = <typeof window.AvoidCircularDependency>{}\r\nElement.prototype.queryAllasArr = Document.prototype.queryAllasArr = function <\r\n\ttype = Element\r\n>(selector: string): type[] {\r\n\treturn Array.from(this.querySelectorAll(selector)).map(\r\n\t\tel => el as unknown as type\r\n\t)\r\n}\r\n//window.Gif = <typeof window.Gif>{}\r\n//window.YT_GIF_SETTINGS_PAGE_INIT = <typeof window.YT_GIF_SETTINGS_PAGE_INIT>{}\r\n//window.YT_GIF_SETTINGS_PAGE = <typeof window.YT_GIF_SETTINGS_PAGE>{}\r\n//window.YT_GIF_DIRECT_SETTINGS = <typeof window.YT_GIF_DIRECT_SETTINGS>{}\r\n//window.YT = <typeof window.YT>{}\r\n//window.roamAlphaAPI = <typeof window.roamAlphaAPI>{}\r\n//window.YT_GIF_OBSERVERS = <typeof window.YT_GIF_OBSERVERS>{}\r\n//window.ddm_html = <typeof window.ddm_html>{}\r\n//window.YTGIF = <typeof window.YTGIF>{}\r\n","const mouseOverEvents = ['mouseover']\r\ntype THierarchy = [\r\n\t{ uid: string; string: string },\r\n\t{ title: string; uid: string }\r\n]\r\nexport const getPageUidSync = (pageTitle: s): s => {\r\n\tconst res = window.roamAlphaAPI.q(\r\n\t\t`[:find (pull ?page [:block/uid])\r\n\t:where [?page :node/title \\\"${pageTitle}\\\"]]`\r\n\t)\r\n\treturn res.length ? res[0][0].uid : null\r\n}\r\nexport const getOrCreatePageUid = async (pageTitle: s, initString?: s) => {\r\n\tlet pageUid = await getPageUid(pageTitle)\r\n\tif (!pageUid) {\r\n\t\tpageUid = await createPage(pageTitle)\r\n\t\tif (initString)\r\n\t\t\tawait createChildBlock(pageUid, 0, initString, createUid())\r\n\t}\r\n\treturn pageUid\r\n}\r\nexport const SetNumberedViewWithUid = async (uid: s) => {\r\n\t//https://github.com/dvargas92495/roam-js-extensions/blob/c7092e40f6602a97fb555ae9d0cda8d2780ba0f2/src/entries/mouseless.ts#:~:text=%60%5B%3Afind%20(pull%20%3Fb%20%5B%3Achildren/view-type%5D)%20%3Awhere%20%5B%3Fb%20%3Ablock/uid%20%22%24%7Buid%7D%22%5D%5D%60\r\n\tconst newViewType = 'numbered'\r\n\tawait window.roamAlphaAPI.updateBlock({\r\n\t\tblock: { uid, 'children-view-type': newViewType },\r\n\t})\r\n}\r\nexport const CollapseDirectcChildren = async (\r\n\tblock_uid: s,\r\n\tblock_expanded: b\r\n) => {\r\n\tconst firstGen = await allChildrenInfo(block_uid)\r\n\tconst children = sortObjectsByOrder(firstGen[0][0].children)\r\n\r\n\tfor (const child of children) {\r\n\t\tawait ExpandBlock(child.uid, block_expanded)\r\n\t}\r\n}\r\nexport const getBlockInfoByUIDM = async (\r\n\tuid: s,\r\n\twithChildren = false,\r\n\twithParents = false\r\n): Promise<TBlockInfoRec[][] | null> => {\r\n\ttry {\r\n\t\tconst q = `[:find (pull ?page\r\n\t\t\t\t\t [:node/title :block/string :block/uid :block/heading :block/props \r\n\t\t\t\t\t  :entity/attrs :block/open :block/text-align :children/view-type\r\n\t\t\t\t\t  :block/order\r\n\t\t\t\t\t  ${withChildren ? '{:block/children ...}' : ''}\r\n\t\t\t\t\t  ${withParents ? '{:block/parents ...}' : ''}\r\n\t\t\t\t\t ])\r\n\t\t\t\t  :where [?page :block/uid \"${uid}\"]  ]`\r\n\t\tconst results = await window.roamAlphaAPI.q(q)\r\n\t\tif (results.length == 0) return null\r\n\t\treturn results\r\n\t} catch (e) {\r\n\t\treturn null\r\n\t}\r\n}\r\nexport const getBlockParentUids = async (uid: s) => {\r\n\ttry {\r\n\t\tconst parentUIDs = await window.roamAlphaAPI.q(\r\n\t\t\t`[:find (pull ?block [{:block/parents [:block/uid]}]) :in $ [?block-uid ...] :where [?block :block/uid ?block-uid]]`,\r\n\t\t\t[uid]\r\n\t\t)[0][0]\r\n\t\tconst UIDS = parentUIDs.parents.map((e: any) => e.uid)\r\n\t\tUIDS.shift()\r\n\t\treturn getPageNamesFromBlockUidList(UIDS) // if I fail. I fail.\r\n\t} catch (e) {\r\n\t\treturn null\r\n\t}\r\n}\r\nexport const updateBlock = async (\r\n\tblock_uid: s,\r\n\tblock_string: s,\r\n\tblock_expanded = true\r\n) => {\r\n\tblock_uid = block_uid.replace('((', '').replace('))', '')\r\n\treturn await window.roamAlphaAPI.updateBlock({\r\n\t\tblock: {\r\n\t\t\tuid: block_uid,\r\n\t\t\tstring: block_string.toString(),\r\n\t\t\topen: block_expanded,\r\n\t\t},\r\n\t})\r\n}\r\nexport const sleep = (ms: n) => new Promise(resolve => setTimeout(resolve, ms))\r\nexport const moveBlock = async (\r\n\tparent_uid: s,\r\n\tblock_order: n,\r\n\tblock_to_move_uid: s\r\n) => {\r\n\treturn window.roamAlphaAPI.moveBlock({\r\n\t\tlocation: { 'parent-uid': parent_uid, order: block_order },\r\n\t\tblock: { uid: block_to_move_uid },\r\n\t})\r\n}\r\nexport const createBlock = async (\r\n\tparent_uid: s,\r\n\tblock_order: n,\r\n\tblock_string: s,\r\n\tmanualUID = false\r\n) => {\r\n\tparent_uid = parent_uid.replace('((', '').replace('))', '')\r\n\tlet newUid = !manualUID\r\n\t\t? await window.roamAlphaAPI.util.generateUID()\r\n\t\t: manualUID // polymorphism man...\r\n\r\n\tawait window.roamAlphaAPI.createBlock({\r\n\t\tlocation: {\r\n\t\t\t'parent-uid': parent_uid,\r\n\t\t\torder: block_order,\r\n\t\t},\r\n\t\tblock: {\r\n\t\t\tstring: block_string.toString(),\r\n\t\t\tuid: newUid,\r\n\t\t},\r\n\t})\r\n\tawait sleep(10) //seems a brief pause is need for DB to register the write\r\n\treturn <const>{\r\n\t\tuid: newUid,\r\n\t\tparentUid: parent_uid,\r\n\t\torder: block_order,\r\n\t\tstring: block_string,\r\n\t}\r\n}\r\nexport const createUid = () => {\r\n\treturn window.roamAlphaAPI.util.generateUID()\r\n}\r\nexport const getPageUid = async (pageTitle: s): Promise<s> => {\r\n\tconst res = await window.roamAlphaAPI.q(\r\n\t\t`[:find (pull ?page [:block/uid])\r\n\t:where [?page :node/title \\\"${pageTitle}\\\"]]`\r\n\t)\r\n\treturn res.length ? res[0][0].uid : null\r\n}\r\nexport const createPage = async (pageTitle: s) => {\r\n\tlet pageUid = createUid()\r\n\tawait window.roamAlphaAPI.createPage({\r\n\t\tpage: { title: pageTitle, uid: pageUid },\r\n\t})\r\n\treturn pageUid\r\n}\r\nexport const createChildBlock = async (\r\n\tparentUid: s,\r\n\torder: n,\r\n\tchildString: s,\r\n\tchildUid: s\r\n) => {\r\n\treturn await window.roamAlphaAPI.createBlock({\r\n\t\tlocation: { 'parent-uid': parentUid, order: order },\r\n\t\tblock: { string: childString.toString(), uid: childUid },\r\n\t})\r\n}\r\nexport const allChildrenInfo = async (blockUid: s) => {\r\n\tlet results = await window.roamAlphaAPI.q(\r\n\t\t`[:find (pull ?parent [* {:block/children [:block/string :block/uid :block/order]}]) :where [?parent :block/uid \\\"${blockUid}\\\"]]`\r\n\t)\r\n\treturn results.length == 0 ? undefined : results\r\n}\r\nexport const sortObjectsByOrder = (o: any) => {\r\n\t//@ts-ignore\r\n\treturn o.sort((a, b) => a.order - b.order)\r\n}\r\nexport const ExpandBlock = async (block_uid: s, block_expanded: b) => {\r\n\treturn await window.roamAlphaAPI.updateBlock({\r\n\t\tblock: { uid: block_uid, open: block_expanded },\r\n\t})\r\n}\r\nexport const getPageNamesFromBlockUidList = async (blockUidList: string[]) => {\r\n\t//blockUidList ex ['sdfsd', 'ewfawef']\r\n\tconst rule =\r\n\t\t'[[(ancestor ?b ?a)[?a :block/children ?b]][(ancestor ?b ?a)[?parent :block/children ?b ](ancestor ?parent ?a) ]]'\r\n\tconst query = `[:find  (pull ?block [:block/uid :block/string])(pull ?page [:node/title :block/uid])\r\n\t\t\t\t\t\t\t\t\t :in $ [?block_uid_list ...] %\r\n\t\t\t\t\t\t\t\t\t :where\r\n\t\t\t\t\t\t\t\t\t  [?block :block/uid ?block_uid_list]\r\n\t\t\t\t\t\t\t\t\t [?page :node/title]\r\n\t\t\t\t\t\t\t\t\t (ancestor ?block ?page)]`\r\n\r\n\tconst results: THierarchy[] = await window.roamAlphaAPI.q(\r\n\t\tquery,\r\n\t\tblockUidList,\r\n\t\trule\r\n\t)\r\n\treturn results\r\n}\r\n/* ********************** */\r\nexport const isBlockRef = async (uid: s) => {\r\n\ttry {\r\n\t\tif (uid.startsWith('((')) {\r\n\t\t\tuid = uid.slice(2, uid.length)\r\n\t\t\tuid = uid.slice(0, -2)\r\n\t\t}\r\n\r\n\t\tconst block_ref = await window.roamAlphaAPI.q(`\r\n\t\t  [:find (pull ?e [:block/string])\r\n\t\t\t  :where [?e :block/uid \"${uid}\"]]`)\r\n\r\n\t\treturn block_ref.length > 0 && block_ref[0][0] != null ? true : false\r\n\t} catch (e) {\r\n\t\treturn ''\r\n\t}\r\n}\r\nexport const getBlockByPhrase = async (search_phrase: s) => {\r\n\treturn await window.roamAlphaAPI.q(\r\n\t\t`[:find (pull ?e [:block/uid :block/string] ) :where [?e :block/string ?contents][(clojure.string/includes? ?contents \"${search_phrase}\")]]`\r\n\t)\r\n}\r\nexport const simulateMouseOver = (element: El) => {\r\n\tmouseOverEvents.forEach(mouseEventType =>\r\n\t\telement.dispatchEvent(\r\n\t\t\tnew MouseEvent(mouseEventType, {\r\n\t\t\t\tview: window,\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcancelable: true,\r\n\t\t\t\tbuttons: 1,\r\n\t\t\t})\r\n\t\t)\r\n\t)\r\n}\r\nexport const setSideBarState = async (state: 1 | 2 | 3 | 4) => {\r\n\tswitch (state) {\r\n\t\tcase 1: //open left\r\n\t\t\tif (document.querySelector('.rm-open-left-sidebar-btn')) {\r\n\t\t\t\t//not open.. so open\r\n\t\t\t\tsimulateMouseOver(\r\n\t\t\t\t\tdocument.getElementsByClassName(\r\n\t\t\t\t\t\t'rm-open-left-sidebar-btn'\r\n\t\t\t\t\t)[0]\r\n\t\t\t\t)\r\n\t\t\t\tsetTimeout(async () => {\r\n\t\t\t\t\tconst el = document.getElementsByClassName(\r\n\t\t\t\t\t\t'rm-open-left-sidebar-btn'\r\n\t\t\t\t\t)[0] as HTMLElement\r\n\t\t\t\t\tel.click()\r\n\t\t\t\t}, 100)\r\n\t\t\t}\r\n\t\t\tbreak\r\n\t\tcase 2: //close left\r\n\t\t\tif (!document.querySelector('.rm-open-left-sidebar-btn')) {\r\n\t\t\t\t//open.. so close\r\n\t\t\t\tconst el = document.querySelector(\r\n\t\t\t\t\t'.roam-sidebar-content .bp3-icon-menu-closed'\r\n\t\t\t\t) as HTMLElement\r\n\t\t\t\tel.click()\r\n\t\t\t\tsimulateMouseOver(\r\n\t\t\t\t\tdocument.getElementsByClassName('roam-article')[0]\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t\tbreak\r\n\t\tcase 3: //open right\r\n\t\t\tawait window.roamAlphaAPI.ui.rightSidebar.open()\r\n\t\t\tbreak\r\n\t\tcase 4: //close right\r\n\t\t\tawait window.roamAlphaAPI.ui.rightSidebar.close()\r\n\t\t\tbreak\r\n\t}\r\n}\r\nexport const getBlockOrPageInfo = async (blockUid: s) => {\r\n\tconst results = await window.roamAlphaAPI.q(\r\n\t\t`[:find (pull ?e [ :node/title :block/string :block/children :block/uid :block/order { :block/children ... } ] ) :where [ ?e :block/uid \\\"${blockUid}\\\" ] ]`\r\n\t)\r\n\r\n\treturn results.length == 0 ? undefined : results\r\n}\r\nexport const getBlockStringByUID = async (\r\n\tblockUid: string\r\n): Promise<string> => {\r\n\tconst info = await window.roamAlphaAPI.q(\r\n\t\t`[:find (pull ?b [:block/string]):where [?b :block/uid \"${blockUid}\"]]`\r\n\t)\r\n\treturn info[0]?.[0]?.string\r\n}\r\nexport const getBlockParentUids_custom = async (\r\n\tuid: string\r\n): Promise<THierarchy[]> => {\r\n\ttry {\r\n\t\tconst parentUIDs = await window.roamAlphaAPI.q(\r\n\t\t\t`[:find (pull ?block [{:block/parents [:block/uid]}]) :in $ [?block-uid ...] :where [?block :block/uid ?block-uid]]`,\r\n\t\t\t[uid]\r\n\t\t)[0][0]\r\n\t\t// @ts-ignore\r\n\t\tconst UIDS: string[] = parentUIDs?.parents?.map(e => e.uid)\r\n\t\treturn getPageNamesFromBlockUidList(UIDS)\r\n\t} catch (e) {\r\n\t\treturn []\r\n\t}\r\n}\r\nexport const navigateToUiOrCreate = async (\r\n\tdestinationPage: s,\r\n\topenInSideBar = false,\r\n\tsSidebarType = 'outline'\r\n) => {\r\n\t//sSidebarType = block, outline, graph\r\n\tconst prefix = destinationPage.substring(0, 2)\r\n\tconst suffix = destinationPage.substring(\r\n\t\tdestinationPage.length - 2,\r\n\t\tdestinationPage.length\r\n\t)\r\n\tif (sSidebarType == 'outline' && prefix == '((' && suffix == '))') {\r\n\t\t//test if block ref to open in block mode\r\n\t\tsSidebarType = 'block' //chnage to block mode\r\n\t}\r\n\tif (\r\n\t\t(prefix == '[[' && suffix == ']]') ||\r\n\t\t(prefix == '((' && suffix == '))')\r\n\t) {\r\n\t\t// [[ ]] or (( ))\r\n\t\tdestinationPage = destinationPage.substring(\r\n\t\t\t2,\r\n\t\t\tdestinationPage.length - 2\r\n\t\t)\r\n\t}\r\n\r\n\tlet uid = await getPageUid(destinationPage)\r\n\r\n\tif (uid == null) {\r\n\t\t//test if UID for zooming in, if not create page\r\n\t\tuid = await getNodePageInfo(destinationPage)\r\n\t\tif (uid == null) {\r\n\t\t\t//not a page, nor UID so create page\r\n\t\t\tif (destinationPage.length > 255) {\r\n\t\t\t\tdestinationPage = destinationPage.substring(0, 254)\r\n\t\t\t}\r\n\t\t\tawait getOrCreatePageUid(destinationPage)\r\n\r\n\t\t\tawait sleep(50)\r\n\r\n\t\t\tuid = await getPageUid(destinationPage)\r\n\t\t} else {\r\n\t\t\tuid = destinationPage //seems to be a UID, zoom it\r\n\t\t}\r\n\t}\r\n\r\n\tif (openInSideBar == false) {\r\n\t\tdocument.location.href = baseUrl().href + '/' + uid\r\n\t} else {\r\n\t\tawait window.roamAlphaAPI.ui.rightSidebar.addWindow({\r\n\t\t\twindow: {\r\n\t\t\t\t'block-uid': uid,\r\n\t\t\t\ttype: sSidebarType,\r\n\t\t\t},\r\n\t\t})\r\n\t}\r\n\treturn uid\r\n\r\n\tfunction sleep(afterMiliseconds: n) {\r\n\t\treturn new Promise(resolve => setTimeout(resolve, afterMiliseconds))\r\n\t}\r\n\r\n\tfunction baseUrl() {\r\n\t\tconst url = new URL(window.location.href)\r\n\t\tconst parts = url.hash.split('/')\r\n\t\turl.hash = parts.slice(0, 3).concat(['page']).join('/')\r\n\t\treturn url\r\n\t}\r\n\r\n\tasync function getNodePageInfo(uid: s) {\r\n\t\tconst results = await window.roamAlphaAPI.q(\r\n\t\t\t`[:find (pull ?e [ :node/title :block/string :block/children :block/uid :block/order { :block/children ... } ] ) :where [ ?e :block/uid \\\"${uid}\\\" ] ]`\r\n\t\t)\r\n\t\treturn results.length == 0 ? undefined : results\r\n\t}\r\n}\r\n/* -------------------------------------------------------------------- */\r\nexport const openBlockInSidebar = (blockUid: s, windowType = 'outline') => {\r\n\t//windowType = block, outline, graph\r\n\treturn window.roamAlphaAPI.ui.rightSidebar.addWindow({\r\n\t\twindow: { type: windowType, 'block-uid': blockUid },\r\n\t})\r\n}\r\nexport const deleteBlock = (blockUid: s) => {\r\n\treturn window.roamAlphaAPI.deleteBlock({ block: { uid: blockUid } })\r\n}\r\nexport const rap = {\r\n\t/* DISCLAIMER - THE MAJORITY OF THIS FUNCTIONS I TOOK THEM FROM ...\r\n    https://github.com/yangkennyk/Roam42-Mirror/blob/5f9217e7f89c46b8cc409726aca744d1eca106e9/common/commonDatalog.js\r\n    https://github.com/dvargas92495/roam42/blob/35f75e3bfbcaea1cecb79250175f4730df3128b5/common/commonDatalog.js\r\n    https://github.com/dvargas92495/roam42/blob/7b20c8a80eda4ef8641916db4c252c7dbe58ba58/common/commonFunctions.js\r\n    https://davidbieber.com/snippets/2020-12-22-datalog-queries-for-roam-research/\r\n    https://www.zsolt.blog/2021/01/Roam-Data-Structure-Query.html\r\n    https://www.putyourleftfoot.in/introduction-to-the-roam-alpha-api\r\n    https://www.putyourleftfoot.in/roampagesearch\r\n    https://github.com/c3founder/Roam-Enhancement/blob/main/enhancedUtility.js\r\n    https://github.com/dvargas92495/roam42/blob/35f75e3bfbcaea1cecb79250175f4730df3128b5/common/commonDatalog.js\r\n    >>>> \"Why not use those already?\" Well, I learned some things in the process. I'd like to think that way. \r\n    Also, this piece of code is less dependent on external resources.\r\n    */\r\n\tgetBlockInfoByUIDM,\r\n\tsleep,\r\n\tupdateBlock,\r\n\tmoveBlock,\r\n\tcreateBlock,\r\n\tSetNumberedViewWithUid,\r\n\tCollapseDirectcChildren,\r\n\tExpandBlock,\r\n\tsortObjectsByOrder,\r\n\tgetBlockParentUids,\r\n\tgetPageNamesFromBlockUidList,\r\n\tgetPageUid,\r\n\tgetPageUidSync,\r\n\tcreateUid,\r\n\tcreatePage,\r\n\tcreateChildBlock,\r\n\tgetOrCreatePageUid,\r\n\tallChildrenInfo,\r\n\t//\r\n\tisBlockRef,\r\n\tgetBlockByPhrase,\r\n\tsimulateMouseOver,\r\n\tsetSideBarState,\r\n\tgetBlockOrPageInfo,\r\n\tgetBlockStringByUID,\r\n\tgetBlockParentUids_custom,\r\n\tnavigateToUiOrCreate,\r\n\topenBlockInSidebar,\r\n\tdeleteBlock,\r\n}\r\n//export default rap\r\n","export const fmtSplit = ' : '\r\nexport const PmtSplit = ' / '\r\nexport const cptrPrfx = '<',\r\n\tcptrSufx = '>'\r\n\r\nexport const chk = 'checkbox',\r\n\tsel = 'string',\r\n\tstr = 'string',\r\n\tpmt = 'prompt',\r\n\tint = 'integer',\r\n\tbol = 'boolean',\r\n\turl = 'url',\r\n\trng = 'range',\r\n\trad = 'radio'\r\n//prettier-ignore\r\nexport type Ttype = '' | 'checkbox' | 'string' | 'prompt' | 'integer' | 'boolean' | 'url' | 'range' | 'radio' | Array<Ttype>;\r\nexport interface T_SettingsAny extends TBlock, Tprimitive {\r\n\tsessionValue?: string | number | boolean\r\n\tUpdateSettingsBlockValue: (replaceWith: string) => Promise<void>\r\n}\r\nexport type T_settings_map = Map<string, T_SettingsAny>\r\n\r\nexport type Tprimitive = {\r\n\tuid: string\r\n\texamined: boolean\r\n\tparentKey: string\r\n\tstring: string\r\n\tchild: number\r\n\tindent: number\r\n\tinputType: Ttype\r\n\torder: number\r\n\tinlineObj: boolean\r\n}\r\ntype join = typeof fmtSplit | typeof PmtSplit\r\nexport type TBlock = Tprimitive & {\r\n\tjoin: join\r\n}\r\nexport type TInline = Tprimitive & TBlock\r\ntype Tk = {\r\n\tbaseValue: string | number\r\n\tinputType: Ttype\r\n}\r\nexport type TProperty = TBlock &\r\n\tTk & {\r\n\t\tsessionValue: string | number\r\n\t\tcaputuredValue: string\r\n\t\tUpdateSettingsBlockValue: (replaceWith: string) => Promise<void>\r\n\t}\r\nexport type Tdom = Tk & {\r\n\tdomEl: ''\r\n}\r\nexport type TDomProperty = TProperty & Tdom\r\n","import type {\r\n\tTInline,\r\n\tTBlock,\r\n\tTtype,\r\n\tTprimitive,\r\n\tTDomProperty,\r\n\tTdom,\r\n\tTProperty} from './types';\r\nimport {\r\n\tPmtSplit,\r\n\tpmt,\r\n\tfmtSplit,\r\n} from './types'\r\n\r\nexport function InlinePmt(blockContent = ''): TInline {\r\n\treturn <const>{\r\n\t\t//promptObj\r\n\t\t...BasePmt(),\r\n\t\tinlineObj: true,\r\n\t\tstring: blockContent,\r\n\t}\r\n}\r\nexport function BasePmt(blockContent = ''): TBlock {\r\n\treturn <const>{\r\n\t\t//promptObj\r\n\t\t...baseTmp(),\r\n\t\tjoin: PmtSplit,\r\n\t\tinputType: pmt,\r\n\t\tstring: blockContent,\r\n\t}\r\n}\r\n/*--------------------------------*/\r\nexport function BaseSetting(inputType?: Ttype): Tprimitive {\r\n\treturn baseTmp(inputType)\r\n}\r\n/*---------------------------------------------*/\r\nexport function BaseDom(baseValue = '', inputType: Ttype): TDomProperty {\r\n\treturn <const>{\r\n\t\t//domObj\r\n\t\t...subTemp(),\r\n\t\tdomEl: '',\r\n\t\tbaseValue: baseValue,\r\n\t\tinputType: inputType,\r\n\t\tinlineObj: false,\r\n\t}\r\n}\r\nexport function dom(baseValue = '', inputType: Ttype = ''): Tdom {\r\n\treturn <const>{\r\n\t\t//domObj\r\n\t\t...subTemp(),\r\n\t\tdomEl: '',\r\n\t\tbaseValue: baseValue,\r\n\t\tinputType: inputType,\r\n\t}\r\n}\r\n/*--------------------*/\r\nexport function BaseInitSetting(\r\n\tbaseValue: string | number = '',\r\n\tinputType: Ttype\r\n): TProperty {\r\n\treturn <const>{\r\n\t\t//subInputObj\r\n\t\t...subTemp(),\r\n\t\tbaseValue: baseValue,\r\n\t\tinputType: inputType,\r\n\t\tinlineObj: false,\r\n\t}\r\n}\r\n/*---------------------------------------------------------------*/\r\nfunction subTemp(baseValue = '', inputType?: Ttype): TProperty {\r\n\treturn <const>{\r\n\t\t...baseTmp(inputType),\r\n\t\tbaseValue: baseValue,\r\n\t\tsessionValue: undefined as any,\r\n\t\tcaputuredValue: '<>',\r\n\t\tjoin: fmtSplit,\r\n\t\tinlineObj: true,\r\n\t\tUpdateSettingsBlockValue: async function () {\r\n\t\t\tconsole.warn(\r\n\t\t\t\t//@tsignore-flag\r\n\t\t\t\t`Update block not implemented... ${this.uid} ${this.string}`\r\n\t\t\t)\r\n\t\t},\r\n\t}\r\n}\r\nfunction baseTmp(_inputType: Ttype = '', _string = ''): Tprimitive {\r\n\treturn <const>{\r\n\t\texamined: false,\r\n\r\n\t\tuid: '',\r\n\t\tparentKey: '',\r\n\t\tstring: _string,\r\n\r\n\t\tinputType: _inputType,\r\n\r\n\t\tindent: 0,\r\n\t\tchild: 0,\r\n\t\torder: 0,\r\n\r\n\t\tinlineObj: false,\r\n\t}\r\n}\r\n","import { chk, sel, rng, int, str, bol, url } from './types'\r\nimport {\r\n\tBasePmt,\r\n\tInlinePmt,\r\n\tBaseSetting,\r\n\tBaseDom,\r\n\tBaseInitSetting,\r\n\tdom,\r\n} from './block-types'\r\n\r\n/**\r\n * @summary YT_GIF_SETTINGS_PAGE\r\n * @type Object\r\n * @description Actual user settings\r\n */\r\n\r\nexport const YT_GIF_SETTINGS_PAGE = {\r\n\tWorkflow: {\r\n\t\tbaseKey: BasePmt(`BIP BOP . . .`),\r\n\t\tjoins: InlinePmt(\r\n\t\t\t`either \"ﾠ:ﾠ\" for actual settings or \"ﾠ/ﾠ\" for prompt guidelines`\r\n\t\t),\r\n\t\tparameters: {\r\n\t\t\tbaseKey: BasePmt(\r\n\t\t\t\t'\\n`(xxxuidxxx)` : `yt_gif_settings_key` : `<value>`'\r\n\t\t\t),\r\n\t\t\tuid: InlinePmt(\r\n\t\t\t\t\"\\n`(xxxuidxxx)`\\nunique per user data base, without it the settings can't be written on this page\"\r\n\t\t\t),\r\n\t\t\tkey: InlinePmt(\r\n\t\t\t\t'\\n`yt_gif_settings_key`\\nsecond way to know which setting to change'\r\n\t\t\t),\r\n\t\t\tvalue: InlinePmt(\r\n\t\t\t\t'\\n`<value>`\\nin many cases optional and most of the time a binary switch, on - off'\r\n\t\t\t),\r\n\t\t},\r\n\t\t//reach: InlinePmt(`Blocks below \"LogStatus\" will be ignored`),\r\n\t},\r\n\tdisplay: {\r\n\t\tbaseKey: BaseSetting(chk),\r\n\t\tsimulate_roam_research_timestamps: dom(),\r\n\t\tms_options: dom('clip_lifespan_format', sel),\r\n\t\tfmt_options: dom('avoid_redundancy', sel),\r\n\t\tyt_playback_speed: dom('Default', sel),\r\n\t},\r\n\r\n\ttimestamps: {\r\n\t\tbaseKey: BaseSetting(sel),\r\n\t\ttm_recovery: dom('1', chk),\r\n\t\ttm_seek_to: dom('strict'),\r\n\t\ttm_restore: dom('match'),\r\n\t\ttm_reset_on_removal: dom('container'),\r\n\r\n\t\ttm_loop_hierarchy: dom('disabled'),\r\n\t\ttm_loop_to: dom('start'),\r\n\t\ttm_loop_options: dom('skip,include_player'),\r\n\t\ttm_seek_action: dom('disabled'),\r\n\r\n\t\ttm_workflow_display: dom('default'),\r\n\t\ttm_workflow_grab: dom('HMS'),\r\n\t\ttm_options: dom(''),\r\n\t},\r\n\r\n\texperience: {\r\n\t\tbaseKey: BaseSetting(sel),\r\n\r\n\t\tinitialize_mode: dom('buffer'),\r\n\t\tawaiting_input_type: dom('mouseenter'),\r\n\t\txp_options: dom('thumbnail_as_bg'),\r\n\t},\r\n\r\n\tplayerSettings: {\r\n\t\tbaseKey: BaseSetting(sel),\r\n\r\n\t\tplay_style: dom('strict'),\r\n\t\tmute_style: dom('strict'),\r\n\t\tfullscreen_style: dom('disabled'),\r\n\r\n\t\turl_boundaries: dom('strict'),\r\n\t\turl_volume: dom('strict'),\r\n\r\n\t\tps_options: dom('mantain_last_active_player'),\r\n\t},\r\n\r\n\trange: {\r\n\t\tbaseKey: BaseSetting(rng),\r\n\t\ttimestamp_display_scroll_offset: {\r\n\t\t\tbaseKey: BaseDom('5', int),\r\n\t\t\ttdso_opt: InlinePmt(`seconds up to 60`),\r\n\t\t},\r\n\t\tend_loop_sound_volume: {\r\n\t\t\tbaseKey: BaseDom('50', int),\r\n\t\t\telsv_opt: InlinePmt(`integers from 0 to 100`),\r\n\t\t},\r\n\t\tiframe_buffer_slider: {\r\n\t\t\tbaseKey: BaseDom('10', int),\r\n\t\t\tibs_opt: InlinePmt(`integers from 1 to 30`),\r\n\t\t},\r\n\t},\r\n\tdefaultPlayerValues: {\r\n\t\tbaseKey: BaseSetting(),\r\n\t\tplayer_span: {\r\n\t\t\tbaseKey: BaseInitSetting('50%', str),\r\n\t\t\tps_opt: InlinePmt(\r\n\t\t\t\t`empty means 50% - only valid css units like px  %  vw`\r\n\t\t\t),\r\n\t\t\tpv_opt_2: InlinePmt(\r\n\t\t\t\t\"each block's url parameter `&sp=` has priority over this\"\r\n\t\t\t),\r\n\t\t},\r\n\t\tplayer_volume: {\r\n\t\t\tbaseKey: BaseInitSetting(40, int),\r\n\t\t\tvv_opt: InlinePmt(`integers from 0 to 100`),\r\n\t\t\tpv_opt: InlinePmt(\r\n\t\t\t\t\"each block's url parameter `&vl=` has priority over this\"\r\n\t\t\t),\r\n\t\t},\r\n\t\tplayer_interface_language: {\r\n\t\t\tbaseKey: BaseInitSetting('en', str),\r\n\t\t\tpil_opt: InlinePmt(\r\n\t\t\t\t\"each block's url parameter `&hl=` has priority over this\"\r\n\t\t\t),\r\n\t\t\tpli_guide: InlinePmt(\r\n\t\t\t\t`https://developers.google.com/youtube/player_parameters#:~:text=Sets%20the%20player%27s%20interface%20language.%20The%20parameter%20value%20is%20an%20ISO%20639-1%20two-letter%20language%20code%20or%20a%20fully%20specified%20locale.%20For%20example%2C%20fr%20and%20fr-ca%20are%20both%20valid%20values.%20Other%20language%20input%20codes%2C%20such%20as%20IETF%20language%20tags%20(BCP%2047)%20might%20also%20be%20handled%20properly.`\r\n\t\t\t),\r\n\t\t},\r\n\t\tplayer_captions_language: {\r\n\t\t\tbaseKey: BaseInitSetting('en', str),\r\n\t\t\tpcl_opt: InlinePmt(\r\n\t\t\t\t\"each block's url parameter `&cc=` has priority over this\"\r\n\t\t\t),\r\n\t\t\tpcl_guide: InlinePmt(\r\n\t\t\t\t`https://developers.google.com/youtube/player_parameters#:~:text=This%20parameter%20specifies%20the%20default%20language%20that%20the%20player%20will%20use%20to%20display%20captions.%20Set%20the%20parameter%27s%20value%20to%20an%20ISO%20639-1%20two-letter%20language%20code.`\r\n\t\t\t),\r\n\t\t},\r\n\t\tplayer_captions_on_load: {\r\n\t\t\tbaseKey: BaseInitSetting('true', bol),\r\n\t\t\tpcol_guide: InlinePmt(\r\n\t\t\t\t\"Browsers love to cash data... if set to -true- most certently you'll get caption on load, but it's hard to tell otherwise... Also, the mix and match of diferent `&hl=` and `&cc=` can cause to not show the captions on load\"\r\n\t\t\t),\r\n\t\t},\r\n\t},\r\n\tdefaultValues: {\r\n\t\tbaseKey: BaseSetting(),\r\n\t\toverride_roam_video_component: {\r\n\t\t\tbaseKey: BaseInitSetting('', [bol, str]),\r\n\t\t\torvc_opt: InlinePmt(\r\n\t\t\t\t'distinguish between `{{[[video]]:}}` from `{{[[yt-gif]]:}}` or \"both\" which is also valid'\r\n\t\t\t),\r\n\t\t},\r\n\t\tend_loop_sound_src: {\r\n\t\t\tbaseKey: BaseInitSetting(\r\n\t\t\t\t'https://freesound.org/data/previews/256/256113_3263906-lq.mp3',\r\n\t\t\t\turl\r\n\t\t\t),\r\n\t\t\telss_opt: InlinePmt(\r\n\t\t\t\t`src sound when yt gif makes a loop, empty if unwanted`\r\n\t\t\t),\r\n\t\t},\r\n\t\toverride_simulate_url_to_video_component: {\r\n\t\t\tbaseKey: BaseInitSetting('', bol),\r\n\t\t\torsuvc_opt: InlinePmt(\r\n\t\t\t\t`Because of browsers' external problems, I'd like to set this as the \"usage key\" replacement`\r\n\t\t\t),\r\n\t\t},\r\n\t\tYT_API_KEY_V3: {\r\n\t\t\tbaseKey: BaseInitSetting('', str),\r\n\t\t\tyakv_opt: InlinePmt(``),\r\n\t\t},\r\n\t\tInAndOutKeys: {\r\n\t\t\tbaseKey: BaseInitSetting('ctrlKey', str),\r\n\t\t\tiaok_opt: InlinePmt(\r\n\t\t\t\t`Any permutation of: altKey, shiftKey, ctrlKey \\nfollowed by a \",\" coma\\n\\nMiddle mouse button is on by default`\r\n\t\t\t),\r\n\t\t},\r\n\t},\r\n\tdropdownMenu: {\r\n\t\tbaseKey: BaseSetting(),\r\n\t\tddm_css_theme_input: {\r\n\t\t\tbaseKey: BaseInitSetting('', chk),\r\n\t\t\tct_opt: InlinePmt(`\"dark\" == \"true\" or \"light\" == \"false\"`),\r\n\t\t},\r\n\t},\r\n\tLogStatus: {\r\n\t\tbaseKey: BasePmt(`Everything looks alright :D`),\r\n\t\tDisplacedBlocks: {\r\n\t\t\tbaseKey: BasePmt(\r\n\t\t\t\t`invalid -> settings block - deleted - deprecated\\n**__If you encounter any nested blocks, it's extremely advisable that you delete them__**`\r\n\t\t\t),\r\n\t\t},\r\n\t\tUnknownBlocks: {\r\n\t\t\tbaseKey: BasePmt(\r\n\t\t\t\t`... to the YT GIF SETTINGS PAGE script algorithm-functions`\r\n\t\t\t),\r\n\t\t},\r\n\t\tls_: InlinePmt(`End of settings`),\r\n\t},\r\n}\r\nYT_GIF_SETTINGS_PAGE.Workflow.baseKey.string = `The ${\r\n\tObject.keys(YT_GIF_SETTINGS_PAGE).length\r\n} blocks will be -added on updates- and -removed if deprecated- automatically. The last parameters \"<>\" are customizable. 🐕 👋`\r\n\r\nexport type PAGE_TYPE = typeof YT_GIF_SETTINGS_PAGE\r\n","import { getPageUidSync, getOrCreatePageUid } from '$lib/utils-roam-alpha-api'\r\n\r\nexport const TARGET_PAGE = 'roam/js/kauderk/yt-gif/other'\r\nexport let TARGET_UID = getPageUidSync(TARGET_PAGE)\r\nexport async function TryToSetTargetUID() {\r\n\tTARGET_UID = await getOrCreatePageUid(TARGET_PAGE)\r\n}\r\n","export const ObjectKeys = <obj extends o>(o: obj) =>\r\n\tObject.keys(o) as (keyof typeof o)[]\r\n\r\nexport const ObjectValues = <obj extends o>(o: obj) =>\r\n\tObject.values(o) as Array<typeof o[keyof typeof o]>\r\n\r\nexport const ObjectEntries = <obj extends o>(o: obj) =>\r\n\tObject.entries(o) as [keyof typeof o, typeof o[keyof typeof o]][]\r\n\r\n// use: clone( <thing to copy> ) returns <new copy>\r\n// untested use at own risk\r\n// https://stackoverflow.com/a/54206471/13914180\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport function Clone<T extends object>(o: T, m?: any): T {\r\n\t// return non object values\r\n\tif ('object' !== typeof o) return o\r\n\t// m: a map of old refs to new object refs to stop recursion\r\n\tif ('object' !== typeof m || null === m) m = new WeakMap()\r\n\tlet n = m.get(o)\r\n\tif ('undefined' !== typeof n) return n\r\n\t// shallow/leaf clone object\r\n\tlet c = Object.getPrototypeOf(o).constructor\r\n\t// TODO: specialize copies for expected built in types i.e. Date etc\r\n\tswitch (c) {\r\n\t\t// shouldn't be copied, keep reference\r\n\t\tcase Boolean:\r\n\t\tcase Error:\r\n\t\tcase Function:\r\n\t\tcase Number:\r\n\t\tcase Promise:\r\n\t\tcase String:\r\n\t\tcase Symbol:\r\n\t\tcase WeakMap:\r\n\t\tcase WeakSet:\r\n\t\t\tn = o\r\n\t\t\tbreak\r\n\t\t// array like/collection objects\r\n\t\tcase Array:\r\n\t\t\t// @ts-ignore\r\n\r\n\t\t\tm.set(o, (n = o.slice(0)))\r\n\t\t\t// recursive copy for child objects\r\n\t\t\t// @ts-ignore\r\n\t\t\tn.forEach(function (v, i) {\r\n\t\t\t\tif ('object' === typeof v) n[i] = Clone(v, m)\r\n\t\t\t})\r\n\t\t\tbreak\r\n\t\tcase ArrayBuffer:\r\n\t\t\t// @ts-ignore\r\n\t\t\tm.set(o, (n = o.slice(0)))\r\n\t\t\tbreak\r\n\t\tcase DataView:\r\n\t\t\tm.set(\r\n\t\t\t\to,\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\t(n = new c(Clone(o.buffer, m), o.byteOffset, o.byteLength))\r\n\t\t\t)\r\n\t\t\tbreak\r\n\t\tcase Map:\r\n\t\tcase Set:\r\n\t\t\t// @ts-ignore\r\n\t\t\tm.set(o, (n = new c(Clone(Array.from(o.entries()), m))))\r\n\t\t\tbreak\r\n\t\tcase Int8Array:\r\n\t\tcase Uint8Array:\r\n\t\tcase Uint8ClampedArray:\r\n\t\tcase Int16Array:\r\n\t\tcase Uint16Array:\r\n\t\tcase Int32Array:\r\n\t\tcase Uint32Array:\r\n\t\tcase Float32Array:\r\n\t\tcase Float64Array:\r\n\t\t\t// @ts-ignore\r\n\t\t\tm.set(o, (n = new c(Clone(o.buffer, m), o.byteOffset, o.length)))\r\n\t\t\tbreak\r\n\t\t// use built in copy constructor\r\n\t\tcase Date:\r\n\t\tcase RegExp:\r\n\t\t\tm.set(o, (n = new c(o)))\r\n\t\t\tbreak\r\n\t\t// fallback generic object copy\r\n\t\tdefault:\r\n\t\t\tm.set(o, (n = Object.assign(new c(), o)))\r\n\t\t\t// recursive copy for child objects\r\n\t\t\tfor (c in n) if ('object' === typeof n[c]) n[c] = Clone(n[c], m)\r\n\t}\r\n\treturn n\r\n}\r\nexport const exitFullscreen = () => {\r\n\tif (document.exitFullscreen) {\r\n\t\tdocument.exitFullscreen() //@ts-ignore\r\n\t} else if (document.mozCancelFullScreen) {\r\n\t\t//@ts-ignore\r\n\t\tdocument.mozCancelFullScreen() //@ts-ignore\r\n\t} else if (document.webkitExitFullscreen) {\r\n\t\t//@ts-ignore\r\n\t\tdocument.webkitExitFullscreen()\r\n\t}\r\n}\r\nexport const isValidUrl = (value: string) => {\r\n\treturn /^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#]\\S*)?$/i.test(\r\n\t\tvalue\r\n\t)\r\n}\r\n// linearly maps value from the range (a..b) to (c..d)\r\nexport const mapRange = (\r\n\tvalue: number,\r\n\ta: number,\r\n\tb: number,\r\n\tc: number,\r\n\td: number\r\n) => {\r\n\t// first map value from (a..b) to (0..1)\r\n\tvalue = (value - a) / (b - a)\r\n\t// then map it from (0..1) to (c..d) and return it\r\n\treturn c + value * (d - c)\r\n}\r\nexport const RemovedElementObserver = (options: {\r\n\tel: HTMLElement | null\r\n\tOnRemovedFromDom_cb: Function\r\n\tdirectMatch?: boolean\r\n}) => {\r\n\tif (!options.el) {\r\n\t\treturn null\r\n\t}\r\n\tconst config = { subtree: true, childList: true }\r\n\tconst RemovedObserver = new MutationObserver(MutationRemoval_cb)\r\n\tRemovedObserver.observe(document.body, config)\r\n\treturn RemovedObserver\r\n\r\n\tasync function MutationRemoval_cb(\r\n\t\tmutationsList: MutationRecord[],\r\n\t\tobserver: MutationObserver\r\n\t) {\r\n\t\tfor (const mutation of mutationsList) {\r\n\t\t\tconst nodes = Array.from(mutation.removedNodes)\r\n\t\t\tconst directMatch = nodes.indexOf(options.el!) > -1\r\n\t\t\tconst parentMatch = nodes.some(parentEl =>\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\tparentEl.contains(options.el)\r\n\t\t\t)\r\n\r\n\t\t\tif (directMatch) {\r\n\t\t\t\tobserver.disconnect()\r\n\t\t\t\tif (options.directMatch)\r\n\t\t\t\t\tawait options.OnRemovedFromDom_cb(observer)\r\n\t\t\t\telse console.log(`node ${options.el} was directly removed!`)\r\n\t\t\t} else if (parentMatch) {\r\n\t\t\t\tawait options.OnRemovedFromDom_cb(observer)\r\n\t\t\t\tobserver.disconnect()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nexport const assertSelector = (sel: string) => {\r\n\tif (sel.includes('@')) {\r\n\t\t// if string begins with invalid character, such as '@---.com' -> '\\\\@---.com\\\\\r\n\t\tlet selArr = sel.split(' > ')\r\n\t\tfor (let i = 0; i < selArr.length; i++) {\r\n\t\t\tif (!selArr[i].includes('@')) continue\r\n\t\t\tconst rgx = new RegExp(/(@.*)\\.com/, 'gm')\r\n\t\t\tconst replaceWith = rgx.exec(selArr[i])?.[1]\r\n\t\t\tselArr[i] = selArr[i].replace(rgx, `\\\\${replaceWith}\\\\.com`)\r\n\t\t}\r\n\t\tsel = selArr.join(' > ')\r\n\t}\r\n\treturn sel\r\n}\r\nexport const ChangeElementType = (element: Element, newtype: string) => {\r\n\tlet newelement = document.createElement(newtype)\r\n\r\n\t// move children\r\n\twhile (element.firstChild) newelement.appendChild(element.firstChild)\r\n\r\n\t// copy attributes\r\n\tfor (let i = 0, a = element.attributes, l = a.length; i < l; i++) {\r\n\t\t// @ts-ignore\r\n\t\tnewelement.attributes[a[i].name] = a[i].value\r\n\t}\r\n\r\n\t// event handlers on children will be kept. Unfortunately, there is\r\n\t// no easy way to transfer event handlers on the element itself,\r\n\t// this would require a full management system for events, which is\r\n\t// beyond the scope of this answer. If you figure it out, do it here.\r\n\r\n\telement.parentNode?.replaceChild(newelement, element)\r\n\treturn newelement\r\n}\r\nexport const HMSToSecondsOnly = (str: string) => {\r\n\tif (/:/.test(str)) {\r\n\t\tlet p = str.split(':'),\r\n\t\t\ts = 0,\r\n\t\t\tm = 1\r\n\r\n\t\twhile (p.length > 0) {\r\n\t\t\ts += m * parseInt(p.pop()!, 10)\r\n\t\t\tm *= 60\r\n\t\t}\r\n\r\n\t\treturn s\r\n\t} else if (/h|m|s/.test(str)) {\r\n\t\tconst hms = str.split(/(?<=h)|(?<=m)|(?<=s)/)\r\n\r\n\t\treturn hms.reduce((acc, crr) => {\r\n\t\t\tlet t = parseInt(crr) || 0\r\n\r\n\t\t\tif (/s/.test(crr)) return t + acc\r\n\t\t\tif (/m/.test(crr)) return t * 60 + acc\r\n\t\t\tif (/h/.test(crr)) return t * 3600 + acc\r\n\r\n\t\t\treturn acc\r\n\t\t}, 0)\r\n\t}\r\n\r\n\treturn parseFloat(str)\r\n}\r\nexport const toggleClasses = (\r\n\tbol: boolean,\r\n\tclassNames: string[],\r\n\tel: Element\r\n) => {\r\n\tif (bol) {\r\n\t\tel.classList.add(...classNames)\r\n\t} else {\r\n\t\tel.classList.remove(...classNames)\r\n\t}\r\n}\r\nexport const removeIMGbg = (wrapper: HTMLElement) => {\r\n\twrapper.style.backgroundImage = 'none'\r\n}\r\nexport const simHover = () => {\r\n\treturn simMouseEvent('mouseenter')\r\n}\r\nexport const applyIMGbg = (wrapper: HTMLElement, url: string) => {\r\n\twrapper.style.backgroundImage = `url(${get_youtube_thumbnail(url)})`\r\n}\r\nexport const isTrue = (value: string | number | boolean) => {\r\n\tif (typeof value === 'string') value = value.trim().toLowerCase()\r\n\r\n\tswitch (value) {\r\n\t\tcase true:\r\n\t\tcase 'true':\r\n\t\tcase 1:\r\n\t\tcase '1':\r\n\t\tcase 'on':\r\n\t\tcase 'yes':\r\n\t\t\treturn true\r\n\t\tdefault:\r\n\t\t\treturn false\r\n\t}\r\n}\r\nexport function GetClosestRate(rates: number[], x: number) {\r\n\treturn [...rates].sort((a, b) => Math.abs(a - x) - Math.abs(b - x))[0]\r\n}\r\nexport const sleep = (ms: number) => {\r\n\treturn new Promise(resolve => setTimeout(resolve, ms))\r\n}\r\nexport const isElementVisible = (elem: HTMLElement) => {\r\n\t// https://stackoverflow.com/questions/19669786/check-if-element-is-visible-in-dom#:~:text=function%20isElementVisible(elem)%20%7B%0A%20%20%20%20if%20(!(elem%20instanceof%20Element))%20throw%20Error(%27DomUtil%3A%20elem%20is%20not%20an%20element.%27)%3B%0A%20%20%20%20const%20style%20%3D%20getComputedStyle(elem)%3B\r\n\tconst style = getComputedStyle(elem)\r\n\tif (style.display === 'none') return false\r\n\tif (style.visibility !== 'visible') return false\r\n\t// @ts-ignore\r\n\tif (style.opacity === 0) return false\r\n\tif (\r\n\t\telem.offsetWidth +\r\n\t\t\telem.offsetHeight +\r\n\t\t\telem.getBoundingClientRect().height +\r\n\t\t\telem.getBoundingClientRect().width ===\r\n\t\t0\r\n\t) {\r\n\t\treturn false\r\n\t}\r\n\tlet elementPoints = {\r\n\t\tcenter: {\r\n\t\t\tx: elem.getBoundingClientRect().left + elem.offsetWidth / 2,\r\n\t\t\ty: elem.getBoundingClientRect().top + elem.offsetHeight / 2,\r\n\t\t},\r\n\t\t'top-left': {\r\n\t\t\tx: elem.getBoundingClientRect().left,\r\n\t\t\ty: elem.getBoundingClientRect().top,\r\n\t\t},\r\n\t\t'top-right': {\r\n\t\t\tx: elem.getBoundingClientRect().right,\r\n\t\t\ty: elem.getBoundingClientRect().top,\r\n\t\t},\r\n\t\t'bottom-left': {\r\n\t\t\tx: elem.getBoundingClientRect().left,\r\n\t\t\ty: elem.getBoundingClientRect().bottom,\r\n\t\t},\r\n\t\t'bottom-right': {\r\n\t\t\tx: elem.getBoundingClientRect().right,\r\n\t\t\ty: elem.getBoundingClientRect().bottom,\r\n\t\t},\r\n\t}\r\n\r\n\tfor (let index in elementPoints) {\r\n\t\t// @ts-ignore\r\n\t\tlet point = elementPoints[index]\r\n\t\tif (point.x < 0) return false\r\n\t\tif (\r\n\t\t\tpoint.x >\r\n\t\t\t(document.documentElement.clientWidth || window.innerWidth)\r\n\t\t)\r\n\t\t\treturn false\r\n\t\tif (point.y < 0) return false\r\n\t\tif (\r\n\t\t\tpoint.y >\r\n\t\t\t(document.documentElement.clientHeight || window.innerHeight)\r\n\t\t)\r\n\t\t\treturn false\r\n\t\tlet pointContainer = document.elementFromPoint(point.x, point.y)\r\n\t\tif (pointContainer !== null) {\r\n\t\t\tdo {\r\n\t\t\t\tif (pointContainer === elem) return true\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t} while ((pointContainer = pointContainer.parentNode))\r\n\t\t}\r\n\t}\r\n\treturn false\r\n}\r\nexport const toggleAttribute = (\r\n\tbol: boolean,\r\n\tName: string,\r\n\tel: Element,\r\n\tvalue = ''\r\n) => {\r\n\tif (bol) {\r\n\t\tel.setAttribute(Name, value)\r\n\t} else {\r\n\t\tel.removeAttribute(Name)\r\n\t}\r\n}\r\nexport const closestBlockID = (el: Element) => {\r\n\treturn el?.closest('.rm-block__input')?.id\r\n}\r\nexport const getUniqueSelectorSmart = (el: Element) => {\r\n\tconst _sel = getUniqueSelector(el) as s\r\n\treturn assertSelector(_sel)\r\n}\r\nexport function isRendered(el: QrySearch) {\r\n\treturn document.body.contains(el!)\r\n}\r\n/* -------------------------------- */\r\nexport const pushSame = <T>(arr = Array<T>(), el: T) => {\r\n\tarr.push(el)\r\n\treturn arr\r\n}\r\nexport const convertHMS = (value: string | number) => {\r\n\tconst sec = parseInt(value.toString(), 10) // convert value to number if it's string\r\n\tlet hours: string | number = Math.floor(sec / 3600) // get hours\r\n\tlet minutes: string | number = Math.floor((sec - hours * 3600) / 60) // get minutes\r\n\tlet seconds: string | number = sec - hours * 3600 - minutes * 60 //  get seconds\r\n\t// add 0 if value < 10; Example: 2 => 02\r\n\tif (hours < 10) {\r\n\t\thours = '0' + hours\r\n\t}\r\n\tif (minutes < 10) {\r\n\t\tminutes = '0' + minutes\r\n\t}\r\n\tif (seconds < 10) {\r\n\t\tseconds = '0' + seconds\r\n\t}\r\n\treturn hours + ':' + minutes + ':' + seconds // Return is HH : MM : SS\r\n}\r\nexport const seconds2time = (seconds: number, useLetters?: boolean) => {\r\n\t// https://stackoverflow.com/questions/6312993/javascript-seconds-to-time-string-with-format-hhmmss#:~:text=Variation%20on%20a%20theme.%20Handles%20single%20digit%20seconds%20a%20little%20differently\r\n\tconst hours = Math.floor(seconds / 3600)\r\n\tlet minutes = Math.floor((seconds - hours * 3600) / 60)\r\n\tconst _seconds = seconds - hours * 3600 - minutes * 60\r\n\tlet time = ''\r\n\tconst t = {\r\n\t\th: useLetters ? 'h' : ':',\r\n\t\tm: useLetters ? 'm' : ':',\r\n\t\ts: useLetters ? 's' : '',\r\n\t}\r\n\tconst cero = useLetters ? '' : '0'\r\n\r\n\tif (hours != 0) time = hours + t.h\r\n\r\n\tif (!useLetters || minutes > 0) {\r\n\t\tconst _minutes = minutes < 10 ? cero + minutes : String(minutes)\r\n\t\ttime += _minutes + t.m\r\n\t}\r\n\r\n\tif (time === '') time = _seconds + t.s\r\n\telse if (!useLetters || _seconds > 0) {\r\n\t\ttime += _seconds < 10 ? cero + _seconds : String(_seconds)\r\n\t\ttime += t.s\r\n\t}\r\n\r\n\treturn time\r\n}\r\nexport const getUniqueSelector = (el: Element) => {\r\n\t// https://stackoverflow.com/questions/3620116/get-css-path-from-dom-element#:~:text=Doing%20a%20reverse%20CSS%20selector%20lookup%20is%20an%20inherently%20tricky%20thing.%20I%27ve%20generally%20come%20across%20two%20types%20of%20solutions%3A\r\n\tlet sSel,\r\n\t\taAttr = ['name', 'value', 'title', 'placeholder', 'data-*'], // Common attributes\r\n\t\taSel: string[] = [],\r\n\t\t// Derive selector from element\r\n\t\tgetSelector = function (el: Element) {\r\n\t\t\t// 1. Check ID first\r\n\t\t\t// NOTE: ID must be unique amongst all IDs in an HTML5 document.\r\n\t\t\t// https://www.w3.org/TR/html5/dom.html#the-id-attribute\r\n\t\t\tif (el.id) {\r\n\t\t\t\taSel.unshift('#' + el.id)\r\n\t\t\t\treturn true\r\n\t\t\t}\r\n\t\t\taSel.unshift((sSel = el.nodeName.toLowerCase()))\r\n\t\t\t// 2. Try to select by classes\r\n\t\t\tif (el.className) {\r\n\t\t\t\taSel[0] = sSel += '.' + el.className.trim().replace(/ +/g, '.')\r\n\t\t\t\tif (uniqueQuery()) return true\r\n\t\t\t}\r\n\t\t\t// 3. Try to select by classes + attributes\r\n\t\t\tfor (const element of aAttr) {\r\n\t\t\t\tif (element === 'data-*') {\r\n\t\t\t\t\t// Build array of data attributes\r\n\t\t\t\t\tconst aDataAttr = [].filter.call(\r\n\t\t\t\t\t\tel.attributes,\r\n\t\t\t\t\t\tfunction (attr: Attr) {\r\n\t\t\t\t\t\t\treturn attr.name.indexOf('data-') === 0\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t)\r\n\t\t\t\t\tfor (const element of aDataAttr) {\r\n\t\t\t\t\t\taSel[0] = sSel +=\r\n\t\t\t\t\t\t\t'[' +\r\n\t\t\t\t\t\t\t// @ts-ignore TODO:\r\n\t\t\t\t\t\t\telement.name +\r\n\t\t\t\t\t\t\t'=\"' +\r\n\t\t\t\t\t\t\t// @ts-ignore TODO:\r\n\t\t\t\t\t\t\telement.value +\r\n\t\t\t\t\t\t\t'\"]'\r\n\t\t\t\t\t\tif (uniqueQuery()) return true\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t} else if (el[element]) {\r\n\t\t\t\t\taSel[0] = sSel +=\r\n\t\t\t\t\t\t//@ts-ignore\r\n\t\t\t\t\t\t'[' + element + '=\"' + el[element] + '\"]'\r\n\t\t\t\t\tif (uniqueQuery()) return true\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// 4. Try to select by nth-of-type() as a fallback for generic elements\r\n\t\t\tlet elChild: El | null = el,\r\n\t\t\t\tsChild,\r\n\t\t\t\tn = 1\r\n\t\t\twhile ((elChild = elChild.previousElementSibling)) {\r\n\t\t\t\tif (elChild.nodeName === el.nodeName) ++n\r\n\t\t\t}\r\n\t\t\taSel[0] = sSel += ':nth-of-type(' + n + ')'\r\n\t\t\tif (uniqueQuery()) return true\r\n\t\t\t// 5. Try to select by nth-child() as a last resort\r\n\t\t\telChild = el\r\n\t\t\tn = 1\r\n\t\t\twhile ((elChild = elChild.previousElementSibling)) ++n\r\n\t\t\taSel[0] = sSel = sSel.replace(\r\n\t\t\t\t/:nth-of-type\\(\\d+\\)/,\r\n\t\t\t\tn > 1 ? ':nth-child(' + n + ')' : ':first-child'\r\n\t\t\t)\r\n\t\t\tif (uniqueQuery()) return true\r\n\t\t\treturn false\r\n\t\t},\r\n\t\t// Test query to see if it returns one element\r\n\t\tuniqueQuery = function () {\r\n\t\t\treturn document.querySelectorAll(aSel.join('>')).length === 1\r\n\t\t}\r\n\t// Walk up the DOM tree to compile a unique selector\r\n\twhile (el.parentNode) {\r\n\t\tif (getSelector(el)) return aSel.join(' > ')\r\n\t\t//@ts-ignore\r\n\t\tel = el.parentNode\r\n\t}\r\n}\r\nexport const getYouTubeVideoID = (url: string) => {\r\n\t//https://stackoverflow.com/questions/28735459/how-to-validate-youtube-url-in-client-side-in-text-box#:~:text=function%20matchYoutubeUrl(url)%20%7B\r\n\tconst urls = url.split(/(vi\\/|v=|\\/v\\/|youtu\\.be\\/|\\/embed\\/)/)\r\n\treturn urls[2] !== undefined ? urls[2].split(/[^0-9a-z_\\-]/i)[0] : urls[0]\r\n}\r\nexport const fetchTextTrimed = async (url: string) => {\r\n\t// https://stackoverflow.com/questions/27841112/how-to-remove-white-space-between-html-tags-using-javascript#:~:text=Ignoring%20%3C%20and%20%3E%20chars%20inside%20text%20nodes%3A\r\n\tconst str = await FetchText(url)\r\n\treturn trimHtml(str)\r\n}\r\nexport const trimHtml = (str: string) => {\r\n\tconst rexp = new RegExp('>[\\ts\\n ]*<', 'g')\r\n\treturn str.replace(rexp, '><')\r\n}\r\nexport const isNotZoomPath = (el: Element) => {\r\n\treturn !el.closest(\"[class*='rm-zoom']\")\r\n}\r\nexport const unshiftSame = <T>(arr: Array<T>, el: T) => {\r\n\tarr.unshift(el)\r\n\treturn arr\r\n}\r\nexport const simMouseEvent = (eventName: string) => {\r\n\treturn new MouseEvent(eventName, {\r\n\t\tview: window,\r\n\t\tbubbles: true,\r\n\t\tcancelable: true,\r\n\t})\r\n}\r\nexport const simMousedown = () => {\r\n\treturn simMouseEvent('mousedown')\r\n}\r\n//simHover,\r\nexport const simHoverOut = () => {\r\n\treturn simMouseEvent('mouseleave')\r\n}\r\nexport const includesAtlest = (\r\n\tarr: Array<string>,\r\n\tcontainer: string,\r\n\tdefaultString: string\r\n) => {\r\n\tconst match = arr.filter(s => container.includes(s))\r\n\treturn match.length > 0 ? match[0] : defaultString // filter first match or default\r\n}\r\nexport const hasOneDayPassed_localStorage = (itemKey: string) => {\r\n\t// https://stackoverflow.com/questions/11741979/run-code-once-a-day#:~:text=Using%20localStorage%20is%20the%20best%20way%20to%20go%20when%20you%20don%27t%20have%20a%20server%2C%20since%20the%20javascript%20code%20might%20restarted%20(by%20closing%20the%20tab%20and%20re%2Dopening)%2C%20therefore%20loosing%20the%20previous%20state.\r\n\t// get today's date. eg: \"7/37/2007\"\r\n\tlet date = new Date().toLocaleDateString()\r\n\r\n\t// if there's a date in localstorage and it's equal to the above:\r\n\t// inferring a day has yet to pass since both dates are equal.\r\n\tif (localStorage[itemKey] == date) return false\r\n\r\n\t// this portion of logic occurs when a day has passed\r\n\tlocalStorage[itemKey] = date\r\n\treturn true\r\n}\r\nexport const div = (classList = Array<string>()) => elm(classList, 'div')\r\nexport const span = (classList = Array<string>()) => elm(classList, 'span')\r\nexport const elm = (classList = Array<string>(), nodeType?: string) => {\r\n\tconst span = document.createElement(nodeType!)\r\n\tspan.classList.add(...classList!)\r\n\treturn span\r\n}\r\nexport const innerElsContains = (selector: string, text: string) => {\r\n\t// https://stackoverflow.com/questions/37098405/javascript-queryselector-find-div-by-innertext#:~:text=return%20Array.prototype.filter.call(elements%2C%20function(element)%7B\r\n\tlet elements = document.querySelectorAll(selector)\r\n\treturn Array.prototype.filter.call(elements, function (element) {\r\n\t\treturn RegExp(text).test(element.textContent)\r\n\t})\r\n}\r\n/**\r\n * Returns copy of itself with subOjects that directly include the filterKey\r\n * @param {String} subKeyAsFilter\r\n * @returns {Object} Filtered sub properties\r\n */\r\nexport const FilterSubObjByKey = (subKeyAsFilter: string, refObj: Object) => {\r\n\treturn (\r\n\t\tObject.keys(refObj)\r\n\t\t\t//@ts-ignore\r\n\t\t\t.filter(key => refObj[key].hasOwnProperty(subKeyAsFilter))\r\n\t\t\t.reduce((accObj, key) => {\r\n\t\t\t\t//@ts-ignore\r\n\t\t\t\taccObj[key] = refObj[key]\r\n\t\t\t\treturn accObj\r\n\t\t\t}, {})\r\n\t)\r\n}\r\n/* ----------------------------------------------- */\r\nexport const RemoveElsEventListeners = (withEventListeners: Element[]) => {\r\n\tfor (const el of withEventListeners) {\r\n\t\tel.replaceWith(el.cloneNode(true))\r\n\t}\r\n}\r\nexport const RemoveAllChildren = (node: Element) => {\r\n\t//https://stackoverflow.com/questions/3955229/remove-all-child-elements-of-a-dom-node-in-javascript#:~:text=var%20cNode%20%3D%20node.cloneNode(false)%3B\r\n\tconst cNode = node.cloneNode(false)\r\n\tnode.parentNode?.replaceChild(cNode, node)\r\n\treturn node\r\n}\r\n\r\nexport const print = (str = 'hi') => {\r\n\tconsole.log(str)\r\n}\r\nexport const linkClickPreviousElement = (el: Element) => {\r\n\tel.previousElementSibling?.setAttribute('for', el.id) // link clicks\r\n}\r\nexport const NoCash = (url: string) => {\r\n\treturn url + '?' + new Date().getTime()\r\n}\r\n\r\nexport const inViewportEls = (els: HTMLElement[]) => {\r\n\tlet matches = [],\r\n\t\telCt = els.length\r\n\r\n\tfor (let i = 0; i < elCt; ++i) {\r\n\t\tlet el = els[i],\r\n\t\t\tb = el.getBoundingClientRect(),\r\n\t\t\tc\r\n\r\n\t\tif (\r\n\t\t\tb.width > 0 &&\r\n\t\t\tb.height > 0 &&\r\n\t\t\tb.left + b.width > 0 &&\r\n\t\t\tb.right - b.width < window.outerWidth &&\r\n\t\t\tb.top + b.height > 0 &&\r\n\t\t\tb.bottom - b.width < window.outerHeight &&\r\n\t\t\t(c = window.getComputedStyle(el)) &&\r\n\t\t\tc.getPropertyValue('visibility') === 'visible' &&\r\n\t\t\tc.getPropertyValue('opacity') !== 'none'\r\n\t\t) {\r\n\t\t\tmatches.push(el)\r\n\t\t}\r\n\t}\r\n\treturn matches\r\n}\r\nexport const inViewportElsHard = (els: HTMLElement[]) => {\r\n\tlet matches = []\r\n\r\n\tfor (const el of els) {\r\n\t\tif (isElementVisible(el)) {\r\n\t\t\tmatches.push(el)\r\n\t\t}\r\n\t}\r\n\treturn matches\r\n}\r\nexport const emptyEl = (classList: string, el: HTMLElement) => {\r\n\tif (classList) el.classList.add(classList)\r\n\treturn el\r\n}\r\nexport const allIframeIDprfx = (iframeIDprfx: string) => {\r\n\treturn document.querySelectorAll(`[id*=${iframeIDprfx}]`)\r\n}\r\nexport const allIframeStyle = (style: string) => {\r\n\treturn document.querySelectorAll(`[${style}]`)\r\n}\r\nexport const isValidFetch = async (url: string) => {\r\n\ttry {\r\n\t\tconst response = await fetch(url, { cache: 'no-store' })\r\n\t\tif (!response.ok) throw new Error('Request failed.')\r\n\t\treturn [response, null]\r\n\t} catch (error) {\r\n\t\tconsole.log(`Your custom link ${url} is corrupt. ;c`)\r\n\t\treturn [null, error]\r\n\t}\r\n}\r\nexport const FetchText = async (url: string) => {\r\n\tconst [response, err] = await isValidFetch(NoCash(url)) // firt time fetching something... This is cool\r\n\t// @ts-ignore\r\n\tif (response) return await response.text()\r\n}\r\nexport const get_youtube_thumbnail = (\r\n\turl: string,\r\n\tquality?: 'low' | 'medium' | 'high'\r\n) => {\r\n\t//https://stackoverflow.com/questions/18681788/how-to-get-a-youtube-thumbnail-from-a-youtube-iframe\r\n\tif (url) {\r\n\t\tlet video_id, thumbnail: string, result\r\n\t\tif ((result = url.match(/youtube\\.com.*(\\?v=|\\/embed\\/)(.{11})/))) {\r\n\t\t\tvideo_id = result.pop()\r\n\t\t} else if ((result = url.match(/youtu.be\\/(.{11})/))) {\r\n\t\t\tvideo_id = result.pop()\r\n\t\t}\r\n\r\n\t\tif (video_id) {\r\n\t\t\tif (typeof quality == 'undefined') {\r\n\t\t\t\tquality = 'high'\r\n\t\t\t}\r\n\r\n\t\t\tlet quality_key = 'maxresdefault' // Max quality\r\n\t\t\tif (quality == 'low') {\r\n\t\t\t\tquality_key = 'sddefault'\r\n\t\t\t} else if (quality == 'medium') {\r\n\t\t\t\tquality_key = 'mqdefault'\r\n\t\t\t} else if (quality == 'high') {\r\n\t\t\t\tquality_key = 'hqdefault'\r\n\t\t\t}\r\n\r\n\t\t\tlet thumbnail =\r\n\t\t\t\t'https://img.youtube.com/vi/' +\r\n\t\t\t\tvideo_id +\r\n\t\t\t\t'/' +\r\n\t\t\t\tquality_key +\r\n\t\t\t\t'.jpg'\r\n\t\t\treturn thumbnail\r\n\t\t}\r\n\t}\r\n\treturn false\r\n}\r\n\r\nexport const isValidCSSUnit = (value: string) => {\r\n\t//  valid CSS unit types\r\n\tconst CssUnitTypes = [\r\n\t\t'em',\r\n\t\t'ex',\r\n\t\t'ch',\r\n\t\t'rem',\r\n\t\t'vw',\r\n\t\t'vh',\r\n\t\t'vmin',\r\n\t\t'vmax',\r\n\t\t'%',\r\n\t\t'cm',\r\n\t\t'mm',\r\n\t\t'in',\r\n\t\t'px',\r\n\t\t'pt',\r\n\t\t'pc',\r\n\t]\r\n\r\n\t// create a set of regexps that will validate the CSS unit value\r\n\tconst regexps = CssUnitTypes.map(unit => {\r\n\t\t// creates a regexp that matches '#unit' or '#.#unit' for every unit type\r\n\t\treturn new RegExp(`^[0-9]+${unit}$|^[0-9]+\\\\.[0-9]+${unit}$`, 'i')\r\n\t})\r\n\r\n\t// attempt to find a regexp that tests true for the CSS value\r\n\tconst isValid = regexps.find(regexp => regexp.test(value)) !== undefined\r\n\r\n\treturn isValid\r\n}\r\nconst util = {\r\n\tObjKeysAsArr: ObjectKeys,\r\n\tObjValsAsArr: ObjectValues,\r\n\tObjEntriesAsArr: ObjectEntries,\r\n\texitFullscreen,\r\n\tsleep,\r\n\tisTrue,\r\n\tgetUniqueSelectorSmart,\r\n\tassertSelector,\r\n\tHMSToSecondsOnly,\r\n\tRemovedElementObserver,\r\n\tmapRange,\r\n\tapplyIMGbg,\r\n\tremoveIMGbg,\r\n\tisElementVisible,\r\n\ttoggleClasses,\r\n\ttoggleAttribute,\r\n\tclosestBlockID,\r\n\tisValidUrl,\r\n\tChangeElementType,\r\n\t/* */\r\n\tsimHover,\r\n\tpushSame,\r\n\tconvertHMS,\r\n\tseconds2time,\r\n\tgetUniqueSelector,\r\n\tgetYouTubeVideoID,\r\n\tfetchTextTrimed,\r\n\ttrimHtml,\r\n\tisNotZoomPath,\r\n\tunshiftSame,\r\n\tsimMouseEvent,\r\n\tsimMousedown,\r\n\tsimHoverOut,\r\n\tincludesAtlest,\r\n\thasOneDayPassed_localStorage,\r\n\tdiv,\r\n\tspan,\r\n\telm,\r\n\tinnerElsContains,\r\n\tFilterSubObjByKey,\r\n\tRemoveElsEventListeners,\r\n\tRemoveAllChildren,\r\n\tprint,\r\n\tlinkClickPreviousElement,\r\n\tNoCash,\r\n\tinViewportEls,\r\n\tinViewportElsHard,\r\n\temptyEl,\r\n\tallIframeIDprfx,\r\n\tallIframeStyle,\r\n\tisValidFetch,\r\n\tFetchText,\r\n\tget_youtube_thumbnail,\r\n\tisValidCSSUnit,\r\n}\r\n//window.kauderk.util = util\r\n//export default util\r\n","import type { Ttype, T_settings_map } from './types'\r\nimport type { PAGE_TYPE } from './shape'\r\nimport { updateBlock } from '$lib/utils-roam-alpha-api'\r\nimport { TARGET_PAGE } from './keys'\r\nimport { Clone } from '$lib/utils'\r\n\r\nclass ILoop {\r\n\tparentKey: s = ''\r\n\tindent: n = -1\r\n\taccStr: s = ''\r\n\tnextStr: s = ''\r\n\tinputTypeFromBaseKey: Ttype = '' // so it can be used in the Func Rec_assignChildrenMissingValues\r\n\taccKeys?: string[] = [] // IParent\r\n}\r\ninterface IobjAssign {\r\n\tindent: n\r\n\torder: n\r\n\tinputTypeFromBaseKey?: Ttype\r\n}\r\n\r\nexport async function pageShape2BlockMap(page: PAGE_TYPE) {\r\n\tconst keyObjMap = <T_settings_map>new Map() // acc inside the Rec_func\r\n\tconst passAccObj = new ILoop()\r\n\tconst _page = Clone(page)\r\n\r\n\treturn <const>{\r\n\t\tpageAsText: await Rec_PageShape2BlockMap(_page, passAccObj, keyObjMap),\r\n\t\tkeyObjMap,\r\n\t\tpage: _page,\r\n\t}\r\n}\r\nasync function Rec_PageShape2BlockMap(\r\n\tnextObj: any,\r\n\taccObj: ILoop,\r\n\tmap: T_settings_map\r\n) {\r\n\tlet { accStr } = accObj\r\n\tlet funcGeneralOrder = -1\r\n\r\n\tconst { nextStr, indent } = accObj\r\n\tconst tab = `\\t`.repeat(indent < 0 ? 0 : indent)\r\n\r\n\taccStr = accStr + '\\n' + tab + nextStr\r\n\r\n\tfor (const key in nextObj) {\r\n\t\tconst RAW_OBJ = nextObj[key]\r\n\t\tif (!isAnObjectWith(nextObj, RAW_OBJ, key)) continue\r\n\r\n\t\tconst nextAccObj: ILoop = {\r\n\t\t\tparentKey: key,\r\n\r\n\t\t\tindent: indent + 1,\r\n\t\t\tinputTypeFromBaseKey: RAW_OBJ?.baseKey?.inputType,\r\n\r\n\t\t\taccStr: accStr,\r\n\t\t\tnextStr: RAW_OBJ.string || '',\r\n\t\t}\r\n\r\n\t\tif (key != 'baseKey') {\r\n\t\t\tmap.set(key, PassDirectSetting(RAW_OBJ, accObj))\r\n\t\t}\r\n\r\n\t\taccStr = await Rec_PageShape2BlockMap(nextObj[key], nextAccObj, map)\r\n\r\n\t\tconst getAssignObj = () => ({\r\n\t\t\tindent: nextAccObj.indent,\r\n\t\t\torder: Number(++funcGeneralOrder),\r\n\t\t})\r\n\r\n\t\t// 3. FIXME: Split the logic into two parts:\r\n\t\tif (RAW_OBJ.baseKey != undefined) {\r\n\t\t\tAssignBaseObj(RAW_OBJ, getAssignObj())\r\n\t\t}\r\n\t\t// InlinePmt and dom/setting so far // valid form baseKey? no, then keep same\r\n\t\telse if (RAW_OBJ.inlineObj == true) {\r\n\t\t\tAssignInlineObj(RAW_OBJ, {\r\n\t\t\t\t...getAssignObj(),\r\n\t\t\t\tinputTypeFromBaseKey: accObj.inputTypeFromBaseKey,\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\treturn accStr\r\n}\r\n// 🧱🧱🧱\r\nfunction AssignInlineObj(RAW_OBJ: any, obj: IobjAssign) {\r\n\tRAW_OBJ.order = obj.order\r\n\tRAW_OBJ.indent = obj.indent\r\n\r\n\tRAW_OBJ.inputType = RAW_OBJ.inputType\r\n\t\t? RAW_OBJ.inputType\r\n\t\t: obj.inputTypeFromBaseKey\r\n}\r\nfunction AssignBaseObj(RAW_OBJ: any, obj: IobjAssign) {\r\n\tRAW_OBJ.baseKey.order = obj.order // the property (name) is a wrapper, look on it's level to access the baseKey\r\n\tRAW_OBJ.baseKey.indent = obj.indent\r\n}\r\nfunction PassDirectSetting(RAW_OBJ: any, accObj: ILoop) {\r\n\tconst direct = RAW_OBJ?.baseKey ? RAW_OBJ.baseKey : RAW_OBJ\r\n\tdirect.parentKey = accObj.parentKey || TARGET_PAGE // alright\r\n\tif (direct.UpdateSettingsBlockValue) {\r\n\t\t// an actual setting ... most definitely an inline Object\r\n\t\tdirect.UpdateSettingsBlockValue = ClosureSettingsBlock(direct)\r\n\t}\r\n\treturn direct\r\n}\r\nfunction ClosureSettingsBlock(RAW_OBJ: any) {\r\n\treturn async function (replaceWith: s) {\r\n\t\tconst rgxValue = new RegExp(/<(.*?)>/, 'gm') // \"<XXX>\"\r\n\r\n\t\t// const preChange = entry.string + ''\r\n\t\tconst postChange = RAW_OBJ.string.replace(rgxValue, `<${replaceWith}>`)\r\n\t\t// well. don't make extra api calls\r\n\t\tif (postChange != RAW_OBJ.string) {\r\n\t\t\tRAW_OBJ.string = postChange\r\n\t\t\tRAW_OBJ.sessionValue = replaceWith\r\n\t\t\tawait updateBlock(RAW_OBJ.uid, RAW_OBJ.string)\r\n\t\t}\r\n\t}\r\n}\r\nfunction isAnObjectWith(nextObj: o, target: o, key: s) {\r\n\treturn (\r\n\t\tnextObj.hasOwnProperty(key) &&\r\n\t\ttarget &&\r\n\t\ttypeof target === 'object' &&\r\n\t\t!(target instanceof Array)\r\n\t)\r\n}\r\n","import { moveBlock } from '$lib/utils-roam-alpha-api'\r\nimport type { T_SettingsAny, TProperty } from './types'\r\n\r\n/* 🚙 🚙 🚙*/\r\n// prettier-ignore\r\n\r\nexport function AssignExamineProperty<T extends T_SettingsAny>(baseKeyObj: T, string: s, uid: s) {\r\n\treturn Object.assign(baseKeyObj, {\r\n\t\texamined: true,\r\n\t\tuid: uid,\r\n\t\tstring,\r\n\t}) as typeof baseKeyObj;\r\n}\r\nexport async function checkReorderBlockObj(\r\n\tparentUid: s,\r\n\tselfOrder: n,\r\n\tchildObjToMoveUID: TProperty\r\n) {\r\n\tconst validOrder = childObjToMoveUID.order\r\n\tconst validUid = childObjToMoveUID.uid\r\n\ttry {\r\n\t\tif (parentUid == validUid) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`STOP! Don't move block to itself =>         ${parentUid} ${childObjToMoveUID.string}`\r\n\t\t\t)\r\n\t\t}\r\n\t\tif (selfOrder != validOrder) {\r\n\t\t\tdebugger\r\n\t\t\tawait moveBlock(parentUid, validOrder, validUid)\r\n\t\t}\r\n\t} catch (err) {\r\n\t\tdebugger\r\n\t}\r\n}\r\n","import type { PAGE_TYPE } from './shape'\r\nimport { createBlock, createUid } from '$lib/utils-roam-alpha-api'\r\nimport type { TProperty, TDomProperty } from './types';\r\nimport { fmtSplit, cptrPrfx, cptrSufx } from './types'\r\nimport { TARGET_UID } from './keys'\r\nimport { checkReorderBlockObj, AssignExamineProperty } from './utils'\r\nArray.prototype.Last = function () {\r\n\treturn this[this.length - 1]\r\n}\r\n\r\nclass IBaseAcc {\r\n\taccStr: string = ''\r\n\tnextStr: string = ''\r\n\taccKeys: string[] = []\r\n\taccHierarchyUids: string[] = []\r\n\tparentKey: string = '' // IRecursiveAcc\r\n\ttab: string = ''\r\n\tappenAccStr: () => string = appenAccStr\r\n}\r\ninterface IManualStt {\r\n\tm_uid: string\r\n\tm_strArr: Array<string>\r\n\tm_order: number\r\n\tm_join?: string\r\n}\r\n\r\nexport async function CreateMissingBLocks(page: PAGE_TYPE) {\r\n\t// 0.\r\n\tconst ACC_OBJ = new IBaseAcc()\r\n\r\n\t// 1.\r\n\treturn await Rec_CreateMissingBLocks(page, ACC_OBJ)\r\n}\r\nasync function Rec_CreateMissingBLocks(nextObj: any, accObj: IBaseAcc) {\r\n\tlet { accStr } = accObj\r\n\taccStr = accObj.appenAccStr()\r\n\tlet hierarchyUids = Array<string>()\r\n\r\n\tfor (const key in nextObj) {\r\n\t\tlet RAW_OBJ = nextObj[key]\r\n\r\n\t\tif (!isAnObjectWith(RAW_OBJ, key, nextObj)) continue\r\n\r\n\t\tif (key == 'baseKey') {\r\n\t\t\tif (RAW_OBJ.examined == false)\r\n\t\t\t\tRAW_OBJ = await createBaseKey(RAW_OBJ, accObj)\r\n\r\n\t\t\thierarchyUids = [...hierarchyUids, RAW_OBJ?.uid]\r\n\t\t}\r\n\r\n\t\tconst nextAccObj: IBaseAcc = {\r\n\t\t\tparentKey: key,\r\n\t\t\taccKeys: [...accObj.accKeys, key],\r\n\t\t\taccHierarchyUids: [...accObj.accHierarchyUids, ...hierarchyUids],\r\n\t\t\taccStr: accStr,\r\n\t\t\tnextStr: RAW_OBJ.string || '',\r\n\t\t\tappenAccStr,\r\n\t\t\ttab: '',\r\n\t\t}\r\n\r\n\t\taccStr = await Rec_CreateMissingBLocks(nextObj[key], nextAccObj) // recursion with await - 🤯\r\n\r\n\t\tif (RAW_OBJ.examined == false) {\r\n\t\t\tRAW_OBJ = await createInlineSetting(\r\n\t\t\t\tnextAccObj,\r\n\t\t\t\tRAW_OBJ,\r\n\t\t\t\thierarchyUids.Last()\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\r\n\treturn accStr\r\n}\r\n// 🧱🧱🧱\r\nasync function createBaseKey(nestedPpt: TDomProperty, accObj: IBaseAcc) {\r\n\tlet preStr: string\r\n\tconst prntKeyToInlineKey = accObj.parentKey\r\n\r\n\tif (nestedPpt.baseValue != undefined) {\r\n\t\t// in most cases it't children will add up information about it\r\n\t\tpreStr = validThirdParameterSplit(nestedPpt)\r\n\t}\r\n\r\n\t// conventional - property that wraps others\r\n\telse {\r\n\t\tpreStr = nestedPpt.string\r\n\t}\r\n\r\n\tconst manualStt: IManualStt = {\r\n\t\tm_uid: accObj.accHierarchyUids.Last() || TARGET_UID,\r\n\t\tm_strArr: preStr ? [prntKeyToInlineKey, preStr] : [prntKeyToInlineKey],\r\n\t\tm_order: nestedPpt.order,\r\n\t}\r\n\t// prettier-ignore\r\n\tnestedPpt = await UIBlockCreation(nestedPpt, manualStt) as TDomProperty;\r\n\treturn nestedPpt\r\n}\r\nfunction isAnObjectWith(nestedPpt: any, property: s, nextObj: any) {\r\n\treturn (\r\n\t\tnextObj.hasOwnProperty(property) &&\r\n\t\t//@tsignore-flag\r\n\t\ttypeof nextObj[property] === 'object' &&\r\n\t\t//@tsignore-flag\r\n\t\tnextObj[property] != null &&\r\n\t\t!(nestedPpt instanceof Array)\r\n\t)\r\n}\r\nasync function createInlineSetting(\r\n\tnextAccObj: IBaseAcc,\r\n\tnestedPpt: TProperty,\r\n\tm_uid: s\r\n) {\r\n\tconst manualStt = {\r\n\t\tm_uid: m_uid,\r\n\t\tm_strArr: [\r\n\t\t\tnextAccObj.accKeys.Last(),\r\n\t\t\tvalidThirdParameterSplit(nestedPpt),\r\n\t\t],\r\n\t\tm_order: nestedPpt.order,\r\n\t}\r\n\r\n\tnestedPpt = (await UIBlockCreation(nestedPpt, manualStt)) as TProperty\r\n\treturn nestedPpt\r\n}\r\nasync function UIBlockCreation(keyObj: TProperty, manual: IManualStt) {\r\n\tconst { m_order, m_uid, m_join, m_strArr } = manual\r\n\tconst { uid, string } = fmtSettings(m_strArr, m_join || keyObj.join)\r\n\tconst { order: selfOrder } = keyObj\r\n\r\n\tawait createBlock(\r\n\t\tm_uid || TARGET_UID,\r\n\t\tm_order || selfOrder || 10000,\r\n\t\tstring,\r\n\t\tuid\r\n\t)\r\n\tawait checkReorderBlockObj(m_uid, m_order, keyObj)\r\n\treturn AssignExamineProperty(keyObj, string, uid)\r\n\t//#region local utils\r\n\tfunction fmtSettings(strArr: s[], splitter = fmtSplit) {\r\n\t\tconst manualUID = createUid()\r\n\t\tconst preBlockStr = [`(${manualUID})`, ...strArr]\r\n\t\tconst blockStr = preBlockStr.join(splitter)\r\n\t\treturn <const>{\r\n\t\t\tuid: manualUID,\r\n\t\t\tstring: blockStr,\r\n\t\t}\r\n\t}\r\n\t//#endregion\r\n}\r\nfunction validThirdParameterSplit(nestedPpt: TProperty) {\r\n\tif (nestedPpt.join == fmtSplit) {\r\n\t\tconst value = (nestedPpt.sessionValue = nestedPpt.baseValue)\r\n\t\treturn (nestedPpt.caputuredValue = `${cptrPrfx}${value}${cptrSufx}`) // BIG BOI  <value>\r\n\t}\r\n\t//else if (nestedPpt.join == PmtSplit) {\r\n\treturn nestedPpt.string\r\n\t//}\r\n}\r\nfunction appenAccStr(this: IBaseAcc): string {\r\n\treturn this.accStr + '\\n' + this.nextStr\r\n}\r\n","import {\r\n\tgetBlockInfoByUIDM,\r\n\tgetBlockParentUids,\r\n\tupdateBlock,\r\n\tsleep,\r\n\tmoveBlock,\r\n} from '$lib/utils-roam-alpha-api'\r\nimport type {\r\n\tT_SettingsAny,\r\n\tTBlock,\r\n\tTProperty,\r\n\tT_settings_map} from './types';\r\nimport {\r\n\tPmtSplit,\r\n\tfmtSplit,\r\n\tcptrPrfx,\r\n\tcptrSufx,\r\n\tint\r\n} from './types'\r\nimport { TARGET_UID, TARGET_PAGE } from './keys'\r\nimport { AssignExamineProperty } from './utils'\r\n\r\nclass TAcc {\r\n\tkeyFromLevel0: s = ''\r\n\tselfOrder: n = 0\r\n}\r\nclass TRes {\r\n\taccStr: s = ''\r\n\tkeyObjMap: T_settings_map = new Map()\r\n\tpendingBLocks2Displace: Function[] = []\r\n\tsingleKeyEntries: string[] = []\r\n}\r\ninterface IParentState {\r\n\tdisplaced: boolean // can loop throughout its children\r\n\toverrideKey?: any\r\n}\r\ninterface IKeyMap {\r\n\tkey: string\r\n\tmap: T_settings_map\r\n\thas: (key?: string) => boolean\r\n\tget: (key?: string) => T_SettingsAny | undefined\r\n\tcrrUID: string\r\n}\r\ninterface ICredential {\r\n\tsuccess: boolean\r\n\toutKey: string\r\n\toutUid: string\r\n}\r\ninterface IReadKeys {\r\n\tkey: string\r\n\tnextStr: string\r\n\tuid: StrSearch\r\n\tjoin: string\r\n\tcrrUID: string\r\n\tsplitedStrArr: s[]\r\n}\r\ninterface IWriteKeys {\r\n\tvalue: string\r\n\tcaputuredValue: string\r\n}\r\ninterface IParentKeys {\r\n\tget: () => IParentState\r\n\tuid: () => StrSearch\r\n\tindent: () => number\r\n\taccObj: () => TAcc\r\n}\r\n\r\nexport async function Read_Write_SettingsPage(\r\n\tUID: s,\r\n\tkeyObjMap = <T_settings_map>new Map()\r\n) {\r\n\tkeyObjMap.set(TARGET_PAGE, <T_SettingsAny>{ uid: TARGET_UID }) // the most special cases of them all... the actual page\r\n\r\n\tconst ChildrenHierarchy = await getBlockInfoByUIDM(UID, true)\r\n\r\n\tconst accObj = new TAcc()\r\n\tlet accRes = { ...new TRes(), keyObjMap }\r\n\r\n\tif (!ChildrenHierarchy) {\r\n\t\tconsole.error(`No ChildrenHierarchy for uid: ${UID}`)\r\n\t\treturn accRes.pendingBLocks2Displace // 'Page is empty'\r\n\t}\r\n\r\n\taccRes = await Rec_Read_Write_SettingsPage(\r\n\t\tChildrenHierarchy[0][0],\r\n\t\taccObj,\r\n\t\taccRes\r\n\t)\r\n\r\n\treturn accRes.pendingBLocks2Displace\r\n}\r\nasync function Rec_Read_Write_SettingsPage(\r\n\tblockInfo: TBlockInfoRec,\r\n\taccObj: TAcc,\r\n\taccRes: TRes\r\n) {\r\n\tconst nextStr = blockInfo.string || blockInfo.title || ''\r\n\tlet parentState: IParentState = {\r\n\t\tdisplaced: false, // to be changed inside the pending funcs\r\n\t\toverrideKey: null,\r\n\t}\r\n\r\n\tconst keywords = getKeywordsFromBlockString(nextStr)\r\n\tconst readKeys: IReadKeys = { ...keywords, nextStr, crrUID: blockInfo.uid }\r\n\tconst writeKeys: IWriteKeys = { ...keywords }\r\n\tconst parentKeys: IParentKeys = {\r\n\t\tuid: () => keywords.uid,\r\n\t\tindent: () => position.indent,\r\n\t\tget: () => parentState,\r\n\t\taccObj: () => accObj,\r\n\t}\r\n\tconst mapObj: IKeyMap = {\r\n\t\tkey: keywords.key,\r\n\t\tmap: accRes.keyObjMap,\r\n\t\thas: (k?: string) => accRes.keyObjMap.has(k ?? mapObj.key),\r\n\t\tget: (k?: string) => accRes.keyObjMap.get(k ?? mapObj.key),\r\n\t\tcrrUID: blockInfo.uid, // could be it's own obj\r\n\t}\r\n\r\n\tconst position = await RelativeChildInfo(mapObj)\r\n\t// prettier-ignore\r\n\tconst TRY = await ValidateTargetBlockObj(mapObj, accRes.singleKeyEntries, readKeys, blockInfo, parentState)\r\n\t// prettier-ignore\r\n\tconst credentials = TRY.credentials ?? (await ReadWriteBlock(readKeys, writeKeys, TRY.block))\r\n\r\n\tif (TRY.block) {\r\n\t\tconst ok = validNestFromThePast(TRY.block, parentKeys)\r\n\t\taccRes.pendingBLocks2Displace.push(async () =>\r\n\t\t\tOrderPossiblyMistakenBlock(ok, TRY.block, parentKeys, mapObj)\r\n\t\t)\r\n\t}\r\n\t// prettier-ignore\r\n\tif (credentials.success) {\r\n\t\taccRes.accStr = accRes.accStr + '\\n' + position.tab + nextStr // outside of here, you'll the page before the changes\r\n\t}\r\n\telse if (wrongBlock(credentials)) {\r\n\t\t// prettier-ignore\r\n\t\tconst asyncFunc = HandleFutureMove(credentials.outUid, parentKeys, readKeys, mapObj)\r\n\t\tif (asyncFunc) {\r\n\t\t\taccRes.pendingBLocks2Displace.push(asyncFunc)\r\n\t\t}\r\n\t}\r\n\r\n\tfor (const child of blockInfo.children ?? []) {\r\n\t\tconst nextAccObj: TAcc = {\r\n\t\t\tkeyFromLevel0: blockInfo.overrideKey || keywords.key || TARGET_PAGE,\r\n\t\t\tselfOrder: child.order,\r\n\t\t}\r\n\r\n\t\taccRes = await Rec_Read_Write_SettingsPage(child, nextAccObj, accRes)\r\n\t}\r\n\r\n\treturn accRes\r\n}\r\n// 🧱🧱🧱\r\nfunction wrongBlock(c: ICredential) {\r\n\treturn c.outUid != TARGET_UID && c.outKey != TARGET_PAGE\r\n}\r\n// var from obj .1\r\nfunction getKeywordsFromBlockString(nextStr: s) {\r\n\tconst rgxUid = new RegExp(/\\(([^\\)]+)\\)/, 'gm') //(XXXXXXXX)\r\n\tconst join = includesAtlest(nextStr, [PmtSplit, fmtSplit])\r\n\tconst splitedStrArr = nextStr.split(join) // deconstruct\r\n\tconst everyFirstKeyword = splitedStrArr.map(word => word.split(' ')[0]) // returns array of words\r\n\r\n\tconst preUid = rgxUid.exec(everyFirstKeyword[0])\r\n\tconst p_uid: StrSearch = preUid?.[1]\r\n\r\n\tconst { value, caputureValueOk } = tryTrimCapturedValue(\r\n\t\teveryFirstKeyword[2] || ''\r\n\t)\r\n\r\n\treturn <const>{\r\n\t\tuid: p_uid,\r\n\r\n\t\tkey: everyFirstKeyword[1],\r\n\r\n\t\tcaputuredValue: everyFirstKeyword[2],\r\n\t\tvalue: value,\r\n\t\tcaputureValueOk,\r\n\r\n\t\tsplitedStrArr,\r\n\r\n\t\tjoin,\r\n\t}\r\n}\r\nfunction tryTrimCapturedValue(string: s) {\r\n\tconst prefix = string.substring(0, 1)\r\n\tconst suffix = string.substring(string.length - 1, string.length)\r\n\tif (prefix == cptrPrfx && suffix == cptrSufx) {\r\n\t\t// < >\r\n\t\treturn <const>{\r\n\t\t\tvalue: string.substring(1, string.length - 1),\r\n\t\t\tcaputureValueOk: true,\r\n\t\t}\r\n\t}\r\n\treturn <const>{\r\n\t\tvalue: string,\r\n\t\tcaputureValueOk: false,\r\n\t}\r\n}\r\nfunction includesAtlest(string: s, Arr: s[]) {\r\n\tconst match = Arr.filter(s => string.includes(s))\r\n\treturn match.length > 0 ? match[0] : fmtSplit // filter first match or default\r\n}\r\n// var from obj .2\r\nasync function RelativeChildInfo(mapObj: IKeyMap) {\r\n\tconst tab = '\\t'\r\n\tlet position = { indent: 0, parentUid: '' } // TODO: did lots of changes, don't know this even works\r\n\r\n\tif (mapObj.has()) {\r\n\t\t// tryto get existing setting, from assignChildrenMissingValues()\r\n\t\tconst searchBlock = mapObj.get()! // @tsignore-flag No, typescript, this is not undefined\r\n\r\n\t\tposition = mapObj.map.has(searchBlock.parentKey)\r\n\t\t\t? HandleNewParentUID(searchBlock, mapObj) // search within\r\n\t\t\t: await getRelativeInfoAsync(mapObj.crrUID) // find new one\r\n\t}\r\n\r\n\tif (!position.parentUid)\r\n\t\tposition = await getRelativeInfoAsync(mapObj.crrUID)\r\n\r\n\treturn <const>{\r\n\t\ttab: tab.repeat(position.indent),\r\n\t\t...position,\r\n\t}\r\n}\r\nfunction HandleNewParentUID(searchBlock: T_SettingsAny, mapObj: IKeyMap) {\r\n\treturn <const>{\r\n\t\tindent: searchBlock.indent,\r\n\t\tparentUid: mapObj.get(searchBlock.parentKey)?.uid ?? '',\r\n\t}\r\n}\r\n\r\nasync function getRelativeInfoAsync(crrUID: s) {\r\n\tlet parentsHierarchy = await getBlockParentUids(crrUID)\r\n\t//if (!parentsHierarchy) console.error(`uid: ${crrUID} has no parents`)\r\n\r\n\treturn <const>{\r\n\t\tindent: parentsHierarchy?.length ?? 0,\r\n\t\tparentUid: parentsHierarchy ? parentsHierarchy[0]?.[0].uid : TARGET_UID, // if undefined - most defenetly it's the direct child (level 0) of page\r\n\t}\r\n}\r\n\r\n/* ********************************************* */\r\n// main logic\r\nasync function ReadWriteBlock(\r\n\treadKeys: IReadKeys,\r\n\twriteKeys: IWriteKeys,\r\n\tblock: T_SettingsAny\r\n) {\r\n\t// 1.2.1 make sure to read useful session values\r\n\tconst { key, nextStr, uid, crrUID, join, splitedStrArr } = readKeys\r\n\tlet p_string = nextStr\r\n\tconst { v_uid, uidOk } = await validateBlockUid(uid, crrUID)\r\n\tconst { v_string, stringOK } = await validateBlockContent(\r\n\t\tblock as TBlock,\r\n\t\tsplitedStrArr\r\n\t)\r\n\r\n\tif (!uidOk || !stringOK) {\r\n\t\tp_string = await UpdateRoamBlock_Settings(key, readKeys, v_string) // valid string for prompts\r\n\t}\r\n\r\n\tAssignExamineProperty(block, p_string, v_uid) // write\r\n\r\n\tif (join == fmtSplit && block.hasOwnProperty('sessionValue')) {\r\n\t\tObject.assign(block, UpdateInlineObj(writeKeys, block as TProperty)) // for and actual setting\r\n\t}\r\n\r\n\treturn <const>{\r\n\t\tsuccess: true,\r\n\t\toutKey: key,\r\n\t\toutUid: v_uid,\r\n\t}\r\n}\r\nasync function ValidateTargetBlockObj(\r\n\tmapObj: IKeyMap,\r\n\tsingleKeyEntries: string[],\r\n\treadKeys: IReadKeys,\r\n\tblockInfo: TBlockInfoRec,\r\n\tparentState: IParentState\r\n) {\r\n\tconst credentials: ICredential = {\r\n\t\tsuccess: false,\r\n\t\toutKey: mapObj.key,\r\n\t\toutUid: mapObj.crrUID,\r\n\t}\r\n\t// 1.1\r\n\tif (mapObj.key && singleKeyEntries.includes(mapObj.key)) {\r\n\t\t// someone made a hard copy of a setting, deal with it\r\n\t\tif (mapObj.has()) {\r\n\t\t\tconst invalidKey = `${mapObj.key}`.concat('_InvalidDuplicate')\r\n\t\t\tconst n_string = await UpdateRoamBlock_Settings(\r\n\t\t\t\tinvalidKey,\r\n\t\t\t\treadKeys\r\n\t\t\t)\r\n\t\t\tdebugger\r\n\t\t\t//accObj.RoamObj.string = n_string;\r\n\t\t\tblockInfo.string = n_string\r\n\t\t\tparentState.overrideKey = invalidKey // it's facinating that this value will be lost in the recursion void - my understanding is that I can't grasp this shit... but attaching the value to a Rec_Fuc param as it's property... THAT! that will do the job... Facinating stuff indeed...\r\n\t\t\tblockInfo.overrideKey = invalidKey\r\n\r\n\t\t\treturn <const>{\r\n\t\t\t\tblock: null,\r\n\t\t\t\tcredentials: {\r\n\t\t\t\t\t...credentials,\r\n\t\t\t\t\toutKey: invalidKey,\r\n\t\t\t\t} as ICredential,\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// 1.0\r\n\tsingleKeyEntries.push(mapObj.key) // keep track of any possible duplicates\r\n\tconst block = mapObj.get()\r\n\r\n\t// 1.2\r\n\tif (!(block && mapObj.key != TARGET_PAGE))\r\n\t\treturn <const>{\r\n\t\t\tblock: null,\r\n\t\t\tcredentials,\r\n\t\t}\r\n\treturn <const>{\r\n\t\tblock,\r\n\t\tcredentials: null,\r\n\t}\r\n}\r\n\r\nasync function validateBlockUid(caputuredUID: StrSearch, crrUID: string) {\r\n\tconst uidOk = caputuredUID == crrUID // kinda redundant\r\n\tconst v_uid = uidOk ? caputuredUID : crrUID // : nextUID;\r\n\treturn <const>{\r\n\t\tuidOk,\r\n\t\tv_uid,\r\n\t}\r\n}\r\nasync function validateBlockContent(obj: TBlock, splitedStrArr: s[]) {\r\n\tconst caputuredString = splitedStrArr[2] || '' // undefinded means it doens't requieres a third param, that's ok\r\n\r\n\tlet v_string = caputuredString\r\n\tlet stringOK = true\r\n\r\n\tif (obj.string != caputuredString && obj.join == PmtSplit) {\r\n\t\t// kinda hardcoded...\r\n\t\tif (\r\n\t\t\tobj.uid != '' ||\r\n\t\t\tobj.string.includes(' / ') ||\r\n\t\t\tsplitedStrArr[3] != undefined\r\n\t\t) {\r\n\t\t\tdebugger\r\n\t\t\t/*\r\n\t\t\tIf you are running this script twice in the same session\r\n\t\t\t\t- you will get an error here,\r\n\t\t\t\t  But if you write this command on the console...\r\n\t\t\t\t\twindow.YT_GIF_DIRECT_SETTINGS = null\r\n\t\t\t\t  then you can run the script again\r\n\t\t\t\t- Keep in mind, the script is ment to be executed once PER SESSION\r\n\t\t\t\t  But If you get this error on startup,\r\n\t\t\t\t  Then it is a FATAL ERROR, please report it to the developer\r\n\t\t\t\t\thttps://github.com/kauderk/kauderk.github.io/issues\r\n\t\t\t*/\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`YT GIF Settings Page: STOP! the string is invalid or was already set...`\r\n\t\t\t)\r\n\t\t}\r\n\t\tv_string = obj.string\r\n\t\tstringOK = false\r\n\t}\r\n\r\n\treturn <const>{\r\n\t\tv_string,\r\n\t\tstringOK,\r\n\t}\r\n}\r\n\r\n// 1.1  - 1.2.2\r\nasync function UpdateRoamBlock_Settings(\r\n\tnewKey: s,\r\n\treadKeys: IReadKeys,\r\n\tnewString?: s\r\n) {\r\n\tconst { nextStr, uid, crrUID, join, splitedStrArr } = readKeys\r\n\r\n\tsplitedStrArr.splice(0, 1, `(${crrUID})`) //.replace(/\\(([^\\)]+)\\)/, `(${nextChildObj.uid})`);;\r\n\tsplitedStrArr.splice(1, 1, newKey)\r\n\r\n\tif (newString) {\r\n\t\tsplitedStrArr.splice(2, 1, newString)\r\n\t}\r\n\r\n\tconst v_string = splitedStrArr.join(join || PmtSplit)\r\n\tawait updateBlock(crrUID, v_string)\r\n\tawait sleep(50)\r\n\r\n\tconsole.log(\r\n\t\t`Updating block  ((${uid})) -> \\n ${nextStr} \\n\\nto ((${crrUID})) -> \\nﾠ\\n${v_string}`\r\n\t)\r\n\treturn v_string\r\n}\r\n\r\n// 1.2.4\r\nfunction UpdateInlineObj(writeKeys: IWriteKeys, crrObjKey: TProperty) {\r\n\tcrrObjKey.sessionValue = writeKeys.value\r\n\tcrrObjKey.caputuredValue = writeKeys.caputuredValue\r\n\r\n\tif (crrObjKey.inputType == int) {\r\n\t\tcrrObjKey.sessionValue = parseInt(crrObjKey.sessionValue, 10)\r\n\t}\r\n\r\n\t// if (!caputureValueOk && splitedStrArr[2]) {\r\n\t// \t// caputured string too\r\n\t// \tconsole.warn(\r\n\t// \t\t`\"${nextStr}\" value looks weird, it will default to false...` // Why? // FIXME:\r\n\t// \t)\r\n\t// }\r\n\treturn crrObjKey\r\n}\r\n\r\n// 1.2.5\r\nasync function OrderPossiblyMistakenBlock(\r\n\tvalidNestFromThePast: boolean,\r\n\tblock: T_SettingsAny,\r\n\tparentKey: IParentKeys,\r\n\tmapObj: IKeyMap\r\n) {\r\n\tconst relevantParentUID = validNestFromThePast\r\n\t\t? parentKey.uid()\r\n\t\t: mapObj.get(block.parentKey)?.uid // block with proper indent? no, then nest it under it's most relevant parent\r\n\r\n\tif (parentKey.get().displaced == false) {\r\n\t\t// shall stay with it's parent then\r\n\t\tawait TryToMoveBlock(relevantParentUID, block.order, block.uid)\r\n\t\tif (parentKey.accObj().keyFromLevel0 != block.parentKey) {\r\n\t\t\tawait TryToMoveBlock(\r\n\t\t\t\tmapObj.get(block.parentKey)?.uid,\r\n\t\t\t\tblock.order,\r\n\t\t\t\tblock.uid\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n}\r\nfunction validNestFromThePast(block: T_SettingsAny, parentKey: IParentKeys) {\r\n\tconst ok = isOrderOk(block, parentKey)\r\n\tif (ok) {\r\n\t\tparentKey.get().displaced = true\r\n\t}\r\n\treturn ok\r\n}\r\n\r\nfunction isOrderOk(targeObj: T_SettingsAny, parentKeys: IParentKeys) {\r\n\t// validNestFromThePast\r\n\treturn (\r\n\t\ttargeObj.indent == parentKeys.indent() && // are you indented correctly?\r\n\t\tparentKeys.accObj().selfOrder == targeObj.order && // is your relative order alright?\r\n\t\tparentKeys.accObj().keyFromLevel0 == targeObj.parentKey // are you nested under the proper block?\r\n\t)\r\n}\r\nfunction GetSearchBlock(key: s, mapObj: IKeyMap) {\r\n\tconst parentVal = mapObj.get(key)\r\n\treturn parentVal\r\n}\r\n// 1.1\r\nfunction HandleFutureMove(\r\n\tuidToMove: s,\r\n\tparentKey: IParentKeys,\r\n\treadKeys: IReadKeys,\r\n\tmapObj: IKeyMap\r\n): Function | null {\r\n\tif (!uidToMove)\r\n\t\tthrow new Error(\r\n\t\t\t`YT GIF Settings Page: STOP! a future block will try to move to an undefined place`\r\n\t\t)\r\n\r\n\tlet Recycle_cb: Function | null = null\r\n\r\n\tif (parentKey.accObj().keyFromLevel0 == 'LogStatus') {\r\n\t\t// stop right here, else you'll assign the parent to the child\r\n\t\treturn null\r\n\t}\r\n\r\n\tif (parentKey.accObj().keyFromLevel0 != 'DisplacedBlocks' && mapObj.key) {\r\n\t\t// move one block at a time and it's children along with it\r\n\t\tRecycle_cb = async () =>\r\n\t\t\tTryToMoveBlock(mapObj.get('DisplacedBlocks')?.uid, 0, uidToMove)\r\n\t} //\r\n\telse if (\r\n\t\tparentKey.accObj().keyFromLevel0 != 'UnknownBlocks' &&\r\n\t\t!readKeys.nextStr.includes(readKeys.join)\r\n\t) {\r\n\t\t// well well well don't delete it if you don't know what it is\r\n\t\tRecycle_cb = async () =>\r\n\t\t\tTryToMoveBlock(mapObj.get('UnknownBlocks')?.uid, 0, uidToMove)\r\n\t}\r\n\r\n\t// TODO: HUH this might be the bug I didn't notice the last time I touched this code\r\n\tparentKey.get().displaced = true\r\n\r\n\treturn Recycle_cb\r\n}\r\n\r\n/* ********* */\r\nasync function TryToMoveBlock(parentUid: StrSearch, order: number, selfUid: s) {\r\n\ttry {\r\n\t\tif (parentUid && selfUid && parentUid == selfUid) {\r\n\t\t\tthrow new Error(\r\n\t\t\t\t`YT GIF Settings Page: STOP! Don't move block to itself =>         ${parentUid} ${selfUid}`\r\n\t\t\t)\r\n\t\t}\r\n\t\tif (!parentUid) return\r\n\t\t// throw new Error(\r\n\t\t// \t`YT GIF Settings Page: STOP! parentUid is undefined`\r\n\t\t// )\r\n\t\tmoveBlock(parentUid, order, selfUid)\r\n\t} catch (err) {\r\n\t\tdebugger\r\n\t}\r\n}\r\n","import {\r\n\tSetNumberedViewWithUid,\r\n\tCollapseDirectcChildren,\r\n} from '$lib/utils-roam-alpha-api'\r\nimport { YT_GIF_SETTINGS_PAGE } from './shape'\r\nimport { pageShape2BlockMap } from './key-block-map'\r\nimport { CreateMissingBLocks } from './block-creation'\r\nimport { Read_Write_SettingsPage } from './read-warite'\r\nimport { TARGET_UID, TryToSetTargetUID } from './keys'\r\n\r\n// window.YT_GIF_SETTINGS_PAGE_INIT = async () => await init()\r\n// window.YT_GIF_SETTINGS_PAGE = <typeof YT_GIF_SETTINGS_PAGE>{}\r\nwindow.YT_GIF_DIRECT_SETTINGS = new Map()\r\n\r\nexport async function init() {\r\n\tconst res = await pageShape2BlockMap(YT_GIF_SETTINGS_PAGE)\r\n\r\n\tif (!TARGET_UID) {\r\n\t\t// Brand new installation\r\n\t\tawait TryToSetTargetUID()\r\n\t\tawait CreateMissingBLocks(res.page) // 🐌\r\n\t\tawait SetNumberedViewWithUid(TARGET_UID)\r\n\t\tawait CollapseDirectcChildren(TARGET_UID, false)\r\n\t} // Read and store Session Values\r\n\telse {\r\n\t\t// prettier-ignore\r\n\t\tconst pendingBLocks2Displace = await Read_Write_SettingsPage(TARGET_UID, res.keyObjMap) // 🐌\r\n\t\tawait CreateMissingBLocks(res.page) // 🐌 // THEY WILL STACK UP AGAINS EACHOTHER IF THEY ARE NOT EXAMINED - careful, bud\r\n\t\tfor (const cb_closure of pendingBLocks2Displace) //\r\n\t\t\tawait cb_closure()\r\n\t}\r\n\twindow.YT_GIF_DIRECT_SETTINGS = res.keyObjMap\r\n\treturn res.page\r\n}\r\n","import { isTrue } from '$lib/utils'\r\n\r\ntype s = string\r\nconst urlFolder = (f: s) =>\r\n\t`https://kauderk.github.io/yt-gif-extension/resources/${f}`\r\nconst self_urlFolder = (f: s) =>\r\n\t`https://kauderk.github.io/yt-gif-extension/v0.2.0/${f}`\r\nconst urlFolder_css = (f: s) => urlFolder(`css/${f}`)\r\nconst urlFolder_html = (f: s) => urlFolder(`html/${f}`)\r\nconst urlFolder_js = (f: s) => urlFolder(`js/${f}`)\r\n\r\nexport const links = {\r\n\tcss: {\r\n\t\tdropDownMenuStyle: urlFolder_css('drop-down-menu.css'),\r\n\t\tplayerStyle: urlFolder_css('player.css'),\r\n\t\tthemes: {\r\n\t\t\tdark: urlFolder_css('themes/dark-drop-down-menu.css'),\r\n\t\t\tlight: urlFolder_css('themes/light-drop-down-menu.css'),\r\n\t\t\tget: function (i: s | n) {\r\n\t\t\t\treturn this.toogle(!isTrue(i))\r\n\t\t\t},\r\n\t\t\ttoogle: function (t: b) {\r\n\t\t\t\treturn isTrue(t) ? this.dark : this.light\r\n\t\t\t},\r\n\t\t},\r\n\t},\r\n\thtml: {\r\n\t\tdropDownMenu: self_urlFolder('html/drop-down-menu.html'),\r\n\t\tplayerControls: self_urlFolder('html/player-controls.html'),\r\n\t\turlBtn: self_urlFolder('html/url-btn.html'),\r\n\t\tanchor: self_urlFolder('html/yt-gif-anchor.html'),\r\n\t\tinsertOptions: self_urlFolder('html/insert-options.html'),\r\n\t\tfetched: {\r\n\t\t\tplayerControls: '',\r\n\t\t\turlBtn: '',\r\n\t\t\tanchor: '',\r\n\t\t\tinsertOptions: '',\r\n\t\t},\r\n\t},\r\n\tjs: {\r\n\t\tutils: urlFolder_js('js'),\r\n\t\troamAlphaApi: urlFolder_js('utils-roam-alpha-api.js'),\r\n\t\tsettingsPage: self_urlFolder('js/settings-page.js'),\r\n\t\tmain: self_urlFolder('js/yt-gif-main.js'),\r\n\t},\r\n\thelp: {\r\n\t\tgithub_isuues: `https://github.com/kauderk/kauderk.github.io/issues`,\r\n\t},\r\n}\r\nexport type TCss = typeof cssData\r\nexport const cssData = <const>{\r\n\tyt_gif: 'yt-gif',\r\n\tyt_gif_wrapper: 'yt-gif-wrapper',\r\n\tyg_wrapper_p: 'yt-gif-wrapper-parent',\r\n\tyt_gif_iframe_wrapper: 'yt-gif-iframe-wrapper',\r\n\tyt_gif_timestamp: 'yt-gif-timestamp',\r\n\tyt_gif_audio: 'yt-gif-audio',\r\n\tyt_gif_custom_player_span_first_usage:\r\n\t\t'ty-gif-custom-player-span-first-usage',\r\n\r\n\tawiting_player_pulse_anim: 'yt-gif-awaiting-palyer--pulse-animation',\r\n\tawaitng_player_user_input: 'yt-gif-awaiting-for-user-input',\r\n\tawaitng_input_with_thumbnail:\r\n\t\t'yt-gif-awaiting-for-user-input-with-thumbnail',\r\n\r\n\tddm_icon: 'ty-gif-icon',\r\n\r\n\tdwn_no_input: 'dropdown_not-allowed_input',\r\n\tdropdown_fadeIt_bg_animation: 'dropdown_fadeIt-bg_animation',\r\n\tdropdown_forbidden_input: 'dropdown_forbidden-input',\r\n\tdropdown_allright_input: 'dropdown_allright-input',\r\n\r\n\tdropdown__hidden: 'dropdown--hidden',\r\n\tdropdown_deployment_style: 'dropdown_deployment-style',\r\n\tdwp_message: 'dropdown-info-message',\r\n\tddm_info_message_selector: `.dropdown .dropdown-info-message`,\r\n\r\n\tdwn_pulse_anim: 'drodown_item-pulse-animation',\r\n\r\n\tddm_exist: 'yt-gif-drop-down-menu-toolbar',\r\n\r\n\tddm_focus: 'dropdown-focus',\r\n\r\n\tstt_allow: 'settings-not-allowed',\r\n\r\n\tditem_allow: 'dropdown-item_not-allowed_input',\r\n\r\n\tp_controls: 'yt-gif-controls',\r\n\r\n\tddn_tut_awaiting: 'ddm-tut-awaiting-input',\r\n\r\n\tid: {\r\n\t\tnavigate_btn: '#navigate-to-yt-gif-settings-page',\r\n\t\ttoogle_theme: '#yt-gif-ddm-theme',\r\n\t\tddm_main_theme: '#yt-gif-ddm-main-theme',\r\n\t},\r\n\traw_anchorSel: 'rm-xparser-default-anchor',\r\n}\r\nexport const attrData = {\r\n\t// [data-main] -> [data-bind]\r\n\t'initialize-mode': '',\r\n\t'timestamp-experience': '',\r\n\t'timestamp-loop-opt': '',\r\n\tms_options: '',\r\n\tfmt_options: '',\r\n}\r\nexport const attrInfo = {\r\n\turl: {\r\n\t\tpath: 'data-video-url',\r\n\t\tindex: 'data-video-index',\r\n\t},\r\n\ttarget: 'data-target',\r\n\tuid: 'data-uid',\r\n\tcreation: {\r\n\t\tname: 'data-creation',\r\n\t\tforceAwaiting: 'force-awaiting',\r\n\t\tcleaning: 'cleaning',\r\n\t\tdisplaced: 'displaced',\r\n\t\tbuffer: 'buffer',\r\n\t},\r\n}\r\n/*-----------------------------------*/\r\nexport const ytGifAttr = {\r\n\tsound: {\r\n\t\tmute: 'yt-mute',\r\n\t\tunMute: 'yt-unmute',\r\n\t},\r\n\tplay: {\r\n\t\tplaying: 'yt-playing',\r\n\t\tpaused: 'yt-paused',\r\n\t},\r\n\textra: {\r\n\t\treadyToEnable: 'readyToEnable',\r\n\t},\r\n} as const\r\n","/* ********************* */\r\nexport function isSelected(select: HTMLSelectElement, ...value: string[]) {\r\n\treturn Array.from(select.selectedOptions).find(o =>\r\n\t\tvalue.includes(o.value)\r\n\t) as HTMLOptionElement\r\n}\r\nexport function getOption(select: HTMLSelectElement, value: string) {\r\n\treturn Array.from(select.options).find(\r\n\t\to => o.value == value\r\n\t) as HTMLOptionElement\r\n}\r\n","export class Wild_Config {\r\n\tstatic readonly componentPage = '[^:]+'\r\n\tstatic readonly targetStringRgx = /{{([^}]*)/gm\r\n}\r\n","import { div, getUniqueSelectorSmart, toggleAttribute } from '$lib/utils'\r\nimport { attrInfo } from '../init/config/paths'\r\nimport { Wild_Config } from '$v3/lib/types/Wild_Config'\r\nexport function properBlockIDSufix(url: string, urlIndex: number | string) {\r\n\treturn '_' + [url, urlIndex].join('_')\r\n}\r\nexport function preRgxComp(rgxPage: string) {\r\n\treturn `{{(\\\\[\\\\[)?(${rgxPage})((?=:):|[^:|\\\\/]+?(:))(|[^{]+)}}`\r\n}\r\nexport function BlockRegexObj(\r\n\tcomponentPage = Wild_Config.componentPage,\r\n\ttargetStringRgx?: RegExp\r\n) {\r\n\tconst componentRgx = new RegExp(preRgxComp(componentPage), 'gm')\r\n\tconst anyPossibleComponentsRgx = Wild_Config.targetStringRgx // https://stackoverflow.com/questions/30787438/how-to-stop-match-until-before-a-character-in-regex#:~:text=assisterId%3D-,(%5B%5E%22%5D*),-%5B%5E%22%5D*%20matches%20any%20character\r\n\tconst aliasPlusUidsRgx = /\\[(.*?(?=\\]))]\\(\\(\\((.*?(?=\\)))\\)\\)\\)/gm\r\n\tconst tooltipCardRgx = /{{=:(.+?)\\|([^}]*)/gm\r\n\tconst anyUidRgx = /(?<=\\(\\()([^(].*?[^)])(?=\\)\\))/gm\r\n\t// set in the order in which roam renders them - anyPossibleComponents is kinda like a joker card, it will trap components along with irrelevant uids\r\n\tconst baseBlockRgx = [\r\n\t\ttooltipCardRgx,\r\n\t\tcomponentRgx,\r\n\t\tanyPossibleComponentsRgx,\r\n\t\taliasPlusUidsRgx,\r\n\t\tanyUidRgx,\r\n\t]\r\n\tif (targetStringRgx) baseBlockRgx.push(targetStringRgx)\r\n\tconst blockRgx = reduceRgxArr(baseBlockRgx)\r\n\r\n\treturn <const>{\r\n\t\tblockRgx,\r\n\t\taliasPlusUidsRgx,\r\n\t\ttooltipCardRgx,\r\n\t\tanyPossibleComponentsRgx,\r\n\t\tcomponentRgx,\r\n\t\tanyUidRgx,\r\n\t}\r\n}\r\nfunction reduceRgxArr(regexArr: RegExp[]) {\r\n\t// https://masteringjs.io/tutorials/fundamentals/concat-regexp\r\n\treturn regexArr.reduce(\r\n\t\t(acc, v, i, a) =>\r\n\t\t\tnew RegExp(\r\n\t\t\t\tacc.source != '(?:)' ? acc.source + '|' + v.source : v.source,\r\n\t\t\t\t'gm'\r\n\t\t\t),\r\n\t\t// @ts-ignore // TODO:\r\n\t\tnew RegExp()\r\n\t)\r\n}\r\nexport function floatParam(p: string, url: string) {\r\n\tconst raw = paramRgx(p)?.exec(url)?.[2]\r\n\r\n\treturn raw ? time2sec(raw) : 0\r\n}\r\nexport function time2sec(raw: string) {\r\n\tif (/[hms]/.test(raw)) {\r\n\t\tconst hms = raw.split(/(?<=h)|(?<=m)|(?<=s)/)\r\n\r\n\t\treturn hms.reduce((acc, crr) => {\r\n\t\t\tconst t = parseInt(crr) || 0\r\n\r\n\t\t\tif (/s/.test(crr)) return t + acc\r\n\t\t\tif (/m/.test(crr)) return t * 60 + acc\r\n\t\t\tif (/h/.test(crr)) return t * 3600 + acc\r\n\r\n\t\t\treturn acc\r\n\t\t}, 0)\r\n\t}\r\n\r\n\treturn parseFloat(raw)\r\n}\r\nexport function paramRgx(p: string, f = 'gm') {\r\n\treturn new RegExp(`((?:${p})=)(([^&]+))`, f)\r\n}\r\nexport function CleanAndBrandNewWrapper(\r\n\twrapper_p: Element,\r\n\tattr_name = attrInfo.creation.name,\r\n\tattr_value = ''\r\n) {\r\n\tconst targetClass = wrapper_p.getAttribute(`${attrInfo.target}`) as string\r\n\tconst parentSel = getUniqueSelectorSmart(wrapper_p.parentNode as Element)\r\n\r\n\twrapper_p.parentNode?.removeChild(wrapper_p)\r\n\tconst el = div([targetClass])\r\n\ttoggleAttribute(true, attr_name, el, attr_value)\r\n\tdocument.querySelector(parentSel)?.appendChild(el)\r\n\treturn el\r\n}\r\n","import { getUniqueSelectorSmart } from '$lib/utils'\r\nimport { CleanAndBrandNewWrapper } from '../../lib/utils'\r\nimport { attrInfo } from './paths'\r\n\r\ntype T_UI = {\r\n\tdefaultPlayerValues: {\r\n\t\tplayer_captions_language: string | 'en'\r\n\t\tplayer_captions_on_load: string | 'true'\r\n\t\tplayer_interface_language: string | 'en'\r\n\t\tplayer_span: string | '50%'\r\n\t\tplayer_volume: number\r\n\t}\r\n\tdefaultValues: {\r\n\t\tInAndOutKeys: string | 'ctrlKey,altKey'\r\n\t\tYT_API_KEY_V3: string\r\n\t\tend_loop_sound_src:\r\n\t\t\t| 'https://freesound.org/data/previews/256/256113_3263906-lq.mp3'\r\n\t\t\t| string\r\n\t\toverride_roam_video_component: string\r\n\t\toverride_simulate_url_to_video_component: string\r\n\t}\r\n\tdeploymentStyle: {\r\n\t\tdeploy_yt_gifs: HTMLInputElement\r\n\t\tdeployment_style_both: HTMLInputElement\r\n\t\tdeployment_style_video: HTMLInputElement\r\n\t\tdeployment_style_yt_gif: HTMLInputElement\r\n\t\tsuspend_yt_gif_deployment: HTMLInputElement\r\n\t}\r\n\tdisplay: {\r\n\t\tfmt_options: HTMLSelectElement\r\n\t\tms_options: HTMLSelectElement\r\n\t\tsimulate_roam_research_timestamps: HTMLInputElement\r\n\t\tyt_playback_speed: HTMLSelectElement\r\n\t}\r\n\tdropdownMenu: {\r\n\t\tddm_css_theme_input: HTMLInputElement\r\n\t}\r\n\texperience: {\r\n\t\tawaiting_input_type: HTMLSelectElement\r\n\t\tinitialize_mode: HTMLSelectElement\r\n\t\txp_options: HTMLSelectElement\r\n\t}\r\n\tplayerSettings: {\r\n\t\tfullscreen_style: HTMLSelectElement\r\n\t\tmute_style: HTMLSelectElement\r\n\t\tplay_style: HTMLSelectElement\r\n\t\tps_options: HTMLSelectElement\r\n\t\turl_boundaries: HTMLSelectElement\r\n\t\turl_volume: HTMLSelectElement\r\n\t}\r\n\trange: {\r\n\t\tend_loop_sound_volume: HTMLInputElement\r\n\t\tiframe_buffer_slider: HTMLInputElement\r\n\t\ttimestamp_display_scroll_offset: HTMLInputElement\r\n\t}\r\n\ttimestamps: {\r\n\t\ttm_loop_hierarchy: HTMLSelectElement\r\n\t\ttm_loop_options: HTMLSelectElement\r\n\t\ttm_loop_to: HTMLSelectElement\r\n\t\ttm_options: HTMLSelectElement\r\n\t\ttm_recovery: HTMLInputElement\r\n\t\ttm_reset_on_removal: HTMLSelectElement\r\n\t\ttm_restore: HTMLSelectElement\r\n\t\ttm_seek_action: HTMLSelectElement\r\n\t\ttm_seek_to: HTMLSelectElement\r\n\t\ttm_workflow_display: HTMLSelectElement\r\n\t\ttm_workflow_grab: HTMLSelectElement\r\n\t}\r\n}\r\n\r\n// I shouldn't be able to do this...\r\nexport let UI = <T_UI>{}\r\n\r\n//export const YT = window.YT\r\n\r\nexport const iframeIDprfx = 'player_'\r\nexport let currentFullscreenPlayer: string\r\nexport const setCurrentFullscreenPlayer = (id: string) =>\r\n\t(currentFullscreenPlayer = id)\r\n\r\n/*-----------------------------------*/\r\nexport const YT_GIF_OBSERVERS_TEMP = {\r\n\tmasterMutationObservers: Array<Tobserver>(),\r\n\tmasterIntersectionObservers: Array<Tobserver>(),\r\n\tmasterIntersectionObservers_buffer: Array<Tobserver>(),\r\n\tmasterIframeBuffer: Array<Tobserver | string>(),\r\n\t//slashMenuObserver: null,\r\n\ttimestampObserver: null as MutationObserver | null,\r\n\tkeyupEventHandler: (e: KeyboardEvent): void => {},\r\n\tcreationCounter: -1, // crucial, because the api won't reload iframes with the same id\r\n\tCleanMasterObservers: function () {\r\n\t\tconst mutObjRes = cleanObserverArr(this.masterMutationObservers)\r\n\t\tthis.masterMutationObservers = mutObjRes.observer\r\n\r\n\t\tconst insObjRes = cleanObserverArr(this.masterIntersectionObservers)\r\n\t\tthis.masterIntersectionObservers = insObjRes.observer\r\n\r\n\t\tconst bufObjRes = cleanObserverArr(\r\n\t\t\tthis.masterIntersectionObservers_buffer\r\n\t\t)\r\n\t\tthis.masterIntersectionObservers_buffer = insObjRes.observer\r\n\r\n\t\tconsole.log(\r\n\t\t\t`${mutObjRes.counter} mutation, ${insObjRes.counter} intersection and ${bufObjRes.counter} iframe buffer master observers cleaned`\r\n\t\t)\r\n\r\n\t\tfunction cleanObserverArr(observer: Array<Tobserver>) {\r\n\t\t\t//https://www.codegrepper.com/code-examples/javascript/how+to+do+a+reverse+loop+in+javascript#:~:text=www.techiedelight.com-,how%20to%20reverse%20loop%20in%20javascript,-javascript%20by%20Dark\r\n\t\t\tlet counter = 0\r\n\t\t\tfor (let i = observer.length - 1; i >= 0; i--) {\r\n\t\t\t\tobserver[i].disconnect()\r\n\t\t\t\tobserver.splice(i, 1)\r\n\t\t\t\tcounter++\r\n\t\t\t}\r\n\t\t\treturn <const>{\r\n\t\t\t\tobserver,\r\n\t\t\t\tcounter,\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tCleanLoadedWrappers: function () {\r\n\t\tconst wrappers = document.queryAllasArr(`[${attrInfo.target}]`)\r\n\r\n\t\tfor (let i = wrappers.length - 1; i >= 0; i--) {\r\n\t\t\tCleanAndBrandNewWrapper(\r\n\t\t\t\tdocument.querySelector(\r\n\t\t\t\t\tgetUniqueSelectorSmart(wrappers[i])\r\n\t\t\t\t) as El,\r\n\t\t\t\tattrInfo.creation.name,\r\n\t\t\t\tattrInfo.creation.cleaning\r\n\t\t\t) //wrapperParent -> nest new span\r\n\t\t}\r\n\t},\r\n\tdmm_html: window.ddm_html,\r\n}\r\n\r\nwindow.YT_GIF_OBSERVERS = !window.YT_GIF_OBSERVERS\r\n\t? YT_GIF_OBSERVERS_TEMP\r\n\t: window.YT_GIF_OBSERVERS\r\nexport function TryCreateUserInputObject(\r\n\tYT_GIF_SETTINGS_PAGE: typeof window.YT_GIF_SETTINGS_PAGE\r\n): T_UI {\r\n\treturn (UI = JSON.parse(\r\n\t\tJSON.stringify(\r\n\t\t\tObject.assign(YT_GIF_SETTINGS_PAGE, {\r\n\t\t\t\t// FIXME: SHould be a separate object\r\n\t\t\t\tdeploymentStyle: {\r\n\t\t\t\t\t//menu\r\n\t\t\t\t\tsuspend_yt_gif_deployment: '',\r\n\r\n\t\t\t\t\t// radio hidden submenu\r\n\t\t\t\t\tdeployment_style_yt_gif: '1',\r\n\t\t\t\t\tdeployment_style_video: '',\r\n\t\t\t\t\tdeployment_style_both: '',\r\n\r\n\t\t\t\t\t// hidden submenu\r\n\t\t\t\t\tdeploy_yt_gifs: '',\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t)\r\n\t) as unknown as T_UI)\r\n}\r\nexport function GetPlayerState() {\r\n\treturn window.YT.PlayerState\r\n}\r\n","interface TArgs<T = number> {\r\n\tvalue?: T\r\n\talias?: string[]\r\n}\r\ntype Initializer<T> = T extends Function ? never : T | ((crr: T) => T)\r\nfunction set<T>(this: Param<T>, arg: Initializer<T>) {\r\n\tif (typeof arg === 'function') {\r\n\t\tthis.value = arg(this.value)\r\n\t} else {\r\n\t\tthis.value = arg as T\r\n\t}\r\n}\r\nfunction setDefault(this: TNumParam, arg: number) {\r\n\tthis.value = arg\r\n\tthis.default = arg\r\n}\r\nclass Param<T> {\r\n\tvalue\r\n\treadonly alias\r\n\treadonly set = set\r\n\tconstructor(_value: T, args?: TArgs<T>) {\r\n\t\tthis.value = args?.value ?? _value\r\n\t\tthis.alias = args?.alias ?? []\r\n\t}\r\n}\r\nclass NumHistory extends Param<number> {\r\n\tconstructor(args?: TArgs) {\r\n\t\tsuper(0, args)\r\n\t}\r\n\tupdate = this.value\r\n\treadonly history: number[] = []\r\n}\r\nexport class TNumParam extends Param<number> {\r\n\tconstructor(args?: TArgs) {\r\n\t\tsuper(0, args)\r\n\t}\r\n\tdefault = this.value\r\n\treadonly setDefault = setDefault\r\n}\r\nclass StrParam extends Param<string> {\r\n\tconstructor(args?: TArgs<string>) {\r\n\t\tsuper('', args)\r\n\t}\r\n}\r\nclass BolParam extends Param<boolean> {\r\n\tconstructor(args?: TArgs<boolean>) {\r\n\t\tsuper(false, args)\r\n\t}\r\n}\r\nconst getPlayerVol = () =>\r\n\twindow.YT_GIF_DIRECT_SETTINGS.get('player_volume')?.sessionValue as number\r\nexport class TVideoParams {\r\n\treadonly id = new StrParam({ value: '---------' })\r\n\treadonly src = new StrParam({\r\n\t\tvalue: 'https://www.youtube.com/embed/---------?',\r\n\t})\r\n\treadonly speed = new TNumParam({ value: 1, alias: ['s'] })\r\n\treadonly start = new TNumParam({ alias: ['t'] })\r\n\treadonly end = new TNumParam()\r\n\r\n\treadonly updateTime = new TNumParam()\r\n\treadonly timestamps = new NumHistory()\r\n\treadonly volume = new NumHistory({ value: getPlayerVol(), alias: ['vl'] })\r\n}\r\nexport class IExtendedVideoParams extends TVideoParams {\r\n\treadonly hl = new StrParam()\r\n\treadonly cc = new StrParam()\r\n\treadonly sp = new StrParam()\r\n\treadonly mute = new BolParam()\r\n\treadonly playRightAway = new BolParam()\r\n}\r\n","import { sleep, isRendered } from '$lib/utils'\r\n\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\nconst NotImplementationWarning = <R extends unknown>(): R => {\r\n\tconsole.warn('Not implemented')\r\n\treturn <R>{}\r\n}\r\nexport class T_YT_RECORD {\r\n\twTarget: YT_TargetWrapper | undefined\r\n\tconstructor(wTarget?: YT_TargetWrapper) {\r\n\t\tthis.wTarget = wTarget\r\n\t}\r\n\tuid: string = ''\r\n\tseekToUpdatedTime: (desiredTime: number) => void = NotImplementationWarning\r\n\tsameBoundaries: () => boolean = NotImplementationWarning\r\n\tisSoundingFine: (bol: boolean) => void = NotImplementationWarning\r\n\ttogglePlay: (bol: boolean) => void = NotImplementationWarning\r\n\tbounded: (sec: number) => boolean = NotImplementationWarning\r\n}\r\nexport interface YT_IFRAME {\r\n\treadonly target: unknown\r\n\treadonly wTarget: YT_TargetWrapper\r\n\treadonly data: number\r\n}\r\nexport class YT_TargetWrapper {\r\n\tprivate t: any\r\n\tytgif: m\r\n\r\n\tconstructor(target: any) {\r\n\t\tthis.t = target\r\n\t\ttarget.ytgif ??= new m()\r\n\t\tthis.ytgif = target.ytgif\r\n\t}\r\n\tGetIframeID: FString = () =>\r\n\t\tthis.t.i?.id || this.t.g?.id || this.t.getIframe()?.id\r\n\tGetVideoID: FString = () => this.t.j.i.videoId\r\n\tGetVars: () => {\r\n\t\tstart: number\r\n\t\tend: number\r\n\t} = () => this.t.j.i.playerVars\r\n\t// any should do, because sometimes it holds\r\n\tApiIsWorking: () => Function | undefined = () => this.t.seekTo\r\n\tWhileApiHolds = async (iframe: QrySearch, delay = 500) => {\r\n\t\twhile (isRendered(iframe) && isNaN(this.t?.getCurrentTime?.())) {\r\n\t\t\tawait sleep(delay)\r\n\t\t}\r\n\t}\r\n\tDestroyTarget() {\r\n\t\tif (!this.t) return\r\n\t\tthis.ytgif.enter = () => {\r\n\t\t\t/* empty */\r\n\t\t}\r\n\t\tthis.t.destroy()\r\n\t}\r\n\r\n\tloadVideoById: (detail: {}) => Promise<void> = o => this.t.loadVideoById(o)\r\n\r\n\tgetDuration: FNumber = () => this.t.getDuration()\r\n\r\n\tsetVolume: (vol: number) => void = (n: n) => this.t.setVolume(n)\r\n\tgetVolume: FNumber = () => this.t.getVolume()\r\n\r\n\tseekTo: (sec: number) => void = (n: n) => this.t.seekTo(n)\r\n\tgetCurrentTime: FNumber = () => this.t.getCurrentTime()\r\n\r\n\tgetPlayerState: FNumber = () => this.t.getPlayerState()\r\n\tsetPlaybackRate: (rate: number) => void = (n: n) =>\r\n\t\tthis.t.setPlaybackRate(n)\r\n\r\n\tsetOnStateChange(cb: TSetStageChange): void {\r\n\t\tthis.t.m.i[5] = cb\r\n\t}\r\n\tgetPlaybackRate: FNumber = () => this.t.getPlaybackRate()\r\n\tsetPlayerState: (state: string) => void = (s: string) =>\r\n\t\t(this.t.playerInfo.playerState = s)\r\n\r\n\tplayVideo: FVoid = () => this.t.playVideo()\r\n\tpauseVideo: FVoid = () => this.t.pauseVideo()\r\n\tunMute: FVoid = () => this.t.unMute()\r\n\tmute: FVoid = () => this.t.mute()\r\n\r\n\tgetIframe: () => HTMLIFrameElement = () => this.t.getIframe()\r\n\tdestroy: FVoid = () => this.t.destroy()\r\n\tgetAvailablePlaybackRates: () => number[] = () =>\r\n\t\tthis.t.getAvailablePlaybackRates()\r\n}\r\ntype TSetStageChange = (state: YT_IFRAME) => Promise<void>\r\nclass m {\r\n\tpreviousTick = 0\r\n\ttimers = Array<number>()\r\n\ttimerID = 0\r\n\tglobalHumanInteraction = false\r\n\tClearTimers() {\r\n\t\twindow.clearInterval(this.timerID)\r\n\t\tthis.timerID = 0\r\n\r\n\t\tif (this.timers.length != 0) {\r\n\t\t\tfor (const tmr of this.timers) {\r\n\t\t\t\tclearInterval(tmr)\r\n\t\t\t}\r\n\r\n\t\t\tthis.timers = []\r\n\t\t}\r\n\t}\r\n\tPushSingleInterval(cb: () => void, delay = 1000) {\r\n\t\tthis.ClearTimers()\r\n\t\tthis.timerID = window.setInterval(cb, delay)\r\n\t\tthis.timers.push(this.timerID)\r\n\t}\r\n\tenter() {\r\n\t\t/*NewIntervalUpdate*/\r\n\t}\r\n}\r\n","import { BlockRegexObj } from '../utils'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport { TVideoParams } from '$v3/lib/types/video-types'\r\nimport { T_YT_RECORD } from './yt-types'\r\nimport { Wild_Config } from './Wild_Config'\r\n\r\nexport const recordedIDs = new Map<string, T_YT_RECORD>()\r\nexport const allVideoParameters = new Map<string, IExtendedVideoParams>()\r\nexport const lastBlockIDParameters = new Map<string, TVideoParams>()\r\nexport const observedParameters = new Map<string, TlastActiveTm>()\r\n// FIXME: split into string map and KeyObj map\r\nexport const anchorInstanceMap: Trm_map = new Map()\r\nexport const UIDtoURLInstancesMapMap = new Map<string, number>() // since it store recursive maps, once per instance it's enough\r\nexport const YTvideoIDs = new Map<string, number>()\r\n\r\nexport const s_u_f_key = 'simulate_url_formatter'\r\n\r\n/* */\r\nexport interface ICongif {\r\n\tcomponentPage: string\r\n\ttargetStringRgx: RegExp\r\n\tscatteredMatch?: boolean\r\n}\r\nexport class StartEnd_Config {\r\n\tstatic readonly componentPage = 'yt-gif\\\\/(start|end)'\r\n\tstatic readonly targetStringRgx: RegExp =\r\n\t\t/(\\d+h)(\\d+m)|(\\d+h)?(\\d+m)?(\\d+s)|(\\d+m)|(\\d+h)|((\\d{1,2}):)?((\\d{1,2}):)((\\d{1,2}))|(\\d+(?:(\\.\\d{1})|(?=\\s|\\}|\\w+|$)))/\r\n}\r\nexport class YTGIF_Config {\r\n\tstatic componentPage: TGifTarget = 'yt-gif|video' // this needs to change dynamically\r\n\tstatic readonly targetStringRgx =\r\n\t\t/https\\:\\/\\/(www\\.)?(youtu(be.com\\/watch|.be\\/))?(.*?(?=\\s|$|\\}|\\]|\\)))/\r\n\tstatic readonly minimalRgx = /(?<!\\S)\\/[^:|\\s|}|\\]|\\)]{11,}/\r\n\tstatic readonly guardClause = (url: unknown) =>\r\n\t\ttypeof url == 'string' && !!url.match('https://(www.)?youtube|youtu.be')\r\n}\r\nexport class URL_Config {\r\n\tstatic readonly componentPage = Wild_Config.componentPage\r\n\tstatic readonly scatteredMatch = true // alright\r\n\tstatic readonly targetStringRgx = YTGIF_Config.targetStringRgx\r\n}\r\n\r\nexport const anchorsRgx = BlockRegexObj('yt-gif/anchor|yt-gif')\r\nexport class Anchor_Config {\r\n\tstatic readonly componentPage = 'yt-gif/anchor|yt-gif'\r\n\tstatic readonly componentRgx = anchorsRgx.componentRgx\r\n\tstatic readonly uidRefRgx = new RegExp(\r\n\t\t`\\\\(\\\\(${anchorsRgx.anyUidRgx.source}\\\\)\\\\)`,\r\n\t\t'gm'\r\n\t)\r\n\tstatic readonly targetStringRgx = new RegExp(\r\n\t\t`${YTGIF_Config.targetStringRgx.source}|${anchorsRgx.anyUidRgx.source}`,\r\n\t\t'gm'\r\n\t)\r\n}\r\n\r\n/* ------------------ */\r\nexport const videoParams = new TVideoParams()\r\nexport const sessionIDs = new T_YT_RECORD()\r\n","import { isNotZoomPath } from '$lib/utils'\r\n\r\nexport async function Mutation_cb_raw_rm_cmpts(\r\n\tmutationsList: MutationRecord[],\r\n\ttargetClass: string,\r\n\tonRenderedCmpt_cb: (cmpt: HTMLElement) => void\r\n) {\r\n\tconst found: HTMLElement[] = []\r\n\r\n\tfor (const { addedNodes } of mutationsList) {\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\t\tfor (const node of Array.from(<HTMLScriptElement[]>(<any>addedNodes))) {\r\n\t\t\tif (!node.tagName) continue // not an element\r\n\r\n\t\t\tif (node.classList.contains(targetClass)) found.push(node)\r\n\t\t\telse if (node.firstElementChild)\r\n\t\t\t\t// @ts-ignore it's not worth it to typecast this\r\n\t\t\t\tfound.push(...node.getElementsByClassName(targetClass))\r\n\t\t}\r\n\t}\r\n\r\n\tfor (const node of found) if (isNotZoomPath(node)) onRenderedCmpt_cb(node)\r\n}\r\n","import { properBlockIDSufix } from '../utils'\r\nimport { isSelected } from '../backend-frontend/option'\r\nimport { attrInfo } from '../../init/config/paths'\r\nimport { UI } from '../../init/config/yt-gif-init'\r\n\r\nexport { properBlockIDSufix }\r\nexport function toggleAttribute(\r\n\tbol: boolean,\r\n\tclass_: string,\r\n\tel: HTMLElement,\r\n\tvalue = ''\r\n) {\r\n\tif (bol) {\r\n\t\tel.setAttribute(class_, value)\r\n\t} else {\r\n\t\tel.removeAttribute(class_)\r\n\t}\r\n}\r\nexport function toggleClasses(\r\n\tbol: boolean,\r\n\tclassNames: string[],\r\n\tel: HTMLElement\r\n) {\r\n\tif (bol) el.classList.add(...classNames)\r\n\telse el.classList.remove(...classNames)\r\n}\r\nexport function closestBlock(el: QrySearch) {\r\n\treturn el ? el.closest('.rm-block__input') : null\r\n}\r\nexport function isRendered(el: QrySearch) {\r\n\treturn document.body.contains(el!)\r\n}\r\nexport function getUidFromBlock(el: QrySearch, closest = false) {\r\n\tlet block = el\r\n\tif (closest) block = closestBlock(el) as Element\r\n\treturn block?.id?.slice(-9) as s\r\n}\r\nexport function closest_container_request(el?: Element) {\r\n\tif (isSelected(UI.timestamps.tm_options, 'anchor'))\r\n\t\treturn closest_anchor_container(el!)\r\n\telse return closest_container(el!)\r\n}\r\nexport function closest_anchor_container(el: QrySearch) {\r\n\tconst anc = (el: QrySearch) =>\r\n\t\tel?.closest('[yt-gif-anchor-container]') ?? null\r\n\r\n\tconst yuid = (el: QrySearch) => el?.getAttribute('yt-gif-anchor-container')\r\n\r\n\tconst buid = (el: QrySearch) => el?.getAttribute('yt-gif-block-uid')\r\n\r\n\tconst rm = closest_container(el) as Element\r\n\tconst yt = anc(el)\r\n\r\n\tif (buid(rm) == yuid(anc(rm))) return anc(rm)\r\n\treturn rm || yt\r\n}\r\nexport function closest_container(el: QrySearch) {\r\n\treturn el?.closest('.roam-block-container') ?? null\r\n}\r\nexport function closestYTGIFparentID(el: QrySearch) {\r\n\treturn (closestBlock(el) || el?.closest('.dwn-yt-gif-player-container'))\r\n\t\t?.id as s\r\n}\r\nexport function getWrapperUrlSufix(wrapper: QrySearch, uid = '') {\r\n\tconst url = wrapper?.getAttribute(attrInfo.url.path)\r\n\tconst urlIndex = wrapper?.getAttribute(attrInfo.url.index)\r\n\tconst urlSufix = properBlockIDSufix(url!, urlIndex!)\r\n\treturn uid + urlSufix\r\n}\r\nexport function closest_attr(el: Element, attr: string) {\r\n\tconst found = el?.closest(`[${attr}]`)\r\n\treturn <const>{ found, value: found?.getAttribute(attr) }\r\n}\r\n","import { closestBlock } from './elements-yt-gif-parent'\r\n\r\nexport function ElementsPerBlock(block: QrySearch, selector: string) {\r\n\tif (!block) return []\r\n\r\n\treturn block\r\n\t\t.queryAllasArr(selector)\r\n\t\t.filter(b => closestBlock(b)?.id == block.id) // FIXME: could be null checks\r\n}\r\n","import {\r\n\tgetUidFromBlock,\r\n\tclosestBlock,\r\n} from '$v3/lib/dom/elements-yt-gif-parent'\r\n\r\nexport const aliasSel = {\r\n\tinline: {\r\n\t\tis: 'a.rm-alias.rm-alias--block',\r\n\t\tfrom: '.rm-alias-tooltip__content',\r\n\t},\r\n\tcard: {\r\n\t\tis: '.rm-block__part--equals',\r\n\t\tfrom: '.bp3-card',\r\n\t},\r\n}\r\nexport const openAlias = function (isSel: s) {\r\n\treturn document.querySelector(`.bp3-popover-open > ${isSel}`)\r\n}\r\nexport const aliasCondition = function (originalEl: Element) {\r\n\treturn function condition(this: TAlias) {\r\n\t\t// prettier-ignore\r\n\t\tconst PopOverParent = originalEl.closest(`div.bp3-popover-content > ${this.from}`);\r\n\t\treturn PopOverParent && this.uidCondition()\r\n\t}\r\n}\r\nexport const grandParentBlockFromAlias = function (this: TAlias) {\r\n\treturn closestBlock(this.el.closest('.bp3-popover-open'))\r\n}\r\nexport const grandParentBlock = function (this: TBase) {\r\n\treturn closestBlock(this.el)\r\n}\r\nexport const condition = function (this: TBase) {\r\n\treturn (this.uid = getUidFromBlock(this.grandParentBlock()))\r\n}\r\nexport const SubUrlObj = {\r\n\turlComponents: function (this: TBase) {\r\n\t\treturn [\r\n\t\t\t...Array.from(\r\n\t\t\t\tthis.grandParentBlock().querySelectorAll(this.targetSelector)\r\n\t\t\t),\r\n\t\t]\r\n\t},\r\n\tgetUrlIndex: function (this: TBase) {\r\n\t\treturn this.urlComponents().indexOf(this.el)\r\n\t},\r\n}\r\nexport interface TBase {\r\n\tuid: string\r\n\turl: string\r\n\tel: Element\r\n\ttargetSelector: string\r\n\tgrandParentBlock: () => Element\r\n\turlComponents: () => Element[]\r\n\tcondition: () => string\r\n\tgetUrlIndex: () => number\r\n}\r\nexport type TAlias = TBase & {\r\n\tfrom: string\r\n\tuidCondition: () => string\r\n}\r\n","import { attrInfo } from '$v3/init/config/paths'\r\nimport { ElementsPerBlock } from '$v3/lib/dom/ytgif'\r\nimport { ObjectKeys } from '$lib/utils'\r\nimport {\r\n\tSubUrlObj,\r\n\topenAlias,\r\n\taliasSel,\r\n\tgrandParentBlockFromAlias,\r\n\tcondition,\r\n\taliasCondition,\r\n\tgrandParentBlock,\r\n} from './composition'\r\nimport type { TAlias, TBase } from './composition'\r\n\r\nexport function GetUidResultObj(el: Element) {\r\n\tconst uidResults = {\r\n\t\t'is component': GetIsComponent(el),\r\n\t\t'is tooltip card': GetIsTooltipCard(el),\r\n\t\t'is alias': GetIsAlias(el),\r\n\t\t'is ddm tutorial': GetIsDmmTutorial(el),\r\n\t}\r\n\tObject.values(uidResults).forEach(obj => Object.assign(obj, SubUrlObj))\r\n\tObject.assign(uidResults['is component'], {\r\n\t\turlComponents: function (this: TBase) {\r\n\t\t\t// prettier-ignore\r\n\t\t\treturn ElementsPerBlock(this.grandParentBlock(), this.targetSelector)\r\n\t\t},\r\n\t})\r\n\r\n\treturn <const>{\r\n\t\tkey: ObjectKeys(uidResults).find(x => uidResults[x].condition()),\r\n\t\tuidResults,\r\n\t}\r\n}\r\n\r\nfunction GetPreSelector() {\r\n\treturn [\r\n\t\t[...window.AvoidCircularDependency.getCurrentClassesToObserver()].map(\r\n\t\t\ts => '.' + s\r\n\t\t),\r\n\t\t'.yt-gif-wrapper',\r\n\t]\r\n}\r\nfunction GetIsDmmTutorial(el: Element) {\r\n\treturn (<const>{\r\n\t\tuid: 'irrelevant-uid',\r\n\t\turl: '',\r\n\t\tel,\r\n\t\ttargetSelector: ['[data-video-url]'].join(),\r\n\r\n\t\tcondition: function () {\r\n\t\t\treturn (this.url = this.el.getAttribute(attrInfo.url.path) || '')\r\n\t\t},\r\n\t\tgrandParentBlock: function () {\r\n\t\t\treturn this.el.closest('.dropdown-content')\r\n\t\t},\r\n\t}) as TBase\r\n}\r\nfunction GetIsAlias(el: El) {\r\n\treturn (<const>{\r\n\t\tuid: '',\r\n\t\turl: '',\r\n\t\tel: openAlias(aliasSel.inline.is),\r\n\r\n\t\ttargetSelector: [aliasSel.inline.is].join(),\r\n\r\n\t\tfrom: aliasSel.inline.from,\r\n\t\tgrandParentBlock: grandParentBlockFromAlias,\r\n\t\tuidCondition: condition,\r\n\t\tcondition: aliasCondition(el),\r\n\t}) as TAlias\r\n}\r\nfunction GetIsTooltipCard(el: El) {\r\n\treturn (<const>{\r\n\t\tuid: '',\r\n\t\turl: '',\r\n\t\tel: openAlias(aliasSel.card.is),\r\n\r\n\t\ttargetSelector: [aliasSel.card.is].join(),\r\n\r\n\t\tfrom: aliasSel.card.from,\r\n\t\tgrandParentBlock: grandParentBlockFromAlias,\r\n\t\tuidCondition: condition,\r\n\t\tcondition: aliasCondition(el),\r\n\t}) as TAlias\r\n}\r\nfunction GetIsComponent(el: Element) {\r\n\treturn (<const>{\r\n\t\tuid: '',\r\n\t\turl: '',\r\n\t\ttargetSelector: GetPreSelector().join(),\r\n\t\tel,\r\n\r\n\t\tcondition,\r\n\t\tgrandParentBlock,\r\n\t\t...SubUrlObj,\r\n\t}) as TBase\r\n}\r\n","import type { ICongif } from '../types/config'\r\nimport {\r\n\tYTGIF_Config,\r\n\tAnchor_Config,\r\n\tanchorInstanceMap,\r\n\tUIDtoURLInstancesMapMap,\r\n} from '../types/config'\r\nimport { getBlockStringByUID } from '$lib/utils-roam-alpha-api'\r\nimport { pushSame } from '$lib/utils'\r\nimport { preRgxComp, BlockRegexObj } from '../utils'\r\n\r\nexport async function getAnchor_smart(uid: string) {\r\n\treturn getMap_smart(\r\n\t\tuid,\r\n\t\tanchorInstanceMap,\r\n\t\tgetComponentMap,\r\n\t\tuid,\r\n\t\tAnchor_Config\r\n\t)\r\n}\r\nexport async function getUrlMap_smart(uid: string) {\r\n\treturn getMap_smart(\r\n\t\tuid,\r\n\t\tUIDtoURLInstancesMapMap,\r\n\t\tgetComponentMap,\r\n\t\tuid,\r\n\t\tYTGIF_Config\r\n\t)\r\n}\r\nexport async function getMap_smart<V = Trm_map>(\r\n\tkey: string,\r\n\tmap: Map<string | TObjAsKey, unknown>,\r\n\tcallback: Function,\r\n\t...setMapCb_params: Array<unknown>\r\n) {\r\n\t// https://stackoverflow.com/questions/3458553/javascript-passing-parameters-to-a-callback-function#:~:text=console.log(param1)%3B%0A%7D-,function%20callbackTester(callback%2C%20...params)%20%7B,-callback(...params)%3B%0A%7D%0A%0A%0A%0AcallbackTester\r\n\t// since it store recursive maps, once per instance it's enough\r\n\t// try {\r\n\tif (!key)\r\n\t\tthrow new Error('invalid uid|key while trying to call getComponentMap')\r\n\tif (!map.has(key)) map.set(key, await callback(...setMapCb_params))\r\n\t//@ts-ignore\r\n\treturn map.get(key) as V\r\n\t// } catch (error) {\r\n\t// \tconsole.log(error)\r\n\t// FIXME?\r\n\t// \treturn null // If there's and error The entire app should sotp either way... so we can't return null\r\n\t// }\r\n}\r\nexport async function getComponentMap(tempUID: string, _Config: ICongif) {\r\n\tlet uidMagazine = Array<string>()\r\n\tlet indentFunc = 0\r\n\tconst { componentPage, targetStringRgx, scatteredMatch } = _Config\r\n\r\n\tclass TOrder {\r\n\t\torder = -1\r\n\t\tincrementIf: (x: unknown) => n | null = (condition: unknown) => {\r\n\t\t\treturn condition ? Number(++this.order) : null\r\n\t\t}\r\n\t\tcondition = (x: unknown) => false\r\n\t}\r\n\t//TODO:\r\n\ttype position = {\r\n\t\tis: isKey\r\n\t\torder: number\r\n\t\tcapture: StrSearch\r\n\t}\r\n\ttype rmObj = position & {\r\n\t\tvalue: string\r\n\t\ttargetStringsWithUids?: Array<rmResObj>\r\n\t}\r\n\ttype rmResObj = rmObj | rmResObj[]\r\n\tclass IResults {\r\n\t\t'is tooltip card' = new TOrder()\r\n\t\t'is substring' = new TOrder()\r\n\t\t'is component' = new TOrder()\r\n\t\t'is alias' = new TOrder()\r\n\t\t'is block reference' = new TOrder()\r\n\t}\r\n\tclass IStringWithUIDs {\r\n\t\ttargetStringsWithUids = Array<rmResObj>()\r\n\t\tblockReferencesAlone = Array<string>()\r\n\t\tuid: string = ''\r\n\t\tuidHierarchy = Array<string>()\r\n\t\tisKey?: isKey\r\n\t}\r\n\r\n\t// create results from Iresults\r\n\tconst results = new IResults()\r\n\r\n\t//Object.keys(results).forEach(key => Object.assign(results[key], orderObj))\r\n\t// componentsInOrderMap\r\n\treturn TryToFindTargetStrings_Rec(\r\n\t\tawait TryToFindTargetString(tempUID),\r\n\t\tnew IStringWithUIDs(),\r\n\t\tnew Map()\r\n\t)\r\n\r\n\tasync function TryToFindTargetStrings_Rec(\r\n\t\tobjRes: IStringWithUIDs,\r\n\t\tparentObj: IStringWithUIDs,\r\n\t\tmap: Trm_map\r\n\t) {\r\n\t\tfor (const matchObj of objRes?.targetStringsWithUids) {\r\n\t\t\t// loop through RENDERED targetStrings (components) and uids (references)\r\n\t\t\tconst { value, is } = matchObj as rmObj\r\n\t\t\tconst generateUniqueKey = (): TObjAsKey =>\r\n\t\t\t\tassertUniqueKey_while(\r\n\t\t\t\t\tobjRes.uid,\r\n\t\t\t\t\tindentFunc,\r\n\t\t\t\t\tmatchObj as position\r\n\t\t\t\t)\r\n\r\n\t\t\tif (\r\n\t\t\t\t['is alias', 'is component', 'is substring'].some(w => w === is)\r\n\t\t\t) {\r\n\t\t\t\tmap.set(generateUniqueKey(), value)\r\n\t\t\t} else if (is === 'is tooltip card') {\r\n\t\t\t\tconst { tooltipKey, tooltipObj } = generateTooltipObj(\r\n\t\t\t\t\tvalue,\r\n\t\t\t\t\tobjRes,\r\n\t\t\t\t\tgenerateUniqueKey\r\n\t\t\t\t) // save it a spot in the map\r\n\t\t\t\tconst tooltipMap = await TryToFindTargetStrings_Rec(\r\n\t\t\t\t\ttooltipObj,\r\n\t\t\t\t\tparentObj,\r\n\t\t\t\t\tnew Map()\r\n\t\t\t\t)\r\n\t\t\t\tmap.set(tooltipKey, tooltipMap) // assign it\r\n\t\t\t} else if (is == 'is block reference') {\r\n\t\t\t\tparentObj.uidHierarchy = pushSame(parentObj.uidHierarchy, value)\r\n\r\n\t\t\t\tconst comesFromRecursiveParent = parentObj?.uid == value\r\n\t\t\t\tconst isSelfRecursive =\r\n\t\t\t\t\tparentObj?.blockReferencesAlone?.includes(value) ||\r\n\t\t\t\t\tvalue == tempUID\r\n\t\t\t\tconst pastFirstLevel =\r\n\t\t\t\t\tindentFunc > parentObj?.uidHierarchy?.length ?? 1\r\n\t\t\t\tif (\r\n\t\t\t\t\tcomesFromRecursiveParent ||\r\n\t\t\t\t\t(pastFirstLevel && isSelfRecursive)\r\n\t\t\t\t)\r\n\t\t\t\t\tcontinue // skip it | unrendered\r\n\r\n\t\t\t\t// it is rendered, so execute it's rec func\r\n\t\t\t\tindentFunc += 1\r\n\t\t\t\tobjRes.isKey = is\r\n\t\t\t\tmap = await TryToFindTargetStrings_Rec(\r\n\t\t\t\t\tawait TryToFindTargetString(value),\r\n\t\t\t\t\tobjRes,\r\n\t\t\t\t\tmap\r\n\t\t\t\t)\r\n\t\t\t\tindentFunc -= 1\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn map\r\n\r\n\t\tfunction assertUniqueKey_while(\r\n\t\t\tuid: string,\r\n\t\t\tindent: number,\r\n\t\t\t{ is, order, capture }: position\r\n\t\t): TObjAsKey {\r\n\t\t\tuidMagazine = PushIfNewEntry(uidMagazine, uid) // clunky, but it works\r\n\r\n\t\t\tconst similarCount = uidMagazine.filter(x => x === uid).length // uniqueKey among non siblings\r\n\t\t\treturn <const>{\r\n\t\t\t\tindent,\r\n\t\t\t\tuid,\r\n\t\t\t\tsimilarCount,\r\n\t\t\t\tisKey: is,\r\n\t\t\t\tisKeyOrder: isCount(),\r\n\t\t\t\torder,\r\n\t\t\t\tcapture: capture as string,\r\n\t\t\t}\r\n\r\n\t\t\tfunction isCount() {\r\n\t\t\t\tfor (const [_is, _val] of Object.entries(results))\r\n\t\t\t\t\t_val.incrementIf(_is === is)\r\n\r\n\t\t\t\treturn results[is].order\r\n\t\t\t}\r\n\t\t}\r\n\t\tfunction PushIfNewEntry<T>(arr: Array<T>, item: T) {\r\n\t\t\tconst lastItem = [...arr]?.pop()\r\n\t\t\tif (lastItem != item) arr = pushSame(arr, item)\r\n\t\t\treturn arr\r\n\t\t}\r\n\t}\r\n\r\n\tfunction generateTooltipObj(\r\n\t\tvalue: string,\r\n\t\tobjRes: IStringWithUIDs,\r\n\t\tgenerateUniqueKey: Function\r\n\t) {\r\n\t\tconst tooltipObj = stringsWihtUidsObj(value)\r\n\r\n\t\ttooltipObj.uid =\r\n\t\t\tobjRes.uid +\r\n\t\t\t'_t' +\r\n\t\t\t(results['is tooltip card'].order < 0\r\n\t\t\t\t? 0\r\n\t\t\t\t: results['is tooltip card'].order)\r\n\r\n\t\tconst tooltipKey: string = generateUniqueKey()\r\n\t\treturn <const>{ tooltipKey, tooltipObj }\r\n\t}\r\n\r\n\tasync function TryToFindTargetString(desiredUID: string) {\r\n\t\tconst rawText = await getBlockStringByUID(desiredUID)\r\n\t\tconst resObj = stringsWihtUidsObj(rawText)\r\n\t\tresObj.uid = desiredUID\r\n\t\tresObj.uidHierarchy = resObj.uidHierarchy ?? []\r\n\t\treturn resObj\r\n\t}\r\n\r\n\tfunction stringsWihtUidsObj(rawText: string): IStringWithUIDs {\r\n\t\tconst { blockRgx, aliasPlusUidsRgx, tooltipCardRgx, componentRgx } =\r\n\t\t\tBlockRegexObj(componentPage, targetStringRgx)\r\n\r\n\t\tconst string = clean_rm_string(rawText)\r\n\r\n\t\tlet blockRefsOnly: string[] = [] // ACC inside getRenderedStuff()\r\n\r\n\t\tconst compactObjs = getRenderedStuff(string)\r\n\t\t// @ts-ignore Type instantiation is excessively deep and possibly infinite.ts(2539)\r\n\t\t// prettier-ignore\r\n\t\tconst targetStringsWithUids: rmResObj[] = compactObjs.flat(Infinity).filter(x => x != null);\r\n\r\n\t\treturn <const>{\r\n\t\t\t...(<IStringWithUIDs>{}),\r\n\t\t\ttargetStringsWithUids,\r\n\t\t\tblockReferencesAlone: blockRefsOnly,\r\n\t\t}\r\n\r\n\t\tfunction getRenderedStuff(string: string) {\r\n\t\t\tconst blockMatches = [\r\n\t\t\t\t...[...string.matchAll(new RegExp(blockRgx, 'gm'))].map(\r\n\t\t\t\t\t// @ts-ignore\r\n\t\t\t\t\tx => (x = x[0])\r\n\t\t\t\t),\r\n\t\t\t]\r\n\t\t\tconst siblingsOrderObj = new IResults()\r\n\r\n\t\t\treturn blockMatches.map(val => isValueObj(val, siblingsOrderObj))\r\n\r\n\t\t\tfunction isValueObj(\r\n\t\t\t\tval: string,\r\n\t\t\t\tsiblingsOrder: IResults\r\n\t\t\t): rmResObj {\r\n\t\t\t\tfunction resObj(): rmResObj {\r\n\t\t\t\t\tsiblingsOrder[is].incrementIf(true)\r\n\t\t\t\t\treturn <const>{\r\n\t\t\t\t\t\tvalue: inOrderValue as string,\r\n\t\t\t\t\t\tis,\r\n\t\t\t\t\t\torder: siblingsOrder[is].order,\r\n\t\t\t\t\t\tcapture: rgxMatch as string,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tconst match = (rgx: RegExp) => val.match(rgx)?.[0]\r\n\t\t\t\tconst matchAll = (rgx: RegExp) => [...val.matchAll(rgx)][0]\r\n\r\n\t\t\t\tlet is: isKey = 'is block reference',\r\n\t\t\t\t\tinOrderValue: StrSearch = val,\r\n\t\t\t\t\trgxMatch: StrSearch // because we're assigning and checking within the if statements\r\n\r\n\t\t\t\tif ((rgxMatch = match(tooltipCardRgx))) {\r\n\t\t\t\t\t// {{=:_rendered_by_roam_| -> string XXxxxx ... <- }}\r\n\t\t\t\t\tis = 'is tooltip card'\r\n\t\t\t\t\tinOrderValue = matchAll(tooltipCardRgx)[2]\r\n\r\n\t\t\t\t\tconst blockLikeString = matchAll(tooltipCardRgx)[1]\r\n\t\t\t\t\treturn [resObj(), ...getRenderedStuff(blockLikeString)]\r\n\t\t\t\t} else if ((rgxMatch = match(aliasPlusUidsRgx))) {\r\n\t\t\t\t\t// [xxxanything goesxxx]((( -> xxxuidxxx <- )))\r\n\t\t\t\t\tis = 'is alias'\r\n\t\t\t\t\tinOrderValue = matchAll(aliasPlusUidsRgx)[2]\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tscatteredMatch &&\r\n\t\t\t\t\t(rgxMatch = match(targetStringRgx)) &&\r\n\t\t\t\t\t!match(componentRgx)\r\n\t\t\t\t) {\r\n\t\t\t\t\t//  -> ... .... ..... -> subStrings in the wild XXxxxx ... <-\r\n\t\t\t\t\tis = 'is substring'\r\n\t\t\t\t\tinOrderValue = match(targetStringRgx)\r\n\t\t\t\t} else if (\r\n\t\t\t\t\t!scatteredMatch &&\r\n\t\t\t\t\t(rgxMatch = match(componentRgx))\r\n\t\t\t\t) {\r\n\t\t\t\t\t// {{componentPage: -> first target <- xxxxxx xxx... }}\r\n\t\t\t\t\tis = 'is component'\r\n\t\t\t\t\tinOrderValue = match(targetStringRgx)\r\n\t\t\t\t} // xxxuidxxx\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (inOrderValue.length != 9)\r\n\t\t\t\t\t\treturn null! // @ts-ignore Should be able to return null here, because we're filtering out nulls\r\n\t\t\t\t\telse blockRefsOnly = pushSame(blockRefsOnly, val)\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn resObj()\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nexport function clean_rm_string(rawText: string) {\r\n\tconst s1 = rawText.replace(\r\n\t\t/(`.+?`)|(`([\\s\\S]*?)`)/gm,\r\n\t\t'used_to_be_an_inline_code_block'\r\n\t)\r\n\treturn s1.replace(\r\n\t\tnew RegExp(preRgxComp('embed'), 'gm'),\r\n\t\t'used_to_be_an_embed_block'\r\n\t)\r\n}\r\n","// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\ntype TMap<V> = Map<any, V>\r\nexport function Value_AtIndexInMap<M, n extends number, K extends isKey>(\r\n\tmap: TMap<M>,\r\n\tvalueAtIndex: n,\r\n\tproperty: K\r\n): K extends 'is alias' | 'is component' ? string : TObjAsKey {\r\n\tconst key = FilterMapByIsKey(map, property)?.[valueAtIndex]\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\treturn map?.get(key!) as any // it's ok to return undefined\r\n}\r\nexport function ObjKey_AtIndexInMap<M>(\r\n\tmap: TMap<M>,\r\n\tvalueAtIndex: number,\r\n\tproperty: isKey\r\n) {\r\n\treturn FilterMapByIsKey(map, property)?.[valueAtIndex]\r\n}\r\nfunction FilterMapByIsKey<V>(map: Map<TObjAsKey, V>, property: isKey) {\r\n\tif (!map || map?.size == 0) return null\r\n\treturn [...map.keys()].filter(o => o['isKey'].includes(property))\r\n}\r\n","import { getUrlMap_smart } from '$v3/lib/backend-frontend/get-maps'\r\nimport { Value_AtIndexInMap } from '$v3/lib/backend-frontend/map-query'\r\nimport type { TAlias, TBase } from './composition'\r\n\r\nexport async function Flow(\r\n\tuidResults: {\r\n\t\t/* a class makes the most sense here, but they're so similar, yet so different, and it only happens once at the time I hope... */\r\n\t\t'is component': TBase\r\n\t\t'is tooltip card': TAlias\r\n\t\t'is alias': TAlias\r\n\t\t'is ddm tutorial': TBase\r\n\t},\r\n\tkey: keyof typeof uidResults\r\n) {\r\n\tconst resObj = {\r\n\t\tuid: uidResults[key].uid,\r\n\t\tpreUrlIndex: uidResults[key].getUrlIndex(),\r\n\t\taccUrlIndex: 0,\r\n\t\turl: uidResults[key].url,\r\n\t\tgrandParentBlock: uidResults[key].grandParentBlock(),\r\n\t\tnestedComponentMap: <Trm_map>{},\r\n\t\tearlyReturnKey: '',\r\n\t}\r\n\r\n\t//#region Flow\r\n\tif (key == 'is ddm tutorial') {\r\n\t\tresObj.accUrlIndex = resObj.preUrlIndex\r\n\t\treturn resObj\r\n\t} else if (key == 'is tooltip card') {\r\n\t\t// it is a block in it's own right\r\n\t\tconst tempMap = await getUrlMap_smart(uidResults[key].uid)\r\n\r\n\t\t// @ts-ignore FIXME: this will never return a Map\r\n\t\tresObj.nestedComponentMap = Value_AtIndexInMap(\r\n\t\t\ttempMap,\r\n\t\t\tresObj.preUrlIndex,\r\n\t\t\tkey\r\n\t\t)\r\n\t\t// https://roamresearch.slack.com/archives/CTAE9JC2K/p1638578496037700\r\n\t\tif (\r\n\t\t\t!resObj?.nestedComponentMap ||\r\n\t\t\tresObj?.nestedComponentMap.size == 0\r\n\t\t) {\r\n\t\t\tconsole.log('yt-gif debugger')\r\n\t\t\tresObj.nestedComponentMap = [...tempMap.values()][\r\n\t\t\t\tresObj.preUrlIndex\r\n\t\t\t] as Trm_map\r\n\t\t}\r\n\t\tif (\r\n\t\t\t!resObj?.nestedComponentMap ||\r\n\t\t\tresObj?.nestedComponentMap.size == 0\r\n\t\t) {\r\n\t\t\treturn resObj\r\n\t\t}\r\n\t\tupdateUrlIndexInsideAlias()\r\n\t} else if (key == 'is alias') {\r\n\t\tconst tempMap = await getUrlMap_smart(uidResults[key].uid)\r\n\r\n\t\t// needs it's own UID                                   // is it's parent's\r\n\t\tresObj.uid = Value_AtIndexInMap(tempMap, resObj.preUrlIndex, key)\r\n\t\tresObj.nestedComponentMap = await getUrlMap_smart(resObj.uid)\r\n\t\tupdateUrlIndexInsideAlias()\r\n\t} else {\r\n\t\tresObj.nestedComponentMap = await getUrlMap_smart(resObj.uid)\r\n\t}\r\n\t//#endregion\r\n\r\n\tresObj.url = Value_AtIndexInMap(\r\n\t\tresObj.nestedComponentMap,\r\n\t\tresObj.preUrlIndex,\r\n\t\t'is component'\r\n\t)\r\n\tresObj.accUrlIndex += resObj.preUrlIndex\r\n\treturn resObj\r\n\r\n\tfunction updateUrlIndexInsideAlias() {\r\n\t\tresObj.accUrlIndex += resObj.preUrlIndex\r\n\t\tresObj.preUrlIndex = uidResults[key].getUrlIndex() // it also needs it's own urlIndex\r\n\t}\r\n}\r\n","import { YTGIF_Config } from '$v3/lib/types/config'\r\nimport { GetUidResultObj } from './query'\r\nimport { Flow } from './flow'\r\n\r\nexport async function URLResults(el: El) {\r\n\tconst { key, uidResults } = GetUidResultObj(el)\r\n\r\n\tif (!key) {\r\n\t\treturn <typeof resObj>{}\r\n\t}\r\n\r\n\tconst resObj = await Flow(uidResults, key)\r\n\r\n\tif (!YTGIF_Config.guardClause(resObj?.url)) {\r\n\t\tresObj.url = ''\r\n\t}\r\n\r\n\treturn resObj\r\n}\r\n","import { isRendered } from '../../../lib/dom/elements-yt-gif-parent'\r\nimport { div, toggleClasses } from '$lib/utils'\r\nimport { links } from '../../config/paths'\r\n\r\n/* ***************** */\r\n\r\nexport function GetConfirmBtns(btnNames: s[], urlBtn: Function) {\r\n\t// TODO : how do you know which ppts are being used before hand?\r\n\treturn () =>\r\n\t\tbtnNames\r\n\t\t\t.map(s => urlBtn(s))\r\n\t\t\t.forEach(btn => {\r\n\t\t\t\tconst p: HTMLElement =\r\n\t\t\t\t\tbtn?.closest('.btn-row') ||\r\n\t\t\t\t\tbtn?.closest('.yt-gif-url-btn-wrapper')\r\n\t\t\t\tif (p && !btn.onclick) p.style.display = 'none'\r\n\t\t\t})\r\n}\r\nexport function GetUrlBtn<type>(el: El, sel: s) {\r\n\treturn (page: type) =>\r\n\t\tel.querySelector(`${sel} [yt-gif-url-btn=\"${page}\"]`) as IBtn\r\n}\r\nexport function appendVerticalUrlBtns(targetNode: El, kind = 'formatter') {\r\n\tconst urlBtns = appendlUrlBtns(targetNode, kind) as El\r\n\ttoggleClasses(true, ['vertical'], urlBtns)\r\n}\r\nexport function appendlUrlBtns(targetNode: El, kind = 'formatter') {\r\n\tconst c = 'yt-gif-url-btns-wrapper'\r\n\tconst el = targetNode.querySelector(`[${kind}]`) ?? div([c])\r\n\r\n\t// hardcoded for now\r\n\tconst dir = kind == 'formatter' ? 'urlBtn' : 'insertOptions'\r\n\r\n\tif (!el.querySelector('.yt-gif-url-btns'))\r\n\t\tel.insertAdjacentHTML('afterbegin', links.html.fetched[dir])\r\n\tif (!isRendered(el)) targetNode.insertAdjacentElement('afterbegin', el)\r\n\r\n\ttoggleClasses(true, [c], el)\r\n\treturn targetNode.querySelector('.yt-gif-url-btns')\r\n}\r\n","import type { TRes } from './types'\r\n\r\nexport function Format() {\r\n\tlet url = '',\r\n\t\thidden = ''\r\n\r\n\treturn <const>{\r\n\t\tgetters: {\r\n\t\t\tget u() {\r\n\t\t\t\treturn url\r\n\t\t\t},\r\n\t\t\tget h() {\r\n\t\t\t\treturn hidden\r\n\t\t\t},\r\n\t\t},\r\n\t\ttrim(res: TRes) {\r\n\t\t\turl = res.url as s\r\n\t\t\thidden = res.hidden ?? ''\r\n\t\t\thidden = hidden.trim() ? hidden.trim() + ' ' : ''\r\n\t\t},\r\n\t}\r\n}\r\n","import type { ExamineResObj } from './filter'\r\n\r\nexport type Tpage = 'start' | 'end' | 'speed' | 'format'\r\nexport const btnNames: Array<Tpage> = ['speed', 'start', 'end']\r\nexport type TRes = Awaited<ReturnType<typeof ExamineResObj>>\r\n","import { convertHMS, HMSToSecondsOnly, seconds2time } from '$lib/utils'\r\nimport { UI } from '../config/yt-gif-init'\r\n\r\n//DAMN!!!\r\ntype sn = string | number\r\nexport function fmtTimestamp<T extends number | string = string>(\r\n\tvalue: keyof Itime = UI.timestamps.tm_workflow_display.value as keyof Itime\r\n) {\r\n\tconst str2sec = (str: sn) => HMSToSecondsOnly(str.toString())\r\n\tlet fmt = (tms: sn): T => tms.toString() as T\r\n\r\n\tif (value == 'lessHMS')\r\n\t\tfmt = (tms: sn): T => seconds2time(str2sec(tms.toString())) as T\r\n\telse if (value == 'HMS')\r\n\t\tfmt = (tms: sn): T => convertHMS(str2sec(tms.toString())) as T\r\n\telse if (value == 'hmsSufix')\r\n\t\tfmt = (tms: sn): T => seconds2time(str2sec(tms.toString()), true) as T\r\n\telse if (value == 'S' || <T>{}.toString() == 'number')\r\n\t\tfmt = (tms: sn) => str2sec(tms.toString()) as T // I could extract this one, but nah\r\n\r\n\treturn fmt\r\n}\r\n","import { fmtTimestamp } from '../init/timestamp/utils'\r\nimport { ElementsPerBlock } from './dom/ytgif'\r\nimport { floatParam, paramRgx } from './utils'\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\nexport function replaceString({ string, start, end, replace }: any) {\r\n\tif (start < 0 || start > string.length) {\r\n\t\tthrow new RangeError(\r\n\t\t\t`start index ${start} is out of the range 0~${string.length}`\r\n\t\t)\r\n\t}\r\n\tif (end > string.length || end < start) {\r\n\t\tthrow new RangeError(\r\n\t\t\t`end index ${end} is out of the range ${start}~${string.length}`\r\n\t\t)\r\n\t}\r\n\treturn string.substring(0, start) + replace + string.substring(end)\r\n}\r\nexport function delSubstr(str: string, st: number, ed: number) {\r\n\treturn str.substring(0, st) + str.substring(ed)\r\n}\r\nexport function NonReferencedPerBlock(\r\n\tblock: Element,\r\n\tselector: string,\r\n\ttargetNode: Element\r\n) {\r\n\tconst inBlockEls = ElementsPerBlock(block, selector)\r\n\tconst closestRef = (el: El) => el.closest('.rm-block-ref[data-uid]')\r\n\tconst refParent = closestRef(targetNode)\r\n\r\n\tconst innerElms = ChildrenPerEml(selector, refParent)\r\n\tconst elemtToFilter = innerElms.length != 0 ? innerElms : inBlockEls\r\n\tconst condition = (b: El) => (refParent ? closestRef(b) : !closestRef(b))\r\n\r\n\treturn elemtToFilter.filter(condition)\r\n\tfunction ChildrenPerEml(selector: string, parent: El | null) {\r\n\t\tif (!parent) return []\r\n\t\treturn parent\r\n\t\t\t.queryAllasArr(selector)\r\n\t\t\t.filter(b => b.closest(selector) == parent)\r\n\t}\r\n}\r\nexport function isSpace(s: string) {\r\n\t// https://stackoverflow.com/questions/1496826/check-if-a-single-character-is-a-whitespace#:~:text=return%20/%5Cs/g.test(s)%3B\r\n\treturn /\\s/g.test(s)\r\n}\r\nexport function getConcatS(string: string) {\r\n\treturn isSpace([...string].pop()!) ? '' : ' '\r\n}\r\nexport function anyVisibleChar(word: string) {\r\n\treturn [...word].some(c => !isSpace(c))\r\n}\r\nexport function rgx2Gm(rgx: RegExp) {\r\n\treturn new RegExp(rgx.source, 'gm')\r\n}\r\nexport function stopEvents(e: Event) {\r\n\te.preventDefault()\r\n\te.stopPropagation()\r\n}\r\ntype TurlFmt = {\r\n\tmatch: string\r\n\tvalue?: string | number\r\n\tp: string\r\n\tfloat: boolean\r\n\tfmt: keyof Itime\r\n}\r\n/**\r\n * append page param if missing\r\n */\r\nexport function tryFmt_urlParam({\r\n\tmatch,\r\n\tvalue,\r\n\tp,\r\n\tfloat,\r\n\tfmt = 'S',\r\n}: TurlFmt) {\r\n\tlet m = match,\r\n\t\tv = value\r\n\r\n\tv = !float ? fmtTimestamp(fmt)(v ?? '0') : Number(v)\r\n\tif (!v || v == '0' || v == '0s') return m\r\n\r\n\tconst replace = new RegExp(`(${paramRgx(p).source})`)\r\n\tif (replace.test(m)) {\r\n\t\treturn m.replace(replace, `${p}=${v}`)\r\n\t} else {\r\n\t\tconst c = [...m].pop() == '?' ? '' : m.includes('?') ? '&' : '?' // ends on '?' then it is blank, else add '&' or '?' depending on which is missing\r\n\t\treturn (m += `${c}${p}=${v}`)\r\n\t}\r\n}\r\nexport function assertTmParams(url: string, fmt_?: string) {\r\n\t// HOLY SHIT THIS IS MADNESS!\r\n\tconst fmt = (p: string, v: number) =>\r\n\t\ttryFmt_urlParam({\r\n\t\t\tmatch: url,\r\n\t\t\tvalue: v,\r\n\t\t\tp,\r\n\r\n\t\t\tfloat: false,\r\n\t\t\t// @ts-ignore\r\n\t\t\tfmt: fmt_ ?? UI.timestamps.tm_workflow_grab.value,\r\n\t\t})\r\n\turl = fmt('t', floatParam('t', url))\r\n\turl = fmt('end', floatParam('end', url))\r\n\treturn url\r\n}\r\nexport function getAnyTmParamType(url: string) {\r\n\treturn getTypeOfTmParam('t', url) || getTypeOfTmParam('end', url)\r\n}\r\nexport function validTmParam(url: string) {\r\n\treturn floatParam('t', url) ?? floatParam('end', url)\r\n}\r\nexport function getTypeOfTmParam(p: string, url: string) {\r\n\tconst str = paramRgx(p)?.exec(url)?.[2] as string\r\n\tif (/:/.test(str)) return 'HMS' // lessHMS\r\n\tif (/h|m|s/.test(str)) return 'hmsSufix'\r\n\tif (/\\d+/.test(str)) return 'S'\r\n}\r\nexport async function CreateXload(src: string) {\r\n\tconst obj = {\r\n\t\tsrc: src,\r\n\t\tid: `script-yt_gif-${src}`,\r\n\t}\r\n\r\n\tromoveIfany(obj.id)\r\n\tconst script = createScript(obj)\r\n\treturn await loadScript(script)\r\n\r\n\tfunction romoveIfany(id: string) {\r\n\t\tdocument\r\n\t\t\t.queryAllasArr(`[id='${id}']`)\r\n\t\t\t.forEach(script => script.parentElement!.removeChild(script))\r\n\t}\r\n\tfunction createScript({ src, id } = obj) {\r\n\t\tconst script = document.createElement('script')\r\n\t\tscript.src = src + '?' + new Date().getTime()\r\n\t\tscript.id = id\r\n\t\tscript.async = false\r\n\t\tscript.type = 'text/javascript'\r\n\t\tdocument.getElementsByTagName('head')[0].appendChild(script)\r\n\t\treturn script\r\n\t}\r\n\tasync function loadScript(\r\n\t\tscript: HTMLScriptElement\r\n\t): Promise<HTMLScriptElement> {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\t//Script finished loading\r\n\t\t\tscript.addEventListener('load', () => resolve(script))\r\n\t\t})\r\n\t}\r\n}\r\n","import type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport type { K } from './extract'\r\n\r\nexport function GetParamFunc<V = number>(\r\n\tkey: K,\r\n\tmedia: IExtendedVideoParams,\r\n\ttm: (str: s) => V\r\n) {\r\n\t// check yourself and your aliases\r\n\tconst alias = [key, ...media[key].alias]\r\n\t// @ts-ignore\r\n\tconst init = media[key].value as V\r\n\r\n\treturn alias.reduce((acc, crr) => {\r\n\t\tconst val = tm(crr) ?? init\r\n\t\t// valid? then keep it\r\n\t\treturn val ? val : acc\r\n\t}, init)\r\n}\r\n\r\nexport function indexPairObj(regex: RegExp, str: string, type: string) {\r\n\t// https://www.designcise.com/web/tutorial/how-to-return-the-position-of-a-regular-expression-match-in-javascript#:~:text=matchArr%5B1%5D.length%5D)%3B%0A%7D-,console.log(indexPairs)%3B%20//%20output%3A%20%5B8%2C%2025%5D%2C%20%5B27%2C%2035%5D,-The%20exec()%20method\r\n\tconst matches = [...str.matchAll(regex)]\r\n\r\n\tconst indexPairs: Array<TIndexPair> = []\r\n\r\n\tfor (const matchArr of matches) {\r\n\t\tconst idx = matchArr.index ?? 0 // FIXME: have no idea if this is correct\r\n\r\n\t\tindexPairs.push({\r\n\t\t\ttype,\r\n\t\t\tstart: idx,\r\n\t\t\tend: idx + matchArr[0].length,\r\n\t\t\tmatch: matchArr[0],\r\n\t\t\tgroups: matchArr,\r\n\t\t})\r\n\t}\r\n\r\n\treturn indexPairs\r\n}\r\nexport class TIndexPair {\r\n\ttype = ''\r\n\tstart = 0\r\n\tend = 0\r\n\tmatch: StrSearch = undefined\r\n\t// @ts-ignore\r\n\tgroups: RegExpMatchArray = []\r\n}\r\n","import { BlockRegexObj, time2sec } from '../../../lib/utils'\r\nimport { rgx2Gm } from '../../../lib/helpers'\r\nimport { YTGIF_Config } from '../../../lib/types/config'\r\nimport { getYouTubeVideoID } from '$lib/utils'\r\nimport { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport { TIndexPair, indexPairObj, GetParamFunc } from './regex'\r\n\r\n/* ******** */\r\n\r\nexport function ExtractContentFromCmpt(capture: s) {\r\n\treturn (\r\n\t\t[...capture.matchAll(BlockRegexObj().componentRgx)][0]?.[5] || capture\r\n\t)\r\n}\r\nexport function ExtractUrlsObj(searchThrough: s): TIndexPair {\r\n\tconst { targetStringRgx: urlRgx, minimalRgx } = YTGIF_Config\r\n\r\n\tif (!searchThrough) return new TIndexPair()\r\n\r\n\treturn (\r\n\t\tindexPairObj(rgx2Gm(urlRgx), searchThrough, 'url')?.[0] ||\r\n\t\tindexPairObj(rgx2Gm(minimalRgx), searchThrough, 'minimal')?.[0] ||\r\n\t\tnew TIndexPair()\r\n\t)\r\n}\r\nexport type K = keyof IExtendedVideoParams\r\nexport function ExtractParamsFromUrl(url: s) {\r\n\tconst media = new IExtendedVideoParams()\r\n\tconst matches: { [key: string]: string } = {}\r\n\r\n\tif (YTGIF_Config.guardClause(url)) {\r\n\t\tfor (const pair of [...url.matchAll(/(\\w+)=([^&]+)/gm)]) {\r\n\t\t\tmatches[pair[1]] = pair[2]\r\n\t\t}\r\n\r\n\t\tmedia.id.set(getYouTubeVideoID(url))\r\n\t\tmedia.src.set(url)\r\n\r\n\t\tmedia.start.setDefault(GetStartEndParam('start'))\r\n\t\tmedia.end.setDefault(GetStartEndParam('end'))\r\n\t\tmedia.volume.set(GetNumParam('volume'))\r\n\t\tmedia.speed.setDefault(GetNumParam('speed'))\r\n\r\n\t\tmedia.hl.set(GetStrParam('hl'))\r\n\t\tmedia.cc.set(GetStrParam('cc'))\r\n\t\tmedia.sp.set(GetStrParam('sp'))\r\n\r\n\t\treturn media\r\n\t}\r\n\treturn <IExtendedVideoParams>{} // TODO: used to return null, don't know if this brakes anything\r\n\r\n\tfunction GetStartEndParam(key: K) {\r\n\t\treturn GetParamFunc(key, media, (str: s) => time2sec(matches[str]))\r\n\t}\r\n\tfunction GetNumParam(key: K) {\r\n\t\treturn GetParamFunc(key, media, (str: s) => parseFloat(matches[str]))\r\n\t}\r\n\tfunction GetStrParam(key: K) {\r\n\t\treturn GetParamFunc(key, media, (str: s) => matches[str])\r\n\t}\r\n}\r\n","import { isSpace, delSubstr } from '../../../lib/helpers'\r\nimport { ExtractUrlsObj, ExtractContentFromCmpt } from './extract'\r\n\r\n/* ***************** */\r\n\r\nexport function UrlBtnAction2InfoObj(\r\n\tcapture: s,\r\n\tExtractSubstringObj = ExtractUrlsObj\r\n) {\r\n\tconst content = ExtractContentFromCmpt(capture)\r\n\r\n\tconst matchObj = ExtractSubstringObj(content)\r\n\r\n\tconst start = matchObj?.start! // trust me typescript this will be ok\r\n\tconst end = matchObj?.end! // trust me typescript this will be ok\r\n\r\n\tlet hidden = matchObj?.match ? delSubstr(content, start, end) : ''\r\n\r\n\tif (hidden && matchObj?.match)\r\n\t\tif (isSpace(hidden[start - 1]) && isSpace(hidden[start]))\r\n\t\t\thidden = delSubstr(hidden, start - 1, start)\r\n\r\n\thidden = hidden.trim()\r\n\r\n\treturn {\r\n\t\thiddenObj: ExtractSubstringObj(hidden),\r\n\t\tmatchObj,\r\n\t\tcontentObj: {\r\n\t\t\tmatch: matchObj?.match,\r\n\t\t\thidden,\r\n\t\t\tcontent,\r\n\t\t},\r\n\t}\r\n}\r\n","import { paramRgx } from '../../../../lib/utils'\r\nimport {\r\n\ttryFmt_urlParam,\r\n\tassertTmParams,\r\n\tgetAnyTmParamType,\r\n} from '../../../../lib/helpers'\r\nimport { UI } from '../../../config/yt-gif-init'\r\nimport { ExtractUrlsObj } from '../../query/extract'\r\nimport { UrlBtnAction2InfoObj } from '../../query/match-info'\r\n\r\nexport async function FilterToUrl(o: TResObj) {\r\n\tconst actionObj = UrlBtnAction2InfoObj(o.capture, ExtractUrlsObj)\r\n\tlet match = actionObj.matchObj.match as s\r\n\tlet fmt = getAnyTmParamType(match)\r\n\tfmt = fmt == 'S' ? 'hmsSufix' : 'S'\r\n\tactionObj.matchObj.match = assertTmParams(match, fmt)\r\n\treturn getResults(actionObj)\r\n}\r\n\r\nexport async function ExamineResObj(resObj: TResObjExtraVals) {\r\n\tconst actionObj = UrlBtnAction2InfoObj(resObj.capture, ExtractUrlsObj)\r\n\r\n\tactionObj.matchObj.match = tryFmt_urlParam({\r\n\t\tmatch: actionObj.matchObj.match as s,\r\n\t\tvalue:\r\n\t\t\tresObj.from.value ??\r\n\t\t\tparamRgx(resObj.from.param)?.exec(\r\n\t\t\t\tactionObj.matchObj.match as s\r\n\t\t\t)?.[2],\r\n\t\tp: resObj.from.param,\r\n\r\n\t\tfmt: UI.timestamps.tm_workflow_grab.value as keyof Itime,\r\n\r\n\t\tfloat: resObj.from.float ?? false,\r\n\t})\r\n\r\n\t// update vars\r\n\treturn getResults(actionObj)\r\n}\r\nfunction getResults(actionObj: ReturnType<typeof UrlBtnAction2InfoObj>) {\r\n\treturn <const>{\r\n\t\turl: actionObj.matchObj.match,\r\n\t\thidden: actionObj.contentObj.hidden,\r\n\t}\r\n}\r\n","import { GetUrlBtn, GetConfirmBtns } from '../../button/creation'\r\nimport { Format } from './Format'\r\nimport type { Tpage} from './types';\r\nimport { btnNames } from './types'\r\nimport { ExamineResObj, FilterToUrl } from './filter'\r\n\r\nexport function fmtIframe2Url(\r\n\ttargetNode: El,\r\n\tinnerWrapperSel = '.yt-gif-url-btns'\r\n) {\r\n\tconst urlBtn = GetUrlBtn<Tpage>(targetNode, innerWrapperSel)\r\n\tconst { getters: _, trim } = Format()\r\n\treturn <const>{\r\n\t\turlBtn,\r\n\t\tconfirmBtns: GetConfirmBtns(btnNames, urlBtn),\r\n\t\tinstParam: async (o: TResObjExtraVals) => {\r\n\t\t\tawait ExamineResObj(o).then(trim)\r\n\t\t\treturn `{{[[yt-gif]]: ${_.u} ${_.h}}}`\r\n\t\t},\r\n\t\tupdUrl: async (o: TResObj) => {\r\n\t\t\to.to = ['url']\r\n\t\t\tawait FilterToUrl(o).then(trim)\r\n\t\t\treturn `${_.u}${_.h}`\r\n\t\t},\r\n\t}\r\n}\r\n","import { fmtTimestamp } from '../../../timestamp/utils'\r\nimport { floatParam } from '../../../../lib/utils'\r\nimport { stopEvents } from '../../../../lib/helpers'\r\nimport { UI } from '../../../config/yt-gif-init'\r\n\r\nexport type Tfmt_tm = {\r\n\tpage?: Tpage\r\n\tvalue?: s\r\n\tmatch: s\r\n}\r\nexport function StopPropagations(\r\n\turlBtn: (page: Tpage) => IBtn,\r\n\ttargetNode: El,\r\n\tinnerWrapperSel = '.yt-gif-url-btns'\r\n) {\r\n\tconst innerWrapper = targetNode.querySelector(innerWrapperSel) as IBtn\r\n\tif (innerWrapper) {\r\n\t\tinnerWrapper.onmousedown = stopEvents\r\n\t}\r\n\r\n\tbtnNames.map(s => urlBtn(s)).forEach(btn => (btn.onmousedown = stopEvents))\r\n}\r\nexport const btnNames: Array<Tpage> = [\r\n\t'yt-gif',\r\n\t'format',\r\n\t'url',\r\n\t'start',\r\n\t'end',\r\n\t'start|end',\r\n]\r\nfunction getFmtPage(p: s, url: s) {\r\n\treturn fmtTimestamp(UI.timestamps.tm_workflow_grab.value as keyof Itime)(\r\n\t\tfloatParam(p, url) || '0'\r\n\t)\r\n} // javascript is crazy!\r\n\r\nexport function startTm(url: s) {\r\n\treturn getFmtPage('t|start', url)\r\n}\r\nexport function endTm(url: s) {\r\n\treturn getFmtPage('end', url)\r\n}\r\n","import { isSpace } from '../../../../lib/helpers'\r\nimport type { TRes } from './examine'\r\n\r\nexport function Format() {\r\n\tlet url = '', // u -> url\r\n\t\thidden = '' // h -> hidden content\r\n\r\n\treturn <const>{\r\n\t\tgetters: {\r\n\t\t\tget u() {\r\n\t\t\t\treturn url\r\n\t\t\t},\r\n\t\t\tget h() {\r\n\t\t\t\treturn hidden\r\n\t\t\t},\r\n\t\t},\r\n\t\tconcatNoCmpt(res: TRes) {\r\n\t\t\thidden = hidden.trim()\r\n\t\t\tconst cs = !hidden ? '' : ' '\r\n\t\t\tconst ce = isSpace(res.space) ? '' : cs\r\n\t\t\thidden = cs + hidden + ce\r\n\t\t},\r\n\t\ttrim(res: TRes) {\r\n\t\t\turl = res.url\r\n\t\t\thidden = res.hidden ?? ''\r\n\t\t\thidden = hidden.trim() ? hidden.trim() + ' ' : ''\r\n\t\t\treturn res\r\n\t\t},\r\n\t}\r\n}\r\n","import { getBlockInfoByUIDM } from '$lib/utils-roam-alpha-api'\r\nimport { Wild_Config } from '$v3/lib/types/Wild_Config'\r\nimport type { TIndexPair } from '../query/regex'\r\n\r\nexport async function TryRecycle(\r\n\trecycledRequest: TBlockInfo[][] | null,\r\n\ttempUid: string\r\n) {\r\n\tconst blockReq = recycledRequest ?? (await getBlockInfoByUIDM(tempUid))\r\n\tconst info = blockReq?.[0]?.[0]\r\n\treturn { info, blockReq }\r\n}\r\nexport function filterOutCode(indexObj: TIndexPair[]) {\r\n\tconst inlindeCodeRgx = /(`.+?`)|(`([\\s\\S]*?)`)/gm\r\n\treturn [...indexObj].filter(x => !inlindeCodeRgx.test(x.match as s))\r\n}\r\nexport function GetPossibleMatches(\r\n\tIndexObj: (rgx: RegExp, type: s) => TIndexPair[],\r\n\ttoReplace: string\r\n) {\r\n\t// https://stackoverflow.com/questions/4009756/how-to-count-string-occurrence-in-string#:~:text=var%20m%20%3D%20this.match(new%20RegExp(search.toString().replace(/(%3F%3D%5B.%5C%5C%2B*%3F%5B%5E%5C%5D%24()%7B%7D%5C%7C%5D)/g%2C%20%22%5C%5C%22)%2C%20%22g%22))%3B\r\n\treturn IndexObj(\r\n\t\t// prettier-ignore\r\n\t\tnew RegExp(`(${toReplace.replace(/(?=[.\\\\+*?[^\\]$(){}\\|])/g, '\\\\')})`, 'gm'),\r\n\t\t'urlsMatch'\r\n\t)\r\n}\r\nexport function GetBadMatches(\r\n\tIndexObj: (rgx: RegExp, type: s) => TIndexPair[],\r\n\ttoReplace: string\r\n) {\r\n\tconst BadIndexMatches = [\r\n\t\t...IndexObj(/(`.+?`)|(`([\\s\\S]*?)`)/gm, 'codeBlocks'),\r\n\t\t...filterOutCode(IndexObj(/{{=:(.+?)\\|(.+)}}/gm, 'tooltipPrompt')).map(\r\n\t\t\tpromptToBadCode\r\n\t\t),\r\n\t]\r\n\tconst cmptRgx = Wild_Config.targetStringRgx // anyPossibleComponentsRgx\r\n\r\n\t// 1.1 get out of your own way?\r\n\tif (!toReplace.match(cmptRgx)?.[0]) {\r\n\t\t// if it were to be component it would've have filter out itself later on\r\n\t\tBadIndexMatches.push(...IndexObj(cmptRgx, 'components'))\r\n\t}\r\n\treturn BadIndexMatches\r\n}\r\nexport function TryGetStartEnd(\r\n\tvalidSubstrings: TIndexPair[],\r\n\treplaceIndex: number\r\n) {\r\n\tlet start, end\r\n\ttry {\r\n\t\t// I'm making a bet... if there is exactly one valid substring,\r\n\t\t// And the same time if the replaceIndex is out of bounds ... >\r\n\t\t// then I'm going to assume that the one \"THING\" the user clicked on\r\n\t\t// is unique whitin that particular block.\r\n\t\tif (validSubstrings.length == 1 && !validSubstrings[replaceIndex]) {\r\n\t\t\treplaceIndex = 0\r\n\t\t}\r\n\t\tstart = validSubstrings[replaceIndex].start\r\n\t\tend = validSubstrings[replaceIndex].end\r\n\t} catch (error) {\r\n\t\tconsole.log('yt-gif debugger')\r\n\t\tthrow new Error(\r\n\t\t\t`YT GIF Formatter: Crashed because of out of bounds target...`\r\n\t\t)\r\n\t}\r\n\treturn { start, end, replaceIndex }\r\n}\r\nexport function rightMatch(BadIndexMatches: TIndexPair[], good: TIndexPair) {\r\n\tlet specialCase = false\r\n\tconst badIndex = BadIndexMatches.some(bad => {\r\n\t\tconst bounded = good.start >= bad.start && good.end <= bad.end\r\n\t\tspecialCase = bad.type == 'tooltipPrompt'\r\n\t\treturn bounded\r\n\t})\r\n\tif (specialCase) return true\r\n\treturn !badIndex\r\n}\r\nfunction promptToBadCode(op: TIndexPair) {\r\n\tconst y = { ...op }\r\n\r\n\ty.start = op.start + 4 // 4 = {{=:\r\n\ty.end = op.end - (1 + op.groups[2]?.length + 2) // 1 = |     +    [2].length = hiidden content   +    2 = }}\r\n\ty.match = op.groups[1] // prompt\r\n\treturn y\r\n}\r\n","import { indexPairObj } from '../query/regex'\r\nimport {\r\n\tTryRecycle,\r\n\tGetBadMatches,\r\n\tGetPossibleMatches,\r\n\trightMatch,\r\n\tTryGetStartEnd,\r\n} from './query'\r\n\r\nexport async function TryToUpdateBlockSubString(\r\n\ttempUid: s,\r\n\treplaceIndex: n,\r\n\ttoReplace: s,\r\n\trecycledRequest: TBlockInfo[][] | null\r\n) {\r\n\tconst { info, blockReq } = await TryRecycle(recycledRequest, tempUid)\r\n\r\n\tif (!info || replaceIndex == -1) {\r\n\t\treturn { ...(<typeof res>{}), success: false, open: false }\r\n\t}\r\n\r\n\tconst index = (rgx: RegExp, type: s) => indexPairObj(rgx, info.string, type)\r\n\r\n\t// 1. gather spots/boundaries where roam does NOT render information\r\n\tconst bad = GetBadMatches(index, toReplace)\r\n\r\n\t// 2. valid spots where you can insert fmt components - user requests\r\n\tconst possible = GetPossibleMatches(index, toReplace)\r\n\tconst valid = possible.filter(good => rightMatch(bad, good))\r\n\r\n\t// NICE!\r\n\tconst res = <const>{\r\n\t\tsuccess: true,\r\n\t\tuid: tempUid,\r\n\t\t...TryGetStartEnd(valid, replaceIndex),\r\n\t\topen: info.open,\r\n\t\tstring: info.string,\r\n\t\trecycledRequest: blockReq,\r\n\t}\r\n\treturn res\r\n}\r\n","import { GetClosestRate } from '$lib/utils'\r\nimport type { TIndexPair } from './query/regex'\r\n\r\nexport type TcontentObj = {\r\n\tmatch: StrSearch\r\n\thidden: string\r\n\tcontent: string\r\n}\r\nexport type TpearCaptureObj = {\r\n\thiddenObj: TIndexPair\r\n\tmatchObj: TIndexPair\r\n\tcontentObj: TcontentObj\r\n}\r\nconst strCheck = {\r\n\tdefault: '',\r\n\tok: (str: s) => str?.length > 0,\r\n}\r\nconst boundCheck = {\r\n\tdefault: 0,\r\n\tok: (v: number) => v > 0,\r\n}\r\nconst playbackRates = [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2]\r\nexport const toUrlKeys = {\r\n\t//'id',\r\n\tspeed: {\r\n\t\tdefault: 1,\r\n\t\tok: function (x: n) {\r\n\t\t\treturn GetClosestRate(playbackRates, x) != this.default\r\n\t\t},\r\n\t},\r\n\tstart: boundCheck,\r\n\tend: boundCheck,\r\n\tvolume: {\r\n\t\tdefault: 40,\r\n\t\tok: function (v: number) {\r\n\t\t\treturn v != this.default && v >= 0\r\n\t\t},\r\n\t},\r\n\thl: strCheck,\r\n\tcc: strCheck,\r\n\tsp: strCheck,\r\n}\r\nexport type IDoubleParams = Array<keyof typeof toUrlKeys | Tpage>\r\n","import { fmtTimestamp } from '../../../timestamp/utils'\r\nimport { isSelected } from '../../../../lib/backend-frontend/option'\r\nimport { tryFmt_urlParam, assertTmParams } from '../../../../lib/helpers'\r\nimport { StartEnd_Config } from '../../../../lib/types/config'\r\nimport { UI } from '../../../config/yt-gif-init'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport { ObjectKeys } from '$lib/utils'\r\nimport type { IDoubleParams, TcontentObj } from '../../types';\r\nimport { toUrlKeys } from '../../types'\r\nimport type { Tfmt_tm } from './query'\r\nimport type { o } from './types'\r\n\r\n//#region ExamineResObj Body\r\n\r\nexport function tryFmt_timestamp({ page, value, match }: Tfmt_tm) {\r\n\t// update url\r\n\tconst p = page == 'end' ? 'end' : 't'\r\n\tconst fmt = UI.timestamps.tm_workflow_grab.value != 'S' ? 'hmsSufix' : 'S'\r\n\treturn tryFmt_urlParam({ match, value, p, fmt, float: false }) //TODO: float:null\r\n}\r\nexport function fmtUrlsObj(\r\n\tduplicateParams: IDoubleParams,\r\n\turlObj: IExtendedVideoParams\r\n) {\r\n\tlet params_ = ObjectKeys(toUrlKeys)\r\n\t\t.filter(\r\n\t\t\t// valid params\r\n\t\t\tk =>\r\n\t\t\t\t!duplicateParams.includes(k) &&\r\n\t\t\t\t// @ts-ignore\r\n\t\t\t\ttoUrlKeys[k].ok(urlObj[k].value)\r\n\t\t)\r\n\t\t.reduce((acc, crr) => {\r\n\t\t\tconst min = urlObj[crr].alias[0] || crr\r\n\t\t\treturn acc + `&${min}=${urlObj[crr].value}`\r\n\t\t}, '')\r\n\t\t.slice(1) // remove first '&'\r\n\r\n\tconst fmt = UI.timestamps.tm_workflow_grab.value != 'S' ? 'hmsSufix' : 'S'\r\n\tconst params = assertTmParams(params_, fmt) // '?' for calculations purposes only\r\n\r\n\tconst c = isSelected(UI.display.fmt_options, 'avoid_redundancy')\r\n\t\t? '/'\r\n\t\t: 'https://youtu.be/'\r\n\tconst base = (_: s) => _ + urlObj.id.value\r\n\r\n\treturn <const>{\r\n\t\tminimal: `${base('/')}?${params}`,\r\n\t\tfull: `${base('https://youtu.be/')}?${params}`,\r\n\t\tfmtUrl: params.slice(1) ? `${base(c)}?${params}` : base(c),\r\n\t}\r\n}\r\nexport function getPearTimestamp(\r\n\tfrom: o['from'],\r\n\tpear: keyof ItmSetObj = 'self'\r\n) {\r\n\treturn <const>{\r\n\t\ttimestamp: from.tmSetObj?.[pear]?.timestamp,\r\n\t\tpear,\r\n\t}\r\n}\r\nexport function TryToRemoveRedundantTmParam(\r\n\tcontentObj: TcontentObj,\r\n\t{ timestamp, pear }: ReturnType<typeof getPearTimestamp>\r\n) {\r\n\tif (!timestamp) {\r\n\t\treturn contentObj.hidden\r\n\t}\r\n\r\n\tconst value = fmtTimestamp()(timestamp)\r\n\tconst rawValue = fmtTimestamp()(\r\n\t\tcontentObj.content?.match(StartEnd_Config.targetStringRgx)?.[0] ?? '-1'\r\n\t)\r\n\r\n\tif (\r\n\t\trawValue === value &&\r\n\t\tisSelected(UI.display.fmt_options, 'avoid_redundancy')\r\n\t) {\r\n\t\tif (pear == 'self')\r\n\t\t\tcontentObj.content = contentObj.content\r\n\t\t\t\t.trim()\r\n\t\t\t\t.replace(timestamp.toString(), '')\r\n\t\treturn contentObj.hidden.replace(timestamp.toString(), '')\r\n\t}\r\n\treturn contentObj.hidden\r\n}\r\n","import {\r\n\tgetConcatS,\r\n\tNonReferencedPerBlock,\r\n\treplaceString,\r\n\tisSpace,\r\n\tdelSubstr,\r\n\trgx2Gm,\r\n} from '../../../../lib/helpers'\r\nimport { StartEnd_Config } from '../../../../lib/types/config'\r\nimport type { TcontentObj, TpearCaptureObj } from '../../types'\r\nimport { indexPairObj } from '../../query/regex'\r\nimport { UrlBtnAction2InfoObj } from '../../query/match-info'\r\nimport { TryToUpdateBlockSubString } from '../../update'\r\nimport { tryFmt_timestamp } from './filter'\r\n\r\n// from.page start, end\r\nexport async function RemovePearFromString(\r\n\tfrom: TResObjUrlBtn['from'],\r\n\tresObj: TResObj\r\n) {\r\n\tif (!from.tmSetObj?.pear) return null\r\n\r\n\tconst {\r\n\t\tObjAsKey,\r\n\t\tblock,\r\n\t\ttargetNode,\r\n\t\ttimestamp: tm,\r\n\t\tpage: p,\r\n\t} = from.tmSetObj.pear\r\n\tconst selfIndex = NonReferencedPerBlock(\r\n\t\tblock,\r\n\t\tfrom.sel(tm, p),\r\n\t\ttargetNode\r\n\t).indexOf(targetNode)\r\n\r\n\tconst { uid, capture } = ObjAsKey ?? {}\r\n\tif (!uid || !capture || selfIndex == -1)\r\n\t\tthrow new Error(`YT GIF URL Formatter: Missing pear uid or capture...`)\r\n\r\n\tconst resPear = await TryToUpdateBlockSubString(\r\n\t\tuid,\r\n\t\tselfIndex,\r\n\t\tcapture,\r\n\t\tresObj.recycledRequest\r\n\t)\r\n\r\n\tif (!resPear.success)\r\n\t\tthrow new Error(`YT GIF URL Formatter: Failed to update pear...`)\r\n\r\n\tresObj.string = replaceString({ ...resPear, replace: '' })\r\n\r\n\tconst selfBound = resObj.start + resObj.end\r\n\tconst pearBound = resPear.start + resPear.end\r\n\r\n\tif (selfBound > pearBound) {\r\n\t\t// THIS could be dumb as fuck. People could acutually lose information if I fuck up\r\n\t\tif (\r\n\t\t\tisSpace(resObj.string[resPear.start]) &&\r\n\t\t\tisSpace(resObj.string[resPear.end + 1])\r\n\t\t)\r\n\t\t\tresObj.string = replaceString(\r\n\t\t\t\tObject.assign({ ...resPear }, { end: resPear.start + 1 })\r\n\t\t\t)\r\n\t\tresObj.start -= capture.length\r\n\t\tresObj.end -= capture.length\r\n\t} else if (\r\n\t\tisSpace(resObj.string[resPear.start - 1]) &&\r\n\t\tisSpace(resObj.string[resPear.start])\r\n\t) {\r\n\t\tresObj.string = delSubstr(\r\n\t\t\tresObj.string,\r\n\t\t\tresPear.start - 1,\r\n\t\t\tresPear.start\r\n\t\t)\r\n\t}\r\n\r\n\treturn UrlBtnAction2InfoObj(capture, ExtractTmsObj_cb)\r\n\r\n\tfunction ExtractTmsObj_cb(string: s) {\r\n\t\treturn indexPairObj(\r\n\t\t\trgx2Gm(StartEnd_Config.targetStringRgx),\r\n\t\t\tstring,\r\n\t\t\t'timestamp'\r\n\t\t)?.[0]\r\n\t}\r\n}\r\nexport async function tryFmt_timestamp_pear(\r\n\tmatch: string | undefined,\r\n\tfallbackMatch: s,\r\n\tfrom: TResObj['from']\r\n) {\r\n\tconst value = match\r\n\tif (!value) return fallbackMatch\r\n\tconst page = from.tmSetObj?.pear?.page\r\n\treturn tryFmt_timestamp({\r\n\t\tpage,\r\n\t\tvalue,\r\n\t\tmatch: fallbackMatch as s,\r\n\t})\r\n}\r\nexport function TryToAppendHiddenPearContent(\r\n\tpearCaptureObj: TpearCaptureObj | null,\r\n\tcontentObj: TcontentObj\r\n) {\r\n\tconst h = pearCaptureObj?.contentObj?.hidden\r\n\tif (!h) return ''\r\n\tcontentObj.content ??= ''\r\n\tconst c = getConcatS(contentObj.content)\r\n\treturn c + pearCaptureObj.contentObj?.content?.trim() + ' '\r\n}\r\n","export type Trm_block = { uid: string; string: string }\r\nexport interface ILastUrlObj {\r\n\tmatch: string\r\n\tindex: number\r\n\tcomponentMap: Trm_map\r\n\tfrom: string\r\n\tObjAsKey: TObjAsKey\r\n}\r\nexport class TIframeMap {\r\n\tblockID: StrSearch = undefined\r\n\tstart = 0\r\n\tend = 0\r\n\tHMS = 0\r\n\tcrrTime: number | undefined = undefined\r\n\tcondition = (sufix: string) => false\r\n}\r\nexport type Itime = {\r\n\tlessHMS: string\r\n\tHMS: string\r\n\thmsSufix: string\r\n\tS: string\r\n}\r\nexport type IFilters = {\r\n\ttargets: TIframeMap\r\n\tlastParams: TIframeMap\r\n}\r\n","import { recordedIDs, lastBlockIDParameters } from '../types/config'\r\nimport { convertHMS, seconds2time } from '$lib/utils'\r\nimport { properBlockIDSufix, floatParam } from '../utils'\r\nimport type { TVideoParams } from '$v3/lib/types/video-types'\r\nimport type { T_YT_RECORD } from '../types/yt-types'\r\nimport { ObjectValues } from '$lib/utils'\r\nimport type { ILastUrlObj, Trm_block, IFilters, Itime } from './types';\r\nimport { TIframeMap } from './types'\r\n\r\n//#region get last cmpts utils\r\n\r\nexport function getYTGIFparams(\r\n\tblockObj: Trm_block,\r\n\tlastUrlObj: ILastUrlObj,\r\n\tfilterUrlObj: IFilters,\r\n\toriginBlockObj: Trm_block\r\n) {\r\n\tconst { match, index, componentMap } = lastUrlObj\r\n\r\n\tconst possibleIDsfx = blockObj.uid + properBlockIDSufix(match, index)\r\n\r\n\tconst filter = ObjectValues(filterUrlObj).find(x =>\r\n\t\tx.condition(possibleIDsfx)\r\n\t)\r\n\r\n\tconst startObj = getBoundaryObj(floatParam('t|start', match).toString())\r\n\tconst endObj = getBoundaryObj(floatParam('end', match).toString())\r\n\r\n\treturn <const>{\r\n\t\tformats: getBoundaryObj(filter?.crrTime?.toString() || ''),\r\n\t\tfoundBlock: {\r\n\t\t\t...blockObj,\r\n\t\t\tlastUrl: match,\r\n\t\t\tlastIndex: index,\r\n\t\t\tcomponentMap: componentMap,\r\n\t\t\tblockID: filter?.blockID,\r\n\t\t\tpossibleBlockIDSufix: possibleIDsfx,\r\n\t\t},\r\n\t\ttargetBlock: {\r\n\t\t\t...originBlockObj,\r\n\t\t\tstart: startObj,\r\n\t\t\tend: endObj,\r\n\t\t},\r\n\t\tok: <boolean>true,\r\n\t}\r\n}\r\nexport function AssembleFilterObjs(): IFilters {\r\n\t// TODO: HMS: 000 to HMS: 0\r\n\tconst endsWith = <T>(sfx: string, map: Map<StrSearch, T>) =>\r\n\t\t[...map.keys()].find(k => k?.endsWith(sfx))\r\n\r\n\treturn <const>{\r\n\t\ttargets: {\r\n\t\t\t...new TIframeMap(),\r\n\t\t\tcondition: function (sfx: s): b {\r\n\t\t\t\t// prettier-ignore\r\n\t\t\t\tconst val = AssertValue<T_YT_RECORD>(this, sfx, recordedIDs)?.wTarget?.getCurrentTime();\r\n\t\t\t\treturn AssertCrrTime.call(this, val)\r\n\t\t\t},\r\n\t\t},\r\n\t\tlastParams: {\r\n\t\t\t...new TIframeMap(),\r\n\t\t\tcondition: function (sfx: s): b {\r\n\t\t\t\t// prettier-ignore\r\n\t\t\t\tconst val = AssertValue<TVideoParams>(this, sfx, lastBlockIDParameters)?.updateTime?.value;\r\n\t\t\t\treturn AssertCrrTime.call(this, val)\r\n\t\t\t},\r\n\t\t},\r\n\t}\r\n\r\n\t// Alright... // FIXME:\r\n\tfunction AssertValue<T>(o: TIframeMap, sfx: s, map: Map<StrSearch, T>) {\r\n\t\to.blockID = endsWith(sfx, map)\r\n\t\treturn map.get(o.blockID) as T\r\n\t}\r\n\tfunction AssertCrrTime(this: TIframeMap, val: n | undefined) {\r\n\t\tthis.crrTime = val ?? this.crrTime\r\n\t\treturn val ? true : false\r\n\t}\r\n}\r\nfunction getBoundaryObj(v: string): Itime {\r\n\treturn <const>{\r\n\t\tlessHMS: seconds2time(parseInt(v)),\r\n\t\tHMS: convertHMS(v),\r\n\t\thmsSufix: seconds2time(parseInt(v), true),\r\n\t\tS: v,\r\n\t}\r\n}\r\n","import { YTGIF_Config, Anchor_Config, anchorInstanceMap } from '../types/config'\r\nimport {\r\n\tgetBlockParentUids_custom,\r\n\tgetBlockStringByUID,\r\n} from '$lib/utils-roam-alpha-api'\r\nimport type { ILastUrlObj, Trm_block } from './types'\r\nimport {\r\n\tgetMap_smart,\r\n\tgetComponentMap,\r\n\tgetUrlMap_smart,\r\n\tclean_rm_string,\r\n} from './get-maps'\r\nimport { AssembleFilterObjs, getYTGIFparams } from './components'\r\n\r\n//#region  backend/frontend communication - XXX_Config = {...}\r\n\r\nexport async function getLastAnchorCmptInHierarchy(\r\n\ttempUID: string,\r\n\tincludeOrigin = true\r\n) {\r\n\t// the anchor workflow is to find itself and any valid urls in the process\r\n\tconst filterUrlObj = AssembleFilterObjs()\r\n\tconst { blockStrings, originBlockObj } = await getParentsHierarchy(\r\n\t\ttempUID,\r\n\t\tincludeOrigin\r\n\t)\r\n\r\n\tfor (let blockObj of blockStrings?.reverse()) {\r\n\t\tconst componentMap = await getMap_smart(\r\n\t\t\tblockObj.uid,\r\n\t\t\tanchorInstanceMap,\r\n\t\t\tgetComponentMap,\r\n\t\t\t// rest\r\n\t\t\tblockObj.uid,\r\n\t\t\tAnchor_Config\r\n\t\t)\r\n\t\tconst reverseEntries = [...componentMap.entries()].reverse()\r\n\t\tconst lastUrlObj = await findLastAnchorObj(reverseEntries, componentMap) // this right here\r\n\r\n\t\tif (!lastUrlObj || !lastUrlObj.match) continue\r\n\r\n\t\tif (lastUrlObj.from == 'yt-gif')\r\n\t\t\tblockObj = Object.assign(blockObj, lastUrlObj.ObjAsKey)\r\n\t\t// blockObj.anchor: { ...blockObj }, seems like this is not needed\r\n\t\treturn getYTGIFparams(\r\n\t\t\tblockObj,\r\n\t\t\tlastUrlObj,\r\n\t\t\tfilterUrlObj,\r\n\t\t\toriginBlockObj\r\n\t\t)\r\n\t}\r\n\treturn <ReturnType<typeof getYTGIFparams>>{ ok: false }\r\n}\r\nasync function findLastAnchorObj(\r\n\treverseEntries: Trm_map_entry[],\r\n\tmap: Trm_map\r\n) {\r\n\tconst resObj = (str: string, entry: Trm_map_entry) =>\r\n\t\t<const>{\r\n\t\t\tmatch: str,\r\n\t\t\tindex: reverseEntries.indexOf(entry),\r\n\t\t\tcomponentMap: map,\r\n\t\t\tfrom: 'anchor',\r\n\t\t\tObjAsKey: <TObjAsKey>{},\r\n\t\t}\r\n\r\n\tfor (const entry of reverseEntries) {\r\n\t\tconst [obj, str] = entry as [TObjAsKey, string]\r\n\t\t// str could be either an xxxuidxxx or an url, bc Anchor_Config pages are those... 'yt-gif' or 'yt-gif/anchor'\r\n\t\tconst match = obj?.capture\r\n\t\t\t? [...obj?.capture.matchAll(Anchor_Config.componentRgx)][0]\r\n\t\t\t: []\r\n\t\tconst page = match?.[2]\r\n\t\tconst content = match?.[5]\r\n\r\n\t\tif (page == 'yt-gif' && YTGIF_Config.guardClause(str))\r\n\t\t\t// it is an url\r\n\t\t\treturn resObj(str, entry)\r\n\t\tif (page != 'yt-gif/anchor' || !content)\r\n\t\t\t// is not an anchor\r\n\t\t\tcontinue\r\n\t\tif (YTGIF_Config.guardClause(str))\r\n\t\t\t// it is an url inside an anchor\r\n\t\t\treturn resObj(str, entry)\r\n\t\tif (!str || str.length != 9)\r\n\t\t\t// is it a valid uid?\r\n\t\t\tcontinue\r\n\r\n\t\treturn getLastUrlObjInMap(str)\r\n\t}\r\n\treturn null\r\n}\r\nasync function getLastUrlObjInMap(uid: string): Promise<ILastUrlObj> {\r\n\tconst componentMap = await getUrlMap_smart(uid)\r\n\tconst reverseValues = [...componentMap.values()].reverse()\r\n\tconst match = reverseValues.find(str => YTGIF_Config.guardClause(str))\r\n\tconst index = reverseValues.indexOf(match!) // I expect the posibility of -1 the Non-null assertion operator makes that possible?\r\n\r\n\treturn (<const>{\r\n\t\tmatch,\r\n\t\tindex,\r\n\t\tcomponentMap,\r\n\t\tfrom: 'yt-gif',\r\n\t\tObjAsKey: [...componentMap.keys()].reverse()[index],\r\n\t\t// FIXME: This will break, 100% sure\r\n\t}) as ILastUrlObj\r\n}\r\nasync function getParentsHierarchy(\r\n\ttempUID: string,\r\n\tincludeOrigin: boolean\r\n): Promise<{ originBlockObj: Trm_block; blockStrings: Trm_block[] }> {\r\n\tconst ParentHierarchy = await getBlockParentUids_custom(tempUID)\r\n\t// if (!ParentHierarchy) {\r\n\t// \treturn null // turns out the function had a try/catch, so this is not needed\r\n\t// \t//throw new Error('no parent hierarchy')\r\n\t// }\r\n\tlet Hierarchy: typeof ParentHierarchy,\r\n\t\toriginalStr = ''\r\n\r\n\tif (!includeOrigin) {\r\n\t\tHierarchy = ParentHierarchy\r\n\t} else {\r\n\t\toriginalStr = (await getBlockStringByUID(tempUID)) || ''\r\n\t\tHierarchy = [\r\n\t\t\t...ParentHierarchy,\r\n\t\t\t[\r\n\t\t\t\t{ uid: tempUID, string: originalStr },\r\n\t\t\t\t{ title: 'made-up', uid: 'invalid' },\r\n\t\t\t],\r\n\t\t]\r\n\t}\r\n\r\n\treturn <const>{\r\n\t\tblockStrings: Hierarchy.map(arr => arr[0]).map(o => ({\r\n\t\t\tstring: clean_rm_string(o.string),\r\n\t\t\tuid: o.uid,\r\n\t\t})),\r\n\t\toriginBlockObj: {\r\n\t\t\tstring: originalStr,\r\n\t\t\tuid: tempUID,\r\n\t\t},\r\n\t}\r\n}\r\n","import { paramRgx } from '../../../../lib/utils'\r\nimport { getLastAnchorCmptInHierarchy } from '../../../../lib/backend-frontend/xxx-congif'\r\nimport type { o } from './types'\r\n\r\n// to url, yt-gif\r\nexport function TryToReorderTmParams(p: s, url: s) {\r\n\tconst t = 'start|t' // this is annoying...\r\n\tp = p ?? t\r\n\tp = p.includes('t') ? t : 'end'\r\n\r\n\tconst o = p.includes('t') ? 'end' : t\r\n\tconst wrongOrderRegex = new RegExp(\r\n\t\t`(${paramRgx(o).source})(.*&)(${paramRgx(p).source})`\r\n\t)\r\n\r\n\tif (wrongOrderRegex.test(url)) url = url.replace(wrongOrderRegex, '$6$5$1')\r\n\treturn url\r\n}\r\nexport async function TryToAssertHierarchyUrl({ uid }: o) {\r\n\tconst { foundBlock } = await getLastAnchorCmptInHierarchy(uid, false)\r\n\tif (!foundBlock?.lastUrl) return ''\r\n\r\n\treturn foundBlock.lastUrl\r\n}\r\n","import { isSelected } from '../../../../lib/backend-frontend/option'\r\nimport { getConcatS } from '../../../../lib/helpers'\r\nimport { UI } from '../../../config/yt-gif-init'\r\nimport { ExtractParamsFromUrl } from '../../query/extract'\r\nimport { UrlBtnAction2InfoObj } from '../../query/match-info'\r\nimport {\r\n\tRemovePearFromString,\r\n\ttryFmt_timestamp_pear,\r\n\tTryToAppendHiddenPearContent,\r\n} from './from.start-end'\r\nimport { TryToAssertHierarchyUrl, TryToReorderTmParams } from './to.url-ytgif'\r\nimport {\r\n\tTryToRemoveRedundantTmParam,\r\n\tgetPearTimestamp,\r\n\ttryFmt_timestamp,\r\n\tfmtUrlsObj,\r\n} from './filter'\r\nimport type { TIndexPair } from '../../query/regex'\r\n\r\nexport type TRes = Awaited<ReturnType<typeof ExamineResObj>>\r\nexport async function ExamineResObj(resObj: TResObjUrlBtn) {\r\n\tconst { capture, from, to } = resObj\r\n\tconst { contentObj, matchObj, hiddenObj } = UrlBtnAction2InfoObj(capture)\r\n\tconst { lastUrl, url } = await TryGetUrlMatches(resObj, matchObj)\r\n\r\n\t//#region body\r\n\tmatchObj.match = url\r\n\r\n\tcontentObj.hidden = TryAssignMatch(contentObj)\r\n\r\n\t// remove redundant tm\r\n\tcontentObj.hidden = TryToRemoveRedundantTmParam(\r\n\t\tcontentObj,\r\n\t\tgetPearTimestamp(from, 'self')\r\n\t)\r\n\r\n\t// append page param if missing\r\n\tmatchObj.match = tryFmt_timestamp({\r\n\t\tpage: from.page,\r\n\t\tvalue: getPearTimestamp(from).timestamp,\r\n\t\tmatch: matchObj.match,\r\n\t})\r\n\t//#endregion\r\n\r\n\tif (['start', 'end'].some(p => p == to[0])) {\r\n\t\tconst foundUrl = getFmtUrl(to, url)\r\n\t\tconst lastFmtUrl = getLastFmtUrl(to, lastUrl)\r\n\r\n\t\tif (differentUrls(hiddenObj, foundUrl, lastFmtUrl)) {\r\n\t\t\tconst c = getConcatS(contentObj.hidden)\r\n\t\t\tcontentObj.hidden += `${c + foundUrl} `\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\telse if (['start', 'end'].some(p => p == from.page)) {\r\n\t\t// append pear content\r\n\t\tif (isSelected(UI.display.fmt_options, 'lift_pears')) {\r\n\t\t\tconst pearCaptureObj = await RemovePearFromString(from, resObj)\r\n\t\t\tmatchObj.match = await tryFmt_timestamp_pear(\r\n\t\t\t\tpearCaptureObj?.matchObj?.match,\r\n\t\t\t\tmatchObj.match,\r\n\t\t\t\tfrom\r\n\t\t\t)\r\n\t\t\tcontentObj.hidden += TryToAppendHiddenPearContent(\r\n\t\t\t\tpearCaptureObj,\r\n\t\t\t\tcontentObj\r\n\t\t\t)\r\n\t\t\tcontentObj.hidden = TryToRemoveRedundantTmParam(\r\n\t\t\t\tcontentObj,\r\n\t\t\t\tgetPearTimestamp(from, 'pear')\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n\tif (['url', 'yt-gif'].some(t => t == to[0])) {\r\n\t\t// sometimes end comes before start, fix that\r\n\t\tmatchObj.match = TryToReorderTmParams(from.page, matchObj.match as s)\r\n\t}\r\n\r\n\t// update vars\r\n\treturn <const>{\r\n\t\turl: matchObj.match,\r\n\t\thidden: contentObj.hidden,\r\n\t\tspace: resObj.string[resObj.end],\r\n\t}\r\n}\r\nfunction differentUrls(\r\n\thiddenObj: TIndexPair,\r\n\tfmtUrl: string,\r\n\tlastFmtUrl: string | null\r\n) {\r\n\treturn !(hiddenObj?.match as s)?.includes?.(fmtUrl) && fmtUrl != lastFmtUrl\r\n}\r\n\r\nfunction getLastFmtUrl(to: Tpage[], lastUrl: string) {\r\n\tconst param = !lastUrl\r\n\t\t? { fmtUrl: null }\r\n\t\t: fmtUrlsObj(to, ExtractParamsFromUrl(lastUrl))\r\n\treturn param.fmtUrl\r\n}\r\n\r\nfunction getFmtUrl(to: Tpage[], url: string) {\r\n\tconst param = fmtUrlsObj(to, ExtractParamsFromUrl(url))\r\n\treturn param.fmtUrl\r\n}\r\n\r\nasync function TryGetUrlMatches(\r\n\tresObj: TResObjUrlBtn,\r\n\tmatchObj: TUrlMatchObjs['matchObj']\r\n) {\r\n\tlet _match = matchObj.match\r\n\tconst lastUrl = await TryToAssertHierarchyUrl(resObj)\r\n\tif (!_match && SelectedRelyOnHierarchy()) {\r\n\t\t_match = lastUrl\r\n\t}\r\n\tif (!_match) {\r\n\t\tthrow new Error(`YT GIF URL Formatter: Missing video url...`)\r\n\t}\r\n\treturn <const>{\r\n\t\tlastUrl,\r\n\t\turl: GetUrl(matchObj, _match),\r\n\t}\r\n}\r\ntype TUrlMatchObjs = ReturnType<typeof UrlBtnAction2InfoObj>\r\nfunction TryAssignMatch(contentObj: TUrlMatchObjs['contentObj']) {\r\n\tif (typeof contentObj.match == 'undefined') {\r\n\t\t// Hmmm...\r\n\t\treturn contentObj.content\r\n\t}\r\n\treturn contentObj.hidden\r\n}\r\n\r\nfunction GetUrl({ type }: TIndexPair, _match: string) {\r\n\treturn type == 'minimal' ? 'https://youtu.be' + _match : _match\r\n}\r\n\r\nfunction SelectedRelyOnHierarchy() {\r\n\t// try to keep running the logic, if there isn't a match exit\r\n\treturn isSelected(UI.display.fmt_options, 'rely_on_hierarchy')\r\n}\r\n","import { GetUrlBtn, GetConfirmBtns } from '../../button/creation'\r\nimport { StopPropagations, btnNames, startTm, endTm } from './query'\r\nimport { Format } from './Format'\r\nimport { ExamineResObj } from './examine'\r\nimport type { o } from './types'\r\n\r\nexport function fmtTimestampsUrlObj(\r\n\ttargetNode: El,\r\n\tinnerWrapperSel = '.yt-gif-url-btns'\r\n) {\r\n\tconst urlBtn = GetUrlBtn<Tpage>(targetNode, innerWrapperSel)\r\n\tStopPropagations(urlBtn, targetNode)\r\n\tconst { getters: _, trim, concatNoCmpt } = Format()\r\n\treturn <const>{\r\n\t\tstartTm,\r\n\t\tendTm,\r\n\t\turlBtn,\r\n\t\tconfirmBtns: GetConfirmBtns(btnNames, urlBtn),\r\n\t\tasync ytGifCmpt(o: o) {\r\n\t\t\to.to = ['yt-gif']\r\n\t\t\tawait ExamineResObj(o).then(trim)\r\n\t\t\treturn `{{[[yt-gif]]: ${_.u} ${_.h}}}`\r\n\t\t},\r\n\t\tasync startCmpt(o: o) {\r\n\t\t\to.to = ['start']\r\n\t\t\tawait ExamineResObj(o).then(trim)\r\n\t\t\treturn `{{[[yt-gif/start]]: ${startTm(_.u)} ${_.h}}}`\r\n\t\t},\r\n\t\tasync endCmpt(o: o) {\r\n\t\t\to.to = ['end']\r\n\t\t\tawait ExamineResObj(o).then(trim)\r\n\t\t\treturn `{{[[yt-gif/end]]: ${endTm(_.u)} ${_.h}}}`\r\n\t\t},\r\n\t\tasync startEndCmpt(o: o) {\r\n\t\t\to.to = ['start', 'end']\r\n\t\t\tawait ExamineResObj(o).then(trim)\r\n\t\t\t// prettier-ignore\r\n\t\t\treturn `{{[[yt-gif/start]]: ${startTm(_.u)} ${_.h}}} {{[[yt-gif/end]]: ${endTm(_.u)} }}`\r\n\t\t},\r\n\t\tasync compt2Url(o: o) {\r\n\t\t\to.to = ['url']\r\n\t\t\tawait ExamineResObj(o).then(trim).then(concatNoCmpt)\r\n\t\t\treturn `${_.u}${_.h}`\r\n\t\t},\r\n\t}\r\n}\r\n","import { ElementsPerBlock } from '../../../lib/dom/ytgif'\r\nimport { ObjKey_AtIndexInMap } from '../../../lib/backend-frontend/map-query'\r\nimport { NonReferencedPerBlock, replaceString } from '../../../lib/helpers'\r\nimport { UIDtoURLInstancesMapMap } from '../../../lib/types/config'\r\nimport { updateBlock } from '$lib/utils-roam-alpha-api'\r\nimport { TryToUpdateBlockSubString } from '../update'\r\n\r\nexport async function TryToUpdateBlock_fmt<\r\n\tT extends TblockUpd_fmt | TblockUpd_UrlBnt\r\n>({\r\n\tblock,\r\n\ttargetNode,\r\n\tsiblingSel,\r\n\tselfSel,\r\n\tgetMap,\r\n\tisKey,\r\n\tfmtCmpnt_cb,\r\n\ttempUID,\r\n\tfrom,\r\n}: T) {\r\n\t// Grab, if any, nested block information\r\n\tconst siblingIndex = ElementsPerBlock(block, siblingSel).indexOf(targetNode)\r\n\tconst selfIndex = NonReferencedPerBlock(block, selfSel, targetNode).indexOf(\r\n\t\ttargetNode\r\n\t)\r\n\tconst map = await getMap()\r\n\tconst ObjAsKey = ObjKey_AtIndexInMap(map, siblingIndex, isKey)\r\n\r\n\t// exit if the information isn't available\r\n\tconst { uid, capture } = ObjAsKey ?? {}\r\n\tif (!capture || !uid || selfIndex == -1) return\r\n\tconst res = await TryToUpdateBlockSubString(uid, selfIndex, capture, null)\r\n\tif (!res?.success) return\r\n\r\n\t// update the block\r\n\ttry {\r\n\t\tconst replaceObj = { ...res, capture, from, replace: '' }\r\n\t\treplaceObj.replace = await fmtCmpnt_cb(replaceObj)\r\n\t\tawait updateBlock(uid, replaceString(replaceObj), res.open)\r\n\t\tUIDtoURLInstancesMapMap.delete(uid)\r\n\t\tUIDtoURLInstancesMapMap.delete(tempUID)\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\t} catch (error: any) {\r\n\t\tconst _from = from as TblockUpd_UrlBnt['from']\r\n\t\tconst tp = _from?.urlBtn?.closest('[data-tooltip]')\r\n\t\tconst err = `${error?.message} ((${tempUID}))`\r\n\t\tconsole.error(err)\r\n\t\treturn tp?.setAttribute('data-tooltip', err)\r\n\t}\r\n\treturn <const>{ success: true }\r\n}\r\n","import { getUrlMap_smart } from '$v3/lib/backend-frontend/get-maps'\r\nimport { TryToUpdateBlock_fmt } from '$v3/init/formatter/Flow'\r\n\r\nexport async function OnYtGifUrlBtn(\r\n\te: Event,\r\n\tfmtCmpnt_cb: TFmtCb,\r\n\tinstance: IInstance\r\n) {\r\n\te.preventDefault()\r\n\te.stopPropagation()\r\n\r\n\tawait TryToUpdateBlock_fmt(settings(e, fmtCmpnt_cb, instance, {}))\r\n}\r\nexport async function OnYtGifInsertBtn(\r\n\te: Event,\r\n\tfmtCmpnt_cb: TFmtCb,\r\n\tinstance: IInstance,\r\n\tfromObj = {}\r\n) {\r\n\te.preventDefault()\r\n\te.stopPropagation()\r\n\r\n\t// ugly code :x\r\n\tawait TryToUpdateBlock_fmt(settings(e, fmtCmpnt_cb, instance, fromObj))\r\n}\r\nexport interface IInstance {\r\n\tgrandParentBlock: El\r\n\twrapper: El\r\n\turl: s\r\n\tuid: s\r\n}\r\nfunction settings(\r\n\te: Event,\r\n\tfmtCmpnt_cb: TFmtCb,\r\n\tinstance: IInstance,\r\n\tfromObj = {}\r\n): TblockUpd_UrlBnt {\r\n\treturn <const>{\r\n\t\tblock: instance.grandParentBlock,\r\n\t\ttargetNode: instance.wrapper,\r\n\r\n\t\tsiblingSel: '.yt-gif-wrapper',\r\n\t\tselfSel: `[data-video-url=\"${instance.url}\"]`,\r\n\r\n\t\tgetMap: async () => getUrlMap_smart(instance.uid),\r\n\t\tisKey: 'is component',\r\n\r\n\t\ttempUID: instance.uid,\r\n\r\n\t\tfrom: {\r\n\t\t\tcaster: 'player',\r\n\t\t\tpage: 'yt-gif',\r\n\t\t\turlBtn: e.target as El,\r\n\t\t\t...fromObj,\r\n\t\t},\r\n\t\tfmtCmpnt_cb,\r\n\t}\r\n}\r\n","import { isSelected } from '../../../lib/backend-frontend/option'\r\nimport { s_u_f_key } from '../../../lib/types/config'\r\nimport { isTrue } from '$lib/utils'\r\nimport { UI } from '../../config/yt-gif-init'\r\n\r\n/* ***************** */\r\n\r\nexport function ValidUrlBtnUsage() {\r\n\tconst key = s_u_f_key\r\n\r\n\tconst binarySessionVal = (k: s) =>\r\n\t\tisTrue(\r\n\t\t\twindow.YT_GIF_DIRECT_SETTINGS?.get(\r\n\t\t\t\t'ms_options'\r\n\t\t\t\t// @ts-ignore //TODO:\r\n\t\t\t)?.sessionValue?.includes?.(k)\r\n\t\t)\r\n\r\n\tconst usageKey =\r\n\t\tbinarySessionVal('override_' + key) ||\r\n\t\tisTrue(localStorage.getItem(key) as s)\r\n\r\n\treturn usageKey && binarySessionVal(key)\r\n}\r\nexport function valid_url_formatter() {\r\n\t// @ts-ignore //TODO:\r\n\treturn isSelected(UI.display.ms_options, s_u_f_key) && ValidUrlBtnUsage()\r\n}\r\n","import { fmtIframe2Url } from '$v3/init/formatter/Flow/url'\r\nimport { fmtTimestampsUrlObj } from '$v3/init/formatter/Flow/timestamp'\r\nimport type { T_YT_RECORD } from '$v3/lib/types/yt-types'\r\nimport type { IInstance} from './query';\r\nimport { OnYtGifUrlBtn, OnYtGifInsertBtn } from './query'\r\nimport { valid_url_formatter } from '$v3/init/formatter/button/validation'\r\nimport { appendVerticalUrlBtns } from '$v3/init/formatter/button/creation'\r\n\r\nexport function tryToInsertControls(instance: IInstance, record: T_YT_RECORD) {\r\n\tconst { wrapper } = instance\r\n\r\n\tappendVerticalUrlBtns(\r\n\t\twrapper.querySelector('[insertOptions]')!,\r\n\t\t'insertOptions'\r\n\t)\r\n\tconst iframe2urlObj = fmtIframe2Url(wrapper, '[insertOptions]')\r\n\r\n\tif (!valid_url_formatter()) return iframe2urlObj?.confirmBtns()\r\n\r\n\tAppendURLButtons(wrapper, instance)\r\n\t// FIXME: avoid passing iframe2urlObj\r\n\tAppendInsertButtons(iframe2urlObj, record, instance)\r\n}\r\nfunction AppendInsertButtons(\r\n\tiframe2urlObj: {\r\n\t\turlBtn: (page: 'start' | 'end' | 'speed' | 'format') => IBtn\r\n\t\tinstParam: (o: TResObjExtraVals) => Promise<string>\r\n\t},\r\n\trecord: T_YT_RECORD,\r\n\tinstance: IInstance\r\n) {\r\n\tconst { instParam, urlBtn: instBtn } = iframe2urlObj\r\n\tconst t = () => record?.wTarget\r\n\tconst tick = () => parseInt(t()?.getCurrentTime()?.toString()!) || 0\r\n\tconst rate = () => t()?.getPlaybackRate() || 1\r\n\tconst InsertBtn = (e: MouseEvent, o: {}) =>\r\n\t\tOnYtGifInsertBtn(e, instParam, instance, o)\r\n\r\n\tinstBtn('start').onclick = async e =>\r\n\t\tInsertBtn(e, { param: 't', value: tick() })\r\n\tinstBtn('end').onclick = async e =>\r\n\t\tInsertBtn(e, { param: 'end', value: tick() })\r\n\tinstBtn('speed').onclick = async e =>\r\n\t\tInsertBtn(e, { param: 's', value: rate(), float: true })\r\n}\r\n\r\nfunction AppendURLButtons(wrapper: Element, instance: IInstance) {\r\n\tappendVerticalUrlBtns(wrapper.querySelector('[formatter]')!) // shouldn't be null\r\n\tconst { startCmpt, endCmpt, startEndCmpt, compt2Url, urlBtn, confirmBtns } =\r\n\t\tfmtTimestampsUrlObj(wrapper, '[formatter]')\r\n\r\n\turlBtn('url').onclick = async e => OnYtGifUrlBtn(e, compt2Url, instance)\r\n\turlBtn('start').onclick = async e => OnYtGifUrlBtn(e, startCmpt, instance)\r\n\turlBtn('end').onclick = async e => OnYtGifUrlBtn(e, endCmpt, instance)\r\n\turlBtn('start|end').onclick = async e =>\r\n\t\tOnYtGifUrlBtn(e, startEndCmpt, instance)\r\n\tconfirmBtns()\r\n}\r\n","import { UI } from '../../init/config/yt-gif-init'\r\n\r\nexport async function ClickOnTimestamp<T extends IBtnArrObj>(\r\n\ttarget: IBtn,\r\n\toverride = <TClickEventOverride>{}\r\n) {\r\n\tconst seekToMessage =\r\n\t\tUI.timestamps.tm_seek_to.value == 'soft'\r\n\t\t\t? 'seekTo-soft'\r\n\t\t\t: 'seekTo-strict'\r\n\r\n\tconst event: T_TmClickDetailEvent = {\r\n\t\t// cringe event object\r\n\t\t...(<MouseEvent>{}),\r\n\t\tcurrentTarget: target,\r\n\t\twhich: 1,\r\n\t\tmute: UI.timestamps.tm_seek_action.value == 'mute',\r\n\t\tsimMessage: override.simMessage || '',\r\n\t\tseekToMessage: override.seekToMessage || seekToMessage,\r\n\t}\r\n\t// how do you resolve/return a promise using a CustomEvent handler?\r\n\tawait (target as T)?.OnClicks?.(event)\r\n}\r\n","import { ClickOnTimestamp } from '$v3/lib/event/ClickOnTimestamp'\r\nimport { ElementsPerBlock } from '$v3/lib/dom/ytgif'\r\nimport type { T_tmRecord } from '../mutation'\r\nimport { sleep } from '$lib/utils'\r\n\r\nexport function TryToSetLastActiveTimestamp(\r\n\tsetObsTimestamp: ILocalWrapper['setObsTimestamp'],\r\n\tlastActive: T_tmRecord[]\r\n) {\r\n\tconst lastActiveTimestamp = lastActive.find(\r\n\t\taO => aO?.target?.timestamp && aO.blockID\r\n\t)\r\n\tsetObsTimestamp(lastActiveTimestamp as TlastActiveTm['lastActiveTimestamp'])\r\n}\r\n\r\nexport async function TryToRecoverActiveTimestamp(\r\n\tgetCrrContainer: ILocalWrapper['getCrrContainer'],\r\n\tcommonObj: TlastActiveTm['lastActiveTimestamp'] | null,\r\n\tassign2ClickEvent = <TClickEventOverride>{}\r\n) {\r\n\tif (!commonObj) {\r\n\t\tconsole.warn('Passed null common object')\r\n\t\treturn\r\n\t}\r\n\r\n\tawait sleep(10)\r\n\tconst rm_container = getCrrContainer()\r\n\r\n\tconst children = (sel: s, self?: b) =>\r\n\t\t!self\r\n\t\t\t? rm_container?.queryAllasArr(sel)\r\n\t\t\t: [rm_container, ...rm_container?.queryAllasArr(sel)]\r\n\r\n\t// const active_rm_container = atIndex(children('.roam-block-container', true), commonObj.containerIndex);\r\n\tlet active_block = children('.roam-block')[commonObj.blockIndex]\r\n\r\n\tconst block = document.getElementById(commonObj.blockID) as El\r\n\tif (block != active_block && commonObj.workflow == 'strict') {\r\n\t\tif (!rm_container.contains(block)) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tactive_block = block // Hmmm...\r\n\t}\r\n\r\n\tconst timestamps =\r\n\t\tElementsPerBlock(active_block, '[yt-gif-timestamp-emulation]') || []\r\n\tconst targetTimestamp =\r\n\t\ttimestamps[commonObj.target.index] ||\r\n\t\ttimestamps[commonObj.start.index] ||\r\n\t\ttimestamps[commonObj.end.index] ||\r\n\t\ttimestamps[timestamps.length - 1]\r\n\r\n\tawait ClickOnTimestamp(targetTimestamp as IBtn, assign2ClickEvent)\r\n}\r\n","import { HMSToSecondsOnly, sleep } from '$lib/utils'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport { TryToRecoverActiveTimestamp } from './flow/query'\r\n\r\nexport async function AssertParamsClickTimestamp(\r\n\t// prettier-ignore\r\n\t{ getCrrContainer, getObsTimestamp }: Pick<ILocalWrapper, 'getCrrContainer' | 'getObsTimestamp'>,\r\n\tconfigParams: IExtendedVideoParams\r\n) {\r\n\tconst lastActive = getObsTimestamp()\r\n\tif (\r\n\t\t!UI.display.simulate_roam_research_timestamps.checked ||\r\n\t\t!UI.timestamps.tm_recovery.checked ||\r\n\t\t!lastActive\r\n\t) {\r\n\t\treturn\r\n\t}\r\n\tawait TryToRecoverActiveTimestamp(getCrrContainer, lastActive)\r\n\tawait sleep(10)\r\n\r\n\tconst tryActiveTm = (p: startEnd) =>\r\n\t\tconfigParams[p].set(crr => {\r\n\t\t\tconst tm = TryGetTimestampAttr(getCrrContainer, p)\r\n\t\t\treturn HMSToSecondsOnly(tm) || crr\r\n\t\t})\r\n\r\n\ttryActiveTm('start')\r\n\ttryActiveTm('end')\r\n}\r\nfunction TryGetTimestampAttr(\r\n\tgetCrrContainer: ILocalWrapper['getCrrContainer'],\r\n\tpage: startEnd\r\n) {\r\n\treturn (\r\n\t\tgetCrrContainer()\r\n\t\t\t?.querySelector(\r\n\t\t\t\t`.rm-video-timestamp[timestamp-style=\"${page}\"][active-timestamp]`\r\n\t\t\t)\r\n\t\t\t?.getAttribute('timestamp') || ''\r\n\t)\r\n}\r\n","import { lastBlockIDParameters } from '$v3/lib/types/config'\r\nimport { toggleClasses, removeIMGbg, simHover, applyIMGbg } from '$lib/utils'\r\nimport { isSelected } from '$v3/lib/backend-frontend/option'\r\nimport { cssData } from '$v3/init/config/paths'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport { isRendered } from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport { AssertParamsClickTimestamp } from '../observer/timestamp-recovery/click'\r\n\r\n// 8.0\r\nexport function DeployAsync(\r\n\t{\r\n\t\tgetLocalBlockID,\r\n\t\tsetObsTimestamp,\r\n\t\tgetCrrContainer,\r\n\t\tgetObsTimestamp,\r\n\t}: ILocalWrapper,\r\n\to: {\r\n\t\twrapper: HTMLElement\r\n\t\turl: s\r\n\t\tconfigParams: IExtendedVideoParams\r\n\t\tdeploy: () => void\r\n\t}\r\n) {\r\n\tconst { wrapper, url, configParams, deploy } = o\r\n\r\n\tconst mainAnimation = setUpWrapperAwaitingAnimation()\r\n\r\n\tconst { awaiting_input_type } = UI.experience\r\n\tlet interactionType =\r\n\t\tawaiting_input_type.value == 'mousedown' ? 'mousedown' : 'mouseenter' // huga buga\r\n\r\n\tAddInteractionEventListener()\r\n\r\n\twrapper.addEventListener('customPlayerReady', CustomListener)\r\n\r\n\tawaiting_input_type.addEventListener('change', changeMouseEvents)\r\n\r\n\tfunction CustomListener(e: CustomEvent) {\r\n\t\treturn Create(e, HandleDetailEvent)\r\n\t}\r\n\tfunction MouseListener(e: Event) {\r\n\t\treturn Create(e, HandleMouseEvent)\r\n\t}\r\n\r\n\tasync function Create(e: Event | CustomEvent, Work_cb: Function) {\r\n\t\te.preventDefault()\r\n\t\te.stopPropagation()\r\n\r\n\t\ttoggleClasses(false, mainAnimation, wrapper)\r\n\t\tremoveIMGbg(wrapper)\r\n\r\n\t\tRemoveAllListeners()\r\n\r\n\t\tawait Work_cb(e)\r\n\r\n\t\tdeploy()\r\n\t}\r\n\r\n\tasync function HandleMouseEvent() {\r\n\t\tawait AssertParamsClickTimestamp(\r\n\t\t\t{ getCrrContainer, getObsTimestamp },\r\n\t\t\tconfigParams\r\n\t\t)\r\n\t\twrapper.dispatchEvent(simHover())\r\n\t}\r\n\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tfunction HandleDetailEvent(e: CustomEvent<ICustomPlayerReady>) {\r\n\t\tif (!e.detail || typeof e.detail !== 'object') {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\ttrySet('start')\r\n\r\n\t\ttrySet('end')\r\n\r\n\t\tlastBlockIDParameters.delete(getLocalBlockID()) // YIKES!!!\r\n\t\ttrySet('updateTime')\r\n\r\n\t\ttrySet('mute')\r\n\t\ttrySet('playRightAway')\r\n\r\n\t\tsetObsTimestamp({\r\n\t\t\t...e.detail.obsTimestamp,\r\n\t\t\tworkflow: 'soft',\r\n\t\t})\r\n\t\tconfigParams.updateTime.set(\r\n\t\t\tisBounded(get('updateTime'))\r\n\t\t\t\t? get('updateTime')\r\n\t\t\t\t: get(e.detail.page as 'start' | 'end')\r\n\t\t)\r\n\r\n\t\tfunction get(key: TExchange) {\r\n\t\t\treturn configParams[key].value as number\r\n\t\t}\r\n\t\t// prettier-ignore\r\n\t\ttype TExchange = 'start' | 'end' | 'updateTime' | 'mute' | 'playRightAway'\r\n\t\tfunction trySet(key: TExchange) {\r\n\t\t\t// @ts-ignore come on!\r\n\t\t\tconfigParams[key].set((crr: n | b) => e.detail[key] ?? crr)\r\n\t\t}\r\n\t\tfunction isBounded(t: n) {\r\n\t\t\treturn t >= get('start') && t <= get('end')\r\n\t\t}\r\n\t}\r\n\r\n\tfunction RemoveAllListeners() {\r\n\t\tRemoveInteractionEventListener()\r\n\t\t// @ts-ignore come on!\r\n\t\twrapper.removeEventListener('customPlayerReady', CustomListener)\r\n\r\n\t\tawaiting_input_type.removeEventListener('change', changeMouseEvents)\r\n\t}\r\n\tfunction ReplaceInteractionEventListener(listener = interactionType) {\r\n\t\tRemoveInteractionEventListener()\r\n\t\tAddInteractionEventListener((interactionType = listener))\r\n\t}\r\n\tfunction AddInteractionEventListener(listener = interactionType) {\r\n\t\twrapper.addEventListener(listener, MouseListener)\r\n\t}\r\n\tfunction RemoveInteractionEventListener() {\r\n\t\twrapper.removeEventListener(interactionType, MouseListener)\r\n\t}\r\n\tfunction changeMouseEvents(this: HTMLSelectElement) {\r\n\t\tif (!isRendered(wrapper)) {\r\n\t\t\treturn RemoveAllListeners()\r\n\t\t}\r\n\t\tReplaceInteractionEventListener(this.value)\r\n\t}\r\n\r\n\tfunction setUpWrapperAwaitingAnimation() {\r\n\t\tconst {\r\n\t\t\tawiting_player_pulse_anim,\r\n\t\t\tawaitng_player_user_input,\r\n\t\t\tawaitng_input_with_thumbnail,\r\n\t\t} = cssData\r\n\t\tconst awaitingAnimation = [\r\n\t\t\tawiting_player_pulse_anim,\r\n\t\t\tawaitng_player_user_input,\r\n\t\t]\r\n\t\tconst awaitingAnimationThumbnail = [\r\n\t\t\t...awaitingAnimation,\r\n\t\t\tawaitng_input_with_thumbnail,\r\n\t\t]\r\n\r\n\t\tconst mainAnimation = awaitingAnimationThumbnail\r\n\r\n\t\tif (isSelected(UI.experience.xp_options, 'thumbnail_as_bg'))\r\n\t\t\tapplyIMGbg(wrapper, url)\r\n\r\n\t\ttoggleClasses(true, mainAnimation, wrapper)\r\n\t\treturn mainAnimation\r\n\t}\r\n}\r\n","import { isSelected } from '../../backend-frontend/option'\r\nimport { UI } from '../../../init/config/yt-gif-init'\r\n\r\nexport function isIntersection_selectedValid() {\r\n\treturn isIntersectionSeletectd() && isInputBufferSelected() // the only place where it is available\r\n}\r\nexport function isInput_selectedValid() {\r\n\treturn (\r\n\t\tisInputSelected() ||\r\n\t\t(!isIntersectionSeletectd() && isInputBufferSelected()) ||\r\n\t\tisSelected(UI.experience.initialize_mode, 'overflow')\r\n\t)\r\n}\r\nexport function isInputSelected() {\r\n\treturn isSelected(UI.experience.initialize_mode, 'input')\r\n}\r\nexport function isIntersectionSeletectd() {\r\n\treturn isSelected(UI.experience.xp_options, 'intersection')\r\n}\r\nexport function isInputBufferSelected() {\r\n\treturn isSelected(UI.experience.initialize_mode, 'input_x_buffer')\r\n}\r\n","import { isElementVisible } from '$lib/utils'\r\nimport { attrInfo } from '../../config/paths'\r\nimport { getOption } from '../../../lib/backend-frontend/option'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport { CleanAndBrandNewWrapper } from '../../../lib/utils'\r\n\r\nexport function FitBuffer(\r\n\tarr: Array<Tobserver | string>,\r\n\tcap: number,\r\n\tcreation: string\r\n) {\r\n\tlet atLeastOne = false\r\n\t// trying to exploit dynamic types\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tlet lastOne: any = null\r\n\tlet stop = arr.length + 0\r\n\tlet ini = 0 // most defenetly the very first one in the array\r\n\r\n\t// 1. try to clean wrappers\r\n\twhile (arr.length > cap) {\r\n\t\tif (stop < 0) throw new Error('index out of bounds')\r\n\r\n\t\tlastOne = arr[ini]\r\n\t\tconst wrapper = document.querySelector(lastOne) as HTMLElement\r\n\r\n\t\t// 2. if wrapper is not on screen, remove it\r\n\t\tif (wrapper) {\r\n\t\t\tconst newCreation = isElementVisible(wrapper)\r\n\t\t\t\t? attrInfo.creation.forceAwaiting\r\n\t\t\t\t: creation\r\n\t\t\tCleanAndBrandNewWrapper(\r\n\t\t\t\twrapper,\r\n\t\t\t\tattrInfo.creation.name,\r\n\t\t\t\tnewCreation\r\n\t\t\t)\r\n\t\t} else {\r\n\t\t\tini++\r\n\t\t}\r\n\r\n\t\t// 3. shift last one anyways\r\n\t\tarr.shift()\r\n\t\tatLeastOne = true\r\n\r\n\t\tstop--\r\n\t}\r\n\r\n\tarr = [...new Set(arr)] // remove duplicates\r\n\r\n\t// trying to exploit dynamic types\r\n\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\tarr = arr.filter((sel: any) => document.querySelector(sel) != null) // remove any that are no longer in the DOM\r\n\r\n\treturn <const>{ shiftedArr: arr, atLeastOne, lastOne }\r\n}\r\nexport function FitBuffer_OffScreen(\r\n\tarr: Array<Tobserver | string>,\r\n\tcap: number,\r\n\tcreation: string\r\n) {\r\n\t// 0. work very much in progress....\r\n\tconst anyLoaded = document.queryAllasArr('.yt-gif-wrapper')\r\n\r\n\tif (anyLoaded.length < cap) return arr\r\n\r\n\t// 1. loop through all loaded iframes to see if they are off screen and if so, remove them\r\n\tfor (const element of anyLoaded) {\r\n\t\tconst observer = new window.IntersectionObserver(\r\n\t\t\t([entry], observer) => {\r\n\t\t\t\tif (entry.isIntersecting) return arr\r\n\r\n\t\t\t\t// 1.1 not in viewport, remove it\r\n\t\t\t\tconst { shiftedArr } = FitBuffer(arr, cap, creation)\r\n\t\t\t\tarr = shiftedArr\r\n\r\n\t\t\t\tobserver.disconnect()\r\n\t\t\t\treturn (window.YT_GIF_OBSERVERS.masterIframeBuffer = arr) // this can happen in the future...\r\n\t\t\t},\r\n\t\t\t{ root: null, threshold: 0.1 } // set offset 0.1 means trigger if atleast 10% of element in viewport\r\n\t\t) // 1.1\r\n\t\tobserver.observe(element)\r\n\t\treturn arr\r\n\t}\r\n\r\n\treturn arr\r\n}\r\nexport function toggle_buffers_overflow(bol: boolean) {\r\n\tconst modes = UI.experience.initialize_mode\r\n\tconst input_x_buffer = getOption(modes, 'input_x_buffer')\r\n\r\n\tinput_x_buffer.disabled = bol\r\n\tif (!bol) input_x_buffer.selected = false\r\n\r\n\tgetOption(modes, 'overflow').selected = bol\r\n\tmodes.dispatchEvent(new Event('customBind'))\r\n}\r\n","import { pushSame } from '$lib/utils'\r\nimport { attrInfo } from '../../config/paths'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport {\r\n\tisInputSelected,\r\n\tisIntersection_selectedValid,\r\n} from '../../../lib/dom/select/isInputSelected'\r\nimport {\r\n\tFitBuffer_OffScreen,\r\n\tFitBuffer,\r\n\ttoggle_buffers_overflow,\r\n} from './buffer'\r\n\r\nexport function PushNew_ShiftAllOlder_IframeBuffer(parentCssPath: string) {\r\n\tif (parentCssPath)\r\n\t\twindow.YT_GIF_OBSERVERS.masterIframeBuffer = pushSame(\r\n\t\t\twindow.YT_GIF_OBSERVERS.masterIframeBuffer,\r\n\t\t\tparentCssPath\r\n\t\t)\r\n\r\n\tifBuffer_ShiftOldest() // modifies and returns masterIframeBuffer\r\n}\r\nexport function ifBuffer_ShiftOldest() {\r\n\tif (isInputSelected())\r\n\t\t// everything else are buffer variations\r\n\t\treturn null\r\n\r\n\t// work in progress | by shifting/removing the first entry, you clean the most irrelevant YT GIF, and give space to new ones (to load, thus autoplay on mouseenter) when intersecting the website\r\n\tlet arr = window.YT_GIF_OBSERVERS.masterIframeBuffer\r\n\tconst cap = parseInt(UI.range.iframe_buffer_slider.value, 10)\r\n\tconst { displaced, buffer } = attrInfo.creation\r\n\r\n\tif (isIntersection_selectedValid()) {\r\n\t\t// 2.\r\n\t\tarr = FitBuffer_OffScreen(arr, cap, displaced)\r\n\t} else {\r\n\t\t// 2. while...\r\n\t\tconst { shiftedArr, atLeastOne: shifted } = FitBuffer(arr, cap, buffer)\r\n\t\tarr = shiftedArr\r\n\t\t// 2.1 mix and match\r\n\t\tif (shifted || cap <= arr.length) {\r\n\t\t\t// there is space\r\n\t\t\ttoggle_buffers_overflow(true)\r\n\t\t} else if (!shifted && cap > arr.length) {\r\n\t\t\t// overflow\r\n\t\t\ttoggle_buffers_overflow(false)\r\n\t\t}\r\n\t}\r\n\r\n\t// 3. pass by value\r\n\treturn (window.YT_GIF_OBSERVERS.masterIframeBuffer = arr)\r\n}\r\n","import {\r\n\tclosest_container_request,\r\n\tclosest_anchor_container,\r\n} from '../../lib/dom/elements-yt-gif-parent'\r\nimport { toggleAttribute } from '$lib/utils'\r\nimport { YTvideoIDs } from '../../lib/types/config'\r\nimport type { YT_TargetWrapper } from '../../lib/types/yt-types'\r\n\r\nexport function DeactivateTimestampsInHierarchy(\r\n\trm_container: QrySearch,\r\n\ttargetWrapper: QrySearch\r\n) {\r\n\tif (!rm_container) return\r\n\tconst sel = '[yt-gif-timestamp-emulation]'\r\n\tconst all = TimestampsInHierarchy(rm_container, targetWrapper, sel)\r\n\tall.forEach(el => {\r\n\t\ttoggleAttribute(false, 'active-timestamp', el)\r\n\t\ttoggleAttribute(false, 'last-active-timestamp', el)\r\n\t})\r\n}\r\nexport function TimestampsInHierarchy<T extends IBtn>(\r\n\trm_container: Element,\r\n\ttargetWrapper: QrySearch,\r\n\tallSelector: string\r\n) {\r\n\tconst badSets = rm_container\r\n\t\t.queryAllasArr('.yt-gif-wrapper')\r\n\t\t.filter(w => w != targetWrapper)\r\n\t\t.map(w => closest_container_request(w)?.queryAllasArr(allSelector))\r\n\t\t.flat(Infinity)\r\n\r\n\tconst actives = Array.from(\r\n\t\trm_container.querySelectorAll(allSelector)\r\n\t).filter(tm => !badSets.includes(tm))\r\n\r\n\treturn actives as T[]\r\n}\r\nexport function ValidateHierarchyTimestamps(\r\n\twrapper: Element,\r\n\tt: YT_TargetWrapper\r\n) {\r\n\tconst videoId = t.GetVideoID()\r\n\tYTvideoIDs.set(videoId, t.getDuration?.())\r\n\r\n\tconst d = YTvideoIDs.get(videoId)\r\n\tconst rm_container = closest_anchor_container(wrapper)\r\n\r\n\tif (rm_container && typeof d == 'number')\r\n\t\tTimestampsInHierarchy<IBtnArrObj>(\r\n\t\t\trm_container,\r\n\t\t\twrapper,\r\n\t\t\t'[yt-gif-timestamp-emulation]'\r\n\t\t).forEach(tm => tm.validateSelf?.(d))\r\n}\r\n","import { UI } from '$v3/init/config/yt-gif-init'\r\n\r\n//#region validate - check values utils\r\n\r\nexport function CanUnmute() {\r\n\t// NotMuteAnyHover\r\n\treturn !muteIs('soft') && !muteIs('all_muted')\r\n}\r\n//#endregion\r\n//#region play/pause utils\r\n\r\nexport function muteIs(v: TmuteStyle) {\r\n\treturn UI.playerSettings.mute_style.value == v\r\n}\r\ntype TplayStyle = 'strict' | 'soft' | 'all_visible'\r\nexport function playIs(v: TplayStyle) {\r\n\tconst play = UI.playerSettings.play_style\r\n\tconst is = play.value == v\r\n\treturn is // && !getOption(play, v).disabled;\r\n}\r\n","import { UI } from '$v3/init/config/yt-gif-init'\r\nimport { playIs } from './IFR'\r\n\r\n//#region hover/interactions utils\r\n\r\nexport function anyValidInAndOutKey(e: MouseEvent) {\r\n\tif (e.buttons == 4) {\r\n\t\treturn true\r\n\t}\r\n\r\n\treturn (\r\n\t\tUI.defaultValues.InAndOutKeys.split(',')\r\n\t\t\t.map(s => s.trim())\r\n\t\t\t.filter(s => !!s)\r\n\t\t\t// @ts-ignore\r\n\t\t\t.some(k => e[k])\r\n\t)\r\n}\r\nexport function AnyPlayOnHover() {\r\n\treturn playIs('soft') || playIs('strict')\r\n}\r\n","import { UI } from '$v3/init/config/yt-gif-init'\r\nimport { isSelected } from '$v3/lib/backend-frontend/option'\r\nimport type { TQueryResult } from '../../setup/GetQuery'\r\nimport {\r\n\tanyValidInAndOutKey,\r\n\tAnyPlayOnHover,\r\n} from '../../lib/anyValidInAndOutKey'\r\nimport { muteIs, CanUnmute } from '../../lib/IFR'\r\n\r\n// 3. hover over the frame - mute | pause\r\nexport function GetHoverStates(q: TQueryResult) {\r\n\treturn <const>{\r\n\t\tstop(this: Element, e: MouseEvent) {\r\n\t\t\tq.parent.others.toggleActive()\r\n\r\n\t\t\tq.target.others.StrictFlow()\r\n\r\n\t\t\tq.UpdateLocalVolume()\r\n\t\t\tq.UpdateHumanInteraction(false)\r\n\r\n\t\t\tif (anyValidInAndOutKey(e) && !muteIs('all_muted')) {\r\n\t\t\t\tq.parent.toggleActive(true)\r\n\t\t\t\tq.videoIsPlayingWithSound()\r\n\t\t\t} else {\r\n\t\t\t\tq.parent.toggleActive(false)\r\n\t\t\t\tq.togglePlay(!AnyPlayOnHover() && q.isPlaying())\r\n\t\t\t\tq.isSoundingFine(false)\r\n\t\t\t}\r\n\t\t},\r\n\t\tplay() {\r\n\t\t\tif (\r\n\t\t\t\tisSelected(\r\n\t\t\t\t\tUI.playerSettings.ps_options,\r\n\t\t\t\t\t'mantain_last_active_player'\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t\t\tq.parent.others.toggleActive()\r\n\r\n\t\t\tq.target.others.StrictFlow()\r\n\r\n\t\t\tq.UpdateHumanInteraction(true)\r\n\t\t\tq.togglePlay(true)\r\n\r\n\t\t\tif (CanUnmute()) {\r\n\t\t\t\tq.isSoundingFine()\r\n\t\t\t} else if (muteIs('soft')) {\r\n\t\t\t\tq.isSoundingFine(false)\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n}\r\n","import { lastBlockIDParameters } from '$v3/lib/types/config'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport type { TVideoParams } from '$v3/lib/types/video-types'\r\nimport type { ILocal } from '../lib/TStat'\r\nimport type { TQueryResult } from './GetQuery'\r\n\r\n//#region 1. previous parameters\r\nexport function setupPreviousParams(o: ILocal, q: TQueryResult) {\r\n\tconst session = lastBlockIDParameters.get(o.entry.blockID)\r\n\tif (!session) {\r\n\t\treturn\r\n\t}\r\n\r\n\tconst { url_boundaries, url_volume } = UI.playerSettings\r\n\r\n\t// TODO: add noun types: strict | soft\r\n\t// prettier-ignore\r\n\tconst start = GetPreviousStart(session, url_boundaries.value, o.entry.start, q.isBounded);\r\n\tif (start != undefined) {\r\n\t\tq.seekToUpdatedTime(start)\r\n\t}\r\n\r\n\tconst volume = GetPreviousVolume(session, url_volume.value, o.entry.volume)\r\n\tif (volume != undefined) {\r\n\t\to.update.volume = volume\r\n\t}\r\n}\r\n/* ******************* */\r\nfunction GetPreviousVolume(session: TVideoParams, value: string, entryVal: n) {\r\n\tif (value == 'strict') {\r\n\t\tconst vl_Hist = session.volume.history\r\n\r\n\t\tif (vl_Hist[vl_Hist.length - 1] != entryVal) {\r\n\t\t\t// new entry is valid ≡ user updated \"&vl=\"\r\n\t\t\tvl_Hist.push(entryVal)\r\n\t\t\treturn entryVal\r\n\t\t}\r\n\r\n\t\t// updateVolume has priority\r\n\t\telse return session.volume.update\r\n\t}\r\n\r\n\t//\r\n\telse if (value == 'soft') return session.volume.update\r\n\t//if (value == 'start-only')\r\n\t//else return getMapVolume()\r\n}\r\nfunction GetPreviousStart(\r\n\tsession: TVideoParams,\r\n\tvalue: string,\r\n\tentryVal: number,\r\n\tisBounded: (x: number) => boolean\r\n) {\r\n\tif (value == 'strict') {\r\n\t\tconst timeHist = session.timestamps.history\r\n\r\n\t\tif (timeHist[timeHist.length - 1] != entryVal) {\r\n\t\t\t// new entry is valid ≡ user updated \"?t=\"\r\n\t\t\ttimeHist.push(entryVal)\r\n\t\t\treturn entryVal\r\n\t\t}\r\n\r\n\t\t//\r\n\t\telse {\r\n\t\t\treturn session.updateTime.value\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\telse if (value == 'soft' && isBounded(session.updateTime.value)) {\r\n\t\treturn session.updateTime.value\r\n\t}\r\n}\r\n","import { isElementVisible } from '$lib/utils'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport type { TQueryResult } from '../setup/GetQuery'\r\nimport { AnyPlayOnHover } from '../lib/anyValidInAndOutKey'\r\nimport { playIs, muteIs } from '../lib/IFR'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport type { ILocal } from '$v3/player-ready/lib/TStat'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\n\r\n//#region 2. play/mute styles\r\nexport function* FlipStyleGenerator(o: TStyleCallbacks) {\r\n\tlet bol = true\r\n\twhile (true) {\r\n\t\tUI.playerSettings.play_style = Flip(\r\n\t\t\tUI.playerSettings.play_style,\r\n\t\t\tbol,\r\n\t\t\to.play\r\n\t\t)\r\n\t\tUI.playerSettings.mute_style = Flip(\r\n\t\t\tUI.playerSettings.mute_style,\r\n\t\t\tbol,\r\n\t\t\to.mute\r\n\t\t)\r\n\t\tUI.display.yt_playback_speed = Flip(\r\n\t\t\tUI.display.yt_playback_speed,\r\n\t\t\tbol,\r\n\t\t\to.playback\r\n\t\t)\r\n\t\tbol = yield bol\r\n\t}\r\n}\r\nexport type IFlipIterator = ReturnType<typeof FlipStyleGenerator>\r\nexport function GetStyleCallbacks(\r\n\tiframe: IFR,\r\n\tq: TQueryResult,\r\n\tt: YT_TargetWrapper,\r\n\tmap: IExtendedVideoParams,\r\n\tlocal: ILocal\r\n) {\r\n\treturn <const>{\r\n\t\tplay: GetFuncPlay(iframe as IFRH, q),\r\n\t\tmute: GetFuncMute(iframe as IFRH, q),\r\n\t\tplayback: GetFuncPlayback(t, map, local),\r\n\t}\r\n}\r\nexport type TStyleCallbacks = ReturnType<typeof GetStyleCallbacks>\r\n/* ********** */\r\nfunction GetFuncPlay(iframe: IFRH, q: TQueryResult) {\r\n\treturn function () {\r\n\t\tif (!isElementVisible(iframe)) return //play all VISIBLE Players, this will be called on all visible iframes\r\n\r\n\t\tif (playIs('all_visible')) {\r\n\t\t\tq.togglePlay(true)\r\n\t\t\tq.isSoundingFine(false)\r\n\t\t} else if (AnyPlayOnHover()) {\r\n\t\t\tq.togglePlay(!AnyPlayOnHover())\r\n\t\t}\r\n\t}\r\n}\r\nfunction GetFuncMute(iframe: IFRH, q: TQueryResult) {\r\n\treturn function () {\r\n\t\tif (!isElementVisible(iframe)) return //mute all VISIBLE Players, this will be called on all visible iframes\r\n\r\n\t\tif (muteIs('strict') || muteIs('all_muted')) {\r\n\t\t\tq.isSoundingFine(false)\r\n\t\t}\r\n\t}\r\n}\r\nfunction GetFuncPlayback(\r\n\tt: YT_TargetWrapper,\r\n\tmap: IExtendedVideoParams,\r\n\tlocal: ILocal\r\n) {\r\n\treturn function () {\r\n\t\tconst value = UI.display.yt_playback_speed.value\r\n\t\tconst speed = value == 'Default' ? map.speed.value : Number(value)\r\n\t\tlocal.update.tickOffset = 1000 / speed\r\n\t\tt.setPlaybackRate(speed)\r\n\t}\r\n}\r\nfunction Flip(\r\n\tbinaryInput: HTMLSelectElement,\r\n\tbol = false,\r\n\tcb = () => {\r\n\t\t/* empty */\r\n\t}\r\n) {\r\n\tif (binaryInput?.tagName) {\r\n\t\tif (bol) binaryInput.addEventListener('change', cb)\r\n\t\telse binaryInput.removeEventListener('change', cb)\r\n\t}\r\n\r\n\treturn binaryInput\r\n}\r\n","import { isRendered } from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { toggleAttribute } from '$lib/utils'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport { isSelected } from '$v3/lib/backend-frontend/option'\r\nimport type { TQueryResult } from '$v3/player-ready/setup/GetQuery'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport type { ILocal } from '../../../lib/TStat'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport type { TQueryElements } from '$v3/player-ready/setup/GetElements'\r\n\r\n//#region 4. Controls - timedisplay\r\n// timeDisplay\r\nexport function TimeTargetObj(\r\n\tq: TQueryResult,\r\n\tiframe: IFR,\r\n\tmap: IExtendedVideoParams,\r\n\tlocal: ILocal,\r\n\tt: YT_TargetWrapper,\r\n\tl: TQueryElements\r\n) {\r\n\tfunction NewIntervalUpdate() {\r\n\t\tif (!isRendered(iframe)) {\r\n\t\t\treturn t.DestroyTarget()\r\n\t\t}\r\n\t\tif (!q.whole.anyHover()) {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tUpdateTimeDisplay()\r\n\r\n\t\tt.ytgif.PushSingleInterval(() => {\r\n\t\t\tif (q.whole.anyHover()) {\r\n\t\t\t\tUpdateTimeDisplay()\r\n\t\t\t}\r\n\t\t}, local.update.tickOffset)\r\n\t}\r\n\tfunction UpdateTimeDisplay() {\r\n\t\tconst span = q.clipSpan()\r\n\t\tconst offsetClip = span < 0\r\n\t\tconst offsetStart = q.tick() > map.end.value\r\n\r\n\t\ttoggleAttribute(offsetStart, 'tick-offset', l.timeDisplayStart)\r\n\t\ttoggleAttribute(offsetClip, 'offset', l.timeDisplayEnd)\r\n\r\n\t\t// timeDisplay.textContent = '00:00/00:00'\r\n\t\tif (isSelected(UI.display.ms_options, 'clip_lifespan_format')) {\r\n\t\t\t// 'bounded tick'/'clip end'\r\n\t\t\tconst boundedTick = Math.abs(span - (map.end.value - q.tick()))\r\n\t\t\tconst validEnd = offsetClip ? map.end.value : span\r\n\r\n\t\t\tl.timeDisplayStart.textContent = fmtMSS(boundedTick)\r\n\t\t\tl.timeDisplayEnd.textContent = fmtMSS(validEnd)\r\n\t\t} // 'update'/'end'\r\n\t\telse {\r\n\t\t\tl.timeDisplayStart.textContent = fmtMSS(q.tick())\r\n\t\t\tl.timeDisplayEnd.textContent = fmtMSS(map.end.value)\r\n\t\t}\r\n\t}\r\n\treturn <const>{\r\n\t\tNewIntervalUpdate,\r\n\t\tUpdateTimeDisplay,\r\n\t\tSeekToScroll(e: WheelEvent) {\r\n\t\t\tq.videoIsPlayingWithSound(false)\r\n\r\n\t\t\tlet dir =\r\n\t\t\t\tq.tick() +\r\n\t\t\t\tMath.sign(e.deltaY) *\r\n\t\t\t\t\tMath.round(\r\n\t\t\t\t\t\tNumber(UI.range.timestamp_display_scroll_offset.value)\r\n\t\t\t\t\t) *\r\n\t\t\t\t\t-1\r\n\r\n\t\t\tif (isSelected(UI.display.ms_options, 'clip_lifespan_format')) {\r\n\t\t\t\tif (dir <= map.start.value) {\r\n\t\t\t\t\tdir = map.end.value - 1 //can go beyond that\r\n\t\t\t\t}\r\n\t\t\t\tif (dir >= map.end.value) {\r\n\t\t\t\t\tdir = map.start.value //can go beyond that\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tt.seekTo(dir)\r\n\r\n\t\t\tUpdateTimeDisplay()\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tif (q.whole.anyHover()) {\r\n\t\t\t\t\tq.videoIsPlayingWithSound()\r\n\t\t\t\t}\r\n\t\t\t}, local.update.tickOffset) //nice delay to show feedback\r\n\t\t},\r\n\t}\r\n}\r\nexport type TTimeTargetObj = ReturnType<typeof TimeTargetObj>\r\n\r\nfunction fmtMSS(seconds: n) {\r\n\tconst format = (val: n) => `0${Math.floor(val)}`.slice(-2)\r\n\tconst hours = seconds / 3600\r\n\tconst minutes = (seconds % 3600) / 60\r\n\tconst displayFormat =\r\n\t\thours < 1 ? [minutes, seconds % 60] : [hours, minutes, seconds % 60]\r\n\r\n\treturn displayFormat.map(format).join(':')\r\n}\r\n","import { isRendered } from '../dom/elements-yt-gif-parent'\r\nimport { allVideoParameters } from '../types/config'\r\nimport type { YT_TargetWrapper } from '../types/yt-types'\r\nimport { sleep } from '$lib/utils'\r\n\r\n/* ***************** */\r\nexport async function TryReloadVideo({\r\n\tt,\r\n\tstart,\r\n\tend,\r\n}: {\r\n\tt: YT_TargetWrapper | undefined\r\n\tstart: number\r\n\tend: number\r\n}) {\r\n\tif (!t) return\r\n\r\n\tconst vars = t.GetVars()\r\n\tconst map = allVideoParameters.get(t.GetIframeID())\r\n\tif (!map) {\r\n\t\tconsole.warn(\r\n\t\t\t`YT GIF: ReloadYTVideo: Couldn't find VideoConfigParameters for ${t.GetIframeID()}`\r\n\t\t)\r\n\t}\r\n\r\n\tconst iframe = t.getIframe()\r\n\r\n\tstart = start || 0\r\n\tend = end || t.getDuration()\r\n\r\n\tif (map?.start.value == start && map?.end.value == end) {\r\n\t\twhile (isRendered(iframe) && !t.ApiIsWorking()) {\r\n\t\t\tawait sleep(50)\r\n\t\t}\r\n\t\treturn t.seekTo(start)\r\n\t}\r\n\r\n\tmap?.start.set((vars.start = start))\r\n\tmap?.end.set((vars.end = end))\r\n\tconst vol = t.getVolume()\r\n\r\n\twhile (isRendered(iframe) && !t.ApiIsWorking()) {\r\n\t\tawait sleep(50)\r\n\t}\r\n\r\n\t// the only way...\r\n\tif (t.getPlayerState() ?? 0) {\r\n\t\tt.setPlayerState('F')\r\n\t}\r\n\r\n\ttry {\r\n\t\tt.setOnStateChange(async () => {})\r\n\t} catch (error) {\r\n\t\tconsole.warn(\r\n\t\t\t'YT GIF: ReloadYTVideo | onStateChange assignment to undefined'\r\n\t\t)\r\n\t}\r\n\r\n\t// ...to prevent double \"endState\"\r\n\tawait t.loadVideoById({\r\n\t\t// ...it requirers to set \"endSeconds\" once again\r\n\t\tvideoId: t.GetVideoID(),\r\n\t\tstartSeconds: start,\r\n\t\tendSeconds: end,\r\n\t})\r\n\r\n\twhile (isRendered(iframe) && !t.getCurrentTime()) {\r\n\t\tawait sleep(50)\r\n\t}\r\n\r\n\tt.setVolume(vol)\r\n\r\n\ttry {\r\n\t\tt.setOnStateChange(window.AvoidCircularDependency.getOnStateChange())\r\n\t} catch (error) {\r\n\t\tconsole.error(\r\n\t\t\t'YT GIF: ReloadYTVideo | onStateChange assignment to undefined'\r\n\t\t)\r\n\t}\r\n}\r\n","import { toggleAttribute } from '$lib/utils'\r\n\r\nexport function awaitingAtrr(bol: boolean, el: Element) {\r\n\treturn toggleAttribute(bol, 'awaiting', el)\r\n}\r\n","import { closest_anchor_container } from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { DeactivateTimestampsInHierarchy } from '$v3/init/timestamp/hierarchy'\r\nimport { TryReloadVideo } from '$v3/lib/event/TryReloadVideo'\r\nimport { awaitingAtrr } from '$v3/lib/dom/attr'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport type { TQueryResult } from '$v3/player-ready/setup/GetQuery'\r\nimport type { TQueryElements } from '$v3/player-ready/setup/GetElements'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport type { TTimeTargetObj } from '$v3/player-ready/listener/control/time/ClearTimers'\r\nimport type { ILocal } from '$v3/player-ready/lib/TStat'\r\n\r\n//#region 6. reload boundaries\r\nexport function GetFuncResetBoundaries(\r\n\tt: YT_TargetWrapper,\r\n\tq: TQueryResult,\r\n\tl: TQueryElements,\r\n\tmap: IExtendedVideoParams,\r\n\ttime: TTimeTargetObj,\r\n\tlocal: ILocal\r\n) {\r\n\treturn async function (evt: TResetYTEvent | null) {\r\n\t\tconst tEl = (evt?.currentTarget as Element) ?? l.resetBtn\r\n\t\tconst awaiting = (bol: b) => awaitingAtrr(bol, tEl)\r\n\r\n\t\tif (tEl.hasAttribute('awaiting')) return\r\n\r\n\t\tq.timeDisplay.visible(true)\r\n\t\tawaiting(true)\r\n\r\n\t\tDeactivateTimestampsInHierarchy(closest_anchor_container(tEl), l.parent)\r\n\t\tawait TryReloadVideo({\r\n\t\t\tt,\r\n\t\t\tstart: map.start.default,\r\n\t\t\tend: map.end.default,\r\n\t\t})\r\n\t\tq.seekToUpdatedTime(map.start.default ?? 0)\r\n\r\n\t\ttime.UpdateTimeDisplay()\r\n\t\tawaiting(false)\r\n\r\n\t\tif (evt?.message != 'update-timestamp') {\r\n\t\t\treturn q.timeDisplay.visible(false)\r\n\t\t}\r\n\r\n\t\t// update/visible until any interaction\r\n\t\ttime.UpdateTimeDisplay()\r\n\t\tt.ytgif.timerID = window.setInterval(\r\n\t\t\t() => time.UpdateTimeDisplay(),\r\n\t\t\tlocal.update.tickOffset\r\n\t\t)\r\n\t\tt.ytgif.timers.push(t.ytgif.timerID)\r\n\r\n\t\tl.timeDisplay.onmousemove = stopUpdateDisplayOnce\r\n\t}\r\n\tfunction stopUpdateDisplayOnce(e: Event) {\r\n\t\te.stopPropagation()\r\n\t\te.preventDefault()\r\n\t\tq.timeDisplay.visible(false)\r\n\t\t;(e.currentTarget as HTMLElement).onmousemove = null\r\n\t}\r\n}\r\n","import {\r\n\tclosestYTGIFparentID,\r\n\tgetWrapperUrlSufix,\r\n} from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { cssData } from '$v3/init/config/paths'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\n\r\nexport function GetElementsObj(key: string, t: YT_TargetWrapper) {\r\n\tconst iframe = (document.getElementById(key) as IFR) || t.getIframe()\r\n\tconst parent = getParent(iframe)!\r\n\tconst timeDisplay = parent.querySelector(\r\n\t\t'div.' + cssData.yt_gif_timestamp\r\n\t) as HTMLElement\r\n\tconst timeDisplayStart = timeDisplay.querySelector(\r\n\t\t'.yt-gif-timestamp-start'\r\n\t)!\r\n\tconst timeDisplayEnd = timeDisplay.querySelector('.yt-gif-timestamp-end')!\r\n\tconst resetBtn = parent.querySelector(\r\n\t\t'[yt-gif-url-btn=\"reset\"]'\r\n\t) as HTMLResetBtn\r\n\tconst withEventListeners = [\r\n\t\tparent,\r\n\t\tparent.parentNode as El,\r\n\t\ttimeDisplay,\r\n\t\tiframe,\r\n\t] // ready to be cleaned\r\n\r\n\treturn <const>{\r\n\t\tblockID: getBlockID(iframe),\r\n\t\tiframe,\r\n\t\tparent,\r\n\t\ttimeDisplay,\r\n\t\tresetBtn,\r\n\t\twithEventListeners,\r\n\t\ttimeDisplayStart,\r\n\t\ttimeDisplayEnd,\r\n\t}\r\n}\r\nexport type TQueryElements = ReturnType<typeof GetElementsObj>\r\nexport function getBlockID(iframe: IFR) {\r\n\treturn closestYTGIFparentID(iframe) + getWrapperUrlSufix(getParent(iframe)!)\r\n}\r\nexport function getParent(i: Element) {\r\n\treturn i.closest('.' + cssData.yt_gif_wrapper) || i.parentElement\r\n}\r\n","import {\r\n\tclosestYTGIFparentID,\r\n\tgetWrapperUrlSufix,\r\n\tisRendered,\r\n} from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { attrInfo } from '$v3/init/config/paths'\r\nimport {\r\n\tallVideoParameters,\r\n\trecordedIDs,\r\n\tlastBlockIDParameters,\r\n\tvideoParams,\r\n} from '$v3/lib/types/config'\r\nimport { Clone, div, RemoveElsEventListeners } from '$lib/utils'\r\nimport { isBlockRef } from '$lib/utils-roam-alpha-api'\r\nimport { ifBuffer_ShiftOldest } from '$v3/init/observer/performance'\r\nimport type {\r\n\tTVideoParams,\r\n\tIExtendedVideoParams,\r\n} from '$v3/lib/types/video-types'\r\nimport type { IFlipIterator } from '../listener/toggle'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport type { TQueryResult } from '$v3/player-ready/setup/GetQuery'\r\nimport { getParent } from '$v3/player-ready/setup/GetElements'\r\nimport type { ILocal } from '$v3/player-ready/lib/TStat'\r\nimport type { TQueryElements } from '$v3/player-ready/setup/GetElements'\r\n\r\n//#region 8. on destroyed - clean up and ready next session\r\nexport function GetOnIframeRemovedFromDom(\r\n\tflipIterator: IFlipIterator,\r\n\tt: YT_TargetWrapper,\r\n\tq: TQueryResult,\r\n\tmap: IExtendedVideoParams,\r\n\tentry: ILocal['entry'],\r\n\telements: TQueryElements\r\n) {\r\n\treturn async () => {\r\n\t\tconst { iframe, parent } = elements\r\n\t\tconst { blockID, blcokID_prfx, volume, canBeCleanedByBuffer, key } =\r\n\t\t\tentry\r\n\r\n\t\t// expensive for sure 🙋\r\n\t\tRemoveElsEventListeners(elements.withEventListeners)\r\n\t\tflipIterator.next(false)\r\n\r\n\t\t// Update Next Session Values\r\n\t\tconst session = lastBlockIDParameters.get(blockID) ?? videoParams\r\n\t\tconst media: TVideoParams = Clone(session)\r\n\t\tmedia.src.set(getWrapperUrlSufix(parent))\r\n\t\tmedia.id.set(map.id.value)\r\n\t\tmedia.updateTime.set(q.isBounded(q.tick()) ? q.tick() : map.start.value)\r\n\t\tmedia.volume.update = t.getVolume() ?? map.volume.update\r\n\r\n\t\tif (media.timestamps.history.length == 0) {\r\n\t\t\t// kinda spaghetti, but it's super necessary - This will not ignore the first block editing - stack change\r\n\t\t\tmedia.timestamps.history.push(map.start.value)\r\n\t\t}\r\n\t\tif (media.volume.history.length == 0) {\r\n\t\t\tmedia.volume.history.push(volume)\r\n\t\t}\r\n\r\n\t\t// clean... video maps\r\n\t\tt.ytgif.ClearTimers()\r\n\t\trecordedIDs.delete(blockID)\r\n\t\tallVideoParameters.delete(key)\r\n\r\n\t\tconst prefix = closestYTGIFparentID(iframe) ?? blcokID_prfx\r\n\t\tconst suffix = parent.getAttribute(attrInfo.url.index) as s\r\n\t\t// remove useless previous entries\r\n\t\tfor (const key of lastBlockIDParameters.keys()) {\r\n\t\t\tconst remove = () => lastBlockIDParameters.delete(key)\r\n\t\t\tconst isYTgif =\r\n\t\t\t\tkey?.endsWith(suffix) && key?.includes(media.id.value)\r\n\t\t\tconst isBlock = key.startsWith(prefix)\r\n\r\n\t\t\tif (isYTgif && isBlock) {\r\n\t\t\t\tremove()\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tif (!isYTgif) {\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\r\n\t\t\t// i'm trying to avoid the await func\r\n\t\t\tconst wasDeletedExternally =\r\n\t\t\t\tcanBeCleanedByBuffer && (await isBlockRef(prefix.slice(-9)))\r\n\r\n\t\t\tif (wasDeletedExternally) {\r\n\t\t\t\tconsole.log('yt-gif debugger')\r\n\t\t\t\tremove()\r\n\t\t\t}\r\n\t\t}\r\n\t\t// yet add latest params\r\n\t\tif (blockID != null) {\r\n\t\t\tlastBlockIDParameters.set(blockID, media)\r\n\t\t}\r\n\r\n\t\tif (canBeCleanedByBuffer) {\r\n\t\t\tifBuffer_ShiftOldest()\r\n\t\t}\r\n\r\n\t\t// either save the target\r\n\t\tconst targetExist = document.querySelector('#' + key) == iframe\r\n\t\tif (targetExist) {\r\n\t\t\treturn console.log(\r\n\t\t\t\t`${key} is displaced, not removed, thus is not destroyed.`\r\n\t\t\t)\r\n\t\t}\r\n\r\n\t\tsetTimeout(() => {\r\n\t\t\tif (targetExist) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tt.DestroyTarget()\r\n\r\n\t\t\t// roam research displaces blocks and the YT player api doesn't catch up...\r\n\t\t\tconst TRY = TryToGetPreviousParent(key)\r\n\t\t\tif (!TRY) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tconst { previousParent, observerTarget } = TRY\r\n\t\t\tpreviousParent.parentNode?.replaceChild(\r\n\t\t\t\tobserverTarget,\r\n\t\t\t\tpreviousParent\r\n\t\t\t)\r\n\t\t}, 1000)\r\n\t}\r\n}\r\nfunction TryToGetPreviousParent(key: string) {\r\n\tconst previousIframe = document.querySelector('#' + key)!\r\n\tif (!isRendered(previousIframe)) {\r\n\t\treturn null\r\n\t}\r\n\r\n\tconst previousParent = getParent(previousIframe)!\r\n\tif (!isRendered(previousParent)) {\r\n\t\treturn null\r\n\t}\r\n\r\n\tconst observerTarget = div([\r\n\t\twindow.AvoidCircularDependency.getCurrentClassesToObserver()[0],\r\n\t])\r\n\treturn <const>{ previousParent, observerTarget }\r\n}\r\n","import { isRendered } from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport { isSelected } from '$v3/lib/backend-frontend/option'\r\nimport { playIs } from '../lib/IFR'\r\nimport type { TQueryResult } from '$v3/player-ready/setup/GetQuery'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport type { ILocal } from '../lib/TStat'\r\n\r\n//#region 10. pause on off screen\r\nexport function GetFuncPauseOffscreen(\r\n\tq: TQueryResult,\r\n\tt: YT_TargetWrapper,\r\n\tl: ILocal\r\n) {\r\n\tconst loadedAndBlurred = () =>\r\n\t\tq.tick() > l.update.start + 1 && !t.ytgif.globalHumanInteraction\r\n\r\n\treturn (\r\n\t\tentries: IntersectionObserverEntry[],\r\n\t\tobserver: IntersectionObserver\r\n\t) => {\r\n\t\tif (!entries[0] || !isRendered(entries[0].target)) {\r\n\t\t\tobserver.disconnect()\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (loadedAndBlurred()) {\r\n\t\t\tif (!playIs('all_visible')) {\r\n\t\t\t\treturn stopIfInactive(q)\r\n\t\t\t}\r\n\r\n\t\t\tif (entries[0].isIntersecting) {\r\n\t\t\t\tq.togglePlay(true)\r\n\t\t\t} else {\r\n\t\t\t\tstopIfInactive(q)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\nfunction stopIfInactive(q: TQueryResult) {\r\n\tif (\r\n\t\t!q.parent.isActive() ||\r\n\t\t!isSelected(UI.playerSettings.ps_options, 'mantain_last_active_player')\r\n\t) {\r\n\t\treturn q.togglePlay(false)\r\n\t}\r\n\tq.parent.others.toggleActive()\r\n\tq.target.others.Mute()\r\n\tq.target.others.Pause()\r\n}\r\n","import type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport type { TQueryResult } from '../setup/GetQuery'\r\nimport { playIs } from '../lib/IFR'\r\nimport type { ILocal } from '../lib/TStat'\r\nimport type { TStyleCallbacks } from '$v3/player-ready/listener/toggle'\r\n\r\nexport function TryToPauseIfBlurred(q: TQueryResult, play: TPlay) {\r\n\tconst bol = playIs('all_visible')\r\n\tplay(bol) // pause?\r\n\r\n\tif (bol && !q.parent.Hover() && q.isPlaying()) {\r\n\t\t// if mouse is outside parent and video is playing\r\n\t\tplay(false)\r\n\t}\r\n}\r\nexport function TryToPauseAfterASecond(q: TQueryResult, play: TPlay) {\r\n\tsetTimeout(() => {\r\n\t\tif (!q.parent.isActive() && !q.parent.Hover()) {\r\n\t\t\tplay(false)\r\n\t\t}\r\n\t}, 1000)\r\n}\r\nexport function GetAutoplayParent(iframe: IFR) {\r\n\treturn (\r\n\t\tiframe.closest('.rm-alias-tooltip__content') || //tooltip\r\n\t\tiframe.closest('.bp3-card') || //card\r\n\t\tiframe.closest('.myPortal')\r\n\t)\r\n}\r\nexport function TryToRunPreviousParams(\r\n\tt: YT_TargetWrapper,\r\n\tlocal: ILocal,\r\n\tstyleCallbacks: TStyleCallbacks\r\n) {\r\n\t// volume\r\n\ttry {\r\n\t\tt.setVolume(local.update.volume)\r\n\t} catch (error) {\r\n\t\tconsole.log(error)\r\n\t}\r\n\t// playback rate\r\n\tstyleCallbacks.playback()\r\n}\r\ntype TPlay = (bol: b) => void\r\n","import { simHover, isElementVisible } from '$lib/utils'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport type { TQueryResult } from '../setup/GetQuery'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport {\r\n\tGetAutoplayParent,\r\n\tTryToPauseAfterASecond,\r\n\tTryToPauseIfBlurred,\r\n} from './query'\r\n\r\nexport async function AutoPlayToUpdate(\r\n\tiframe: IFR,\r\n\tt: YT_TargetWrapper,\r\n\tq: TQueryResult,\r\n\tmap: IExtendedVideoParams\r\n) {\r\n\tawait t.WhileApiHolds(iframe)\r\n\r\n\tq.seekToUpdatedTime(map.updateTime.value ?? map.start.value)\r\n\tq.togglePlay(true)\r\n\tq.isSoundingFine(!map.mute.value)\r\n\r\n\tmap.playRightAway.set(false)\r\n}\r\n//#region 11. last - let me watch would you\r\nexport async function TryFreezeAutoplay(\r\n\tiframe: IFR,\r\n\tt: YT_TargetWrapper,\r\n\tq: TQueryResult\r\n) {\r\n\tconst parent = GetAutoplayParent(iframe)\r\n\tconst play = (bol: b) => q.videoIsPlayingWithSound(bol)\r\n\r\n\tif (parent) {\r\n\t\tparent.dispatchEvent(simHover())\r\n\t} // human wants to hear and watch\r\n\telse if (q.parent.Hover()) {\r\n\t\tplay(true)\r\n\r\n\t\tTryToPauseAfterASecond(q, play)\r\n\t} //\r\n\telse {\r\n\t\tawait t.WhileApiHolds(iframe, 200)\r\n\t\tconst humanInteraction = t.ytgif.globalHumanInteraction\r\n\r\n\t\t// or if mouse is inside parent\r\n\t\tif (humanInteraction) {\r\n\t\t\t// user wants to listen, don't interrupt\r\n\t\t\tplay(true)\r\n\t\t} //\r\n\t\telse if (isElementVisible(iframe as IFRH) && !humanInteraction) {\r\n\t\t\tTryToPauseIfBlurred(q, play)\r\n\t\t} //\r\n\t\telse if (!q.parent.Hover()) {\r\n\t\t\tplay(false) // pause\r\n\t\t}\r\n\t}\r\n}\r\n","import { ytGifAttr } from '$v3/init/config/paths'\r\nimport { ObjectKeys } from '$lib/utils'\r\n\r\n//#region play/mute attr styles utils\r\ntype TMute = 'yt-mute' | 'yt-unmute'\r\ntype TPlay = 'yt-playing' | 'yt-paused'\r\nexport function SoundIs(style: TMute, el: El) {\r\n\tStyleAttribute(ytGifAttr.sound, style, el)\r\n}\r\nexport function PlayIs(style: TPlay, el: El) {\r\n\tStyleAttribute(ytGifAttr.play, style, el)\r\n}\r\nfunction StyleAttribute(subStyle: {}, style: s, el: El) {\r\n\tObjectKeys(subStyle).forEach(k => el.removeAttribute(subStyle[k]))\r\n\tel.setAttribute(style, '')\r\n}\r\n","import { recordedIDs } from '$v3/lib/types/config'\r\nimport { SoundIs, PlayIs } from '../../lib/PlayIs'\r\nimport { muteIs, playIs } from '../../lib/IFR'\r\nimport { getBlockID } from '$v3/player-ready/setup/GetElements'\r\n\r\n/* ************************************************* */\r\nexport function HandleOthers(iframe: IFR) {\r\n\treturn <const>{\r\n\t\tStrictFlow() {\r\n\t\t\tif (playIs('strict')) {\r\n\t\t\t\tPause()\r\n\t\t\t} else if (muteIs('strict')) {\r\n\t\t\t\tMute()\r\n\t\t\t}\r\n\t\t},\r\n\t\tMute,\r\n\t\tPause,\r\n\t}\r\n\tfunction Mute() {\r\n\t\tLoopTroughYTGIFs(GetMuteOthersCongif)\r\n\t}\r\n\tfunction Pause() {\r\n\t\tLoopTroughYTGIFs(GetPauseOthersCongif)\r\n\t}\r\n\tfunction LoopTroughYTGIFs(config = fallback) {\r\n\t\tconst frames = document.queryAllasArr(`[${config.styleQuery}]`)\r\n\r\n\t\tfor (const i of frames) {\r\n\t\t\tconst o = { el: i, id: getBlockID(i) }\r\n\r\n\t\t\tif (i != iframe) {\r\n\t\t\t\tconfig.others_callback(o)\r\n\t\t\t} //\r\n\t\t\telse if (config.self_callback) {\r\n\t\t\t\tconfig.self_callback(o)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\ntype idEl = {\r\n\tid: string\r\n\tel: IFR\r\n}\r\nconst empty = (_o: idEl) => {\r\n\t/* empty */\r\n}\r\nconst GetMuteOthersCongif = {\r\n\tstyleQuery: 'yt-unmute',\r\n\tothers_callback: (o: idEl) => {\r\n\t\tSoundIs('yt-unmute', o.el)\r\n\t\trecordedIDs.get(o.id)?.wTarget?.mute()\r\n\t},\r\n\tself_callback: empty,\r\n}\r\nconst GetPauseOthersCongif = {\r\n\tstyleQuery: 'yt-playing',\r\n\tothers_callback: (o: idEl) => {\r\n\t\tPlayIs('yt-paused', o.el)\r\n\t\trecordedIDs.get(o.id)?.wTarget?.pauseVideo()\r\n\t},\r\n\tself_callback: empty,\r\n}\r\nconst fallback = {\r\n\tstyleQuery: '',\r\n\tothers_callback: empty,\r\n\tself_callback: empty,\r\n}\r\n","import { videoParams } from '$v3/lib/types/config'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport { GetClosestRate, toggleAttribute, toggleClasses } from '$lib/utils'\r\nimport { HandleOthers } from '../listener/parent/HandleOthers'\r\nexport function GetElementsMethods(\r\n\tparent: Element,\r\n\tiframe: IFR,\r\n\ttimeDisplay: HTMLElement,\r\n\t// FIXME: get me out of here\r\n\tt: YT_TargetWrapper\r\n) {\r\n\tconst active = 'yt-active'\r\n\treturn <const>{\r\n\t\tparent: {\r\n\t\t\tothers: {\r\n\t\t\t\ttoggleActive(bol = false) {\r\n\t\t\t\t\tdocument\r\n\t\t\t\t\t\t.queryAllasArr(`[${active}]`)\r\n\t\t\t\t\t\t.filter(el => el != parent)\r\n\t\t\t\t\t\t.forEach(el => toggleAttribute(bol, active, el))\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\ttoggleActive: (bol: b) => toggleAttribute(bol, active, parent),\r\n\t\t\tHover: () => parent.matches(':hover'),\r\n\t\t\tisActive: () => parent.hasAttribute(active),\r\n\t\t},\r\n\t\ttimeDisplay: {\r\n\t\t\tHover: () => timeDisplay.matches(':hover'),\r\n\t\t\tOnCustomVideoEnded() {\r\n\t\t\t\tif (timeDisplay.classList.contains('yt-gif-timestamp-update')) {\r\n\t\t\t\t\ttimeDisplay.onmousemove = null\r\n\t\t\t\t\tthis.visible(false)\r\n\t\t\t\t\tt.ytgif.ClearTimers()\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tvisible(bol: b) {\r\n\t\t\t\ttoggleClasses(bol, ['yt-gif-timestamp-update'], timeDisplay)\r\n\t\t\t\ttoggleClasses(!bol, ['yt-gif-invisible-element'], timeDisplay)\r\n\t\t\t},\r\n\t\t},\r\n\t\twhole: {\r\n\t\t\tanyHover() {\r\n\t\t\t\treturn parent.matches(':hover') || timeDisplay.matches(':hover')\r\n\t\t\t},\r\n\t\t},\r\n\t\ttarget: {\r\n\t\t\tothers: HandleOthers(iframe),\r\n\t\t},\r\n\t}\r\n}\r\n\r\nexport function GetTarget(t: YT_TargetWrapper) {\r\n\treturn <const>{\r\n\t\ttick: (_ = t) => _?.getCurrentTime(),\r\n\t\tclosestRate(x: n) {\r\n\t\t\tconst rates: Array<n> = t.getAvailablePlaybackRates() || []\r\n\t\t\treturn GetClosestRate(rates, x) || 1\r\n\t\t},\r\n\t\tUpdateHumanInteraction(b: b) {\r\n\t\t\tt.ytgif.globalHumanInteraction = b\r\n\t\t},\r\n\t\tisPlaying() {\r\n\t\t\treturn t.getPlayerState() === 1\r\n\t\t},\r\n\t}\r\n}\r\nexport function GetConfig(map: IExtendedVideoParams) {\r\n\treturn <const>{\r\n\t\tclipSpan: () => map.end.value - map.start.value,\r\n\t\tisBounded: (x: n) => map.start.value < x && x < map.end.value,\r\n\t\tgetMapVolume: () => {\r\n\t\t\treturn videoParams.volume.value || 40\r\n\t\t},\r\n\t}\r\n}\r\n","import type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport { PlayIs, SoundIs } from '../lib/PlayIs'\r\nimport type { ILocal } from '../lib/TStat'\r\nimport { GetElementsMethods, GetConfig, GetTarget } from './composition'\r\n\r\nexport function GetQuery(params: IQueryInput) {\r\n\tconst { parent, timeDisplay, iframe } = params\r\n\tconst { map, t, local } = params\r\n\r\n\treturn <const>{\r\n\t\t...GetElementsMethods(parent, iframe, timeDisplay, t),\r\n\t\t...GetConfig(map),\r\n\t\t...GetTarget(t),\r\n\r\n\t\tvideoIsPlayingWithSound(boo = true) {\r\n\t\t\tthis.isSoundingFine(boo)\r\n\t\t\tthis.togglePlay(boo)\r\n\t\t},\r\n\t\ttogglePlay(bol: b, el = iframe) {\r\n\t\t\tif (bol) {\r\n\t\t\t\tPlayIs('yt-playing', el)\r\n\t\t\t\tt.playVideo()\r\n\t\t\t} else {\r\n\t\t\t\tPlayIs('yt-paused', el)\r\n\t\t\t\tt.pauseVideo()\r\n\t\t\t}\r\n\t\t},\r\n\t\tisSoundingFine(bol = true, el = iframe) {\r\n\t\t\tif (bol) {\r\n\t\t\t\tSoundIs('yt-unmute', el)\r\n\t\t\t\tt.unMute()\r\n\t\t\t\tt.setVolume(local.update.volume)\r\n\t\t\t} else {\r\n\t\t\t\tSoundIs('yt-mute', el)\r\n\t\t\t\tt.mute()\r\n\t\t\t}\r\n\t\t},\r\n\r\n\t\tUpdateLocalVolume(v?: n) {\r\n\t\t\tv = v ?? t.getVolume()\r\n\t\t\tlocal.update.volume = v\r\n\t\t},\r\n\t\tseekToUpdatedTime(desiredTime: n) {\r\n\t\t\tlocal.update.start = desiredTime\r\n\t\t\tt.seekTo(local.update.start)\r\n\t\t},\r\n\t}\r\n}\r\n\r\ninterface IQueryInput {\r\n\tmap: IExtendedVideoParams\r\n\tparent: Element\r\n\ttimeDisplay: HTMLElement\r\n\tt: YT_TargetWrapper\r\n\tiframe: IFR\r\n\tlocal: ILocal\r\n}\r\n\r\nexport type TQueryResult = ReturnType<typeof GetQuery>\r\n","import { allVideoParameters } from '$v3/lib/types/config'\r\nimport type { YT_TargetWrapper, T_YT_RECORD } from '$v3/lib/types/yt-types'\r\nimport type { TQueryResult } from './GetQuery'\r\n\r\nexport function TrySetupRecordID(\r\n\trecording: T_YT_RECORD | undefined,\r\n\tt: YT_TargetWrapper,\r\n\tq: TQueryResult\r\n) {\r\n\tif (!recording) {\r\n\t\treturn\r\n\t}\r\n\trecording.wTarget = t\r\n\trecording.sameBoundaries = function (tg = t) {\r\n\t\tif (!tg) return false\r\n\r\n\t\tconst key = tg.GetIframeID()\r\n\t\tconst { start: startM, end: endM } = allVideoParameters.get(key)!\r\n\t\tconst { start, end } = tg.GetVars()\r\n\r\n\t\treturn startM.value == start && endM.value == end\r\n\t}\r\n\trecording.seekToUpdatedTime = q.seekToUpdatedTime\r\n\trecording.isSoundingFine = q.isSoundingFine\r\n\trecording.togglePlay = q.togglePlay\r\n\trecording.bounded = function (sec: number) {\r\n\t\tconst d = t.getDuration() ?? 0\r\n\t\treturn sec >= 0 && sec <= d\r\n\t}\r\n}\r\n","import { lastBlockIDParameters } from '$v3/lib/types/config'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport { setupPreviousParams } from './setupPreviousParams'\r\nimport { TryFreezeAutoplay } from '../finished/autoplay-flow'\r\nimport { TryToRunPreviousParams } from '../finished/query'\r\nimport type { TQueryResult } from './GetQuery'\r\nimport type { ILocal } from '../lib/TStat'\r\n\r\nexport async function Refurbish(\r\n\tlocal: ILocal,\r\n\tt: YT_TargetWrapper,\r\n\tq: TQueryResult,\r\n\tiframe: IFR\r\n) {\r\n\tconst session = lastBlockIDParameters.get(local.entry.blockID)\r\n\tif (session) {\r\n\t\tsession.updateTime.set(t.ytgif.previousTick)\r\n\t}\r\n\tsetupPreviousParams(local, q) // The YT API reloads the iframe onload, it disorients the users, this a counter-measurement\r\n\tawait TryFreezeAutoplay(iframe, t, q)\r\n\t//TryToRunPreviousParams(t, local)\r\n}\r\n","import { UI, setCurrentFullscreenPlayer } from '$v3/init/config/yt-gif-init'\r\nimport { playIs } from '../../lib/IFR'\r\nimport type { TQueryResult } from '$v3/player-ready/setup/GetQuery'\r\nimport type { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\n\r\n//#region 5. fullscreen\r\nexport function GetFullscreenCallbacks(q: TQueryResult, t: YT_TargetWrapper) {\r\n\treturn <const>{\r\n\t\tdefault() {\r\n\t\t\tsetCurrentFullscreenPlayer(t.GetIframeID())\r\n\r\n\t\t\tif (document.fullscreenElement) {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t\tif (q.parent.Hover()) {\r\n\t\t\t\tif ('mute' == UI.playerSettings.fullscreen_style.value) {\r\n\t\t\t\t\tq.isSoundingFine(false)\r\n\t\t\t\t} else if (\r\n\t\t\t\t\t'pause' == UI.playerSettings.fullscreen_style.value\r\n\t\t\t\t) {\r\n\t\t\t\t\tq.togglePlay(false)\r\n\t\t\t\t}\r\n\t\t\t} else if ('play' == UI.playerSettings.fullscreen_style.value) {\r\n\t\t\t\tq.togglePlay(true)\r\n\t\t\t}\r\n\t\t},\r\n\t\tautoplaySynergy() {\r\n\t\t\tif (document.fullscreenElement) {\r\n\t\t\t\tq.parent.others.toggleActive()\r\n\t\t\t} else if (playIs('all_visible')) {\r\n\t\t\t\tUI.playerSettings.play_style.dispatchEvent(new Event('change'))\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n}\r\n","import { closestYTGIFparentID } from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { allVideoParameters, recordedIDs } from '$v3/lib/types/config'\r\nimport {\r\n\tclosestBlockID,\r\n\tRemovedElementObserver,\r\n\tgetUniqueSelectorSmart,\r\n} from '$lib/utils'\r\nimport { PushNew_ShiftAllOlder_IframeBuffer } from '$v3/init/observer/performance'\r\nimport { ValidateHierarchyTimestamps } from '$v3/init/timestamp/hierarchy'\r\nimport type { YT_IFRAME as YT } from '$v3/lib/types/yt-types';\r\nimport { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport { GetHoverStates } from './listener/parent/in-out-states'\r\nimport { setupPreviousParams } from './setup/setupPreviousParams'\r\nimport { FlipStyleGenerator, GetStyleCallbacks } from './listener/toggle'\r\nimport { TimeTargetObj } from './listener/control/time/ClearTimers'\r\nimport { GetFuncResetBoundaries } from './listener/control/reset-btn/OnCustomVideoEnded'\r\nimport { GetOnIframeRemovedFromDom } from './observer/IframeRemmovedFromDom_callback'\r\nimport { GetFuncPauseOffscreen } from './observer/PauseOffscreen_callback'\r\nimport { TryFreezeAutoplay, AutoPlayToUpdate } from './finished/autoplay-flow'\r\nimport { TryToRunPreviousParams } from './finished/query'\r\nimport { GetQuery } from './setup/GetQuery'\r\nimport { TrySetupRecordID } from './setup/SetupRecordID'\r\nimport type { TStat, ILocal } from './lib/TStat'\r\nimport { Refurbish } from './setup/Refurbish'\r\nimport type { TQueryElements } from './setup/GetElements';\r\nimport { GetElementsObj } from './setup/GetElements'\r\nimport { GetFullscreenCallbacks } from '$v3/player-ready/listener/iframe/fullscreen'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\n\r\nexport async function onPlayerReady(event: YT) {\r\n\t// setup\r\n\tconst t = new YT_TargetWrapper(event.target)\r\n\tconst key = t.GetIframeID()\r\n\tconst l = GetElementsObj(key, t)\r\n\tconst { iframe, parent, timeDisplay, resetBtn } = l\r\n\r\n\tconst map = allVideoParameters.get(key)!\r\n\tmap.start.set(map.start.value || 0)\r\n\tmap.end.set(map.end.value || t.getDuration())\r\n\r\n\tconst local = GetLocalObj(map, l, iframe)\r\n\tconst q = GetQuery({\r\n\t\tmap,\r\n\t\tparent,\r\n\t\ttimeDisplay,\r\n\t\tt,\r\n\t\tiframe,\r\n\t\tlocal,\r\n\t})\r\n\r\n\tmap.speed.set(q.closestRate(map.speed.value || 1))\r\n\r\n\tTrySetupRecordID(recordedIDs.get(local.entry.blockID), t, q)\r\n\r\n\tconst styleCallbacks = GetStyleCallbacks(iframe, q, t, map, local)\r\n\r\n\tif (parent.hasAttribute('loaded')) {\r\n\t\tawait Refurbish(local, t, q, iframe)\r\n\t\tTryToRunPreviousParams(t, local, styleCallbacks)\r\n\t\treturn\r\n\t}\r\n\r\n\tiframe.removeAttribute('title')\r\n\r\n\t// 1. previous parameters if available\r\n\tsetupPreviousParams(local, q)\r\n\r\n\t// 2. play style | pause style\r\n\tconst flipIterator = FlipStyleGenerator(styleCallbacks)\r\n\tflipIterator.next()\r\n\r\n\t// 3. Mouse over the frame functionality\r\n\tconst hover = GetHoverStates(q)\r\n\tparent.addEventListener('mouseenter', hover.play)\r\n\tparent.addEventListener('mouseleave', hover.stop as EventListener)\r\n\tparent.addEventListener(\r\n\t\t'customVideoEnded',\r\n\t\tq.timeDisplay.OnCustomVideoEnded\r\n\t)\r\n\r\n\t// 4. scroll wheel - timestamp display feature\r\n\tconst time = TimeTargetObj(q, iframe, map, local, t, l)\r\n\tt.ytgif.enter = time.NewIntervalUpdate\r\n\ttimeDisplay.addEventListener('wheel', time.SeekToScroll)\r\n\ttimeDisplay.addEventListener('mouseenter', time.NewIntervalUpdate)\r\n\ttimeDisplay.addEventListener('mouseleave', () => t.ytgif.ClearTimers())\r\n\r\n\t// 5. fullscreenStyle\r\n\tconst fullscreen = GetFullscreenCallbacks(q, t)\r\n\tiframe.addEventListener('fullscreenchange', fullscreen.default)\r\n\tiframe.addEventListener('fullscreenchange', fullscreen.autoplaySynergy)\r\n\r\n\t// 6. Reload boundaries\r\n\tconst ResetBoundaries = GetFuncResetBoundaries(t, q, l, map, time, local)\r\n\t// @ts-ignore no overload for (this: HTMLElement, ev: MouseEvent) => any\r\n\tresetBtn.addEventListener('click', ResetBoundaries)\r\n\tresetBtn.ResetBoundaries_smart = ResetBoundaries\r\n\r\n\t// 7. store relevant elements with event event listeners to clean them later\r\n\t// 8. clean data and ready 'previous' parameters for next session with IframeRemovedFromDom_callback\r\n\t// Expensive? think so. Elegant? no, but works\r\n\tRemovedElementObserver({\r\n\t\tel: iframe as IFRH,\r\n\t\tOnRemovedFromDom_cb: GetOnIframeRemovedFromDom(\r\n\t\t\tflipIterator,\r\n\t\t\tt,\r\n\t\t\tq,\r\n\t\t\tmap,\r\n\t\t\tlocal.entry,\r\n\t\t\tl\r\n\t\t),\r\n\t})\r\n\r\n\t// 9. Performance Mode - Iframe Buffer & Initialize on interaction - synergy\r\n\tif (local.entry.canBeCleanedByBuffer && parent) {\r\n\t\t// sometimes the parent is already gone - while loading iframe\r\n\t\tconst parentCssPath = getUniqueSelectorSmart(parent)\r\n\t\tPushNew_ShiftAllOlder_IframeBuffer(parentCssPath)\r\n\t}\r\n\r\n\t// 10. 'auto pause' when an iframe goes out the viewport... stop playing and mute\r\n\tconst ViewportObserver = new IntersectionObserver(\r\n\t\tGetFuncPauseOffscreen(q, t, local),\r\n\t\t{ threshold: [0] }\r\n\t)\r\n\tViewportObserver.observe(iframe)\r\n\r\n\t// 11. well well well\r\n\tif (map.playRightAway?.value && map.hasOwnProperty('updateTime')) {\r\n\t\tawait AutoPlayToUpdate(iframe, t, q, map)\r\n\t} else {\r\n\t\t// pause if user doesn't intents to watch\r\n\t\tawait TryFreezeAutoplay(iframe, t, q) // this being the last one, does matter\r\n\t}\r\n\r\n\t// 12. Guard clause - onPlayerReady executed\r\n\tTryToRunPreviousParams(t, local, styleCallbacks)\r\n\tparent.setAttribute('loaded', '')\r\n\tiframe.addEventListener('load', () => (t.ytgif.previousTick = q.tick()))\r\n\tValidateHierarchyTimestamps(parent, t)\r\n}\r\nfunction GetLocalObj(\r\n\tmap: IExtendedVideoParams,\r\n\tl: TQueryElements,\r\n\tiframe: Element\r\n) {\r\n\tconst stats: TStat = {\r\n\t\tstart: map.start.value,\r\n\t\tvolume: map.volume.value,\r\n\t\tend: map.end.value,\r\n\t}\r\n\tconst local: ILocal = {\r\n\t\tentry: {\r\n\t\t\t...stats,\r\n\t\t\tblockID: l.blockID,\r\n\t\t\tblcokID_prfx: closestYTGIFparentID(iframe),\r\n\t\t\tcanBeCleanedByBuffer: !!closestBlockID(iframe),\r\n\t\t\tkey: iframe.id,\r\n\t\t},\r\n\t\tupdate: { ...stats, tickOffset: 0 },\r\n\t}\r\n\treturn local\r\n}\r\n","export async function ClickResetWrapper(\r\n\ttargetWrapper: QrySearch,\r\n\tassignObj: TResetYTEvent | null = null\r\n) {\r\n\tif (!targetWrapper) return\r\n\r\n\tconst reset = targetWrapper.querySelector(\r\n\t\t'[yt-gif-url-btn=\"reset\"]'\r\n\t) as HTMLResetBtn\r\n\r\n\tif (assignObj && 'delete-obs-tm' in assignObj)\r\n\t\t// alright\r\n\t\treset.dispatchEvent(\r\n\t\t\tnew CustomEvent('customDelObsTimestmp', {\r\n\t\t\t\tbubbles: true,\r\n\t\t\t\tcancelBubble: true,\r\n\t\t\t\tcancelable: true,\r\n\t\t\t\tdetail: {\r\n\t\t\t\t\tblockID: assignObj.blockID,\r\n\t\t\t\t},\r\n\t\t\t})\r\n\t\t)\r\n\r\n\tawait reset?.ResetBoundaries_smart?.(assignObj)\r\n}\r\n","import { UI } from '$v3/init/config/yt-gif-init'\r\nimport {\r\n\tisRendered,\r\n\tclosest_container_request,\r\n\tclosestBlock,\r\n} from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { TimestampsInHierarchy } from '$v3/init/timestamp/hierarchy'\r\nimport { ElementsPerBlock } from '$v3/lib/dom/ytgif'\r\n\r\nexport function ReloadFlow(o: IReload) {\r\n\tif (\r\n\t\to.activeIdx === -1 && // din't find any active\r\n\t\t// and ( only on active or there are no targets)\r\n\t\t(UI.timestamps.tm_loop_hierarchy.value == 'active' ||\r\n\t\t\to.targets.length == 0)\r\n\t) {\r\n\t\treturn <const>{ message: 'reload-this' }\r\n\t}\r\n\r\n\tlet nextIdx = (o.activeIdx + 1) % o.targets.length\r\n\tif (o.includesPlayerOpt) {\r\n\t\t// include player in the loop\r\n\t\tif (o.activeIdx == o.targets.length - 1) {\r\n\t\t\t// the only scenario where we need to go back to the beginning\r\n\t\t\treturn <const>{ message: 'update-timestamp' }\r\n\t\t} //\r\n\t\telse if (o.activeIdx == -1) {\r\n\t\t\t// assuming there are targets and the player was reset, go on the next one\r\n\t\t\tnextIdx = 0\r\n\t\t}\r\n\t}\r\n\r\n\tconst nextTarget = o.targets[nextIdx]\r\n\tif (isRendered(nextTarget)) {\r\n\t\treturn <const>{ message: 'seekTo-strict', target: nextTarget }\r\n\t} else {\r\n\t\treturn <const>{ message: 'reload-this' }\r\n\t}\r\n}\r\n\r\nexport function QueryTimestampObj(\r\n\tiframe: HTMLIFrameElement,\r\n\trm_container: Element\r\n) {\r\n\tconst options = Array.from(\r\n\t\tUI.timestamps.tm_loop_options.selectedOptions\r\n\t).map(o => o.value) // skip - include_player\r\n\r\n\tconst page = UI.timestamps.tm_loop_to.value || 'start'\r\n\tconst sel = `[timestamp-set][timestamp-style=\"${page}\"]`\r\n\tconst boundedSel = `${sel}:not([out-of-bounds])`\r\n\tconst tmSel = options.includes('skip') ? boundedSel : sel // Skip if target is missing or if it is out of bounds\r\n\r\n\tconst wrapper = iframe.closest('.yt-gif-wrapper')\r\n\tconst lastActive = TimestampsInHierarchy(\r\n\t\trm_container,\r\n\t\twrapper,\r\n\t\t'[last-active-timestamp]'\r\n\t)?.[0]\r\n\r\n\tconst activeSel = ElementsPerBlock(\r\n\t\tclosestBlock(lastActive),\r\n\t\ttmSel\r\n\t)?.[0] as IBtn // go one level up and search for an \"start\" timestamp, bc does it doesn't make sense to loop through \"end\" boundaries,\r\n\r\n\tconst targets = TimestampsInHierarchy(rm_container, wrapper, tmSel)\r\n\treturn <const>{\r\n\t\tquery: {\r\n\t\t\tactiveIdx: targets.indexOf(activeSel),\r\n\t\t\ttargets,\r\n\t\t\tincludesPlayerOpt: options.includes('include_player'),\r\n\t\t} as IReload,\r\n\t\twrapper,\r\n\t}\r\n}\r\nexport async function newFunction(iframe: HTMLIFrameElement) {\r\n\tif (!iframe) return <const>{}\r\n\tconst rm_container = closest_container_request(iframe)\r\n\tif (!rm_container) return <const>{}\r\n\treturn <const>{ rm_container }\r\n}\r\ninterface IReload {\r\n\ttargets: IBtn[]\r\n\tactiveIdx: number\r\n\tincludesPlayerOpt: boolean\r\n}\r\n","import { UI, setCurrentFullscreenPlayer } from '$v3/init/config/yt-gif-init'\r\nimport { exitFullscreen, isValidUrl, mapRange, sleep } from '$lib/utils'\r\nimport { ClickResetWrapper } from '$v3/lib/event/ClickResetWrapper'\r\nimport { ClickOnTimestamp } from '$v3/lib/event/ClickOnTimestamp'\r\nimport {\r\n\tReloadFlow,\r\n\tQueryTimestampObj,\r\n\tnewFunction,\r\n} from './TryToLoadNextTimestampSet'\r\n\r\nexport async function TryToLoadNextTimestampSet(\r\n\tiframe: HTMLIFrameElement,\r\n\tReload: () => Promise<void>\r\n) {\r\n\tawait sleep(10)\r\n\r\n\tconst o = await newFunction(iframe)\r\n\tif (!o.rm_container) {\r\n\t\treturn Reload()\r\n\t}\r\n\r\n\tconst { query, wrapper } = QueryTimestampObj(iframe, o.rm_container)\r\n\tconst { message, target } = ReloadFlow(query)\r\n\r\n\tif (message == 'reload-this') {\r\n\t\treturn Reload()\r\n\t} else if (message == 'update-timestamp') {\r\n\t\treturn ClickResetWrapper(wrapper, { message })\r\n\t} else if (message == 'seekTo-strict' && target) {\r\n\t\treturn ClickOnTimestamp(target, { seekToMessage: message })\r\n\t} else {\r\n\t\tconsole.error('Unknown Reload Message', message)\r\n\t}\r\n}\r\n\r\nexport function TryToPlayEndSound() {\r\n\tconst url = window.YT_GIF_DIRECT_SETTINGS.get('end_loop_sound_src')\r\n\t\t?.sessionValue as string\r\n\tif (!isValidUrl(url)) return Promise.resolve()\r\n\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\t// return a promise\r\n\t\tconst audio = new Audio() // create audio wo/ src\r\n\t\taudio.preload = 'auto' // intend to play through\r\n\t\taudio.volume = mapRange(\r\n\t\t\tNumber(UI.range.end_loop_sound_volume.value),\r\n\t\t\t0,\r\n\t\t\t100,\r\n\t\t\t0,\r\n\t\t\t1.0\r\n\t\t)\r\n\t\taudio.autoplay = true // autoplay when loaded\r\n\t\taudio.onerror = reject // on error, reject\r\n\t\taudio.onended = resolve // when done, resolve\r\n\r\n\t\taudio.src = url\r\n\t})\r\n}\r\nexport function ResetFullscreenPlayer() {\r\n\texitFullscreen()\r\n\tsetCurrentFullscreenPlayer('')\r\n}\r\n","import { UI, currentFullscreenPlayer } from '$v3/init/config/yt-gif-init'\r\nimport { isSelected } from '$v3/lib/backend-frontend/option'\r\nimport {\r\n\tTryToPlayEndSound,\r\n\tTryToLoadNextTimestampSet,\r\n\tResetFullscreenPlayer,\r\n} from './lib'\r\n\r\nexport async function HandleEndState(Args: {\r\n\tReload: () => Promise<void>\r\n\tiframe: HTMLIFrameElement\r\n\tid: string\r\n}) {\r\n\tArgs.iframe\r\n\t\t.closest('.yt-gif-wrapper')\r\n\t\t?.dispatchEvent(new CustomEvent('customVideoEnded'))\r\n\r\n\tif (UI.timestamps.tm_loop_hierarchy.value != 'disabled') {\r\n\t\tawait TryToLoadNextTimestampSet(Args.iframe, Args.Reload)\r\n\t} else {\r\n\t\tawait Args.Reload()\r\n\t}\r\n\r\n\tif (UI.range.end_loop_sound_volume.value != '0') {\r\n\t\tTryToPlayEndSound()\r\n\t}\r\n\r\n\tif (\r\n\t\tisSelected(UI.playerSettings.ps_options, 'minimize_on_video_ended') &&\r\n\t\tcurrentFullscreenPlayer === Args.id &&\r\n\t\tdocument.fullscreenElement\r\n\t) {\r\n\t\tResetFullscreenPlayer()\r\n\t}\r\n}\r\n","import { GetPlayerState } from '$v3/init/config/yt-gif-init'\r\nimport { isRendered } from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { allVideoParameters } from '$v3/lib/types/config'\r\nimport { TryReloadVideo } from '$v3/lib/event/TryReloadVideo'\r\nimport type { YT_IFRAME} from '$v3/lib/types/yt-types';\r\nimport { YT_TargetWrapper } from '$v3/lib/types/yt-types'\r\nimport { HandleEndState } from './HandleEndState'\r\n\r\nwindow.AvoidCircularDependency.getOnStateChange = () => onStateChange\r\n\r\nexport async function onStateChange(state: YT_IFRAME) {\r\n\tconst t = new YT_TargetWrapper(state.target)\r\n\tconst id = t.GetIframeID()\r\n\tconst map = allVideoParameters.get(id)\r\n\tconst iframe = t.getIframe()\r\n\r\n\tif (!isRendered(iframe)) return t.DestroyTarget()\r\n\r\n\tif (state.data === GetPlayerState().ENDED) {\r\n\t\tawait HandleEndState({\r\n\t\t\tReload: async () =>\r\n\t\t\t\tTryReloadVideo({\r\n\t\t\t\t\tt,\r\n\t\t\t\t\tstart: map?.start.value ?? 0,\r\n\t\t\t\t\tend: map?.end.value ?? 0,\r\n\t\t\t\t}),\r\n\t\t\tiframe,\r\n\t\t\tid,\r\n\t\t})\r\n\t}\r\n\r\n\tif (state.data === GetPlayerState().PLAYING && t.ytgif.timerID === null) {\r\n\t\t// NON NewIntervalUpdate\r\n\t\tt.ytgif.enter()\r\n\t}\r\n\r\n\tif (state.data === GetPlayerState().PAUSED) {\r\n\t\tt.ytgif.ClearTimers()\r\n\t}\r\n}\r\n","import { isTrue } from '$lib/utils'\r\nimport { onPlayerReady } from '$v3/player-ready'\r\nimport { onStateChange } from '$v3/player-change'\r\nimport type { IExtendedVideoParams } from '$v3/lib/types/video-types'\r\n\r\n// last - customize the iframe - api\r\nexport function playerConfig(configParams: IExtendedVideoParams) {\r\n\t// in progress\r\n\tconst {\r\n\t\tplayer_interface_language,\r\n\t\tplayer_captions_language,\r\n\t\tplayer_captions_on_load,\r\n\t} = Object.fromEntries(window.YT_GIF_DIRECT_SETTINGS) // https://stackoverflow.com/questions/49569682/destructuring-a-map#:~:text=let%20%7B%20b%2C%20d%20%7D%20%3D%20Object.fromEntries(m)\r\n\r\n\tconst playerVars = {\r\n\t\tautoplay: 1,\r\n\t\tcontrols: 1,\r\n\t\tmute: 1,\r\n\t\tstart: configParams?.start.value,\r\n\t\tend: configParams?.end.value,\r\n\r\n\t\thl: configParams?.hl.value || player_interface_language.sessionValue,\r\n\t\tcc_lang_pref:\r\n\t\t\tconfigParams?.cc.value || player_captions_language.sessionValue,\r\n\r\n\t\tcc_load_policy: isTrue(player_captions_on_load.sessionValue as s)\r\n\t\t\t? 1\r\n\t\t\t: 3,\r\n\t\tiv_load_policy: 3,\r\n\r\n\t\tvq: 'hd1080',\r\n\r\n\t\tautohide: 1,\r\n\t\tshowinfo: 0,\r\n\t\tmodestbranding: 1,\r\n\r\n\t\tfs: 1,\r\n\t\trel: 0,\r\n\r\n\t\tversion: 3,\r\n\t\tfeature: 'oembed',\r\n\t\tenablejsapi: 1,\r\n\t\torigin: 'https://www.roamresearch.com',\r\n\t}\r\n\treturn <const>{\r\n\t\theight: '100%',\r\n\t\twidth: '100%',\r\n\t\tvideoId: configParams?.id.value,\r\n\t\tplayerVars,\r\n\t\tevents: {\r\n\t\t\tonReady: onPlayerReady,\r\n\t\t\tonStateChange: onStateChange,\r\n\t\t},\r\n\t}\r\n}\r\n","import {\r\n\tclosestBlock,\r\n\tisRendered,\r\n\tclosestYTGIFparentID,\r\n\tgetWrapperUrlSufix,\r\n} from './elements-yt-gif-parent'\r\nimport { ElementsPerBlock } from './ytgif'\r\nimport { sleep } from '$lib/utils'\r\n\r\n/* ***************** */\r\nexport function getBlockID(wrapper: QrySearch) {\r\n\tif (!wrapper) return null\r\n\treturn closestYTGIFparentID(wrapper) + getWrapperUrlSufix(wrapper)\r\n}\r\nexport function getCurrentInputBlock() {\r\n\treturn document.querySelector(\r\n\t\t'.rm-block__input--active.rm-block-text'\r\n\t) as HTMLInputElement\r\n}\r\ntype T_ObjInHierarchy = {\r\n\tlastWrapper: QrySearch\r\n\tcontainer: QrySearch\r\n\tblock: QrySearch\r\n\tid: s\r\n\toriginalId: StrSearch\r\n\tok: b\r\n}\r\nexport async function getWrapperInHierarchyObj(\r\n\tpointOfReferenceElm: El\r\n): Promise<T_ObjInHierarchy> {\r\n\ttype QryS = QrySearch | undefined\r\n\r\n\tlet el = closestBlock(pointOfReferenceElm)\r\n\tconst originalId = el?.id\r\n\r\n\twhile (el?.contains?.(pointOfReferenceElm)) {\r\n\t\tel = el.parentElement\r\n\r\n\t\tif (classIs(el?.parentElement, 'roam-app')) return GetFailObj() // if you get to the top of the DOM, stop\r\n\r\n\t\tlet wrapper = getWrapper()\r\n\t\tif (!wrapper) {\r\n\t\t\tif (!classIs(el, 'roam-block-container')) {\r\n\t\t\t\tcontinue // F\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// await if the RAW wrapper exists\r\n\t\twhile (\r\n\t\t\tisRendered(wrapper) &&\r\n\t\t\t!wrapper?.hasAttribute('invalid-yt-gif') &&\r\n\t\t\tclassIs(wrapper, 'rm-xparser-default-yt-gif')\r\n\t\t) {\r\n\t\t\tawait sleep(10)\r\n\t\t}\r\n\r\n\t\twrapper = getWrapper() // get the wrapper again, in case it was rendered\r\n\r\n\t\tconst block = closestBlock(wrapper)\r\n\t\tconst lastWrapper = ElementsPerBlock(block, '.yt-gif-wrapper').pop()\r\n\r\n\t\tif (lastWrapper)\r\n\t\t\t// gotem!\r\n\t\t\treturn <const>{\r\n\t\t\t\tlastWrapper,\r\n\t\t\t\tcontainer: el,\r\n\t\t\t\tblock,\r\n\t\t\t\tid: block?.id as s,\r\n\t\t\t\toriginalId,\r\n\t\t\t\tok: true,\r\n\t\t\t}\r\n\t}\r\n\treturn GetFailObj()\r\n\r\n\tfunction classIs(x: QryS, cs: s) {\r\n\t\treturn x ? x.classList.contains(cs) : false\r\n\t}\r\n\tfunction hasSel(x: QryS, sel: s) {\r\n\t\treturn x ? x.querySelector(sel) : null\r\n\t}\r\n\tfunction GetFailObj() {\r\n\t\treturn <T_ObjInHierarchy>{ ok: false }\r\n\t}\r\n\tfunction getWrapper() {\r\n\t\treturn (\r\n\t\t\thasSel(el?.firstElementChild, '.yt-gif-wrapper') ?? // wrapper!\r\n\t\t\thasSel(el?.firstElementChild, '.rm-xparser-default-yt-gif') // RAW wrapper\r\n\t\t)\r\n\t}\r\n}\r\n","import { ElementsPerBlock } from '$v3/lib/dom/ytgif'\r\nimport { closestBlock, closest_attr } from '$v3/lib/dom/elements-yt-gif-parent'\r\n\r\nexport function getMutationNodes(\r\n\tgetCrrContainer: ILocalWrapper['getCrrContainer'],\r\n\tmutationsList: MutationRecord[],\r\n\tMutationObj: TMutationObj\r\n) {\r\n\tlet added = Array<T_tmRecord>()\r\n\tlet lastActive = Array<T_tmRecord>()\r\n\tconst rm_container = getCrrContainer()\r\n\r\n\tfor (const record of mutationsList) {\r\n\t\tconst t = record.target\r\n\t\tif (t == rm_container || !underSameObs()) continue\r\n\t\tif (record.type == 'attributes') {\r\n\t\t\tlastActive = [\r\n\t\t\t\t...lastActive,\r\n\t\t\t\t...NodesRecord(\r\n\t\t\t\t\tgetCrrContainer,\r\n\t\t\t\t\trecord.target,\r\n\t\t\t\t\t'last-active-timestamp',\r\n\t\t\t\t\tt\r\n\t\t\t\t),\r\n\t\t\t]\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\tif (!(record.target as El).hasAttribute('class')) continue\r\n\r\n\t\tconst { removedNodes, addedNodes } = record\r\n\t\tMutationObj.removed = [\r\n\t\t\t...MutationObj.removed,\r\n\t\t\t...NodesRecord(\r\n\t\t\t\tgetCrrContainer,\r\n\t\t\t\tremovedNodes,\r\n\t\t\t\t'active-timestamp',\r\n\t\t\t\tt\r\n\t\t\t),\r\n\t\t]\r\n\t\tadded = [\r\n\t\t\t...added,\r\n\t\t\t...NodesRecord(\r\n\t\t\t\tgetCrrContainer,\r\n\t\t\t\taddedNodes,\r\n\t\t\t\t'yt-gif-timestamp-emulation',\r\n\t\t\t\tt\r\n\t\t\t),\r\n\t\t]\r\n\t}\r\n\r\n\tMutationObj.removed = validArr(MutationObj.removed)\r\n\tadded = validArr(added)\r\n\tlastActive = validArr(lastActive)\r\n\tfunction validArr<T>(arr: T[]) {\r\n\t\treturn arr.flat(Infinity).filter(x => !!x)\r\n\t}\r\n\r\n\treturn <const>{ lastActive, added }\r\n\r\n\t// TODO: added param, I believe the return func never gets executed\r\n\tfunction underSameObs() {\r\n\t\tconst rmAt = (el: El, attr: s) => closest_attr(el, attr).found\r\n\t\treturn (el: El) =>\r\n\t\t\t[\r\n\t\t\t\trmAt(el, 'yt-gif-block-uid'),\r\n\t\t\t\trmAt(el, 'yt-gif-anchor-container'),\r\n\t\t\t].some(v => v == rm_container)\r\n\t}\r\n}\r\nfunction NodesRecord(\r\n\tgetCrrContainer: ILocalWrapper['getCrrContainer'],\r\n\tNodes: NodeList | Node,\r\n\tattr: s,\r\n\ttarget: Node\r\n): T_tmRecord[] {\r\n\tif (!Nodes || (Nodes as NodeList).length == 0) return []\r\n\r\n\tconst ElsArr = (Nodes instanceof NodeList ? Array.from(Nodes) : [Nodes])\r\n\t\t.map(nd => nd as HTMLElement)\r\n\t\t.filter(el => !!el.tagName)\r\n\r\n\tconst _targetEl = target as HTMLElement\r\n\r\n\t//#region utils\r\n\tconst rm_container = getCrrContainer()! // typescript!\r\n\r\n\tconst siblingIndex = (siblings: El[], el: El) =>\r\n\t\tArray.from(siblings).flat(Infinity).indexOf(el)\r\n\r\n\tconst getChildren = (sel: s) => rm_container.queryAllasArr(sel)\r\n\tconst getChildrenArr = (sel: s, self?: b) =>\r\n\t\t!self ? getChildren(sel) : [rm_container, ...getChildren(sel)]\r\n\r\n\tfunction timestampObj(page: startEnd, arr: El[]) {\r\n\t\treturn getTmpObj(\r\n\t\t\tarr.find(x => x.getAttribute('timestamp-style') == page) as El,\r\n\t\t\tpage,\r\n\t\t\tarr\r\n\t\t)\r\n\t}\r\n\tfunction lastTimestampObj(el: El, arr: El[]) {\r\n\t\treturn getTmpObj(\r\n\t\t\tel,\r\n\t\t\tel.getAttribute('timestamp-style') as startEnd,\r\n\t\t\tarr\r\n\t\t)\r\n\t}\r\n\tfunction getTmpObj(el: El, page: startEnd, arr: El[]): T_tmsRec {\r\n\t\treturn <const>{\r\n\t\t\tel,\r\n\t\t\ttimestamp: el?.getAttribute('timestamp') as s,\r\n\t\t\tindex: arr.indexOf(el),\r\n\t\t\tpage,\r\n\t\t\totherPage: (page == 'start' ? 'end' : 'start') as startEnd,\r\n\t\t}\r\n\t}\r\n\r\n\t//#endregion\r\n\treturn ElsArr.map(x => {\r\n\t\tif (x.hasAttribute(attr)) return x\r\n\t\telse return x.queryAllasArr(`[${attr}]`)\r\n\t})\r\n\t\t.flat(Infinity)\r\n\t\t.map(el => closestBlock(el as El))\r\n\t\t.filter((v, i, a) => !!v && a.indexOf(v) === i) // remove duplicates\r\n\t\t.map(block => {\r\n\t\t\tblock = block as HTMLElement // shouldn't be necessary\r\n\r\n\t\t\t// prettier-ignore\r\n\t\t\tconst allTimestamps = ElementsPerBlock(block, '[yt-gif-timestamp-emulation]') || [];\r\n\t\t\t// prettier-ignore\r\n\t\t\tconst activeTimestamps = allTimestamps.filter(x => x.hasAttribute(attr)) || [];\r\n\t\t\t// prettier-ignore\r\n\t\t\tconst lastActiveEl = activeTimestamps.find(x => x.hasAttribute('last-active-timestamp') || x.hasAttribute(attr)) as El;\r\n\r\n\t\t\treturn <const>{\r\n\t\t\t\tblockID: block.id,\r\n\t\t\t\tblockIndex: siblingIndex(\r\n\t\t\t\t\tgetChildrenArr('.rm-block__input')!,\r\n\t\t\t\t\tblock\r\n\t\t\t\t),\r\n\t\t\t\tcontainerIndex: siblingIndex(\r\n\t\t\t\t\tgetChildrenArr('.roam-block-container', true)!,\r\n\t\t\t\t\trm_container\r\n\t\t\t\t),\r\n\t\t\t\tworkflow: 'strict',\r\n\r\n\t\t\t\tnode: _targetEl.querySelector('[yt-gif-timestamp-emulation]')!,\r\n\t\t\t\tstart: timestampObj('start', activeTimestamps),\r\n\t\t\t\tend: timestampObj('end', activeTimestamps),\r\n\t\t\t\ttarget: lastTimestampObj(lastActiveEl, activeTimestamps),\r\n\t\t\t}\r\n\t\t})\r\n}\r\nexport type TMutationObj = { removed: TMutArr; lastActive: TMutArr }\r\nexport type TMutIdx = TlastActiveTm['lastActiveTimestamp'] | T_tmRecord\r\nexport type TMutArr = Array<TMutIdx>\r\ntype T_tmsRec = {\r\n\tel: El\r\n\ttimestamp: string\r\n\tindex: number\r\n\tpage: startEnd\r\n\totherPage: startEnd\r\n}\r\nexport interface T_tmRecord {\r\n\tblockID: string\r\n\tblockIndex: number\r\n\tcontainerIndex: number\r\n\tworkflow: string\r\n\tnode: Element\r\n\tstart: T_tmsRec\r\n\tend: T_tmsRec\r\n\ttarget: T_tmsRec\r\n}\r\n","import { assertSelector } from '$lib/utils'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport { ClickResetWrapper } from '$v3/lib/event/ClickResetWrapper'\r\nimport type { TMutationObj } from '../mutation'\r\n\r\nexport async function TryToReset(\r\n\tgetTargetWrapper: ILocalWrapper['getTargetWrapper'],\r\n\tMutationObj: TMutationObj\r\n) {\r\n\tconst removedActiveObj = MutationObj.removed.find(\r\n\t\trO => rO?.target?.timestamp && canReset(rO.blockID)\r\n\t)\r\n\tconst activeMatch =\r\n\t\t!!removedActiveObj &&\r\n\t\tUI.timestamps.tm_reset_on_removal.value != 'disabled'\r\n\r\n\tif (activeMatch) {\r\n\t\tMutationObj.removed.length = 0\r\n\r\n\t\tawait ClickResetWrapper(getTargetWrapper())\r\n\t}\r\n\r\n\treturn activeMatch\r\n\r\n\tfunction canReset(id: s) {\r\n\t\tif ('block' == UI.timestamps.tm_reset_on_removal.value) {\r\n\t\t\tid = assertSelector(id)\r\n\t\t\tif (!document.querySelector('div.rm-block__input#' + id))\r\n\t\t\t\treturn true\r\n\t\t} else if ('container' == UI.timestamps.tm_reset_on_removal.value) {\r\n\t\t\tif (!document.getElementById(id)) return true\r\n\t\t}\r\n\t}\r\n}\r\n","import { UI } from '$v3/init/config/yt-gif-init'\r\nimport { ElementsPerBlock } from '$v3/lib/dom/ytgif'\r\nimport type { T_tmRecord } from '../mutation'\r\nimport { TryToRecoverActiveTimestamp } from './query'\r\n\r\nexport async function TryToRestore(\r\n\t{ getObsTimestamp, delObsTimestmp, getCrrContainer }: ILocalWrapper,\r\n\tadded: T_tmRecord[]\r\n) {\r\n\tconst commonObj = added.find(a => OkObservedTimestamp(getObsTimestamp, a))\r\n\tconst restoreMath = !!commonObj && UI.timestamps.tm_recovery.checked\r\n\tif (!restoreMath) {\r\n\t\treturn false\r\n\t}\r\n\r\n\tconst block = document.getElementById(commonObj.blockID)\r\n\r\n\t// wait until all timestamps are rendered\r\n\tif (AnyInvalidRawTimestamp(block)) {\r\n\t\treturn true\r\n\t}\r\n\r\n\tconst equals = GetEquals(getObsTimestamp, block)\r\n\r\n\t// cleanup - since it's a rendered mismatch\r\n\tif (UI.timestamps.tm_restore.value == 'match' && !equals()) {\r\n\t\tdelObsTimestmp()\r\n\t\treturn true\r\n\t}\r\n\r\n\t// value == 'any' - go ahead with anything in this position\r\n\tawait TryToRecoverActiveTimestamp(\r\n\t\t//\r\n\t\tgetCrrContainer,\r\n\t\tgetObsTimestamp(),\r\n\t\t{ simMessage: equals() ? 'visuals' : '' }\r\n\t)\r\n\treturn true\r\n}\r\nfunction GetEquals(\r\n\tgetObsTimestamp: ILocalWrapper['getObsTimestamp'],\r\n\tblock: HTMLElement | null\r\n) {\r\n\ttype tms = 'timestamp' | 'index'\r\n\tconst get = (k: tms) => getObsTimestamp()?.target[k]\r\n\r\n\treturn (k: tms = 'timestamp') =>\r\n\t\tget(k)?.toString() ==\r\n\t\tElementsPerBlock(block, `[${k}]`)?.[\r\n\t\t\t//TODO: null may be converted to 0\r\n\t\t\tNumber(get('index'))\r\n\t\t]?.getAttribute?.(k)\r\n}\r\nfunction AnyInvalidRawTimestamp(block: HTMLElement | null) {\r\n\tconst rawComponents = ElementsPerBlock(\r\n\t\tblock,\r\n\t\t'.rm-xparser-default-start, .rm-xparser-default-end'\r\n\t)\r\n\tconst rendered = rawComponents.length > 0\r\n\treturn rendered\r\n}\r\nfunction OkObservedTimestamp(\r\n\tgetObsTimestamp: ILocalWrapper['getObsTimestamp'],\r\n\taO: T_tmRecord\r\n) {\r\n\treturn !!aO.blockID && aO.blockID == getObsTimestamp()?.blockID\r\n}\r\n","import { UI } from '$v3/init/config/yt-gif-init'\r\nimport type { TMutationObj, TMutIdx, T_tmRecord } from '../mutation'\r\n\r\nexport function CleanupGarbage(added: T_tmRecord[], MutationObj: TMutationObj) {\r\n\tif (\r\n\t\t!UI.timestamps.tm_recovery.checked ||\r\n\t\tadded.length > 0 ||\r\n\t\tMutationObj.removed.length > 0\r\n\t) {\r\n\t\treturn\r\n\t}\r\n\r\n\tconst inactiveYetAdded = MutationObj.removed.find(\r\n\t\tr =>\r\n\t\t\tOkTimestamp(r) &&\r\n\t\t\tadded.some(a => OkTimestamp(a) && SameBlockID(a, r))\r\n\t)\r\n\r\n\tif (inactiveYetAdded) {\r\n\t\tconst start = MutationObj.removed.indexOf(inactiveYetAdded)\r\n\t\tMutationObj.removed.splice(start, 1)\r\n\t}\r\n}\r\nfunction OkTimestamp(o: TMutIdx | T_tmRecord) {\r\n\treturn o.target.timestamp\r\n}\r\nfunction SameBlockID(a: T_tmRecord, r: TMutIdx) {\r\n\treturn a.blockID.includes(r.blockID)\r\n}\r\n","import type { TMutationObj } from '../mutation';\r\nimport { getMutationNodes } from '../mutation'\r\nimport { TryToSetLastActiveTimestamp } from './query'\r\nimport { TryToReset } from './reset'\r\nimport { TryToRestore } from './restore'\r\nimport { CleanupGarbage } from './cleanup'\r\n\r\nexport async function TryToRecoverTimestamps(\r\n\tthat: ILocalWrapper,\r\n\tmutationsList: MutationRecord[],\r\n\tMutationObj: TMutationObj\r\n) {\r\n\tconst { lastActive, added } = getMutationNodes(\r\n\t\tthat.getCrrContainer,\r\n\t\tmutationsList,\r\n\t\tMutationObj\r\n\t)\r\n\r\n\t// 0. set last active timestamp by attribute\r\n\tTryToSetLastActiveTimestamp(that.setObsTimestamp, lastActive)\r\n\r\n\t// 1. Reset when removed\r\n\tif (await TryToReset(that.getTargetWrapper, MutationObj)) {\r\n\t\treturn\r\n\t}\r\n\r\n\t// 2. Restore last active timestamp\r\n\tif (await TryToRestore(that, added)) {\r\n\t\treturn\r\n\t}\r\n\r\n\t// 1.2 cleanup - previous unrendered|removed node\r\n\tCleanupGarbage(added, MutationObj)\r\n}\r\n","import { getOption } from '$v3/lib/backend-frontend/option'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport { DeactivateTimestampsInHierarchy } from '$v3/init/timestamp/hierarchy'\r\nimport { closest_anchor_container } from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { TryToRecoverTimestamps } from './flow'\r\nimport type { TMutationObj } from './mutation'\r\n\r\n// -------------------\r\nexport function TrySetUpTimestampRecovery(\r\n\tthat: ILocalWrapper,\r\n\trm_container: El\r\n) {\r\n\tif (!rm_container || rm_container?.hasAttribute('timestamp-observer')) {\r\n\t\treturn <const>{\r\n\t\t\tgetCrrContainer: () => rm_container!,\r\n\t\t\tswitchTimestampObsOnAchor: (e: Event) => {},\r\n\t\t}\r\n\t}\r\n\tconst { delObsTimestmp, getTargetWrapper, getObsTimestamp } = that\r\n\r\n\trm_container.setAttribute('timestamp-observer', '')\r\n\trm_container.addEventListener('customDelObsTimestmp', delObsTimestmp)\r\n\r\n\t// @ts-ignore\r\n\tconst arr: TMutArr = [getObsTimestamp()]\r\n\t// prettier-ignore\r\n\tconst MutationObj: TMutationObj = { removed: arr, lastActive: arr };\r\n\tlet awaiting = false\r\n\r\n\tconst observer = new MutationObserver(async mutationsList => {\r\n\t\tif (awaiting || !UI.display.simulate_roam_research_timestamps.checked)\r\n\t\t\treturn\r\n\r\n\t\tawaiting = true\r\n\r\n\t\tawait TryToRecoverTimestamps(that, mutationsList, MutationObj)\r\n\r\n\t\tawaiting = false\r\n\t})\r\n\r\n\tconst config = { attributes: true, childList: true, subtree: true }\r\n\tconst anchor_opt = getOption(UI.timestamps.tm_options, 'anchor')\r\n\tconst target = getTarget2Observer(anchor_opt.selected)\r\n\r\n\tlet getCrrContainer = () => target\r\n\tobserver.observe(target, config)\r\n\r\n\tconst switchTimestampObsOnAchor = (e: Event) => {\r\n\t\t//@ts-ignore\r\n\t\tconst bol: b = e.target.selected\r\n\r\n\t\tDeactivateTimestampsInHierarchy(\r\n\t\t\tgetTarget2Observer(true),\r\n\t\t\tgetTargetWrapper()\r\n\t\t)\r\n\t\tgetTarget2Observer(!bol)?.removeEventListener(\r\n\t\t\t'customDelObsTimestmp',\r\n\t\t\tdelObsTimestmp\r\n\t\t)\r\n\r\n\t\tobserver.disconnect() // self or anchor?\r\n\r\n\t\tconst target = getTarget2Observer(bol)\r\n\r\n\t\ttarget.addEventListener('customDelObsTimestmp', delObsTimestmp)\r\n\t\tobserver.observe(target, config)\r\n\r\n\t\tgetCrrContainer = () => target\r\n\t}\r\n\r\n\tanchor_opt.addEventListener('customChange', switchTimestampObsOnAchor)\r\n\r\n\tfunction getTarget2Observer(bol: b) {\r\n\t\treturn !bol\r\n\t\t\t? rm_container\r\n\t\t\t: closest_anchor_container(rm_container) ?? rm_container\r\n\t}\r\n\treturn <const>{\r\n\t\tgetCrrContainer,\r\n\t\tswitchTimestampObsOnAchor,\r\n\t}\r\n}\r\n","import { observedParameters } from '$v3/lib/types/config'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport { getBlockID } from '$v3/lib/dom/roam'\r\nimport { TrySetUpTimestampRecovery } from '.'\r\n\r\n// 5.0 timestamp recovery\r\nexport function TimestampRecovery(o: {\r\n\trm_container: El | null\r\n\tgrandParentBlock: El\r\n\tblockID: string\r\n}) {\r\n\tconst { rm_container, grandParentBlock, blockID } = o\r\n\tconst that: ILocalWrapper = {\r\n\t\tgetCrrContainer: () => rm_container!,\r\n\r\n\t\tgetTargetWrapper: () => {\r\n\t\t\tconst block =\r\n\t\t\t\tdocument.getElementById(grandParentBlock.id) ?? grandParentBlock\r\n\t\t\tif (!block) return null\r\n\r\n\t\t\treturn block.queryAllasArr('.yt-gif-wrapper')?.pop() ?? null\r\n\t\t},\r\n\r\n\t\tgetLocalBlockID: () => {\r\n\t\t\treturn getBlockID(that.getTargetWrapper()) ?? blockID\r\n\t\t},\r\n\r\n\t\tgetObsTimestamp: () => {\r\n\t\t\tconst lastActive = observedParameters.get(\r\n\t\t\t\tthat.getLocalBlockID()\r\n\t\t\t)?.lastActiveTimestamp\r\n\r\n\t\t\tif (lastActive && UI.timestamps.tm_recovery.checked) {\r\n\t\t\t\treturn lastActive\r\n\t\t\t}\r\n\t\t\treturn null\r\n\t\t},\r\n\r\n\t\tdelObsTimestmp: () => {\r\n\t\t\tobservedParameters.delete(that.getLocalBlockID())\r\n\t\t},\r\n\r\n\t\tsetObsTimestamp: (commonObj: TlastActiveTm['lastActiveTimestamp']) => {\r\n\t\t\tif (!commonObj || !commonObj.blockID) return\r\n\t\t\tconst blockID = that.getLocalBlockID()\r\n\t\t\tconst lastActive =\r\n\t\t\t\tobservedParameters.get(blockID)?.lastActiveTimestamp\r\n\r\n\t\t\tconst equals =\r\n\t\t\t\tcommonObj.target?.timestamp === lastActive?.target?.timestamp\r\n\t\t\tconst ok = commonObj.target?.timestamp\r\n\r\n\t\t\tif (ok && (!equals || !lastActive))\r\n\t\t\t\t// newEntry || not even initialized || it's pair is missing\r\n\t\t\t\tobservedParameters.set(blockID, {\r\n\t\t\t\t\tlastActiveTimestamp: commonObj,\r\n\t\t\t\t}) // Hmmm...\r\n\t\t},\r\n\r\n\t\tswitchTimestampObsOnAchor: (e: Event) => {},\r\n\t}\r\n\r\n\treturn <const>{\r\n\t\t...that,\r\n\t\t...TrySetUpTimestampRecovery(that, rm_container!),\r\n\t}\r\n}\r\n","import {\r\n\trecordedIDs,\r\n\tUIDtoURLInstancesMapMap,\r\n\tallVideoParameters,\r\n\tsessionIDs,\r\n} from '$v3/lib/types/config'\r\nimport { ChangeElementType } from '$lib/utils'\r\nimport { cssData, attrInfo, links } from '$v3/init/config/paths'\r\nimport { iframeIDprfx } from '$v3/init/config/yt-gif-init'\r\nimport {\r\n\tproperBlockIDSufix,\r\n\tclosest_container,\r\n} from '$v3/lib/dom/elements-yt-gif-parent'\r\nimport { T_YT_RECORD } from '$v3/lib/types/yt-types'\r\nimport { isInput_selectedValid } from '$v3/lib/dom/select/isInputSelected'\r\nimport { ExtractParamsFromUrl } from '$v3/init/formatter/query/extract'\r\n\r\nexport function SetupTimestampObserver(grandParentBlock: Element, uid: string) {\r\n\tconst rm_container = closest_container(grandParentBlock)\r\n\trm_container?.setAttribute('yt-gif-block-uid', uid)\r\n\treturn rm_container\r\n}\r\nexport function GetNewID() {\r\n\treturn iframeIDprfx + Number(++window.YT_GIF_OBSERVERS.creationCounter)\r\n}\r\nexport function CreateRecordID(o: {\r\n\tuid: string\r\n\tgrandParentBlock: Element\r\n\turl: string\r\n\taccUrlIndex: number\r\n}) {\r\n\tconst record = new T_YT_RECORD()\r\n\tsessionIDs.uid = o.uid\r\n\tconst blockID =\r\n\t\to.grandParentBlock.id + properBlockIDSufix(o.url, o.accUrlIndex)\r\n\tif (blockID != null) recordedIDs.set(blockID, record)\r\n\treturn <const>{ blockID, record }\r\n}\r\nexport function CreateConfigParams(newId: string, url: string) {\r\n\tallVideoParameters.set(newId, ExtractParamsFromUrl(url))\r\n\tconst configParams = allVideoParameters.get(newId)! // I just created it!\r\n\treturn configParams\r\n}\r\nexport function CheckFalsePositive(o: {\r\n\turl: string\r\n\taccUrlIndex: number\r\n\tuid: string\r\n\twrapper: HTMLElement\r\n}) {\r\n\tif (!o.url || o.accUrlIndex < 0 || !o.uid) {\r\n\t\tUIDtoURLInstancesMapMap.delete(o.uid)\r\n\t\to.wrapper.setAttribute('invalid-yt-gif', '')\r\n\t\tconsole.log(\r\n\t\t\t`YT GIF: Couldn't find yt-gif component number ${\r\n\t\t\t\to.accUrlIndex + 1\r\n\t\t\t} within the block ((${o.uid}))`\r\n\t\t)\r\n\t\treturn true\r\n\t}\r\n\treturn false\r\n}\r\nexport function CreateYTGIFElement(o: {\r\n\twrapper: HTMLElement\r\n\tcustomSpan: s\r\n\r\n\ttargetClass: string\r\n\tdataCreation: string\r\n\r\n\turl: string\r\n\taccUrlIndex: number\r\n\tnewId: string\r\n}) {\r\n\tlet wrapper = o.wrapper\r\n\r\n\tif (wrapper.tagName != 'DIV') {\r\n\t\twrapper = ChangeElementType(wrapper, 'div')\r\n\t}\r\n\r\n\twrapper.parentElement?.classList.add(`${cssData.yt_gif_wrapper}-parent`)\r\n\twrapper.className = `${cssData.yt_gif_wrapper} dont-focus-block`\r\n\r\n\tif (o.customSpan) {\r\n\t\twrapper.style.setProperty(\r\n\t\t\t'--yt-gif-player-span',\r\n\t\t\tparseFloat(o.customSpan) + '%'\r\n\t\t)\r\n\t}\r\n\r\n\twrapper.setAttribute(attrInfo.target, o.targetClass)\r\n\twrapper.setAttribute(attrInfo.creation.name, o.dataCreation)\r\n\twrapper.setAttribute(attrInfo.url.path, o.url)\r\n\twrapper.setAttribute(attrInfo.url.index, o.accUrlIndex.toString())\r\n\twrapper.innerHTML = ''\r\n\twrapper.insertAdjacentHTML('afterbegin', links.html.fetched.playerControls)\r\n\twrapper.querySelector('.yt-gif-player')!.id = o.newId\r\n\treturn wrapper\r\n}\r\nexport function AsyncDeployment(dataCreation: string) {\r\n\treturn (\r\n\t\tdataCreation == attrInfo.creation.forceAwaiting ||\r\n\t\tisInput_selectedValid()\r\n\t)\r\n}\r\n","import {\r\n\trecordedIDs,\r\n\tUIDtoURLInstancesMapMap,\r\n\tallVideoParameters,\r\n} from '$v3/lib/types/config'\r\nimport { getOption } from '$v3/lib/backend-frontend/option'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\nimport { DeactivateTimestampsInHierarchy } from '$v3/init/timestamp/hierarchy'\r\nimport { isRendered } from '$v3/lib/dom/elements-yt-gif-parent'\r\n\r\nexport function RemovedFromDom(o: {\r\n\tthat: ILocalWrapper\r\n\tblockID: s\r\n\tdeployed(): boolean\r\n\twrapper: El\r\n\tuid: s\r\n\tnewId: s\r\n}) {\r\n\tconst rm_container = o.that.getCrrContainer()\r\n\tUIDtoURLInstancesMapMap.delete(o.uid)\r\n\tif (!o.deployed()) {\r\n\t\trecordedIDs.delete(o.blockID)\r\n\t\tallVideoParameters.delete(o.newId)\r\n\t}\r\n\r\n\tif (!UI.timestamps.tm_recovery.checked) {\r\n\t\tDeactivateTimestampsInHierarchy(rm_container, o.wrapper)\r\n\t}\r\n\r\n\tif (\r\n\t\t!isRendered(rm_container) &&\r\n\t\trm_container?.closest('.rm-sidebar-outline')\r\n\t) {\r\n\t\to.that.delObsTimestmp()\r\n\t}\r\n\r\n\tif (!isRendered(rm_container)) {\r\n\t\tgetOption(UI.timestamps.tm_options, 'anchor').removeEventListener(\r\n\t\t\t'customChange',\r\n\t\t\to.that.switchTimestampObsOnAchor\r\n\t\t)\r\n\t}\r\n}\r\n","import { RemovedElementObserver } from '$lib/utils'\r\nimport { URLResults } from './setup/url-result'\r\nimport { tryToInsertControls } from './setup/formatter'\r\nimport { DeployAsync } from './deploy/async'\r\nimport { playerConfig } from './deploy/config'\r\nimport { TimestampRecovery } from './observer/timestamp-recovery/driver'\r\nimport { AssertParamsClickTimestamp } from './observer/timestamp-recovery/click'\r\nimport {\r\n\tCheckFalsePositive,\r\n\tGetNewID,\r\n\tCreateConfigParams,\r\n\tCreateRecordID,\r\n\tCreateYTGIFElement,\r\n\tSetupTimestampObserver,\r\n\tAsyncDeployment,\r\n} from './setup/query'\r\nimport { RemovedFromDom } from './observer/removed'\r\n\r\nexport async function onYouTubePlayerAPIReady(params: {\r\n\twrapper: HTMLElement\r\n\ttargetClass: string\r\n\tdataCreation: string\r\n\tmessage: string\r\n}) {\r\n\tlet { wrapper } = params\r\n\tif (!wrapper || !wrapper.parentNode) return null\r\n\tlet deployed = false\r\n\r\n\t// search and get urlIndex and uid\r\n\tconst uidResult = await URLResults(wrapper)\r\n\tconst { url, uid, grandParentBlock } = uidResult\r\n\r\n\t// don't add up false positives\r\n\tif (CheckFalsePositive({ ...uidResult, wrapper })) return null\r\n\r\n\tconst newId = GetNewID()\r\n\r\n\t// OnPlayerReady video params point of reference\r\n\tconst configParams = CreateConfigParams(newId, url)\r\n\r\n\t// target's point of reference\r\n\tconst { blockID, record } = CreateRecordID(uidResult)\r\n\r\n\t// the div that the YTiframe will replace\r\n\twrapper = CreateYTGIFElement({\r\n\t\t...params,\r\n\t\t...uidResult,\r\n\t\tcustomSpan: configParams.sp.value,\r\n\t\tnewId,\r\n\t})\r\n\r\n\t// Observe children containers and recover active timestamps respectively\r\n\tconst rm_container = SetupTimestampObserver(grandParentBlock, uid)\r\n\r\n\tconst base = { rm_container, grandParentBlock, blockID }\r\n\tconst that = TimestampRecovery(base)\r\n\tconst instance = { wrapper, ...base, ...uidResult }\r\n\r\n\t// Set up btns\r\n\ttryToInsertControls(instance, record)\r\n\r\n\t// On removed from DOM clear Uid2Url map and deactivate timestamps\r\n\tRemovedElementObserver({\r\n\t\tel: grandParentBlock?.querySelector('span'),\r\n\t\tOnRemovedFromDom_cb: () =>\r\n\t\t\tRemovedFromDom({\r\n\t\t\t\t...instance,\r\n\t\t\t\tdeployed: () => deployed,\r\n\t\t\t\tthat,\r\n\t\t\t\tblockID,\r\n\t\t\t\tnewId,\r\n\t\t\t}),\r\n\t})\r\n\r\n\t// Interaction\r\n\tif (AsyncDeployment(params.dataCreation)) {\r\n\t\tDeployAsync(that, {\r\n\t\t\twrapper,\r\n\t\t\turl,\r\n\t\t\tconfigParams,\r\n\t\t\tdeploy,\r\n\t\t})\r\n\t} else {\r\n\t\tawait AssertParamsClickTimestamp(that, configParams)\r\n\t\tdeploy()\r\n\t}\r\n\r\n\treturn wrapper\r\n\r\n\tfunction deploy() {\r\n\t\tdeployed = true\r\n\t\trecord.wTarget = new window.YT.Player(newId, playerConfig(configParams))\r\n\t}\r\n}\r\n","import { isNotZoomPath } from '$lib/utils'\r\nimport { attrInfo } from '../../config/paths'\r\nimport { onYouTubePlayerAPIReady } from '$v3/api-ready'\r\n\r\nexport function Local(targetClass: s) {\r\n\t// ObserveIntersectToSetUpPlayer when cssClass is added to the DOM\r\n\treturn {\r\n\t\tasync OnRendered(wrapper: Element) {\r\n\t\t\twindow.YT_GIF_OBSERVERS.masterIntersectionObservers.push(\r\n\t\t\t\tPlayerOnIntersection({\r\n\t\t\t\t\twrapper,\r\n\t\t\t\t\tmessage: 'valid entries MutationObserver',\r\n\t\t\t\t\ttargetClass,\r\n\t\t\t\t})\r\n\t\t\t)\r\n\t\t},\r\n\t\tvalidTemplates() {\r\n\t\t\t//AvoidAllZoomChildren\r\n\t\t\treturn document\r\n\t\t\t\t.queryAllasArr('.' + targetClass)\r\n\t\t\t\t.filter(el => isNotZoomPath(el)) as HTMLElement[]\r\n\t\t},\r\n\t}\r\n}\r\nexport function DeployPlayer({ wrapper, targetClass, message }: IReadyInput) {\r\n\tonYouTubePlayerAPIReady({\r\n\t\twrapper: wrapper as HTMLElement,\r\n\t\ttargetClass,\r\n\t\tdataCreation: wrapper.getAttribute(attrInfo.creation.name)!,\r\n\t\tmessage: message || 'YScrollerObserver',\r\n\t})\r\n}\r\nexport function PlayerOnIntersection(input: IReadyInput) {\r\n\tconst yobs = new IntersectionObserver(\r\n\t\tentries => {\r\n\t\t\tif (!entries[0]) yobs.disconnect()\r\n\r\n\t\t\tfor (const entry of entries)\r\n\t\t\t\tif (entry.isIntersecting) {\r\n\t\t\t\t\tDeployPlayer(input)\r\n\t\t\t\t\tyobs.disconnect()\r\n\t\t\t\t\tbreak\r\n\t\t\t\t}\r\n\t\t},\r\n\t\t{\r\n\t\t\tthreshold: [0],\r\n\t\t}\r\n\t)\r\n\r\n\tyobs.observe(input.wrapper)\r\n\r\n\treturn yobs\r\n}\r\ninterface IReadyInput {\r\n\twrapper: Element\r\n\ttargetClass: string\r\n\tmessage?: string\r\n}\r\n","import { inViewportElsHard } from '$lib/utils'\r\nimport { Mutation_cb_raw_rm_cmpts } from '../../../lib/backend-frontend/mutation'\r\nimport { Local, DeployPlayer, PlayerOnIntersection } from './query'\r\n\r\nexport function ObserveIframesAndDelployYTPlayers(targetClass: string) {\r\n\t// set up all visible YT GIFs\r\n\tconst local = Local(targetClass)\r\n\r\n\t// deploy all visible\r\n\tinViewportElsHard(local.validTemplates()).forEach(wrapper =>\r\n\t\tDeployPlayer({ wrapper, message: 'first wave', targetClass })\r\n\t)\r\n\r\n\t// to deploy when visible\r\n\tlocal.validTemplates().forEach(wrapper =>\r\n\t\twindow.YT_GIF_OBSERVERS.masterIntersectionObservers.push(\r\n\t\t\tPlayerOnIntersection({\r\n\t\t\t\twrapper,\r\n\t\t\t\tmessage: 'second wave',\r\n\t\t\t\ttargetClass,\r\n\t\t\t})\r\n\t\t)\r\n\t)\r\n\r\n\t// 3. observe and deploy on intersection\r\n\tconst observer = new MutationObserver(async mutations =>\r\n\t\tMutation_cb_raw_rm_cmpts(mutations, targetClass, local.OnRendered)\r\n\t)\r\n\tobserver.observe(document.body, { childList: true, subtree: true })\r\n\r\n\treturn observer\r\n}\r\n","import { cssData } from '../paths'\r\nimport { ObserveIframesAndDelployYTPlayers } from '../../observer/yt-gif'\r\nimport { UI } from '../yt-gif-init'\r\n\r\nfunction pushMasterObserverWithTargetClass(classToObserve: string) {\r\n\twindow.YT_GIF_OBSERVERS.masterMutationObservers.push(\r\n\t\tObserveIframesAndDelployYTPlayers(classToObserve)\r\n\t)\r\n}\r\ninterface IDeploy {\r\n\tBinaryDomUI: () => HTMLInputElement\r\n}\r\ninterface IObserve {\r\n\tclassToObserve: string\r\n}\r\nconst deploy = {\r\n\tdeploymentStyle: function (this: IDeploy): boolean {\r\n\t\treturn this.BinaryDomUI().checked\r\n\t},\r\n\tcheckSubDeploymentStyle: function (this: IDeploy, bol: boolean) {\r\n\t\tthis.BinaryDomUI().checked = bol\r\n\t},\r\n}\r\nconst base = {\r\n\t...deploy,\r\n\trunMasterObservers: function (this: IObserve) {\r\n\t\tpushMasterObserverWithTargetClass(this.classToObserve)\r\n\t},\r\n}\r\nconst rm_base = {\r\n\tvideo: {\r\n\t\tdescription: '{{[[video]]}}',\r\n\t\tclassToObserve: 'rm-video-player__spacing-wrapper',\r\n\t},\r\n\tyt_gif: {\r\n\t\tdescription: '{{[[yt-gif]]}}',\r\n\t\tclassToObserve: `rm-xparser-default-${cssData.yt_gif}`,\r\n\t},\r\n}\r\nexport const targets = {\r\n\tvideo: {\r\n\t\t...base,\r\n\t\t...rm_base.video,\r\n\t\tpage: 'video' as TGifTarget,\r\n\t\tBinaryDomUI: () => UI.deploymentStyle.deployment_style_video,\r\n\t},\r\n\tyt_gif: {\r\n\t\t...base,\r\n\t\t...rm_base.yt_gif,\r\n\t\tpage: 'yt-gif' as TGifTarget,\r\n\t\tBinaryDomUI: () => UI.deploymentStyle.deployment_style_yt_gif,\r\n\t},\r\n\tboth: {\r\n\t\t...deploy,\r\n\t\tdescription: `${rm_base.video.description} and ${rm_base.yt_gif.description}`,\r\n\t\tclassToObserve: null as never,\r\n\t\tclassesToObserve: [\r\n\t\t\trm_base.video.classToObserve,\r\n\t\t\trm_base.yt_gif.classToObserve,\r\n\t\t],\r\n\t\tBinaryDomUI: () => UI.deploymentStyle.deployment_style_both,\r\n\t\trunMasterObservers: function () {\r\n\t\t\tthis.classesToObserve.forEach(c =>\r\n\t\t\t\tpushMasterObserverWithTargetClass(c)\r\n\t\t\t)\r\n\t\t},\r\n\t},\r\n\tyt_gif_tut: {\r\n\t\tclassToObserve: 'yt-gif-ddm-tutorial' /* TESTING */,\r\n\t},\r\n}\r\n","import { YTGIF_Config } from '../../../lib/types/config'\r\nimport { isTrue, ObjectKeys } from '$lib/utils'\r\nimport { targets } from './targets'\r\n\r\nfunction GetDeployStateDriver(target = targets) {\r\n\tconst state = {\r\n\t\tcurrentKey: 'yt_gif' as rm_key,\r\n\t\tinitialKey: '' as rm_key,\r\n\t\tcurrentClassesToObserver: Array<string>(),\r\n\t}\r\n\treturn {\r\n\t\tstate,\r\n\t\tcheckSubDeploymentStyle(key: rm_key, bol: b) {\r\n\t\t\ttarget[key].checkSubDeploymentStyle(bol)\r\n\t\t},\r\n\t\tRunMasterObserverWithKey(key: rm_key) {\r\n\t\t\tstate.currentKey = key\r\n\t\t\ttarget[key].runMasterObservers()\r\n\t\t},\r\n\t\t//\r\n\t\tassertCurrentKey(overrideKey: string) {\r\n\t\t\tconst newKey = getNewKey(overrideKey)\r\n\t\t\tstate.currentClassesToObserver = getClassesToObserve(newKey)\r\n\t\t\tYTGIF_Config.componentPage = getComponentPage(newKey)\r\n\t\t\treturn (state.currentKey = newKey)\r\n\t\t},\r\n\t\tChargeMasterObserversWithValidDeploymentStyle() {\r\n\t\t\t// prettier-ignore\r\n\t\t\tconst valid = ObjectKeys(target)\r\n\t\t\t\t.filter(k => target[k].hasOwnProperty('deploymentStyle')) as rm_key[]\r\n\t\t\tvalid.some(key => {\r\n\t\t\t\tif (isTrue(target[key].deploymentStyle())) {\r\n\t\t\t\t\tthis.RunMasterObserverWithKey(key) // trust me\r\n\t\t\t\t\treturn true\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t}\r\n\tfunction getNewKey(overrideKey: string | boolean) {\r\n\t\tlet newKey: rm_key = 'yt_gif' // this can be shorter for sure, how though?\r\n\r\n\t\tif (isTrue(overrideKey)) {\r\n\t\t\tnewKey = 'video'\r\n\t\t} else if (overrideKey === 'both') {\r\n\t\t\tnewKey = 'both'\r\n\t\t}\r\n\t\treturn newKey\r\n\t}\r\n\tfunction getComponentPage(newKey: rm_key) {\r\n\t\treturn newKey == 'both' ? 'yt-gif|video' : target[newKey].page\r\n\t}\r\n\tfunction getClassesToObserve(newKey: rm_key) {\r\n\t\treturn newKey == 'both'\r\n\t\t\t? target[newKey].classesToObserve\r\n\t\t\t: [target[newKey].classToObserve]\r\n\t}\r\n}\r\nexport const rm_components = GetDeployStateDriver()\r\nwindow.AvoidCircularDependency.getCurrentClassesToObserver = function () {\r\n\treturn rm_components.state.currentClassesToObserver\r\n}\r\n","import { rm_components } from '../../config/driver'\r\n\r\nexport async function updateSettingsPageBlock(\r\n\tinput: EventTarget,\r\n\tkeyObj: string,\r\n\tsiblingKeys: string[]\r\n) {\r\n\tconst { type, checked, value } = input as HTMLInputElement\r\n\tlet replaceWith: string = value.toString() // range - checkbox - radio - label - select\r\n\r\n\tif (type == 'checkbox' || type == 'radio') {\r\n\t\treplaceWith = checked.toString()\r\n\t}\r\n\tif (type == 'radio') {\r\n\t\t// special case...\r\n\t\t;[...siblingKeys]\r\n\t\t\t.map(x => window.YT_GIF_DIRECT_SETTINGS.get(x)!)\r\n\t\t\t.filter(y => y.inputType == 'radio')\r\n\t\t\t.forEach(o => o.UpdateSettingsBlockValue('')) // to false\r\n\t}\r\n\tif (type == 'select-multiple') {\r\n\t\treplaceWith = Array.from((input as HTMLSelectElement).selectedOptions)\r\n\t\t\t.map(o => o.value)\r\n\t\t\t.toString()\r\n\t}\r\n\r\n\tawait window.YT_GIF_DIRECT_SETTINGS.get(keyObj)?.UpdateSettingsBlockValue?.(\r\n\t\treplaceWith.toString()\r\n\t)\r\n}\r\nexport async function updateOverrideComponentSettingBlock(el: Element) {\r\n\tconst validOverride = validOverrideComponentSettingBlock(el)\r\n\tif (validOverride) {\r\n\t\trm_components.assertCurrentKey(validOverride)\r\n\t\tawait window.YT_GIF_DIRECT_SETTINGS.get(\r\n\t\t\t'override_roam_video_component'\r\n\t\t)?.UpdateSettingsBlockValue(validOverride as s)\r\n\t}\r\n}\r\nfunction validOverrideComponentSettingBlock(el: Element) {\r\n\tconst idPrfx = (key: string) => `deployment_style_${key}`\r\n\tlet replaceWith: null | s = null // FIXME: use typescript\r\n\tswitch (el.id) {\r\n\t\tcase idPrfx('yt_gif'):\r\n\t\t\treplaceWith = 'false'\r\n\t\t\tbreak\r\n\t\tcase idPrfx('video'):\r\n\t\t\treplaceWith = 'true'\r\n\t\t\tbreak\r\n\t\tcase idPrfx('both'):\r\n\t\t\treplaceWith = 'both'\r\n\t\t\tbreak\r\n\t}\r\n\treturn replaceWith\r\n}\r\n","import { ObjectKeys, pushSame } from '$lib/utils'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport {\r\n\tupdateOverrideComponentSettingBlock,\r\n\tupdateSettingsPageBlock,\r\n} from './update'\r\n\r\nexport function SaveSettingsOnChanges() {\r\n\tfor (const parentKey of ObjectKeys(UI)) {\r\n\t\tlet siblingKeys = Array<string>()\r\n\t\tconst parentObj = UI[parentKey]\r\n\r\n\t\tfor (const childKey of ObjectKeys(parentObj)) {\r\n\t\t\tconst child = parentObj[childKey] as HTMLElement\r\n\t\t\tsiblingKeys = pushSame(siblingKeys, childKey)\r\n\t\t\tswitch (parentKey) {\r\n\t\t\t\t//case 'label':\r\n\t\t\t\t//case 'InAndOutKeys':\r\n\t\t\t\t//case 'referenced':\r\n\t\t\t\tcase 'defaultPlayerValues':\r\n\t\t\t\tcase 'defaultValues':\r\n\t\t\t\t\tcontinue\r\n\t\t\t\tcase 'deploymentStyle': // special case...\r\n\t\t\t\t\tchild.addEventListener(\r\n\t\t\t\t\t\t'change',\r\n\t\t\t\t\t\tasync function (e: Event) {\r\n\t\t\t\t\t\t\tawait updateOverrideComponentSettingBlock(\r\n\t\t\t\t\t\t\t\te.target as El\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\ttrue\r\n\t\t\t\t\t)\r\n\t\t\t\t\tcontinue\r\n\t\t\t\tcase 'range': // special case...\r\n\t\t\t\t\tchild.addEventListener(\r\n\t\t\t\t\t\t'wheel',\r\n\t\t\t\t\t\tfunction () {\r\n\t\t\t\t\t\t\tchild.dispatchEvent(new Event('change'))\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\ttrue\r\n\t\t\t\t\t)\r\n\t\t\t}\r\n\t\t\tasync function HandleSettingsPageBlockUpdate(e: Event) {\r\n\t\t\t\t// e.preventDefault();\r\n\t\t\t\t// e.stopPropagation();\r\n\t\t\t\t// if(e.target == e.currentTarget)\r\n\t\t\t\treturn updateSettingsPageBlock(\r\n\t\t\t\t\te.currentTarget!,\r\n\t\t\t\t\tchildKey,\r\n\t\t\t\t\tsiblingKeys\r\n\t\t\t\t)\r\n\t\t\t}\r\n\r\n\t\t\tif (!child?.addEventListener) {\r\n\t\t\t\tconsole.log('yt-gif debugger')\r\n\t\t\t\tcontinue\r\n\t\t\t}\r\n\t\t\tchild.addEventListener(\r\n\t\t\t\t'change',\r\n\t\t\t\tHandleSettingsPageBlockUpdate,\r\n\t\t\t\ttrue\r\n\t\t\t)\r\n\t\t\tchild.addEventListener(\r\n\t\t\t\t'customChange',\r\n\t\t\t\tHandleSettingsPageBlockUpdate,\r\n\t\t\t\ttrue\r\n\t\t\t)\r\n\t\t}\r\n\t}\r\n}\r\n","import { toggleAttribute, toggleClasses } from '$lib/utils'\r\n\r\ntype classes = { selected: string }\r\ninterface Args {\r\n\tfakeSel: HTMLSelectElement\r\n\tclasses?: classes\r\n}\r\nexport default class CustomSelect {\r\n\tclasses: classes\r\n\tfakeSel: HTMLSelectElement\r\n\tcustomSelect: HTMLSelectElement\r\n\r\n\tconstructor(_args: Args) {\r\n\t\tthis.fakeSel = _args.fakeSel\r\n\t\tthis.classes = _args.classes || { selected: 'selected' }\r\n\r\n\t\tthis.customSelect = document.createElement('select')\r\n\r\n\t\tif (this.fakeSel.hasAttribute('multiple'))\r\n\t\t\tthis.customSelect.setAttribute('multiple', '')\r\n\r\n\t\tthis._removeFakeSibling()\r\n\r\n\t\tfor (const fake of this._getArrayChildrenOptions()) {\r\n\t\t\tconst option = document.createElement('option') // binded to the fake select\r\n\r\n\t\t\toption.setAttribute('value', fake.getAttribute('value')!) // could be null\r\n\t\t\toption.textContent = fake.textContent\r\n\t\t\tthis.customSelect.appendChild(option)\r\n\r\n\t\t\tif (fake.hasAttribute('selected')) this._select(fake)\r\n\r\n\t\t\tconst handleSelect = () => {\r\n\t\t\t\tif (fake.hasAttribute('disabled') || option.disabled) return\r\n\r\n\t\t\t\tconst previous = option.selected\r\n\t\t\t\tif (\r\n\t\t\t\t\tthis.fakeSel.hasAttribute('multiple') &&\r\n\t\t\t\t\t(fake.hasAttribute('selected') || option.selected)\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis._deselect(fake)\r\n\t\t\t\t\tthis._fireCustomChange(option, false, previous)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis._select(fake)\r\n\t\t\t\t\tthis._fireCustomChange(option, true, previous)\r\n\t\t\t\t}\r\n\t\t\t\tthis.customSelect.dispatchEvent(new Event('change'))\r\n\t\t\t}\r\n\t\t\tconst customSelect = (bol: boolean) => {\r\n\t\t\t\tif (bol) this._select(fake)\r\n\t\t\t\telse this._deselect(fake)\r\n\t\t\t\tthis.customSelect.dispatchEvent(new Event('customBind'))\r\n\t\t\t}\r\n\r\n\t\t\tfake.addEventListener('click', handleSelect.bind(this))\r\n\t\t\toption.customSelect = customSelect.bind(this)\r\n\t\t\toption.customHandleSelect = handleSelect.bind(this)\r\n\t\t\toption.fake = fake\r\n\t\t}\r\n\r\n\t\tthis.fakeSel.insertAdjacentElement('afterend', this.customSelect)\r\n\t\tthis.customSelect.style.display = 'none'\r\n\t\tthis.customSelect.setAttribute('hidden-fake-select', '')\r\n\t}\r\n\t_output() {\r\n\t\treturn <const>{\r\n\t\t\tselect: this.customSelect,\r\n\t\t\toriginalSelect: this.fakeSel,\r\n\t\t}\r\n\t}\r\n\r\n\t_removeFakeSibling() {\r\n\t\t// if exist\r\n\t\tif (this.fakeSel.nextElementSibling?.hasAttribute('hidden-fake-select'))\r\n\t\t\tthis.fakeSel.parentNode?.removeChild(\r\n\t\t\t\tthis.fakeSel.nextElementSibling\r\n\t\t\t)\r\n\t}\r\n\t_getArrayChildrenOptions() {\r\n\t\treturn Array.from(this.fakeSel.children as HTMLOptionsCollection)\r\n\t}\r\n\t_select(fake: HTMLOptionElement) {\r\n\t\tif (!this.fakeSel.hasAttribute('multiple'))\r\n\t\t\tthis._getArrayChildrenOptions().forEach(el =>\r\n\t\t\t\tthis._vsSelected(false, el)\r\n\t\t\t)\r\n\r\n\t\tthis._isSelected(true, fake)\r\n\t\tthis._vsSelected(true, fake)\r\n\t}\r\n\t_deselect(fake: HTMLOptionElement) {\r\n\t\tthis._isSelected(false, fake)\r\n\t\tthis._vsSelected(false, fake)\r\n\t}\r\n\t_vsSelected(bol: boolean, el: HTMLElement) {\r\n\t\ttoggleAttribute(bol, 'selected', el)\r\n\t\tif (this.classes.selected)\r\n\t\t\ttoggleClasses(bol, [this.classes.selected], el)\r\n\t}\r\n\t_isSelected(bol: boolean, fake: HTMLOptionElement) {\r\n\t\tconst index = this._getArrayChildrenOptions().indexOf(fake)\r\n\t\tconst option = <HTMLOptionElement>this.customSelect.children[index]\r\n\t\toption.selected = bol\r\n\t}\r\n\t_fireCustomChange(\r\n\t\toption: HTMLElement,\r\n\t\tbol: boolean,\r\n\t\tpreviousValue = false\r\n\t) {\r\n\t\tif (previousValue != bol)\r\n\t\t\t// nothing changed, skip\r\n\t\t\toption.dispatchEvent(\r\n\t\t\t\tnew CustomEvent('customChange', {\r\n\t\t\t\t\tbubbles: false,\r\n\t\t\t\t\tcancelBubble: true,\r\n\t\t\t\t\tcancelable: true,\r\n\t\t\t\t\t//composed: false,\r\n\t\t\t\t\tdetail: {\r\n\t\t\t\t\t\tpreviousValue,\r\n\t\t\t\t\t\tcurrentValue: bol,\r\n\t\t\t\t\t},\r\n\t\t\t\t}) as ICustomChangeEvent\r\n\t\t\t)\r\n\t}\r\n}\r\nexport interface ICustomChangeEvent\r\n\textends CustomEvent<{\r\n\t\tpreviousValue: boolean\r\n\t\tcurrentValue: boolean\r\n\t}> {\r\n\tcurrentTarget: HTMLOptionElement\r\n\ttarget: HTMLOptionElement\r\n}\r\n","import { isTrue, ObjectKeys } from '$lib/utils'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport CustomSelect from '../../../lib/dom/select/CustomSelect'\r\n\r\n//#region 2. filter UI user inputs variables\r\n\r\nexport function DDM_to_UI_variables() {\r\n\tdocument.queryAllasArr('.select').forEach(fakeSel => {\r\n\t\tif (!fakeSel) return\r\n\r\n\t\tconst { select, originalSelect } = new CustomSelect({\r\n\t\t\tfakeSel: <HTMLSelectElement>fakeSel,\r\n\t\t})._output() // damn\r\n\r\n\t\tconst attrs = Array.from(originalSelect.attributes).map(a => ({\r\n\t\t\tname: a.name,\r\n\t\t\tvalue: a.value,\r\n\t\t}))\r\n\t\tconst ignore = ['class', 'multiple']\r\n\r\n\t\tfor (const { name, value } of attrs) {\r\n\t\t\tif (ignore.includes(name)) continue\r\n\t\t\tselect.setAttribute(name, value)\r\n\t\t\toriginalSelect.removeAttribute(name)\r\n\t\t}\r\n\t})\r\n\r\n\tfor (const parentKey of ObjectKeys(UI)) {\r\n\t\tconst parentObj = UI[parentKey]\r\n\t\t//@ts-ignore // FIXME:\r\n\t\tif (parentObj.baseKey?.inputType == 'prompt') {\r\n\t\t\tdelete UI[parentKey]\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\tfor (const childKey of ObjectKeys(parentObj)) {\r\n\t\t\tconst child = parentObj[childKey]\r\n\t\t\t//@ts-ignore // FIXME:\r\n\t\t\tconst directObjPpts = child?.baseKey ? child.baseKey : child\r\n\t\t\tconst sessionValue = directObjPpts.sessionValue\r\n\r\n\t\t\tconst getEl = <T extends HTMLElement>(): T =>\r\n\t\t\t\tdocument.getElementById(childKey) as T\r\n\t\t\tconst domEl = getEl<HTMLElement>() // ❗❗❗\r\n\r\n\t\t\tif (domEl) {\r\n\t\t\t\t//@ts-ignore // FIXME:\r\n\t\t\t\tparentObj[childKey] = domEl\r\n\t\t\t\tconst input = getEl<HTMLInputElement>() // wtf\r\n\r\n\t\t\t\tswitch (parentKey) {\r\n\t\t\t\t\tcase 'range':\r\n\t\t\t\t\t\tinput.value = sessionValue\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\t//@ts-ignore // FIXME:\r\n\t\t\t\t\tcase 'label':\r\n\t\t\t\t\t\tdomEl.textContent = sessionValue\r\n\t\t\t\t\t\tbreak\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tif (domEl.tagName == 'SELECT') {\r\n\t\t\t\t\t\t\t// wtf!!!!!\r\n\t\t\t\t\t\t\tconst sesionOptions = sessionValue\r\n\t\t\t\t\t\t\t\t.toString()\r\n\t\t\t\t\t\t\t\t.split(',')\r\n\t\t\t\t\t\t\t\t//@ts-ignore // FIXME:\r\n\t\t\t\t\t\t\t\t.filter(s => !!s)\r\n\r\n\t\t\t\t\t\t\tconst selc = getEl<HTMLSelectElement>() // wtf\r\n\r\n\t\t\t\t\t\t\tArray.from(selc.options).forEach(o => {\r\n\t\t\t\t\t\t\t\tconst selected = sesionOptions.includes(o.value)\r\n\t\t\t\t\t\t\t\to.selected = selected\r\n\t\t\t\t\t\t\t\tif (selected && selc.type == 'select-one')\r\n\t\t\t\t\t\t\t\t\tselc.value = o.value\r\n\t\t\t\t\t\t\t\to['customSelect']?.(o.selected) // Hmmmmm\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t} // checkbox\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tinput.checked = isTrue(sessionValue)\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tdomEl.previousElementSibling?.setAttribute(\r\n\t\t\t\t\t\t\t'for',\r\n\t\t\t\t\t\t\tchildKey\r\n\t\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tif (directObjPpts.hasOwnProperty('baseValue')) {\r\n\t\t\t\t\t//@ts-ignore // FIXME:\r\n\t\t\t\t\tparentObj[childKey] =\r\n\t\t\t\t\t\tsessionValue || directObjPpts.baseValue\r\n\t\t\t\t} else if (\r\n\t\t\t\t\tchildKey == 'baseKey' ||\r\n\t\t\t\t\tdirectObjPpts.inputType == 'prompt'\r\n\t\t\t\t) {\r\n\t\t\t\t\tdelete parentObj[childKey]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n","import { getOption } from '../../../lib/backend-frontend/option'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport { ifBuffer_ShiftOldest } from '$v3/init/observer/performance'\r\n\r\n//#region 3.2 pre startup - iframes\r\nexport function togglePlayPauseStyles() {\r\n\tconst mute = UI.playerSettings.mute_style\r\n\tconst play = UI.playerSettings.play_style\r\n\r\n\tconst ilogicSoftStyle = () => mute.value == 'soft' && play.value == 'soft'\r\n\tconst playState = () =>\r\n\t\t(getOption(play, 'soft').disabled = ilogicSoftStyle())\r\n\r\n\tplayState()\r\n\tmute.addEventListener('change', playState)\r\n\tplay.addEventListener('change', playState)\r\n}\r\nexport function initialize_modes_synergy(\r\n\tslider = UI.range.iframe_buffer_slider,\r\n\tinput_x_buffer = getOption(UI.experience.initialize_mode, 'input_x_buffer'),\r\n\tinitialize_mode = UI.experience.initialize_mode\r\n) {\r\n\tinitialize_mode.addEventListener(\r\n\t\t'change',\r\n\t\t() => (input_x_buffer.disabled = false)\r\n\t)\r\n\r\n\tinput_x_buffer.addEventListener('customChange', ifBuffer_ShiftOldest)\r\n\tslider.addEventListener('click', ifBuffer_ShiftOldest)\r\n\tslider.addEventListener('wheel', ifBuffer_ShiftOldest)\r\n}\r\n","import { isTrue, toggleAttribute, toggleClasses } from '$lib/utils'\r\n\r\n//#region flip icons and tooltip helpers\r\nexport function getIconFlipObj(el: Element) {\r\n\tconst falseVal = Array.from(el.classList)\r\n\t\t?.reverse()\r\n\t\t.find(c => c.includes('bp3-icon-'))!\r\n\tconst trueVal = 'bp3-icon-' + el.getAttribute('flip-icon')\r\n\treturn <const>{ falseVal, trueVal, el }\r\n}\r\nexport function getTooltipFlipObj(el: Element) {\r\n\tconst trueVal = el.getAttribute('flip-tooltip') as s\r\n\tconst falseVal = el.getAttribute('data-tooltip') as s\r\n\treturn <const>{ falseVal, trueVal, el }\r\n}\r\ntype IToggle = {\r\n\tfalseVal: string\r\n\ttrueVal: string\r\n\tel: Element\r\n}\r\nexport function ToggleIcons(bol: boolean, { falseVal, trueVal, el }: IToggle) {\r\n\tbol = isTrue(bol)\r\n\ttoggleClasses(false, [trueVal, falseVal], el)\r\n\ttoggleClasses(true, [bol ? trueVal : falseVal], el)\r\n\treturn bol\r\n}\r\nexport function ToggleTooltips(\r\n\tbol: boolean,\r\n\t{ falseVal, trueVal, el }: IToggle\r\n) {\r\n\tbol = isTrue(bol)\r\n\ttoggleAttribute(true, 'data-tooltip', el, bol ? trueVal : falseVal)\r\n\treturn bol\r\n}\r\n","import { toggleClasses } from '$lib/utils'\r\nimport { cssData } from '$v3/init/config/paths'\r\n\r\nexport function ListenFor(\r\n\tfocus: ReturnType<typeof Focus>,\r\n\tmessage: Element,\r\n\tel: Element\r\n) {\r\n\tmessage.addEventListener('click', () => focus.Gain(message, el))\r\n\tmessage.addEventListener('blur', () => focus.Lost(el))\r\n}\r\nexport function GetWholeEls(ddm_info_message_selector: s) {\r\n\tconst infoMessages = document.queryAllasArr(ddm_info_message_selector)\r\n\tconst validFocusMessage = new Map<El, El>()\r\n\r\n\tfor (const i of infoMessages) {\r\n\t\tconst possibleSubDdm = i.nextElementSibling\r\n\t\tif (possibleSubDdm?.classList.contains('dropdown-content')) {\r\n\t\t\tspanNegativeTabIndex(i)\r\n\t\t\tvalidFocusMessage.set(i, possibleSubDdm)\r\n\t\t}\r\n\t}\r\n\treturn validFocusMessage\r\n}\r\nexport function Focus(classNames: string[]) {\r\n\tfunction Gain(el: El | EventTarget, targetEl: Element) {\r\n\t\t;(el as HTMLElement).focus()\r\n\t\ttoggleClasses(true, classNames, targetEl)\r\n\t}\r\n\tfunction Lost(targetEl: Element) {\r\n\t\ttoggleClasses(false, classNames, targetEl)\r\n\t}\r\n\treturn <const>{ Gain, Lost }\r\n}\r\nexport function GetMainYTGIFicon({ ddm_icon } = cssData) {\r\n\t//\r\n\tconst mainMenu = <HTMLElement>(\r\n\t\tdocument.querySelector('span.yt-gif-drop-down-menu-toolbar .dropdown')\r\n\t)\r\n\tconst mainDDM = <HTMLElement>(\r\n\t\tdocument.querySelector(\r\n\t\t\t'span.yt-gif-drop-down-menu-toolbar .dropdown > .dropdown-content'\r\n\t\t)\r\n\t)\r\n\tconst icon = <HTMLElement>document.querySelector('.' + ddm_icon)\r\n\tspanNegativeTabIndex(icon)\r\n\treturn <const>{ icon, mainDDM, mainMenu }\r\n}\r\nfunction spanNegativeTabIndex(el: El) {\r\n\tif (el.tagName) el.setAttribute('tabindex', '-1') // because they are \"span\"\r\n}\r\n","import { openBlockInSidebar, setSideBarState } from '$lib/utils-roam-alpha-api'\r\nimport { innerElsContains, sleep } from '$lib/utils'\r\nimport { TARGET_PAGE, TARGET_UID } from '$v3/settings-page/keys'\r\nimport {\r\n\tToggleIcons,\r\n\tgetIconFlipObj,\r\n\tToggleTooltips,\r\n\tgetTooltipFlipObj,\r\n} from './flip-tooltip'\r\nimport { GetMainYTGIFicon } from './drop-down-menu/hover/query'\r\n\r\nexport async function navigateToSettingsPageInSidebar() {\r\n\tconst anySidebarInstance = () => Bars().length >= 1\r\n\r\n\tconst { tooltip, icon } = GetTooltips()\r\n\r\n\tconst visuals = (bol: b) => {\r\n\t\tToggleTooltips(bol, tooltip)\r\n\t\tToggleIcons(bol, icon)\r\n\t}\r\n\tconst switchSidebar = () => visuals(anySidebarInstance())\r\n\r\n\ttooltip.el.addEventListener('click', async function () {\r\n\t\t// caution: how do you communicate with the other scripts? Interfaces? Events? WindowEvents?\r\n\t\tawait setSideBarState(3)\r\n\t\tawait sleep(50) // an observer is the safest option though\r\n\r\n\t\tif (!anySidebarInstance()) {\r\n\t\t\tvisuals(true)\r\n\t\t\tawait openBlockInSidebar(TARGET_UID) // backend execution... should it be here...? //https://stackoverflow.com/questions/12097381/communication-between-scripts-three-methods#:~:text=All%20JS%20scripts%20are%20run%20in%20the%20global%20scope.%20When%20the%20files%20are%20downloaded%20to%20the%20client%2C%20they%20are%20parsed%20in%20the%20global%20scope\r\n\t\t}\r\n\r\n\t\t// fires settings page instance\r\n\t\tawait sleep(50)\r\n\t\tBars()?.[0]?.scrollIntoView({\r\n\t\t\tbehavior: 'smooth',\r\n\t\t\tblock: 'center',\r\n\t\t\tinline: 'nearest',\r\n\t\t})\r\n\t})\r\n\r\n\ttooltip.el.addEventListener('mouseenter', switchSidebar)\r\n\r\n\tconst { icon: Icon } = GetMainYTGIFicon()\r\n\tIcon.addEventListener('blur', switchSidebar, true)\r\n\tIcon.addEventListener('mouseenter', switchSidebar, true)\r\n\tIcon.addEventListener('mouseleave', switchSidebar, true)\r\n}\r\nfunction GetTooltips() {\r\n\tconst wrapper = document.querySelector('#navigate-to-yt-gif-settings-page')!\r\n\tconst tooltip = getTooltipFlipObj(wrapper.querySelector(`[data-tooltip]`)!)\r\n\tconst icon = getIconFlipObj(wrapper.querySelector(`input`)!)\r\n\treturn { tooltip, icon }\r\n}\r\n\r\nfunction Bars() {\r\n\treturn innerElsContains(\r\n\t\t'.rm-sidebar-outline .rm-title-display span',\r\n\t\tTARGET_PAGE\r\n\t)\r\n}\r\n","import {\r\n\tFetchText,\r\n\tisValidCSSUnit,\r\n\tisValidFetch,\r\n\tNoCash,\r\n\tRemoveElsEventListeners,\r\n} from '$lib/utils'\r\nimport { cssData } from '../config/paths'\r\n\r\n//#region 1. looks - fetch css html\r\nexport async function smart_LoadCSS(cssURL: s, id: s) {\r\n\t// 'cssURL' is the stylesheet's URL, i.e. /css/styles.css\r\n\tif (!(await isValidFetch(cssURL))) {\r\n\t\treturn\r\n\t}\r\n\r\n\treturn new Promise(function (resolve: Function, reject) {\r\n\t\tDeleteDOM_Els(id, cssURL)\r\n\t\tconst link = document.createElement('link')\r\n\t\tlink.rel = 'stylesheet'\r\n\t\tlink.href = NoCash(cssURL)\r\n\t\tlink.id = id\r\n\t\tdocument.head.appendChild(link)\r\n\r\n\t\tlink.onload = () => resolve()\r\n\t})\r\n}\r\nfunction DeleteDOM_Els(id: s, cssURL: s) {\r\n\tconst stylesAlready = document.queryAllasArr(`[id='${id}']`)\r\n\r\n\tif (stylesAlready?.length > 0) {\r\n\t\t// well well well - we don't like duplicates\r\n\t\tSytleSheetExistAlready(cssURL)\r\n\t\tfor (const el of stylesAlready) {\r\n\t\t\tel.parentElement?.removeChild(el)\r\n\t\t}\r\n\t}\r\n}\r\nfunction SytleSheetExistAlready(id: s) {\r\n\tconsole.log(`The stylesheet ${id} already exist.`)\r\n}\r\nexport function smart_CssPlayer_UCS(player_span: s) {\r\n\tif (isValidCSSUnit(player_span)) {\r\n\t\tdocument.documentElement.style.setProperty(\r\n\t\t\t'--yt-gif-player-span',\r\n\t\t\tplayer_span\r\n\t\t)\r\n\t}\r\n}\r\nexport async function smart_Load_DDM_onTopbar(dropDownMenu: s) {\r\n\t// caution:\r\n\tconst rm_moreIcon = document\r\n\t\t.querySelector('.bp3-icon-more')\r\n\t\t?.closest('.rm-topbar .rm-topbar__spacer-sm + .bp3-popover-wrapper')\r\n\tconst htmlText =\r\n\t\twindow.YT_GIF_OBSERVERS.dmm_html ?? (await FetchText(dropDownMenu))\r\n\tconst previousList = DDM_Els()\r\n\tif (previousList?.length > 0) {\r\n\t\tfor (const el of previousList) {\r\n\t\t\tel.parentElement?.removeChild(el)\r\n\t\t}\r\n\t\tRemoveElsEventListeners(previousList)\r\n\t}\r\n\r\n\trm_moreIcon?.insertAdjacentHTML('afterend', htmlText)\r\n}\r\nexport function DDM_Els() {\r\n\tconst { ddm_exist } = cssData\r\n\treturn document.queryAllasArr('.' + ddm_exist)\r\n}\r\n","import { isTrue, toggleClasses } from '$lib/utils'\r\nimport { links } from '../config/paths'\r\nimport type { T_SettingsAny } from '$v3/settings-page/types'\r\nimport { smart_LoadCSS } from './fetch'\r\nimport { cssData } from '$v3/init/config/paths'\r\nimport { UI } from '$v3/init/config/yt-gif-init'\r\n\r\n/* ************* */\r\nexport function ToggleTheme(\r\n\tSwitch = UI.dropdownMenu.ddm_css_theme_input,\r\n\tthemes = links.css.themes,\r\n\tddm_css_theme_stt = window.YT_GIF_DIRECT_SETTINGS.get(\r\n\t\t'ddm_css_theme_input'\r\n\t)!,\r\n\tddm_main_theme_id = cssData.id.ddm_main_theme\r\n) {\r\n\tconst icons = ['bp3-icon-flash', 'bp3-icon-moon']\r\n\r\n\tflip(Switch)\r\n\r\n\tSwitch.addEventListener('change', flip.bind(null, Switch))\r\n\r\n\tasync function flip(tEl: HTMLInputElement) {\r\n\t\tconst previousIcons = Array.from(tEl?.classList)?.filter(el =>\r\n\t\t\tel.startsWith('bp3-icon-')\r\n\t\t)\r\n\t\ttoggleClasses(false, previousIcons, tEl)\r\n\r\n\t\ttoggleClasses(true, [!tEl.checked ? icons[0] : icons[1]], tEl)\r\n\t\tawait smart_LoadCSS(\r\n\t\t\t//TODO: added isTrue\r\n\t\t\tthemes.toogle(isTrue(ddm_css_theme_stt.sessionValue as s)),\r\n\t\t\tddm_main_theme_id\r\n\t\t)\r\n\t}\r\n}\r\n","import { toggleClasses } from '$lib/utils'\r\nimport { attrData } from '../../config/paths'\r\nimport { cssData } from '$v3/init/config/paths'\r\n\r\n/* ************* */\r\nexport function FlipBindAttr(\r\n\ttoggleClasses = [cssData.dropdown__hidden],\r\n\t_attrData = attrData\r\n) {\r\n\tfor (const key in _attrData) {\r\n\t\tconst { check, select, main } = Toggle(key, toggleClasses)\r\n\t\tif (!main) {\r\n\t\t\tconsole.log('yt-gif debugger')\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\tif (main.tagName == 'INPUT') {\r\n\t\t\tListenToChange(main, check)\r\n\t\t} else if (main.tagName == 'SELECT') {\r\n\t\t\tListenToChange(main, select)\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction ListenToChange(target: ImyElt, OnCb: () => void) {\r\n\tOnCb()\r\n\ttarget.addEventListener('change', OnCb)\r\n\ttarget.addEventListener('customBind', OnCb)\r\n}\r\n\r\nfunction Toggle(key: s, classes: s[]) {\r\n\tconst main = <ImyElt>document.querySelector(`[data-main='${key}']`)\r\n\tconst binds = () => document.queryAllasArr(`[data-bind*='${key}']`)\r\n\r\n\tconst check = () =>\r\n\t\tbinds().forEach(b => toggleClasses(!main.checked, classes, b))\r\n\r\n\tconst select = () =>\r\n\t\tbinds().forEach(b => {\r\n\t\t\tconst { on, not } = GetFlipAttr(b)\r\n\t\t\tconst { equals, any } = GetComparison(main)\r\n\r\n\t\t\tif (on) {\r\n\t\t\t\t// showMatch || showIfAny\r\n\t\t\t\ttoggleClasses(!(equals(on) || any(on)), classes, b)\r\n\t\t\t} else if (not) {\r\n\t\t\t\t// hideMatch || hideIfAny\r\n\t\t\t\ttoggleClasses(equals(not) || any(not), classes, b)\r\n\t\t\t}\r\n\t\t})\r\n\treturn <const>{ check, select, main }\r\n}\r\nfunction GetFlipAttr(b: Element) {\r\n\tconst on = b.getAttribute('on')\r\n\tconst not = b.getAttribute('not')\r\n\treturn { on, not }\r\n}\r\n\r\nfunction GetComparison(main: ImyElt) {\r\n\tconst selOpts =\r\n\t\tmain.type == 'select-multiple'\r\n\t\t\t? [...main.selectedOptions].map(o => o.value)\r\n\t\t\t: [main.value]\r\n\tconst is = (v: s) => selOpts.includes(v)\r\n\r\n\t//prettier-ignore\r\n\tconst equals = (s: s) => s.split(',').map(s => s.trim()).some(v => is(v))\r\n\tconst any = (v: s) => !is('disabled') && v == 'any'\r\n\treturn { equals, any }\r\n}\r\n\r\ninterface ImyElt extends HTMLElement {\r\n\tchecked: boolean\r\n\ttype: string\r\n\tselectedOptions: HTMLOptionElement[]\r\n\tvalue: string\r\n}\r\n","import { applyIMGbg, removeIMGbg } from '$lib/utils'\r\nimport { cssData } from '$v3/init/config/paths'\r\n\r\nexport function ToggleThumbnails(\r\n\tthumbnail_as_bg: HTMLOptionElement,\r\n\t{ awaitng_player_user_input } = cssData\r\n) {\r\n\t// BIND TO SETTINGS PAGE\r\n\tthumbnail_as_bg.addEventListener('customChange', function (e: Event) {\r\n\t\tconst awaitingGifs = document\r\n\t\t\t.queryAllasArr<HTMLElement>(`.${awaitng_player_user_input}`)\r\n\t\t\t.forEach(el => {\r\n\t\t\t\tif ((e.target as HTMLOptionElement).selected)\r\n\t\t\t\t\tapplyIMGbg(el, el.getAttribute('data-video-url') as s)\r\n\t\t\t\telse removeIMGbg(el) // spaguetti\r\n\t\t\t})\r\n\t})\r\n}\r\n","export function UpdateOnScroll_RTM(scroll: HTMLInputElement) {\r\n\tconst labelEl = scroll.nextElementSibling!\r\n\tlabelEl.textContent = scroll.value // don't fire rendundant API calls on startup\r\n\r\n\t// 📦\r\n\tscroll.addEventListener(\r\n\t\t'click',\r\n\t\te => UptLabel(e.currentTarget as HTMLInputElement),\r\n\t\ttrue\r\n\t)\r\n\tscroll.addEventListener('wheel', e => UptLabel(SliderValue(e)), true)\r\n\r\n\tfunction SliderValue(e: WheelEvent) {\r\n\t\tconst elScroll = e.currentTarget as HTMLInputElement // fuck this\r\n\t\tconst dir = Math.sign(e.deltaY) * -1\r\n\t\tconst parsed = parseInt(elScroll.value, 10)\r\n\t\telScroll.value = Number(dir + parsed).toString()\r\n\t\treturn elScroll\r\n\t}\r\n\tfunction UptLabel(elScroll: HTMLInputElement) {\r\n\t\tlabelEl.textContent = elScroll.value // don't worry about overflowing the counter, html range takes care of it\r\n\t\telScroll.dispatchEvent(new Event('change'))\r\n\t}\r\n}\r\n","import { GetMainYTGIFicon, Focus, ListenFor, GetWholeEls } from './query'\r\nimport { cssData } from '$v3/init/config/paths'\r\n\r\nexport function DDMHover({ ddm_focus, ddm_info_message_selector } = cssData) {\r\n\t// 1. caution: special case\r\n\tconst { icon, mainDDM } = GetMainYTGIFicon()\r\n\tconst focus = Focus([ddm_focus]) // used inside two local func\r\n\r\n\tListenFor(focus, icon, mainDDM)\r\n\r\n\t// 2. for all infoMessages in html\r\n\t;[...GetWholeEls(ddm_info_message_selector).entries()].forEach(\r\n\t\t([message, el]) => ListenFor(focus, message, el)\r\n\t)\r\n}\r\n","import { toggleClasses } from '$lib/utils'\r\nimport { isRendered } from '../../../lib/dom/elements-yt-gif-parent'\r\nimport { cssData } from '../../config/paths'\r\n\r\nexport function FocusOnHover(\r\n\tawaitingWrapper: HTMLElement,\r\n\ticon: Element,\r\n\tlocal: ReturnType<typeof Local>\r\n) {\r\n\tawaitingWrapper.addEventListener(\r\n\t\t'mouseenter',\r\n\t\tfunction (this: HTMLElement) {\r\n\t\t\ticon.dispatchEvent(new Event('click'))\r\n\t\t\tlocal.UnfocusOthers(true)\r\n\t\t\tvisualFeedback(this, false)\r\n\t\t}\r\n\t)\r\n\tawaitingWrapper.addEventListener(\r\n\t\t'mouseleave',\r\n\t\tfunction (this: HTMLElement) {\r\n\t\t\tlocal.FocusParents(true)\r\n\t\t\tvisualFeedback(this, true)\r\n\t\t}\r\n\t)\r\n}\r\nexport function Local(input: IInput, wrapper: HTMLElement, parentTarget: El) {\r\n\tconst { icon, mainDDM, ddm_focus } = input\r\n\tconst getContent = () => parentTarget?.closest('.dropdown-content') as El\r\n\r\n\tfunction blur() {\r\n\t\tif (!isRendered(wrapper)) {\r\n\t\t\ticon.removeEventListener('blur', blur)\r\n\t\t} else {\r\n\t\t\tFocusParents(false)\r\n\t\t}\r\n\t}\r\n\tfunction FocusParents(toggle = true) {\r\n\t\t//const ownContent =\r\n\t\t;[getContent(), mainDDM].forEach(el =>\r\n\t\t\ttoggleClasses(toggle, [ddm_focus], el)\r\n\t\t)\r\n\r\n\t\tif (toggle) {\r\n\t\t\ticon.dispatchEvent(new Event('click'))\r\n\t\t}\r\n\t}\r\n\tfunction UnfocusOthers(toggle: b) {\r\n\t\tdocument\r\n\t\t\t.queryAllasArr('.dropdown-item.yt-gif-wrapper-parent')\r\n\t\t\t.map(tut => tut.closest('.dropdown-info-box.dropdown-focus'))\r\n\t\t\t.filter((v, i, a) => !!v && v != getContent() && a.indexOf(v) === i)\r\n\t\t\t.forEach(el => toggleClasses(!toggle, [ddm_focus], el as El))\r\n\t}\r\n\treturn <const>{ blur, FocusParents, UnfocusOthers }\r\n}\r\nfunction visualFeedback(el: El, bol: b) {\r\n\ttoggleClasses(bol, [cssData.ddn_tut_awaiting], el)\r\n}\r\nexport interface IInput {\r\n\ticon: El\r\n\tmainDDM: El\r\n\tddm_focus: s\r\n}\r\n","import { onYouTubePlayerAPIReady } from '$v3/api-ready'\r\nimport type { IInput } from './query';\r\nimport { Local, FocusOnHover } from './query'\r\n\r\nexport async function DeployTutorial(parentTarget: El, input: IInput) {\r\n\tif (!parentTarget || parentTarget.querySelector('.yt-gif-wrapper')) {\r\n\t\t// video already deployed\r\n\t\treturn\r\n\t}\r\n\r\n\t// prettier-ignore\r\n\tconst tutWrapper = parentTarget.querySelector('[data-video-url]') as HTMLElement;\r\n\r\n\t// remove every attribute but data-video-url\r\n\tArray.from(tutWrapper.attributes)\r\n\t\t.filter(attr => attr.name != 'data-video-url')\r\n\t\t.forEach(attr => tutWrapper.removeAttribute(attr.name))\r\n\r\n\tconst awaitingWrapper = await onYouTubePlayerAPIReady({\r\n\t\twrapper: tutWrapper,\r\n\t\ttargetClass: 'yt-gif-ddm-tutorial',\r\n\t\tdataCreation: 'force-awaiting',\r\n\t\tmessage: 'testing manual ty gif tutorial',\r\n\t})\r\n\r\n\tconst local = Local(input, awaitingWrapper!, parentTarget)\r\n\tinput.icon.addEventListener('blur', local.blur)\r\n\r\n\tif (awaitingWrapper) {\r\n\t\tFocusOnHover(awaitingWrapper, input.icon, local)\r\n\t}\r\n}\r\n","import { div, getUniqueSelector, toggleClasses } from '$lib/utils'\r\nimport { getIconFlipObj } from '../dom/flip-tooltip'\r\nimport type { ITutorialInput } from './notification'\r\nimport { DeployTutorial } from './deploy'\r\n\r\nexport function toggleFoldAnim(bol: b, el: El) {\r\n\ttoggleClasses(!bol, ['absolute'], el) // vertical\r\n\ttoggleClasses(bol, ['w-full'], el) // horizontal\r\n}\r\nexport function selectObj(select: HTMLSelectElement, input: ITutorialInput) {\r\n\tconst ddm = select.closest('.ddm-tut')! // should't be null\r\n\tconst tuts = ddm.querySelector('.yt-gifs-tuts')\r\n\r\n\tconst options = Array.from(select.options).map(o => o.value)\r\n\tconst htmls = [...options].reduce((acc, crr) => {\r\n\t\tconst { item, itemHtmml } = assebleTutElm(crr)\r\n\t\ttuts?.appendChild(item)\r\n\t\tacc[crr] = itemHtmml\r\n\t\treturn acc\r\n\t}, {} as { [key: string]: string })\r\n\r\n\tconst target = (v: s) => ddm.querySelector(`[select=\"${v}\"]`) as HTMLElement // alrigth...\r\n\tconst html = (v: s) => htmls[v]\r\n\r\n\treturn <const>{\r\n\t\tselect,\r\n\t\tddm,\r\n\t\tcontainer: select.closest('.dropdown'),\r\n\r\n\t\tresetOptions: async function () {\r\n\t\t\tfor (const value of options) {\r\n\t\t\t\tconst wrapper = target(value)\r\n\t\t\t\tif (!(wrapper instanceof HTMLElement)) continue\r\n\t\t\t\twrapper.style.display = 'none'\r\n\t\t\t\twrapper.innerHTML = html(value)\r\n\t\t\t}\r\n\t\t},\r\n\t\tShowOption: async function () {\r\n\t\t\tif (select.value == 'disabled') return toggleFoldAnim(false, ddm)\r\n\r\n\t\t\ttoggleFoldAnim(true, ddm)\r\n\r\n\t\t\tconst wrapper = target(select.value)\r\n\t\t\twrapper.style.display = 'block'\r\n\r\n\t\t\tawait DeployTutorial(wrapper, input)\r\n\t\t},\r\n\t}\r\n\r\n\tfunction assebleTutElm(crr: s) {\r\n\t\tconst item = div(['dropdown-item'])\r\n\t\titem.setAttribute('select', crr)\r\n\r\n\t\tconst tut = div()\r\n\t\ttut.setAttribute('data-video-url', `https://youtu.be/${crr}`)\r\n\r\n\t\titem.appendChild(tut)\r\n\t\treturn <const>{ item, itemHtmml: item.innerHTML }\r\n\t}\r\n}\r\nexport function getTutorialObj(container: El) {\r\n\tconst btn = container.querySelector(\r\n\t\t'input[class*=bp3-icon-]'\r\n\t) as HTMLInputElement\r\n\tconst pulseElm = container.querySelector(\r\n\t\t'.drodown_item-pulse-animation'\r\n\t) as El\r\n\tconst iconObj = getIconFlipObj(btn) // bookmark\r\n\tconst parentSelector = getUniqueSelector(\r\n\t\tcontainer.querySelector('[data-video-url]')?.parentElement! // TODO: danger...\r\n\t)\r\n\r\n\treturn <const>{\r\n\t\ticonObj,\r\n\t\tbtn,\r\n\t\tpulseElm,\r\n\t\tid: container.id,\r\n\t\ttarget: () => container.querySelector(parentSelector!),\r\n\t\tok: iconObj.falseVal && iconObj.trueVal && btn, // the btn can flip visually\r\n\t}\r\n}\r\n","import type { ITutorialInput } from './notification'\r\nimport { selectObj, toggleFoldAnim } from './query'\r\n\r\n//#region 5. Setting up tutorials\r\nexport function SetUpSelectTutorials(input: ITutorialInput) {\r\n\tdocument\r\n\t\t.queryAllasArr<HTMLSelectElement>('.ddm-tut select')\r\n\t\t.filter(el => !!el)\r\n\t\t.map(sel => selectObj(sel, input))\r\n\t\t.forEach(ListenToDeploy)\r\n}\r\nfunction ListenToDeploy(o: ReturnType<typeof selectObj>) {\r\n\ttoggleFoldAnim(false, o.ddm)\r\n\r\n\to.select.addEventListener('change', async () => {\r\n\t\to.resetOptions()\r\n\t\tawait o.ShowOption()\r\n\t})\r\n\to.container?.addEventListener('mouseenter', async () => o.ShowOption())\r\n\r\n\t// fire change on selected attr\r\n\tconst selected = (o.select.querySelector('[selected]') as HTMLOptionElement)\r\n\t\t?.value\r\n\tif (selected) {\r\n\t\to.select.dispatchEvent(new Event('change'))\r\n\t}\r\n}\r\n","import { Anchor_Config, anchorInstanceMap } from '../../lib/types/config'\r\nimport { RemovedElementObserver, span } from '$lib/utils'\r\nimport { getAnchor_smart } from '../../lib/backend-frontend/get-maps'\r\nimport {\r\n\tisRendered,\r\n\tgetUidFromBlock,\r\n\tclosest_container,\r\n} from '../../lib/dom/elements-yt-gif-parent'\r\nimport { links } from '../config/paths'\r\nimport { ToggleTooltips, getTooltipFlipObj } from '../dom/flip-tooltip'\r\nimport { cssData } from '$v3/init/config/paths'\r\nimport { Mutation_cb_raw_rm_cmpts } from '$v3/lib/backend-frontend/mutation'\r\n\r\n//#region 3.1 observe anchor components\r\nexport function assignFirstAnchorWave({ raw_anchorSel } = cssData) {\r\n\tdocument.queryAllasArr(`.${raw_anchorSel}`).forEach(onRenderedCmpt_cb)\r\n}\r\nexport async function onRenderedCmpt_cb(cmpt: Element) {\r\n\tif (!isRendered(cmpt)) {\r\n\t\treturn\r\n\t}\r\n\r\n\tconst anchorWrp = span(['yt-gif-anchor-wrapper'])\r\n\tanchorWrp.insertAdjacentHTML('afterbegin', links.html.fetched.anchor)\r\n\r\n\t//\r\n\tconst tempUID = getUidFromBlock(cmpt, true)\r\n\tif (!tempUID) {\r\n\t\treturn\r\n\t}\r\n\r\n\tconst componentMap = await getAnchor_smart(tempUID)\r\n\tconst uid = [...componentMap.values()]?.[0]\r\n\r\n\t//\r\n\tconst anchor = anchorWrp.querySelector('.yt-gif-anchor') as El\r\n\tconst tooltipObj = GetAnchorTooltip(anchor, uid)\r\n\tToggleTooltips(true, tooltipObj)\r\n\tcmpt.parentElement?.replaceChild(anchorWrp, cmpt)\r\n\r\n\tif (uid) {\r\n\t\tclosest_container(anchor)?.setAttribute(\r\n\t\t\t'yt-gif-anchor-container',\r\n\t\t\tuid as string\r\n\t\t)\r\n\t} else {\r\n\t\tanchor.setAttribute('disabled', '')\r\n\t}\r\n\r\n\tRemovedElementObserver({\r\n\t\tel: anchorWrp,\r\n\t\tOnRemovedFromDom_cb: () => anchorInstanceMap.delete(tempUID),\r\n\t})\r\n}\r\nfunction GetAnchorTooltip(anchor: Element, uid: string | Trm_map) {\r\n\tconst obj = getTooltipFlipObj(anchor)\r\n\treturn <const>{\r\n\t\t...obj,\r\n\t\ttrueVal: obj.falseVal?.replace(Anchor_Config.uidRefRgx, `((${uid}))`),\r\n\t}\r\n}\r\nexport function SetupAnchorObserver() {\r\n\tconst anchorObs = new MutationObserver(async mutations =>\r\n\t\tMutation_cb_raw_rm_cmpts(\r\n\t\t\tmutations,\r\n\t\t\tcssData.raw_anchorSel,\r\n\t\t\tonRenderedCmpt_cb\r\n\t\t)\r\n\t)\r\n\tanchorObs.observe(document.body, { childList: true, subtree: true })\r\n}\r\n","import { YTGIF_Config } from '../../../lib/types/config'\r\nimport { isRendered } from '../../../lib/dom/elements-yt-gif-parent'\r\n\r\nexport function getYTUrlObj(rm_btn: El) {\r\n\tconst ytUrlEl = rm_btn?.nextSibling as HTMLLinkElement\r\n\r\n\tlet url: string = ytUrlEl?.href\r\n\r\n\tif (!YTGIF_Config.guardClause(url)) url = ''\r\n\r\n\treturn <const>{ url, ytUrlEl }\r\n}\r\nexport function NodesRecord(Nodes: NodeList, sel: s) {\r\n\tif (!Nodes || Nodes.length == 0) return []\r\n\r\n\tconst ElsArr = Array.from(Nodes)\r\n\t\t.map(nd => nd as HTMLElement)\r\n\t\t.filter(el => !!el.tagName)\r\n\r\n\treturn ElsArr.map((x: HTMLElement) => {\r\n\t\tif (x.classList.contains(sel)) return x\r\n\t\telse return Array.from(x.querySelectorAll(`.${sel}`))\r\n\t})\r\n\t\t.flat(Infinity)\r\n\t\t.filter((v, i, a) => {\r\n\t\t\tv = v as El\r\n\t\t\treturn (\r\n\t\t\t\t!!v &&\r\n\t\t\t\tgetYTUrlObj(v).url &&\r\n\t\t\t\t!hasYTGifAttr(v) &&\r\n\t\t\t\t!hasYTGifClass(v) &&\r\n\t\t\t\tv.classList.contains(sel) &&\r\n\t\t\t\ta.indexOf(v) === i &&\r\n\t\t\t\tisRendered(v)\r\n\t\t\t)\r\n\t\t}) as HTMLElement[]\r\n}\r\nexport function hasYTGifClass(b: El) {\r\n\treturn Array.from(b.classList).some(x => x.includes('yt-gif'))\r\n}\r\nexport function hasYTGifAttr(b: El) {\r\n\treturn Array.from(b.attributes)\r\n\t\t.map(a => a.name)\r\n\t\t.some(x => x.includes('yt-gif'))\r\n}\r\n","import { URL_Config } from '../../../lib/types/config'\r\nimport { getComponentMap } from '../../../lib/backend-frontend/get-maps'\r\nimport {\r\n\tclosestBlock,\r\n\tgetUidFromBlock,\r\n} from '../../../lib/dom/elements-yt-gif-parent'\r\nimport { awaitingAtrr } from '../../../lib/dom/attr'\r\nimport { TryToUpdateBlock_fmt } from '../../formatter/Flow'\r\nimport { getYTUrlObj } from './filter'\r\nimport { ValidUrlBtnUsage } from '$v3/init/formatter/button/validation'\r\n\r\nexport async function OnYtGifUrlBtn(e: MouseEvent, ref: IRefObj, fromObj = {}) {\r\n\t// 0.\r\n\tconst tEl = e.currentTarget as HTMLElement\r\n\tconst rm_btn = ref.target\r\n\te.stopPropagation()\r\n\te.preventDefault()\r\n\r\n\t// 1. execute further if the user has valid keys\r\n\tconst block = closestBlock(rm_btn)!\r\n\tconst tempUID = getUidFromBlock(block)\r\n\tconst { url, ytUrlEl } = getYTUrlObj(rm_btn)\r\n\r\n\tif (!ValidUrlBtnUsage())\r\n\t\treturn console.warn('YT GIF Url Button: Invalid Simulation keys')\r\n\tif (!tempUID || !url)\r\n\t\treturn console.warn(\r\n\t\t\t`YT GIF Url Button: Couldn't find any url within the block: ((${tempUID}))`\r\n\t\t)\r\n\r\n\t// 2. protect against spamming clicks\r\n\tconst awaiting = (bol: b) => {\r\n\t\t//TODO: use to be && comparison\r\n\t\tawaitingAtrr(bol, rm_btn)\r\n\t\tawaitingAtrr(bol, tEl)\r\n\t}\r\n\r\n\tif (rm_btn.hasAttribute('awaiting')) return\r\n\r\n\tawaiting(true)\r\n\r\n\tfunction getSettings(\r\n\t\te: MouseEvent,\r\n\t\toutterObj: { fmtCmpnt_cb: TFmtCb },\r\n\t\tfromObj: {}\r\n\t): TblockUpd_UrlBnt {\r\n\t\treturn <const>{\r\n\t\t\tblock,\r\n\t\t\ttargetNode: ytUrlEl,\r\n\r\n\t\t\tsiblingSel: `.bp3-icon-video + a[href*=\"youtu\"]`,\r\n\t\t\tselfSel: `.bp3-icon-video + a[href*=\"${url}\"]`,\r\n\r\n\t\t\tgetMap: async () => getComponentMap(tempUID, URL_Config),\r\n\t\t\tisKey: 'is substring',\r\n\r\n\t\t\ttempUID,\r\n\r\n\t\t\tfrom: {\r\n\t\t\t\tcaster: 'rm-btn',\r\n\t\t\t\turlBtn: e.target as El,\r\n\t\t\t\t...fromObj,\r\n\t\t\t},\r\n\t\t\t...outterObj,\r\n\t\t}\r\n\t}\r\n\r\n\tawait TryToUpdateBlock_fmt(getSettings(e, ref, fromObj))\r\n\r\n\t// 8. set free for any possible future clicks\r\n\tawaiting(false)\r\n}\r\ninterface IRefObj {\r\n\ttarget: HTMLElement\r\n\tfmtCmpnt_cb: TFmtCb\r\n}\r\n","import { toggleClasses } from '$lib/utils'\r\nimport { fmtIframe2Url } from '../../formatter/Flow/url'\r\nimport { fmtTimestampsUrlObj } from '../../formatter/Flow/timestamp'\r\nimport { validTmParam } from '../../../lib/helpers'\r\nimport { NodesRecord, getYTUrlObj } from './filter'\r\nimport { OnYtGifUrlBtn } from './update'\r\nimport { appendlUrlBtns } from '$v3/init/formatter/button/creation'\r\n\r\n//#region 7. url btn emulation\r\nexport function ReadyUrlBtns(added: HTMLElement[]) {\r\n\tfor (const rm_btn of added) {\r\n\t\ttoggleClasses(true, ['yt-gif'], rm_btn)\r\n\t\tappendlUrlBtns(rm_btn)\r\n\r\n\t\tconst Ref = (cb: TFmtCb) => ({ target: rm_btn, fmtCmpnt_cb: cb })\r\n\r\n\t\tif (validTmParam(getYTUrlObj(rm_btn).url)) {\r\n\t\t\tconst i = fmtIframe2Url(rm_btn)\r\n\t\t\ti.urlBtn('format').onclick = async e =>\r\n\t\t\t\tOnYtGifUrlBtn(e, Ref(i.updUrl), { param: 't', float: false })\r\n\t\t}\r\n\r\n\t\tconst o = fmtTimestampsUrlObj(rm_btn)\r\n\t\tconst { urlBtn } = o\r\n\r\n\t\turlBtn('yt-gif').onclick = async e => OnYtGifUrlBtn(e, Ref(o.ytGifCmpt))\r\n\r\n\t\turlBtn('start').onclick = async e => OnYtGifUrlBtn(e, Ref(o.startCmpt))\r\n\r\n\t\turlBtn('end').onclick = async e => OnYtGifUrlBtn(e, Ref(o.endCmpt))\r\n\r\n\t\turlBtn('start|end').onclick = async e =>\r\n\t\t\tOnYtGifUrlBtn(e, Ref(o.startEndCmpt))\r\n\r\n\t\to.confirmBtns()\r\n\t}\r\n}\r\n\r\nexport async function InlineUrlBtnMutations_cb(\r\n\tmutationsList: MutationRecord[]\r\n) {\r\n\tlet added: HTMLElement[] = []\r\n\tfor (const { addedNodes } of mutationsList)\r\n\t\tadded = [...added, ...NodesRecord(addedNodes, 'bp3-icon-video')]\r\n\r\n\tReadyUrlBtns(added)\r\n}\r\n","import { cssData } from '../../config/paths'\r\nimport { rm_components } from '../../config/driver'\r\nimport type { Check } from './Check'\r\nimport type { Label } from './Label'\r\nimport type { Show } from './Show'\r\n\r\n// 1.1\r\nexport const deployInfo = {\r\n\tsuspend: `Suspend Observers`,\r\n\tdeploy: `Deploy Observers`,\r\n\tdischarging: `** Disconecting Observers **`,\r\n\tloading: `** Setting up Observers **`,\r\n}\r\nexport interface ICheckboxes {\r\n\tmenu: HTMLInputElement\r\n\tsub: HTMLInputElement\r\n}\r\nconst { dwn_no_input } = cssData\r\nexport const noInputAnimation = [dwn_no_input]\r\n// 1.1.1\r\nexport function InputGate(\r\n\tdeploy: ICheckboxes,\r\n\t{\r\n\t\tsetText,\r\n\t\tsameLabel,\r\n\t\tvisualFeedback,\r\n\t\tHoldInputFor10Secs,\r\n\t}: ReturnType<typeof Label> &\r\n\t\tReturnType<typeof Show> &\r\n\t\tReturnType<typeof Check>\r\n) {\r\n\tconst {\r\n\t\tdropdown_fadeIt_bg_animation,\r\n\t\tdropdown_forbidden_input,\r\n\t\tdropdown_allright_input,\r\n\t} = cssData\r\n\tconst baseAnimation = [dropdown_fadeIt_bg_animation, ...noInputAnimation]\r\n\tconst redAnimationNoInputs = [...baseAnimation, dropdown_forbidden_input]\r\n\tconst greeAnimationInputReady = [...baseAnimation, dropdown_allright_input]\r\n\r\n\tasync function redCombo() {\r\n\t\tsetText(deployInfo.discharging)\r\n\t\tvisualFeedback(false)\r\n\t\twindow.YT_GIF_OBSERVERS.CleanMasterObservers()\r\n\t\tawait HoldInputFor10Secs(redAnimationNoInputs) //showing the red animation, because you are choosing to suspend\r\n\t\tsetText(deployInfo.deploy)\r\n\t}\r\n\r\n\t// 1.1.2\r\n\tasync function greenCombo() {\r\n\t\trm_components.ChargeMasterObserversWithValidDeploymentStyle()\r\n\t\tsetText(deployInfo.loading) //change label to suspend\r\n\t\tvisualFeedback(true)\r\n\t\tawait HoldInputFor10Secs(greeAnimationInputReady)\r\n\t\tsetText(deployInfo.suspend)\r\n\t}\r\n\tasync function OnInputFlow() {\r\n\t\tif (!deploy.menu.checked) {\r\n\t\t\treturn\r\n\t\t}\r\n\t\tif (sameLabel(deployInfo.suspend)) {\r\n\t\t\t// 1.1.1\r\n\t\t\tawait redCombo() //after the 10 seconds allow inputs again\r\n\t\t} else if (sameLabel(deployInfo.deploy)) {\r\n\t\t\t// 1.1.2\r\n\t\t\tawait greenCombo()\r\n\t\t}\r\n\t}\r\n\t// 2.1\r\n\tasync function OnSubmit() {\r\n\t\tif (deploy.sub.checked && sameLabel(deployInfo.deploy)) {\r\n\t\t\tawait greenCombo()\r\n\t\t}\r\n\t}\r\n\treturn <const>{ OnInputFlow, OnSubmit }\r\n}\r\n","import { deployInfo } from './InputGate'\r\n\r\n/* ****************** */\r\nexport function Label(labelCheckMenu: El) {\r\n\tlabelCheckMenu.textContent = deployInfo.suspend\r\n\tfunction sameLabel(str: s) {\r\n\t\treturn labelCheckMenu.textContent == str\r\n\t}\r\n\tfunction setText(str: s) {\r\n\t\treturn (labelCheckMenu.textContent = str)\r\n\t}\r\n\treturn <const>{ sameLabel, setText }\r\n}\r\n","import { toggleClasses } from '$lib/utils'\r\nimport { cssData } from '../../config/paths'\r\n\r\n/* ****************** */\r\nexport function Show() {\r\n\tconst { dropdown__hidden, dropdown_deployment_style, dwp_message } = cssData\r\n\tconst subHiddenDDM = document.querySelector(\r\n\t\t`.${dropdown__hidden}.${dropdown_deployment_style}`\r\n\t)!\r\n\tconst subHiddenDDM_message = subHiddenDDM.querySelector(`.${dwp_message}`)!\r\n\r\n\tfunction visualFeedback(bol: b) {\r\n\t\tisSubMenuHidden(bol)\r\n\t\tisSubDDMpulsing(!bol)\r\n\t}\r\n\tfunction isSubMenuHidden(bol: b) {\r\n\t\tconst hiddenClass = [`${cssData.dropdown__hidden}`]\r\n\t\ttoggleClasses(bol, hiddenClass, subHiddenDDM)\r\n\t}\r\n\tfunction isSubDDMpulsing(bol: b) {\r\n\t\tconst pulseAnim = [cssData.dwn_pulse_anim] // spagguetti\r\n\t\ttoggleClasses(bol, pulseAnim, subHiddenDDM_message) // spagguetti\r\n\t}\r\n\treturn <const>{ visualFeedback, subHiddenDDM }\r\n}\r\n","import { toggleClasses } from '$lib/utils'\r\nimport type { ICheckboxes} from './InputGate';\r\nimport { noInputAnimation } from './InputGate'\r\n\r\nexport function Check(deploy: ICheckboxes) {\r\n\tfunction disable(b: b) {\r\n\t\tObject.values(deploy).forEach(check => (check.disabled = b))\r\n\t}\r\n\tfunction check(b: b) {\r\n\t\tObject.values(deploy).forEach(check => (check.checked = b))\r\n\t}\r\n\tfunction DeployCheckboxesToggleAnims(bol: b, animation: s[]) {\r\n\t\ttoggleClasses(bol, animation, deploy.menu.parentElement!)\r\n\t\ttoggleClasses(bol, noInputAnimation, deploy.menu.parentElement!)\r\n\t}\r\n\tfunction HoldInputFor10Secs(animation: s[], duration = 10000) {\r\n\t\treturn new Promise(function (resolve: Function) {\r\n\t\t\tdisable(true)\r\n\t\t\tcheck(false)\r\n\t\t\tDeployCheckboxesToggleAnims(true, animation)\r\n\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdisable(false)\r\n\t\t\t\tcheck(false)\r\n\t\t\t\tDeployCheckboxesToggleAnims(false, animation)\r\n\t\t\t\tresolve()\r\n\t\t\t}, duration)\r\n\t\t})\r\n\t}\r\n\treturn <const>{ HoldInputFor10Secs }\r\n}\r\n","import { UI } from '../../config/yt-gif-init'\r\nimport { InputGate } from './InputGate'\r\nimport { Label } from './Label'\r\nimport { Show } from './Show'\r\nimport { Check } from './Check'\r\n\r\n//#region 4. BIG BOI FUNCTION - change the functionality of the extension\r\nexport async function MasterObserver_UCS_RTM() {\r\n\tconst checkboxes = {\r\n\t\tmenu: UI.deploymentStyle.suspend_yt_gif_deployment,\r\n\t\tsub: UI.deploymentStyle.deploy_yt_gifs,\r\n\t}\r\n\r\n\tconst label = checkboxes.menu.previousElementSibling!\r\n\r\n\tconst local = Label(label)\r\n\tconst show = Show()\r\n\tconst checkbox = Check(checkboxes)\r\n\r\n\tconst input = InputGate(checkboxes, { ...local, ...show, ...checkbox })\r\n\r\n\tcheckboxes.menu.addEventListener('change', input.OnInputFlow)\r\n\tcheckboxes.sub.addEventListener('change', input.OnSubmit)\r\n}\r\n","import { hasOneDayPassed_localStorage, isTrue, toggleClasses } from '$lib/utils'\r\nimport { cssData } from '../../config/paths'\r\nimport { ToggleIcons } from '../../dom/flip-tooltip'\r\nimport { getTutorialObj } from '../query'\r\n\r\nexport interface ITutorialInput {\r\n\ticon: Element\r\n\tmainDDM: Element\r\n\tddm_focus: string\r\n}\r\nexport function SetUpTutorials_smartNotification() {\r\n\t;['tut_update_ver']\r\n\t\t.map(id => document.querySelector(`[id=\"${id}\"]`))\r\n\t\t.filter(el => el != null)\r\n\t\t.map(el => getTutorialObj(el as El))\r\n\t\t.filter(o => o.ok)\r\n\t\t.forEach(toggleIconOnChange)\r\n}\r\ntype ITutObj = ReturnType<typeof getTutorialObj>\r\nfunction toggleIconOnChange(o: ITutObj) {\r\n\tconst { btn } = o\r\n\tconst visualFeedback = GetVisualFeedback(o)\r\n\tbtn.addEventListener('change', () => visualFeedback(btn.checked))\r\n\r\n\tCheckOnLocalStorage(o, visualFeedback)\r\n}\r\nfunction GetVisualFeedback(o: ITutObj) {\r\n\treturn function (bol: b) {\r\n\t\tbol = ToggleIcons(bol, o.iconObj) //TODO: removed btn param\r\n\t\ttoggleClasses(!bol, [cssData.dwn_pulse_anim], o.pulseElm)\r\n\t}\r\n}\r\nfunction CheckOnLocalStorage(\r\n\t{ btn, id }: ITutObj,\r\n\tvisualFeedback: (bol: boolean) => void\r\n) {\r\n\tif (hasOneDayPassed_localStorage(id)) {\r\n\t\tbtn.checked = true\r\n\t\tbtn.dispatchEvent(new Event('change'))\r\n\t} else {\r\n\t\tconst sessionValue = window.YT_GIF_DIRECT_SETTINGS.get(id)?.sessionValue\r\n\t\tconst bol =\r\n\t\t\ttypeof sessionValue === 'undefined' ? true : isTrue(sessionValue)\r\n\t\tbtn.checked = bol\r\n\t\tvisualFeedback(bol)\r\n\t}\r\n}\r\n","import { DDM_Els } from '../dom/fetch'\r\n\r\nexport function ResetMasterObservers() {\r\n\t// 0. the objects \"UI\", \"links\", \"attrData\" and \"cssData\" are binded to all of these functions\r\n\tif (DDM_Els().length > 0) {\r\n\t\ttry {\r\n\t\t\twindow.YT_GIF_OBSERVERS.CleanMasterObservers()\r\n\t\t\twindow.YT_GIF_OBSERVERS.CleanLoadedWrappers()\r\n\t\t\twindow.YT_GIF_OBSERVERS.masterIframeBuffer = new Array()\r\n\t\t} catch (err) {\r\n\t\t\tconsole.warn(`YT GIF's Masters observers are not defined.`)\r\n\t\t}\r\n\t\tconsole.log('Reinstalling the YT GIF Extension')\r\n\t}\r\n}\r\n","import { s_u_f_key } from '../../../lib/types/config'\r\nimport type { ICustomChangeEvent } from '../../../lib/dom/select/CustomSelect'\r\nimport { ValidUrlBtnUsage } from '$v3/init/formatter/button/validation'\r\n\r\n/* ****************** */\r\n\r\nexport function confirmUrlBtnUsage(bol: b, e: ICustomChangeEvent) {\r\n\tconst canUse = ValidUrlBtnUsage()\r\n\tif (!bol || canUse) return\r\n\r\n\tconst yesMessage = canUse\r\n\t\t? 'Simulate because I have both graph and localStorage keys'\r\n\t\t: 'Simulate, but first take me to the caution prompt - localStorage key is missing'\r\n\r\n\tconst userMind = confirm(\r\n\t\t`YT GIF Url Button: Simulation Request\\n\\nYES: ${yesMessage} \\n   -  https://github.com/kauderk/kauderk.github.io/blob/main/yt-gif-extension/install/faq/README.md#simulate-url-button-to-video-component \\n\\nNO: Don't simulate`\r\n\t)\r\n\r\n\tif (userMind) {\r\n\t\tlocalStorage.setItem(s_u_f_key, 'true')\r\n\t\tif (!canUse)\r\n\t\t\twindow\r\n\t\t\t\t.open(\r\n\t\t\t\t\t'https://github.com/kauderk/kauderk.github.io/tree/main/yt-gif-extension/install/faq#caution-prompt',\r\n\t\t\t\t\t'_blank'\r\n\t\t\t\t)\r\n\t\t\t\t?.focus()\r\n\t} else {\r\n\t\tif (e) {\r\n\t\t\te.stopPropagation()\r\n\t\t\te.preventDefault()\r\n\t\t\te.currentTarget.customSelect?.(false) // this used to use be a chk tag/events, but since I'm changing them for \"class CustomSelect()\" a weird loop happens with the 'click' event handler...\r\n\t\t\te.currentTarget.parentElement?.dispatchEvent(\r\n\t\t\t\tnew Event('customChange')\r\n\t\t\t)\r\n\t\t}\r\n\t\tlocalStorage.removeItem(s_u_f_key)\r\n\t}\r\n\treturn userMind\r\n}\r\n","import { toggleAttribute } from '$lib/utils'\r\nimport { getYTUrlObj, hasYTGifAttr, hasYTGifClass } from './filter'\r\nimport { ReadyUrlBtns } from '.'\r\n\r\n/* ****************** */\r\nexport function ToggleUrlBtnObserver(bol: b, obs: MutationObserver) {\r\n\tobs.disconnect()\r\n\r\n\tif (bol) {\r\n\t\tconst allUrlBtns_rm = document\r\n\t\t\t.queryAllasArr<HTMLElement>('.bp3-icon-video')\r\n\t\t\t.filter(\r\n\t\t\t\t// those that do not have yt-gif customization\r\n\t\t\t\tb => !hasYTGifAttr(b) && !hasYTGifClass(b) && getYTUrlObj(b).url\r\n\t\t\t)\r\n\r\n\t\tReadyUrlBtns(allUrlBtns_rm)\r\n\r\n\t\t// const ytElms =\r\n\t\tdocument\r\n\t\t\t.queryAllasArr<HTMLElement>(\r\n\t\t\t\t'.yt-gif-controls :is([formatter],[insertOptions]), [yt-gif-timestamp-emulation]'\r\n\t\t\t)\r\n\t\t\t.forEach(el => (el as IBtn)?.tryToAppendUrlBtns?.()) // YIKES! how do you implement an interface?\r\n\r\n\t\tobs.observe(document.body, { childList: true, subtree: true })\r\n\t} else {\r\n\t\t// const allUrlBtns =\r\n\t\tdocument\r\n\t\t\t.queryAllasArr(`.yt-gif-url-btns-wrapper`)\r\n\t\t\t.forEach(el => el.remove())\r\n\t\t// const allUrlBtns_rm =\r\n\t\tdocument\r\n\t\t\t.queryAllasArr('.bp3-icon-video')\r\n\t\t\t.forEach(el => el.classList.remove('yt-gif'))\r\n\t}\r\n}\r\nexport function ToggleBtnsWithNoUrl(bol: b) {\r\n\t// const noUrlBtns =\r\n\tdocument\r\n\t\t.queryAllasArr('.yt-gif-url-btns-wrapper[no-url]')\r\n\t\t.forEach(wrp => toggleAttribute(!bol, 'style', wrp, 'display: none'))\r\n}\r\n","import type { ICustomChangeEvent } from '$v3/lib/dom/select/CustomSelect'\r\nexport function addCustomChangeListener(\r\n\toption: HTMLOptionElement,\r\n\tcb: (e: ICustomChangeEvent) => void\r\n) {\r\n\toption.addEventListener('customChange', cb as EventListener)\r\n}\r\n","import { s_u_f_key } from '../../../lib/types/config'\r\nimport { getOption } from '../../../lib/backend-frontend/option'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport { valid_url_formatter } from '$v3/init/formatter/button/validation'\r\nimport { confirmUrlBtnUsage } from '../../observer/formatter/confirmation'\r\nimport {\r\n\tToggleUrlBtnObserver,\r\n\tToggleBtnsWithNoUrl,\r\n} from '../../observer/formatter/toggle'\r\nimport { addCustomChangeListener } from '$v3/lib/dom/options'\r\n\r\nexport function ListenForUrlOptions(urlObserver: MutationObserver) {\r\n\tconst url_formatter_option = getOption(UI.display.ms_options, s_u_f_key)\r\n\tconst rely_on_hierarchy = getOption(\r\n\t\tUI.display.fmt_options,\r\n\t\t'rely_on_hierarchy'\r\n\t)\r\n\r\n\tconst s_u_f_startUp = valid_url_formatter()\r\n\turl_formatter_option.customSelect?.(s_u_f_startUp)\r\n\tToggleUrlBtnObserver(s_u_f_startUp, urlObserver)\r\n\tToggleBtnsWithNoUrl(rely_on_hierarchy.selected)\r\n\r\n\taddCustomChangeListener(url_formatter_option, e =>\r\n\t\tconfirmUrlBtnUsage(e.detail.currentValue, e)\r\n\t)\r\n\taddCustomChangeListener(url_formatter_option, e =>\r\n\t\tToggleUrlBtnObserver(e.target.selected, urlObserver)\r\n\t)\r\n\taddCustomChangeListener(rely_on_hierarchy, e =>\r\n\t\tToggleBtnsWithNoUrl(e.target.selected)\r\n\t)\r\n}\r\n","import { getUidFromBlock } from '../../lib/dom/elements-yt-gif-parent'\r\nimport { getLastAnchorCmptInHierarchy } from '../../lib/backend-frontend/xxx-congif'\r\nimport { getCurrentInputBlock } from '../../lib/dom/roam'\r\n\r\nexport async function getTimestampObj_smart(\r\n\tpage: startEnd\r\n): Promise<IlocalTimeObjs> {\r\n\tconst openInputBlock = getCurrentInputBlock()\r\n\tconst uid = getUidFromBlock(openInputBlock)\r\n\tconst failObj = <IlocalTimeObjs>{}\r\n\r\n\tif (!page || !uid || !openInputBlock) return failObj // failObj\r\n\r\n\tconst { ok, formats, targetBlock } = await getLastAnchorCmptInHierarchy(uid)\r\n\r\n\tif (!ok) return failObj\r\n\r\n\tconst { lessHMS, HMS, hmsSufix, S } = formats\r\n\r\n\tconst obj = (v: string | number) => ({\r\n\t\tvalue: v,\r\n\t\tfmt: `{{[[yt-gif/${page}]]: ${v} }}`,\r\n\t})\r\n\r\n\treturn <const>{\r\n\t\tlessHMS: obj(fmt({ lessHMS })),\r\n\t\tHMS: obj(fmt({ HMS })),\r\n\t\thmsSufix: obj(fmt({ hmsSufix })),\r\n\t\tS: obj(parseInt(S || targetBlock[page].S)),\r\n\t\tuid: targetBlock?.uid,\r\n\t}\r\n\r\n\tfunction fmt(o: {}) {\r\n\t\t// https://www.codegrepper.com/code-examples/javascript/get+var+name+javascript#:~:text=%E2%80%9Cget%20var%20name%20javascript%E2%80%9D%20Code%20Answer\r\n\t\tconst key = Object.keys(o)[0]\r\n\t\t// @ts-ignore\r\n\t\tconst value = o[key] // Hmmm...\r\n\t\treturn !value || value?.includes?.('NaN')\r\n\t\t\t? // @ts-ignore\r\n\t\t\t  targetBlock[page][key]\r\n\t\t\t: value\r\n\t}\r\n}\r\nwindow.YTGIF = {\r\n\tgetTimestampObj: getTimestampObj_smart,\r\n}\r\n","import { sleep, updateBlock } from '$lib/utils-roam-alpha-api'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport { getTimestampObj_smart } from '../../timestamp/formats'\r\nimport { getCurrentInputBlock } from '../../../lib/dom/roam'\r\n\r\n// 6.3.1\r\nexport async function addBlockTimestamp_smart_local(pageRefSufx: startEnd) {\r\n\tconst timestampObj = await getTimestampObj_smart(pageRefSufx)\r\n\tconst uid = timestampObj.uid\r\n\tconst component =\r\n\t\ttimestampObj[UI.timestamps.tm_workflow_grab.value as keyof Itime]\r\n\t\t\t?.fmt ?? ''\r\n\r\n\tif (!uid)\r\n\t\treturn console.warn(\r\n\t\t\t`YT GIF Timestamps: couldn't find YT GIFs within the Hierarchy: ((${uid}))`\r\n\t\t)\r\n\tif (!component)\r\n\t\treturn console.warn(\r\n\t\t\t`YT GIF Timestamps: couldn't find values with the keyword \"${UI.timestamps.tm_workflow_grab.value}\" from ((${uid}))`\r\n\t\t)\r\n\r\n\tconst { updatedString, el } = concatStringAtCaret(\r\n\t\tgetCurrentInputBlock(),\r\n\t\tcomponent\r\n\t)\r\n\r\n\tawait updateBlock(uid, updatedString)\r\n\tawait sleep(50)\r\n\r\n\tupdateAtCaret(getCurrentInputBlock(), el.selectionEnd ?? 0)\r\n}\r\nfunction updateAtCaret(el: HTMLInputElement, atLength = 0, start = false) {\r\n\tif (start) el.selectionStart = el.selectionEnd = atLength\r\n\telse el.selectionEnd = el.selectionStart = atLength\r\n\tel.focus()\r\n}\r\nfunction concatStringAtCaret(el: HTMLInputElement, newText: string) {\r\n\tconst start = el.selectionStart ?? 0\r\n\tconst end = el.selectionEnd ?? 0\r\n\tconst text = el.value\r\n\tconst before = text.substring(0, start)\r\n\tconst after = text.substring(end, text.length)\r\n\tel.value = before + newText + after\r\n\tupdateAtCaret(el, end + newText.length)\r\n\r\n\treturn <const>{ updatedString: el.value, el }\r\n}\r\n","import { addBlockTimestamp_smart_local } from './replace'\r\n\r\n// 6.3\r\nexport async function registerKeyCombinations(e: KeyboardEvent) {\r\n\tif (!((e.ctrlKey || e.metaKey) && e.altKey)) return\r\n\r\n\tlet pageRefSufx: startEnd | null = null\r\n\tif (e.key == 's')\r\n\t\t// Ctrl + Alt + s\r\n\t\tpageRefSufx = 'start'\r\n\telse if (e.key == 'd')\r\n\t\t// Ctrl + Alt + d\r\n\t\tpageRefSufx = 'end'\r\n\tif (!pageRefSufx) return\r\n\r\n\tawait addBlockTimestamp_smart_local(pageRefSufx)\r\n}\r\nexport function ToggleTimestampShortcuts(bol: b, keyupEventHandler: Function) {\r\n\t// remove them anyway, avoid duplicates\r\n\tdocument.removeEventListener('keydown', keyupEventHandler as EventListener)\r\n\tif (bol) {\r\n\t\tkeyupEventHandler = registerKeyCombinations\r\n\t\tdocument.addEventListener('keydown', keyupEventHandler as EventListener)\r\n\t} else {\r\n\t\t// removed already\r\n\t}\r\n}\r\n","const componentClass = (page: string) =>\r\n\t`bp3-button bp3-small dont-focus-block rm-xparser-default-${page}`\r\nexport const timestampObj = <const>{\r\n\troamClassName: 'rm-video-timestamp dont-focus-block',\r\n\tstart: {\r\n\t\ttargetClass: 'rm-xparser-default-start',\r\n\t\tbuttonClass: componentClass('start'),\r\n\t},\r\n\tend: {\r\n\t\ttargetClass: 'rm-xparser-default-end',\r\n\t\tbuttonClass: componentClass('end'),\r\n\t},\r\n\tattr: {\r\n\t\temulation: 'yt-gif-timestamp-emulation',\r\n\t\ttimestampStyle: 'timestamp-style',\r\n\t\ttimestamp: 'timestamp',\r\n\t},\r\n\ttimestamp: {\r\n\t\tbuttonClass: componentClass('timestamp'),\r\n\t},\r\n\tparent: {\r\n\t\tclassName: 'yt-gif-timestamp-parent',\r\n\t},\r\n}\r\ntype T_startEndTmsObjs =\r\n\t| typeof timestampObj['start']\r\n\t| typeof timestampObj['end']\r\ntype T_TmsObjs = T_startEndTmsObjs & typeof timestampObj['timestamp']\r\n// 6.1 on valid dom nodes get last component and add timestamp + click events\r\nexport type T_tmSetObj = {\r\n\tself: IArrObj\r\n\tpear: IArrObj | null\r\n}\r\nexport interface IArrObj {\r\n\tfromUniqueUid: string\r\n\tsimilarCount: number\r\n\tpage: startEnd\r\n\tindent: number\r\n\ttargetIndex: number\r\n\ttempUID: string\r\n\tfromUid: string\r\n\r\n\ttargetNode: IBtnArrObj\r\n\tappendToParent: Function\r\n\ttargetNodeParent: Element\r\n\r\n\ttimestamp: string\r\n\thasAnyVideoUrl: StrSearch\r\n\r\n\tcolor: CSSStyleDeclaration['color']\r\n\tObjAsKey: TObjAsKey\r\n\tblockUid: string\r\n\tblock: HTMLElement\r\n\tblockID: string\r\n\tstartEndComponentMap: Trm_map\r\n}\r\ninterface ClickInput {\r\n\tuid: s\r\n\ttmSetObj: T_tmSetObj\r\n}\r\nexport type IClickInput = Readonly<ClickInput>\r\n","export const isKey = 'is component'\r\n","import { Value_AtIndexInMap } from '../../../../../lib/backend-frontend/map-query'\r\nimport { isKey } from './types'\r\nimport {\r\n\tExtractUrlsObj,\r\n\tExtractContentFromCmpt,\r\n} from '$v3/init/formatter/query/extract'\r\n\r\nexport function hasAnyVideoUrl(capture: s) {\r\n\t// https://gist.github.com/tonY1883/a3b85925081688de569b779b4657439b\r\n\treturn ExtractUrlsObj(ExtractContentFromCmpt(capture))?.match\r\n}\r\nexport function OutOfBoundsSibling(\r\n\ttargetIndex: number,\r\n\ttargetNodeParent: Element | undefined\r\n) {\r\n\treturn (\r\n\t\ttargetIndex == -1 || !targetNodeParent || !targetNodeParent?.parentNode\r\n\t)\r\n}\r\nexport function DelayedBlocks(\r\n\tstartEndComponentMap: Trm_map,\r\n\tsiblingsArr: Element[],\r\n\tnode: Element\r\n) {\r\n\treturn (\r\n\t\t!startEndComponentMap ||\r\n\t\t(startEndComponentMap.size !== siblingsArr.length &&\r\n\t\t\t!Value_AtIndexInMap(\r\n\t\t\t\tstartEndComponentMap,\r\n\t\t\t\tsiblingsArr.indexOf(node),\r\n\t\t\t\tisKey\r\n\t\t\t))\r\n\t)\r\n}\r\n","import { StartEnd_Config } from '../../../../../lib/types/config'\r\nimport {} from '$lib/utils-roam-alpha-api'\r\nimport { isNotZoomPath, sleep } from '$lib/utils'\r\nimport {\r\n\tgetMap_smart,\r\n\tgetComponentMap,\r\n} from '../../../../../lib/backend-frontend/get-maps'\r\nimport { isRendered } from '../../../../../lib/dom/elements-yt-gif-parent'\r\nimport type { IArrObj } from '../../types'\r\nimport { DelayedBlocks } from './guard-clause'\r\nimport type { TIDs } from './query/objects'\r\n\r\nexport function Local(found: El[]) {\r\n\tconst componentMapMap: Trm_map = new Map()\r\n\tlet _startEndMap: Trm_map = new Map()\r\n\r\n\treturn <const>{\r\n\t\tcomponentMapMap,\r\n\r\n\t\tsiblingsArr: Array<El>(),\r\n\t\tget startEndMap() {\r\n\t\t\treturn _startEndMap\r\n\t\t},\r\n\r\n\t\tmap_successfulEmulationArr: new Map<string, Array<IArrObj>>(),\r\n\r\n\t\trenderedComponents: found.filter(\r\n\t\t\tel => isRendered(el) && isNotZoomPath(el)\r\n\t\t),\r\n\r\n\t\tTryUpdateAgain,\r\n\t\tupdate_startEndComponentMap,\r\n\r\n\t\tTryUpdateMap,\r\n\t}\r\n\tasync function TryUpdateMap(\r\n\t\tids: TIDs,\r\n\t\tsiblingsArr: Element[],\r\n\t\tnode: Element\r\n\t) {\r\n\t\tawait update_startEndComponentMap(ids)\r\n\t\tif (DelayedBlocks(_startEndMap, siblingsArr, node)) {\r\n\t\t\tawait TryUpdateAgain(ids)\r\n\t\t}\r\n\t}\r\n\tasync function TryUpdateAgain(ids: TIDs) {\r\n\t\t// console.count(`YT GIF Timestamps: updating block strings: ((${tempUID})) ...        ...       ...         ...`);\r\n\t\tawait sleep(800) // YIKES!!!\r\n\t\tawait AddTimestampMap(ids)\r\n\t\tawait update_startEndComponentMap(ids)\r\n\t}\r\n\r\n\tasync function update_startEndComponentMap({ mapsKEY, tempUID }: TIDs) {\r\n\t\t_startEndMap = await getMap_smart(\r\n\t\t\tmapsKEY,\r\n\t\t\tcomponentMapMap,\r\n\t\t\tgetComponentMap,\r\n\t\t\t//\r\n\t\t\ttempUID,\r\n\t\t\tStartEnd_Config\r\n\t\t)\r\n\t}\r\n\r\n\tasync function AddTimestampMap({ mapsKEY, tempUID }: TIDs) {\r\n\t\tcomponentMapMap.set(\r\n\t\t\tmapsKEY,\r\n\t\t\tawait getComponentMap(tempUID, StartEnd_Config)\r\n\t\t)\r\n\t}\r\n}\r\n","import { getMap_smart } from '../../../../../../lib/backend-frontend/get-maps'\r\nimport { Value_AtIndexInMap } from '../../../../../../lib/backend-frontend/map-query'\r\nimport { getUidFromBlock } from '../../../../../../lib/dom/elements-yt-gif-parent'\r\nimport type { IArrObj} from '../../../types';\r\nimport { timestampObj } from '../../../types'\r\nimport { OutOfBoundsSibling } from '../guard-clause'\r\nimport { isKey } from '../types'\r\n\r\nexport type TIDs = ReturnType<typeof GetBlockIDs>\r\nexport function GetBlockIDs(block: HTMLElement) {\r\n\treturn <const>{\r\n\t\tmapsKEY: block.id,\r\n\t\ttempUID: getUidFromBlock(block),\r\n\t}\r\n}\r\nexport async function getCashedEmulationArr(\r\n\tmapsKEY: string,\r\n\tmap_successfulEmulationArr: Map<string, IArrObj[]>\r\n) {\r\n\treturn (await getMap_smart(mapsKEY, map_successfulEmulationArr, () =>\r\n\t\tArray<IArrObj>()\r\n\t)) as IArrObj[]\r\n}\r\nexport function GetTargetObj(\r\n\tsiblingsArr: Element[],\r\n\tnode: Element,\r\n\tstartEndMap: Trm_map\r\n) {\r\n\tconst defaultParent = siblingsArr.find(x => x === node)!\r\n\tconst index = siblingsArr.indexOf(node)\r\n\tif (OutOfBoundsSibling(index, defaultParent)) {\r\n\t\treturn null\r\n\t}\r\n\r\n\tconst content = Value_AtIndexInMap(startEndMap, index, isKey)\r\n\tif (!content) {\r\n\t\treturn null\r\n\t}\r\n\treturn <const>{ index, defaultParent, content }\r\n}\r\n\r\nexport function getPositionObj(\r\n\tObjAsKey: TObjAsKey,\r\n\ttargetNodeParent: QrySearch\r\n) {\r\n\tconst { indent, similarCount, uid: fromUid } = ObjAsKey\r\n\tconst similarCountButRoot = indent == 0 ? 0 : similarCount\r\n\r\n\treturn <const>{\r\n\t\tindent,\r\n\t\tsimilarCount,\r\n\t\tfromUid,\r\n\t\tfromUniqueUid: fromUid + similarCountButRoot,\r\n\t\t// FIXME!\r\n\t\tpage: <startEnd>['start', 'end'].find(\r\n\t\t\t\tkey =>\r\n\t\t\t\t\ttargetNodeParent?.classList.contains(\r\n\t\t\t\t\t\t// @ts-ignore come on!\r\n\t\t\t\t\t\ttimestampObj[key]?.targetClass\r\n\t\t\t\t\t)\r\n\t\t\t\t// find timestampObj key that is included in targetNode classlist\r\n\t\t\t) || 'timestamp',\r\n\t}\r\n}\r\n","import { ChangeElementType, elm } from '$lib/utils'\r\nimport { fmtTimestamp } from '../../../../timestamp/utils'\r\nimport { timestampObj } from '../../types'\r\nimport type { getPositionObj } from './query/objects'\r\n\r\nexport function ClearParentNode(targetNodeParent: Element) {\r\n\tArray.from(targetNodeParent.attributes)?.forEach?.(attr =>\r\n\t\ttargetNodeParent?.removeAttribute(attr.name)\r\n\t)\r\n\ttargetNodeParent = ChangeElementType(targetNodeParent, 'div')\r\n\ttargetNodeParent.className = timestampObj.parent.className\r\n\ttargetNodeParent.innerHTML = ''\r\n\treturn targetNodeParent\r\n}\r\nexport function CreatePlaceholder(\r\n\th: ReturnType<typeof getPositionObj>,\r\n\tcontent: string\r\n) {\r\n\tconst targetNode = <IBtnArrObj>elm([], 'a')\r\n\ttargetNode.setAttribute(timestampObj.attr.timestampStyle, h.page)\r\n\ttargetNode.setAttribute(timestampObj.attr.emulation, '')\r\n\ttargetNode.setAttribute(timestampObj.attr.timestamp, content)\r\n\ttargetNode.className = timestampObj.roamClassName\r\n\tconst a = elm([], 'a')\r\n\ttargetNode.appendChild(a)\r\n\ttargetNode.a = a\r\n\ttargetNode.a.textContent = content\r\n\ttargetNode.a.textContent = fmtTimestamp()(targetNode.a.textContent) // javascript is crazy!\r\n\treturn targetNode\r\n}\r\n","import { ObjKey_AtIndexInMap } from '../../../../../../lib/backend-frontend/map-query'\r\nimport type { IArrObj } from '../../../types'\r\nimport { ClearParentNode, CreatePlaceholder } from '../node'\r\nimport { hasAnyVideoUrl } from '../guard-clause'\r\nimport { isKey } from '../types'\r\nimport type { GetTargetObj, TIDs} from './objects';\r\nimport { getPositionObj } from './objects'\r\n\r\nexport function GetTmSetObj(\r\n\ttarget: NonNullable<ReturnType<typeof GetTargetObj>>,\r\n\tstartEndMap: Trm_map,\r\n\tblock: HTMLElement,\r\n\tids: TIDs\r\n) {\r\n\tconst { index, content } = target\r\n\r\n\tconst ObjAsKey = ObjKey_AtIndexInMap(startEndMap, index, isKey)!\r\n\tconst position = getPositionObj(ObjAsKey, target.defaultParent)\r\n\r\n\tconst parent = ClearParentNode(target.defaultParent)\r\n\tconst placeholder = CreatePlaceholder(position, content)\r\n\r\n\tconst { tempUID, mapsKEY } = ids\r\n\r\n\tconst tmSetObj: IArrObj = <const>{\r\n\t\t...position,\r\n\r\n\t\ttargetIndex: index,\r\n\t\ttempUID,\r\n\r\n\t\ttargetNode: placeholder,\r\n\t\tappendToParent: () => parent?.appendChild(placeholder),\r\n\t\ttargetNodeParent: parent,\r\n\r\n\t\ttimestamp: content,\r\n\t\thasAnyVideoUrl: hasAnyVideoUrl(ObjAsKey.capture),\r\n\r\n\t\tcolor: window.getComputedStyle(placeholder).color,\r\n\t\tObjAsKey,\r\n\t\tblockUid: tempUID,\r\n\t\tblock,\r\n\t\tblockID: mapsKEY,\r\n\t\tstartEndComponentMap: startEndMap,\r\n\t}\r\n\treturn tmSetObj\r\n}\r\n","import { closestBlock } from '../../../../../lib/dom/elements-yt-gif-parent'\r\nimport { ElementsPerBlock } from '../../../../../lib/dom/ytgif'\r\nimport { timestampObj } from '../../types'\r\nimport { Local } from './Local'\r\nimport {\r\n\tGetBlockIDs,\r\n\tGetTargetObj,\r\n\tgetCashedEmulationArr,\r\n} from './query/objects'\r\nimport { GetTmSetObj } from './query/timestamp-set'\r\n\r\nconst componentSel = `.${timestampObj.end.targetClass}, .${timestampObj.start.targetClass}, .${timestampObj.parent.className}`\r\nexport async function SetupRerenderedComponents(found: Element[]) {\r\n\tconst local = Local(found)\r\n\tlet siblingsArr: Element[] = []\r\n\r\n\tfor (const node of local.renderedComponents) {\r\n\t\tconst block = closestBlock(node) as HTMLElement\r\n\t\tif (!block) {\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\t// you are iterating through renderedComponents (mutation records), so you need to get the original siblings of each block\r\n\t\tsiblingsArr = ElementsPerBlock(block, `:is(${componentSel})`)\r\n\r\n\t\tconst ids = GetBlockIDs(block)\r\n\r\n\t\tawait local.TryUpdateMap(ids, siblingsArr, node)\r\n\r\n\t\tconst target = GetTargetObj(siblingsArr, node, local.startEndMap)\r\n\t\tif (!target) {\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\tconst tmSetObj = GetTmSetObj(target, local.startEndMap, block, ids)\r\n\r\n\t\tconst cashed = await getCashedEmulationArr(\r\n\t\t\ttmSetObj.blockID,\r\n\t\t\tlocal.map_successfulEmulationArr\r\n\t\t)\r\n\t\tcashed.push(tmSetObj)\r\n\t}\r\n\treturn local.map_successfulEmulationArr\r\n}\r\n","/* ********************* */\r\n\r\nexport async function tryToGetUrlDuration(id: string) {\r\n\t// @ts-ignore //TODO:\r\n\tconst key = window.YT_GIF_DIRECT_SETTINGS.get('YT_API_KEY_V3')?.sessionValue // yikes\r\n\tif (!key) return null\r\n\r\n\ttry {\r\n\t\tconst url = `https://www.googleapis.com/youtube/v3/videos?id=${id}&key=${key}&part=snippet,contentDetails`\r\n\t\tconst res = await asyncAjax(url)\r\n\t\t// @ts-ignore //TODO:\r\n\t\tconst youtube_time = res.items[0].contentDetails.duration\r\n\t\tconsole.log(`youtube_time: ${youtube_time}, id: ${id}`)\r\n\t\treturn formatISODate(youtube_time)\r\n\t} catch (error) {}\r\n\r\n\treturn null\r\n}\r\nfunction asyncAjax(url: string) {\r\n\t// https://stackoverflow.com/questions/27612372/how-to-await-the-ajax-request#:~:text=return%20new%20Promise(function(resolve%2C%20reject)%20%7B\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\t// @ts-ignore //TODO:\r\n\t\t$.ajax({\r\n\t\t\turl: url,\r\n\t\t\ttype: 'GET',\r\n\t\t\tdataType: 'json',\r\n\t\t\tbeforeSend: function () {},\r\n\t\t\tsuccess: (data: unknown) => resolve(data),\r\n\t\t\terror: (err: unknown) => reject(err),\r\n\t\t})\r\n\t})\r\n}\r\nfunction formatISODate(youtube_time: string) {\r\n\t// https://stackoverflow.com/questions/2086260/youtube-player-api-how-to-get-duration-of-a-loaded-cued-video-without-playing-i#:~:text=function%20formatISODate(youtube_time)%7B\r\n\tconst arr = youtube_time.match(/(\\d+)(?=[MHS])/gi) || []\r\n\treturn arr.map(i => (i.length < 2 ? '0' + i : i)).join(':')\r\n}\r\n","import { YTvideoIDs } from '../../../../lib/types/config'\r\nimport { getYouTubeVideoID } from '$lib/utils'\r\nimport { tryToGetUrlDuration } from '../../../../lib/backend-frontend/url-duration'\r\nimport { isSelected } from '../../../../lib/backend-frontend/option'\r\nimport { getMap_smart } from '../../../../lib/backend-frontend/get-maps'\r\nimport { UI } from '../../../config/yt-gif-init'\r\nimport { getWrapperInHierarchyObj } from '../../../../lib/dom/roam'\r\nimport type { IArrObj } from '../types'\r\nimport { fmtTimestamp } from '$v3/init/timestamp/utils'\r\n\r\nexport async function durationObj(\r\n\tsuccesfulEmulationMap: Map<string, IArrObj[]>\r\n) {\r\n\t// gain some performance\r\n\tconst obj = { getDuration: () => -1 }\r\n\r\n\tif (!isSelected(UI.timestamps.tm_options, 'YT_API_KEY_V3')) {\r\n\t\treturn obj\r\n\t}\r\n\r\n\tlet wrapperObjs =\r\n\t\tArray<Awaited<ReturnType<typeof getWrapperInHierarchyObj>>>() // ok. this is crazy\r\n\r\n\tconst rawTargets = [...succesfulEmulationMap.values()].map(\r\n\t\tarrs => arrs[0]?.targetNodeParent\r\n\t)\r\n\tif (rawTargets.length == 0) {\r\n\t\treturn obj\r\n\t}\r\n\r\n\tfor (const el of rawTargets) {\r\n\t\tconst o = await getWrapperInHierarchyObj(el)\r\n\t\tif (!wrapperObjs.find(x => x.id == o.id)) {\r\n\t\t\t// push if o.id is not in wrapperObjs\r\n\t\t\twrapperObjs.push(o)\r\n\t\t}\r\n\t}\r\n\r\n\tconst durationMap = new Map<s, n>() // store duration of each grandparent wrapper, if any\r\n\tfor (const wo of wrapperObjs) {\r\n\t\tconst lastUrl = wo.lastWrapper?.getAttribute('data-video-url')\r\n\t\tconst videoId = getYouTubeVideoID(lastUrl ?? '') || 'invalid'\r\n\t\tif (durationMap.has(wo.id) && !durationMap.get(wo.id))\r\n\t\t\tYTvideoIDs.delete(videoId) // it fetched something wrong, clean it and try angain\r\n\r\n\t\t// getMap_smart -> avoid making redundant requests from YT API V3\r\n\t\tdurationMap.set(\r\n\t\t\two.id,\r\n\t\t\tawait getMap_smart(\r\n\t\t\t\tvideoId,\r\n\t\t\t\tYTvideoIDs,\r\n\t\t\t\ttryToGetUrlDuration,\r\n\t\t\t\tvideoId\r\n\t\t\t)\r\n\t\t)\r\n\t}\r\n\r\n\treturn <const>{\r\n\t\tgetDuration(targetBlockID: s) {\r\n\t\t\t// a grandparent wrapper should have it's duration\r\n\t\t\tconst foundBlockID = wrapperObjs.find(x =>\r\n\t\t\t\tx.container?.contains(document.getElementById(targetBlockID))\r\n\t\t\t)?.id as s\r\n\t\t\treturn durationMap.get(foundBlockID) as n\r\n\t\t},\r\n\t}\r\n}\r\nexport function GetDuration(duration: number) {\r\n\t// if it is anything else but null or undefined, then parse it to secondsOnly\r\n\treturn duration ?? false ? fmtTimestamp<n>('S')(duration + '') : duration\r\n}\r\n","export function sortObjByKey<T extends object>(key: keyof T, obj: Array<T>) {\r\n\t// https://gist.github.com/JamieMason/0566f8412af9fe6a1d470aa1e089a752\r\n\tconst groupBy = (key: keyof T) => (array: Array<T>) =>\r\n\t\tarray.reduce((objectsByKeyValue: object, obj) => {\r\n\t\t\tconst value = obj[key]\r\n\t\t\t// @ts-ignore // TODO: type this\r\n\t\t\t// prettier-ignore\r\n\t\t\tobjectsByKeyValue[value] = (objectsByKeyValue[value] || []).concat(obj);\r\n\t\t\treturn objectsByKeyValue\r\n\t\t}, {})\r\n\tconst groupByKey = groupBy(key)\r\n\tconst objByKey = groupByKey(obj)\r\n\r\n\treturn Object.entries(objByKey).map(([title, data]) => ({\r\n\t\ttitle,\r\n\t\tdata,\r\n\t}))\r\n}\r\n","import type { IArrObj } from '../../types'\r\nimport { sortObjByKey } from '../sortObjByKey'\r\n\r\nexport function SortEmulationArr(values: IArrObj[]) {\r\n\tconst _values = [...values].sort((a, b) => a.indent - b.indent) // RAP utils\r\n\tconst sortedByUid = sortObjByKey('fromUniqueUid', _values)\r\n\t// @ts-ignore\r\n\tconst targetObjsArr: IArrObj[][] = sortedByUid.map(v => v['data'])\r\n\r\n\t//return <const>{ targetObjsArr, values: _values }\r\n\treturn targetObjsArr\r\n}\r\nexport function GetPears(ArrObjs: IArrObj[]) {\r\n\t// prettier-ignore\r\n\tconst findPage = (p: s) => [...ArrObjs].reverse().find(x => x.page == p);\r\n\tconst lastArr = [findPage('start'), findPage('end')]\r\n\tconst completePears = lastArr.every(el => !!el)\r\n\treturn <const>{ lastArr, completePears }\r\n}\r\n","import { toggleClasses } from '$lib/utils'\r\n\r\nexport function PulseObj(tEl: Element) {\r\n\tconst base = ['yt-timestamp-pulse-text-anim']\r\n\tconst animations = {\r\n\t\tgreen: [...base, 'yt-timestamp-success'],\r\n\t\tred: [...base, 'yt-timestamp-warn'],\r\n\t\tblue: [...base, 'yt-timestamp-opening'],\r\n\t\tpurple: [...base, 'yt-timestamp-reset'],\r\n\t\tblueViolet: [...base, 'yt-timestamp-pause'],\r\n\t\tall: Array<string>(),\r\n\t}\r\n\r\n\tanimations['all'] = Object.values(animations)\r\n\t\t.flat(Infinity)\r\n\t\t.filter((v, i, a) => a.indexOf(v) === i) as Array<string>\r\n\r\n\tfunction pulse(anim: keyof typeof animations = 'green') {\r\n\t\ttoggleClasses(false, animations['all'], tEl)\r\n\t\ttoggleClasses(true, animations[anim], tEl)\r\n\t\tsetTimeout(() => toggleClasses(false, animations[anim], tEl), 500)\r\n\t}\r\n\r\n\treturn pulse\r\n}\r\n","import { ObjectKeys } from '$lib/utils'\r\nimport { getLastAnchorCmptInHierarchy } from '../../../lib/backend-frontend/xxx-congif'\r\nimport { closest_container_request } from '../../../lib/dom/elements-yt-gif-parent'\r\n\r\nexport async function getYTwrapperRootObj(uid: string, tEl: Element) {\r\n\tconst { foundBlock } = await getLastAnchorCmptInHierarchy(uid)\r\n\tif (!foundBlock?.uid)\r\n\t\tconsole.warn(\r\n\t\t\t`YT GIF Timestamps: couldn't find YT GIFs within the Hierarchy: ((${uid}))`\r\n\t\t)\r\n\tconst { uid: f_uid } = foundBlock || { uid: '' }\r\n\treturn _getYTwrapperRootObj(f_uid, tEl)\r\n}\r\nexport async function _getYTwrapperRootObj(f_uid: string, tEl: Element) {\r\n\tconst barObj = {\r\n\t\ttEl,\r\n\t\tcondition: function (): boolean {\r\n\t\t\t//@ts-ignore // shuold be ok...\r\n\t\t\treturn this.tEl?.closest(`.${this.root}`) ? true : false\r\n\t\t},\r\n\t}\r\n\tconst PagesObj = {\r\n\t\tmain: {\r\n\t\t\troot: 'roam-article',\r\n\t\t\tcrossRoot: 'rm-sidebar-outline',\r\n\t\t\t...barObj,\r\n\t\t},\r\n\t\tside: {\r\n\t\t\troot: 'rm-sidebar-outline',\r\n\t\t\tcrossRoot: 'roam-article',\r\n\t\t\t...barObj,\r\n\t\t},\r\n\t\tpageRef: {\r\n\t\t\troot: 'rm-reference-main',\r\n\t\t\tcrossRoot: 'rm-sidebar-outline',\r\n\t\t\t...barObj,\r\n\t\t},\r\n\t}\r\n\r\n\tconst key = ObjectKeys(PagesObj).find(x => PagesObj[x].condition())!\r\n\tconst { root, crossRoot } = PagesObj[key]\r\n\tconst blockExist = document.querySelector(`.${root} [id$=\"${f_uid}\"]`)\r\n\r\n\t// root -> roam-article || rm-sidebar-outline\r\n\tconst WrappersInBlock = (r: s) => {\r\n\t\tconst wrappers = document.queryAllasArr(\r\n\t\t\t`.${r} [id$=\"${f_uid}\"] .yt-gif-wrapper`\r\n\t\t)\r\n\r\n\t\tif (r == PagesObj.main.crossRoot) return wrappers // they don't have this tEl\r\n\r\n\t\treturn wrappers\r\n\t\t\t.map(pw => closest_container_request(pw))\r\n\t\t\t.filter(pc => pc?.contains(tEl))\r\n\t\t\t.map(c => c?.queryAllasArr(`[id$=\"${f_uid}\"] .yt-gif-wrapper`))\r\n\t\t\t.flat(Infinity) as Element[]\r\n\t}\r\n\r\n\tconst lastWrapperInBlock = (r = root) =>\r\n\t\t[...WrappersInBlock(r)]?.pop() ?? null\r\n\r\n\treturn <const>{\r\n\t\tlastWrapperInBlock,\r\n\t\tWrappersInBlock,\r\n\t\tf_uid,\r\n\t\tblockExist: !!blockExist && lastWrapperInBlock(root),\r\n\t\troot,\r\n\t\tcrossRoot,\r\n\t\tmainRoot: PagesObj.main.root,\r\n\t}\r\n}\r\n","import { isSelected } from '../../../../lib/backend-frontend/option'\r\nimport { closest_anchor_container } from '../../../../lib/dom/elements-yt-gif-parent'\r\nimport { UI } from '../../../config/yt-gif-init'\r\nimport { _getYTwrapperRootObj, getYTwrapperRootObj } from '../query'\r\nimport type { IClickInput } from '../types'\r\n\r\nexport async function getRelevantWrapperObjFunc1(\r\n\ttEl: IBtn,\r\n\t{ tmSetObj, uid }: IClickInput\r\n) {\r\n\tconst yuid = (el: QrySearch) => el?.getAttribute('yt-gif-anchor-container')\r\n\tconst buid = (el: QrySearch) => el?.getAttribute('yt-gif-block-uid')\r\n\r\n\tlet anchorUid\r\n\tif (isSelected(UI.timestamps.tm_options, 'anchor'))\r\n\t\tanchorUid =\r\n\t\t\tbuid(tEl?.closest('[yt-gif-block-uid]')) ||\r\n\t\t\tyuid(closest_anchor_container(tmSetObj.self.targetNode))\r\n\r\n\tconst m_uid = anchorUid || uid\r\n\tconst getWrapperObj =\r\n\t\tm_uid != uid ? _getYTwrapperRootObj : getYTwrapperRootObj\r\n\r\n\treturn getWrapperObj(m_uid, tEl)\r\n}\r\nexport function getClicks1(which: number) {\r\n\treturn <const>{\r\n\t\tleft: which == 1,\r\n\t\tright: which == 3,\r\n\t\tmiddle: which == 2,\r\n\t}\r\n}\r\n","import { toggleAttribute } from '$lib/utils'\r\nimport type { T_tmSetObj } from '../types'\r\n\r\nexport function ToggleBoundarySet1(\r\n\tbol: boolean,\r\n\ttmSetObj: T_tmSetObj,\r\n\ttargetWrapper: QrySearch\r\n) {\r\n\ttoggleActiveAttr(bol, tmSetObj.self.targetNode)\r\n\tif (tmSetObj.pear) {\r\n\t\ttoggleActiveAttr(bol, tmSetObj.pear.targetNode)\r\n\t}\r\n\r\n\ttoggleAttribute(bol, 'last-active-timestamp', tmSetObj.self.targetNode)\r\n\tif (targetWrapper) {\r\n\t\ttoggleAttribute(bol, 'yt-active', targetWrapper)\r\n\t}\r\n\r\n\tfunction toggleActiveAttr(bol: b, el: El) {\r\n\t\tif (el) toggleAttribute(bol, 'active-timestamp', el)\r\n\t}\r\n}\r\n","import { simHoverOut, simHover } from '$lib/utils'\r\nimport type { PulseObj } from '$v3/init/timestamp/lib'\r\n\r\nexport function TogglePlayAttr_SimHover1(\r\n\tpulse: ReturnType<typeof PulseObj>,\r\n\tlastWrapper: QrySearch\r\n) {\r\n\tpulse('blueViolet')\r\n\tconst iframe = lastWrapper?.querySelector('iframe')\r\n\r\n\tif (iframe?.hasAttribute('yt-playing')) {\r\n\t\t// pepega\r\n\t\tlastWrapper?.dispatchEvent(simHoverOut())\r\n\t}\r\n\r\n\t// hover out -> videoIsPlayingWithSound(false)\r\n\telse if (iframe) {\r\n\t\tlastWrapper?.dispatchEvent(simHover())\r\n\t}\r\n}\r\n","import { UI } from '../../../../../config/yt-gif-init'\r\nimport type { T_YT_RECORD } from '$v3/lib/types/yt-types'\r\nimport type { PulseObj } from '$v3/init/timestamp/lib'\r\nimport type { tryGetRecordBoundary } from '../../record/record'\r\n\r\nexport function TryDispatchCustomPlayerReady({\r\n\ttimestampObj,\r\n\tobsTimestamp,\r\n\ttargetWrapper,\r\n}: TFlow) {\r\n\tconst detail: ICustomPlayerReady = {\r\n\t\t...timestampObj,\r\n\t\tupdateTime: timestampObj.currentTime ?? timestampObj.seekTo,\r\n\t\tplayRightAway: UI.timestamps.tm_seek_action.value == 'play',\r\n\t\tmute: UI.timestamps.tm_seek_action.value == 'mute',\r\n\t\tobsTimestamp,\r\n\t}\r\n\ttargetWrapper?.dispatchEvent(\r\n\t\tnew CustomEvent('customPlayerReady', {\r\n\t\t\tdetail,\r\n\t\t\tcancelBubble: true,\r\n\t\t})\r\n\t)\r\n}\r\nexport function TrySeekToFlow({\r\n\tseekToMessage,\r\n\trecord,\r\n\ttimestampObj,\r\n}: TFlow & ITryPlayInput) {\r\n\tconst { ok, currentTime, seekTo, start } = timestampObj\r\n\tif (seekToMessage == 'seekTo-soft' && ok) {\r\n\t\trecord?.wTarget?.seekTo(currentTime)\r\n\t} else if (seekTo != start) {\r\n\t\t// ReloadYTVideo already seeks to start\r\n\t\trecord?.wTarget?.seekTo(seekTo)\r\n\t}\r\n}\r\nexport function CanGoOn({\r\n\tpulse,\r\n\tboundaryObj,\r\n\tseekToMessage,\r\n\tsimMessage,\r\n}: ITryPlayInput) {\r\n\tif (!boundaryObj.success) {\r\n\t\treturn false\r\n\t}\r\n\tif (simMessage == 'visuals') {\r\n\t\tpulse('purple')\r\n\t} else {\r\n\t\tpulse('green')\r\n\t}\r\n\tconst { ok } = boundaryObj.timestampObj\r\n\tif (simMessage == 'visuals' && ok && seekToMessage != 'seekTo-strict') {\r\n\t\treturn false // should this return the next line \"ReloadYTVideo\"\r\n\t}\r\n\treturn true\r\n}\r\nexport function TryMutePausePlayer(record: T_YT_RECORD | undefined) {\r\n\trecord?.isSoundingFine(UI.timestamps.tm_seek_action.value != 'mute')\r\n\trecord?.togglePlay(UI.timestamps.tm_seek_action.value != 'pause')\r\n}\r\ntype TFlow = ITryPlayInput['boundaryObj']\r\nexport interface ITryPlayInput {\r\n\tpulse: ReturnType<typeof PulseObj>\r\n\tboundaryObj: ReturnType<typeof tryGetRecordBoundary>\r\n\tsimMessage: string\r\n\tseekToMessage: string\r\n}\r\n","import { TryReloadVideo } from '../../../../../../lib/event/TryReloadVideo'\r\nimport type {\r\n\tITryPlayInput} from './query';\r\nimport {\r\n\tCanGoOn,\r\n\tTrySeekToFlow,\r\n\tTryMutePausePlayer,\r\n\tTryDispatchCustomPlayerReady,\r\n} from './query'\r\n\r\n/**\r\n * Simulate Mouseenter\r\n */\r\nexport async function tryPlayLastBlock(input: ITryPlayInput) {\r\n\tif (!CanGoOn(input)) {\r\n\t\treturn\r\n\t}\r\n\tconst { boundaryObj } = input\r\n\tconst { record, timestampObj } = boundaryObj\r\n\r\n\tawait TryReloadVideo({ t: record?.wTarget, ...timestampObj })\r\n\r\n\tTrySeekToFlow({ ...input, ...boundaryObj })\r\n\r\n\tTryMutePausePlayer(record)\r\n\r\n\tTryDispatchCustomPlayerReady(boundaryObj)\r\n}\r\n","import { lastBlockIDParameters } from '../../../../../lib/types/config'\r\nimport { HMSToSecondsOnly } from '$lib/utils'\r\nimport type { T_tmSetObj } from '../../types'\r\nimport type { T_YT_RECORD } from '$v3/lib/types/yt-types'\r\n\r\nexport function getTimestampBoundaryObj(\r\n\tsecondsOnly: number,\r\n\trecord: T_YT_RECORD | undefined,\r\n\ttargetBlockID: string,\r\n\ttmSetObj: T_tmSetObj\r\n) {\r\n\tconst start = sec('start') ? secondsOnly : pearSec() || 0\r\n\tconst end = sec('end')\r\n\t\t? secondsOnly\r\n\t\t: pearSec() || record?.wTarget?.getDuration?.() || 0\r\n\tconst seekTo = sec('end') ? secondsOnly + 1 : secondsOnly\r\n\r\n\tconst tm = record?.wTarget?.getCurrentTime?.()\r\n\tconst currentTimeAlternative =\r\n\t\tlastBlockIDParameters.get(targetBlockID)?.updateTime\r\n\tconst currentTime = tm ?? currentTimeAlternative?.value ?? start\r\n\r\n\tconst bounded = ((tm = currentTime) => tm >= start && tm <= end)()\r\n\tconst farEnough = ((tm = currentTime) => tm + 1 > seekTo)()\r\n\r\n\treturn <const>{\r\n\t\tstart,\r\n\t\tend,\r\n\t\tpage: sec('end') ? 'end' : 'start',\r\n\t\tseekTo,\r\n\t\tcurrentTime,\r\n\t\tok: bounded && farEnough,\r\n\t}\r\n\r\n\tfunction sec(p: startEnd) {\r\n\t\treturn tmSetObj.self.page == p\r\n\t}\r\n\tfunction pearSec() {\r\n\t\treturn HMSToSecondsOnly(tmSetObj.pear?.timestamp || '')\r\n\t}\r\n}\r\n","import {\r\n\trecordedIDs,\r\n\tStartEnd_Config,\r\n\tobservedParameters,\r\n} from '../../../../../lib/types/config'\r\nimport { simHoverOut, toggleAttribute } from '$lib/utils'\r\nimport {\r\n\tclosestYTGIFparentID,\r\n\tgetWrapperUrlSufix,\r\n} from '../../../../../lib/dom/elements-yt-gif-parent'\r\n\r\nexport function GetRecordInfo(targetWrapper: QrySearch, f_uid: string) {\r\n\tconst blockID = [...recordedIDs.keys()]\r\n\t\t.reverse()\r\n\t\t.find(k => k.startsWith(closestYTGIFparentID(targetWrapper))) as s\r\n\tconst record = recordedIDs.get(blockID)\r\n\tconst obsBlockID = [...observedParameters.keys()]\r\n\t\t.reverse()\r\n\t\t.find(k => k.endsWith(getWrapperUrlSufix(targetWrapper, f_uid))) as s\r\n\tconst obsTimestampOrg = observedParameters.get(obsBlockID)\r\n\t\t?.lastActiveTimestamp as TlastActiveTm['lastActiveTimestamp']\r\n\tconst timestamp = { ...obsTimestampOrg }\r\n\treturn { record, timestamp, blockID }\r\n}\r\n\r\nexport function TryGetValidTimestamp(tEl: IBtn) {\r\n\treturn tEl.a.textContent?.match(StartEnd_Config.targetStringRgx)?.[0] as s\r\n}\r\nexport function PauseOthersBut(targetWrapper: QrySearch) {\r\n\treturn document\r\n\t\t.queryAllasArr('.yt-gif-wrapper')\r\n\t\t.filter(el => !el.closest('.ddm-tut')) // yikes\r\n\t\t.forEach(wrapper => {\r\n\t\t\ttoggleAttribute(false, 'yt-active', wrapper)\r\n\t\t\tif (wrapper != targetWrapper) wrapper?.dispatchEvent(simHoverOut())\r\n\t\t})\r\n}\r\n","import { HMSToSecondsOnly } from '$lib/utils'\r\nimport { closest_anchor_container } from '../../../../../lib/dom/elements-yt-gif-parent'\r\nimport { DeactivateTimestampsInHierarchy } from '../../../../timestamp/hierarchy'\r\nimport type { IClickInput } from '../../types'\r\nimport { getTimestampBoundaryObj } from './tmestamp'\r\nimport { PauseOthersBut, GetRecordInfo } from './query'\r\n\r\nexport function tryGetRecordBoundary(\r\n\tlastWrapper: QrySearch,\r\n\tvalidTimestamp: s,\r\n\tf_uid: string,\r\n\tToggleBoundarySet: (bol: boolean, targetWrapper: QrySearch) => void,\r\n\ttmSetObj: IClickInput['tmSetObj']\r\n) {\r\n\t// 1.\r\n\tPauseOthersBut(lastWrapper) // but this\r\n\r\n\t// 2.\r\n\tif (!validTimestamp) {\r\n\t\treturn <typeof res>{ success: false }\r\n\t}\r\n\r\n\t// 2.1\r\n\tconst { record, timestamp, blockID } = GetRecordInfo(lastWrapper, f_uid)\r\n\r\n\t// 3.\r\n\tDeactivateTimestampsInHierarchy(\r\n\t\tclosest_anchor_container(lastWrapper),\r\n\t\tlastWrapper\r\n\t)\r\n\tToggleBoundarySet(true, lastWrapper)\r\n\r\n\tconst res = <const>{\r\n\t\tsameBoundaries: record?.sameBoundaries(),\r\n\t\tsuccess: <boolean>true,\r\n\r\n\t\trecord,\r\n\t\tobsTimestamp: timestamp,\r\n\t\ttargetWrapper: lastWrapper,\r\n\r\n\t\ttimestampObj: getTimestampBoundaryObj(\r\n\t\t\tHMSToSecondsOnly(validTimestamp),\r\n\t\t\trecord,\r\n\t\t\tblockID,\r\n\t\t\ttmSetObj\r\n\t\t),\r\n\t}\r\n\treturn res\r\n}\r\n","import { navigateToUiOrCreate } from '$lib/utils-roam-alpha-api'\r\nimport { isElementVisible, sleep } from '$lib/utils'\r\nimport type { TLastWrapper } from '$v3/init/observer/timestamp/click/types'\r\n\r\nexport async function TryGoToBlockPage({\r\n\tWrappersInBlock,\r\n\tcrossRoot,\r\n\tf_uid,\r\n\troot,\r\n\tmainRoot,\r\n}: TLastWrapper) {\r\n\tif (WrappersInBlock(crossRoot).length == 0) {\r\n\t\t// 0 instances on crossRoot\r\n\t\tawait navigateToUiOrCreate(f_uid, root == mainRoot, 'block')\r\n\t}\r\n}\r\nexport async function SleepIfRendered({\r\n\tlastWrapperInBlock,\r\n\tcrossRoot,\r\n}: TLastWrapper) {\r\n\tconst prevWrapper = lastWrapperInBlock(crossRoot) as HTMLElement\r\n\tconst isRendered =\r\n\t\tprevWrapper instanceof Element && isElementVisible(prevWrapper)\r\n\tawait sleep(isRendered ? 50 : 500) // visible? then quicker\r\n}\r\n","import { setSideBarState } from '$lib/utils-roam-alpha-api'\r\nimport type { PulseObj } from '../../../../timestamp/lib'\r\nimport { ToggleBoundarySet1 } from '../simulation'\r\nimport { TogglePlayAttr_SimHover1 as DispatchPlayPause } from './play-pause'\r\nimport { tryPlayLastBlock } from './play'\r\nimport { tryGetRecordBoundary } from '../record/record'\r\nimport { TryGetValidTimestamp } from '../record/query'\r\nimport type { IClickInput } from '$v3/init/observer/timestamp/types'\r\nimport type { TLastWrapper } from '$v3/init/observer/timestamp/click/types'\r\nimport { TryGoToBlockPage, SleepIfRendered } from './cross-page'\r\nimport { sleep } from '$lib/utils'\r\n\r\nexport function Local(\r\n\tpulse: ReturnType<typeof PulseObj>,\r\n\tevt: ReturnType<typeof Event>,\r\n\tlast: TLastWrapper,\r\n\tinput: IClickInput\r\n) {\r\n\tconst { lastWrapperInBlock } = last\r\n\tasync function tryPlayLastBlock_SimHover(r: s) {\r\n\t\tawait tryPlayLastBlock({\r\n\t\t\tpulse,\r\n\t\t\tboundaryObj: getBoundaryObj(r),\r\n\t\t\t...evt.detail,\r\n\t\t})\r\n\t\t// 6.\r\n\t\tif (evt.ScrollKey()) {\r\n\t\t\tScrollToTargetWrapper(r)\r\n\t\t}\r\n\t}\r\n\tfunction ScrollToTargetWrapper(r: s) {\r\n\t\tlastWrapperInBlock(r)?.scrollIntoView({\r\n\t\t\tbehavior: 'smooth',\r\n\t\t\tblock: 'center',\r\n\t\t\tinline: 'nearest',\r\n\t\t})\r\n\t}\r\n\tfunction getBoundaryObj(r: s) {\r\n\t\treturn tryGetRecordBoundary(\r\n\t\t\tlastWrapperInBlock(r),\r\n\t\t\tTryGetValidTimestamp(evt.tEl),\r\n\t\t\tlast.f_uid,\r\n\t\t\tToggleBoundarySet,\r\n\t\t\tinput.tmSetObj\r\n\t\t)\r\n\t}\r\n\r\n\tfunction TryToDeactivateSet() {\r\n\t\tpulse('red')\r\n\t\tToggleBoundarySet(false, lastWrapperInBlock(last.root))\r\n\t}\r\n\tfunction ToggleBoundarySet(bol: b, targetWrapper: QrySearch) {\r\n\t\tToggleBoundarySet1(bol, input.tmSetObj, targetWrapper)\r\n\t}\r\n\r\n\tasync function PlayPause_SimHover(r: s) {\r\n\t\tDispatchPlayPause(pulse, lastWrapperInBlock(r))\r\n\t}\r\n\r\n\tasync function OpenBlockOnCrossRoot() {\r\n\t\tawait setSideBarState(3)\r\n\t\tawait sleep(50)\r\n\t\tpulse('blue')\r\n\t\tawait TryGoToBlockPage(last)\r\n\t\tawait SleepIfRendered(last)\r\n\t\tScrollToTargetWrapper(last.crossRoot)\r\n\t\tawait tryPlayLastBlock_SimHover(last.crossRoot)\r\n\t}\r\n\r\n\treturn <const>{\r\n\t\ttryPlayLastBlock_SimHover,\r\n\t\tPlayPause_SimHover,\r\n\t\tOpenBlockOnCrossRoot,\r\n\t\tTryToDeactivateSet,\r\n\t}\r\n}\r\nexport function Event(e: T_TmClickDetailEvent) {\r\n\tconst { currentTarget: tEl } = e\r\n\r\n\treturn <const>{\r\n\t\ttEl,\r\n\t\tresolve: () => tEl.removeAttribute('awaiting'),\r\n\t\tisPending: () => tEl.hasAttribute('awaiting'),\r\n\t\tpending: () => tEl.setAttribute('awaiting', 'true'),\r\n\t\tScrollKey: () => e['ctrlKey'],\r\n\t\tdetail: typeof e.detail == 'object' ? e.detail : e,\r\n\t}\r\n}\r\n","import { ClickResetWrapper } from '../../../../lib/event/ClickResetWrapper'\r\nimport { PulseObj } from '../../../timestamp/lib'\r\nimport { getRelevantWrapperObjFunc1, getClicks1 } from './query'\r\nimport type { IClickInput } from '$v3/init/observer/timestamp/types'\r\nimport { Event, Local } from './Flow'\r\n\r\n// 6.1.1\r\n\r\nexport async function PlayPauseOnClicks(\r\n\te: T_TmClickDetailEvent,\r\n\tinput: IClickInput\r\n) {\r\n\tconst evt = Event(e)\r\n\tif (evt.isPending()) {\r\n\t\treturn\r\n\t}\r\n\tevt.pending()\r\n\r\n\tconst { resolve } = evt\r\n\r\n\tconst pulse = PulseObj(evt.tEl)\r\n\tconst click = getClicks1(evt.detail.which)\r\n\r\n\tconst search = await getRelevantWrapperObjFunc1(evt.tEl, input)\r\n\tconst { lastWrapperInBlock, f_uid, blockExist, root } = search\r\n\tconst local = Local(pulse, evt, search, input)\r\n\r\n\tif (!blockExist) {\r\n\t\t// fail\r\n\t\tif (click.left || click.right || !f_uid) {\r\n\t\t\tlocal.TryToDeactivateSet()\r\n\t\t} else if (click.right) {\r\n\t\t\tawait local.OpenBlockOnCrossRoot()\r\n\t\t}\r\n\r\n\t\treturn resolve()\r\n\t}\r\n\r\n\tif (click.left || click.right) {\r\n\t\t// success\r\n\t\tif (e['altKey']) {\r\n\t\t\tawait ClickResetWrapper(lastWrapperInBlock(root), {\r\n\t\t\t\t'delete-obs-tm': true,\r\n\t\t\t})\r\n\t\t} else if (click.left) {\r\n\t\t\tawait local.tryPlayLastBlock_SimHover(root)\r\n\t\t} else if (click.right) {\r\n\t\t\tawait local.PlayPause_SimHover(root)\r\n\t\t}\r\n\r\n\t\treturn resolve()\r\n\t}\r\n\r\n\tif (click.right) {\r\n\t\t// opening?\r\n\t\tawait local.OpenBlockOnCrossRoot()\r\n\t}\r\n\r\n\treturn resolve()\r\n}\r\n","import { TryToUpdateBlock_fmt } from '../../../formatter/Flow'\r\nimport { fmtTimestampsUrlObj } from '../../../formatter/Flow/timestamp'\r\n\r\nexport function SetUpUrlFormatter(\r\n\t{\r\n\t\tblock,\r\n\t\ttargetNode,\r\n\t\tpage,\r\n\t\ttimestamp,\r\n\t\tstartEndComponentMap,\r\n\t\tblockUid,\r\n\t}: T_urlBtnStt,\r\n\ttmSetObj: ItmSetObj\r\n) {\r\n\tconst { ytGifCmpt, compt2Url, urlBtn, confirmBtns } =\r\n\t\tfmtTimestampsUrlObj(targetNode)\r\n\r\n\turlBtn('url').onclick = async e => await OnYtGifUrlBtn(e, compt2Url)\r\n\turlBtn('yt-gif').onclick = async e => await OnYtGifUrlBtn(e, ytGifCmpt)\r\n\tconfirmBtns()\r\n\r\n\tasync function OnYtGifUrlBtn(e: Event, fmtCmpnt_cb: TFmtCb) {\r\n\t\te.preventDefault()\r\n\t\te.stopPropagation()\r\n\r\n\t\tconst sel = (tm: s, p: s) =>\r\n\t\t\t`[timestamp=\"${tm}\"][timestamp-style=\"${p}\"]`\r\n\t\tconst URL_formatter_settings = {\r\n\t\t\tblock,\r\n\t\t\ttargetNode,\r\n\r\n\t\t\tsiblingSel: `[timestamp-style]`,\r\n\t\t\tselfSel: sel(timestamp, page),\r\n\r\n\t\t\tgetMap: async () => startEndComponentMap,\r\n\t\t\tisKey: 'is component',\r\n\r\n\t\t\tfmtCmpnt_cb,\r\n\t\t\ttempUID: blockUid,\r\n\r\n\t\t\tfrom: {\r\n\t\t\t\tcaster: 'timestamp',\r\n\t\t\t\tpage,\r\n\t\t\t\ttmSetObj,\r\n\t\t\t\turlBtn: e.target as El,\r\n\t\t\t\tsel,\r\n\t\t\t},\r\n\t\t}\r\n\r\n\t\tawait TryToUpdateBlock_fmt(URL_formatter_settings as TblockUpd_fmt)\r\n\t}\r\n}\r\nexport interface T_urlBtnStt {\r\n\tblock: El\r\n\ttargetNode: El\r\n\tpage: s\r\n\ttimestamp: s\r\n\tstartEndComponentMap: Trm_map\r\n\tblockUid: s\r\n}\r\n","import { toggleAttribute } from '$lib/utils'\r\nimport { isSelected } from '../../../../../lib/backend-frontend/option'\r\nimport { UI } from '../../../../config/yt-gif-init'\r\nimport { fmtTimestamp } from '../../../../timestamp/utils'\r\nimport { valid_url_formatter } from '$v3/init/formatter/button/validation'\r\nimport { appendVerticalUrlBtns } from '$v3/init/formatter/button/creation'\r\nimport type { IArrObj } from '../../types'\r\nimport { PlayPauseOnClicks } from '../../click'\r\nimport { SetUpUrlFormatter } from '../SetUpUrlFormatter'\r\nimport type { Checks, TPears } from './assign'\r\n\r\nexport function Callbacks(\r\n\to: IArrObj,\r\n\tduration: n,\r\n\t{ validPear }: ReturnType<typeof Checks>,\r\n\t{ lastArr }: TPears\r\n) {\r\n\tconst tmSetObj = {\r\n\t\tself: o,\r\n\t\tpear: validPear ? lastArr.find(po => po != o) ?? null : null,\r\n\t}\r\n\treturn <const>{\r\n\t\tasync OnClicks(e: T_TmClickDetailEvent) {\r\n\t\t\tawait PlayPauseOnClicks(e, { uid: o.tempUID, tmSetObj })\r\n\t\t},\r\n\t\ttryValidateSelf(d: number) {\r\n\t\t\tif (duration < 0) {\r\n\t\t\t\treturn // doesn't make sense\r\n\t\t\t}\r\n\t\t\tif (duration == d && o.targetNode.hasAttribute('out-of-bounds'))\r\n\t\t\t\treturn // already set, exit\r\n\r\n\t\t\tconst tm = parseInt(fmtTimestamp('S')(o.timestamp))\r\n\t\t\tconst bounded = tm >= 0 && tm <= duration // TODO: parseint(duration)\r\n\r\n\t\t\ttoggleAttribute(!bounded, 'out-of-bounds', o.targetNode)\r\n\t\t},\r\n\t\ttryToAppendUrlBtns() {\r\n\t\t\tif (!valid_url_formatter()) return\r\n\r\n\t\t\tappendVerticalUrlBtns(o.targetNode)\r\n\t\t\tSetUpUrlFormatter(\r\n\t\t\t\t{ ...o },\r\n\t\t\t\t{\r\n\t\t\t\t\tpear: tmSetObj.pear,\r\n\t\t\t\t\tself: { ...o },\r\n\t\t\t\t}\r\n\t\t\t)\r\n\r\n\t\t\tif (!o.hasAnyVideoUrl) {\r\n\t\t\t\tconst wrp = o.targetNode.querySelector(\r\n\t\t\t\t\t'.yt-gif-url-btns-wrapper'\r\n\t\t\t\t) as El // shouldn't be null\r\n\t\t\t\tconst valid = isSelected(\r\n\t\t\t\t\tUI.display.fmt_options,\r\n\t\t\t\t\t'rely_on_hierarchy'\r\n\t\t\t\t)\r\n\t\t\t\ttoggleAttribute(!valid, 'style', wrp, 'display: none')\r\n\t\t\t\treturn toggleAttribute(true, 'no-url', wrp)\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n}\r\n","import type { IArrObj } from '../../types'\r\nimport type { GetPears } from './query'\r\nimport type { Callbacks } from './callback'\r\n\r\nexport function AssignCallbacks(\r\n\to: IArrObj,\r\n\tcallbacks: ReturnType<typeof Callbacks>\r\n) {\r\n\to.targetNode.oncontextmenu = e => e.preventDefault() //https://codinhood.com/nano/dom/disable-context-menu-right-click-javascript\r\n\r\n\tconst { OnClicks } = callbacks\r\n\t// @ts-ignore\r\n\to.targetNode.addEventListener('customMousedown', OnClicks)\r\n\t//@ts-ignore // FIXME: I need my own callbacks\r\n\to.targetNode.onmousedown = OnClicks\r\n\to.targetNode.OnClicks = OnClicks\r\n\r\n\to.targetNode.validateSelf = callbacks.tryValidateSelf\r\n\to.targetNode.tryToAppendUrlBtns = callbacks.tryToAppendUrlBtns\r\n\tcallbacks.tryToAppendUrlBtns()\r\n\t// I'm using observers and these functions take just a little bit of longer to get attached, NOW it should be ok\r\n\to.appendToParent()\r\n}\r\n\r\nexport type TPears = ReturnType<typeof GetPears>\r\nexport function Checks(o: IArrObj, { lastArr, completePears }: TPears) {\r\n\tconst isTmSet = lastArr.includes(o)\r\n\tconst validPear = isTmSet && completePears\r\n\r\n\treturn <const>{\r\n\t\tvalidPear,\r\n\t\ttryToCollapse() {\r\n\t\t\tif (isTmSet) {\r\n\t\t\t\to.targetNode.setAttribute(\r\n\t\t\t\t\t'timestamp-set',\r\n\t\t\t\t\tcompletePears ? 'pears' : 'single'\r\n\t\t\t\t)\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n}\r\n","import type { IArrObj } from '../../types'\r\nimport { durationObj, GetDuration } from '../durationObj'\r\nimport { SortEmulationArr, GetPears } from './query'\r\nimport { Callbacks } from './callback'\r\nimport type { TPears} from './assign';\r\nimport { Checks, AssignCallbacks } from './assign'\r\n\r\nexport async function TryToDeployTimestampElms(\r\n\tmap_successfulEmulationArr: Map<string, IArrObj[]>\r\n) {\r\n\tif (map_successfulEmulationArr.size === 0) {\r\n\t\treturn\r\n\t}\r\n\tconst { getDuration } = await durationObj(map_successfulEmulationArr)\r\n\tfor (const values of map_successfulEmulationArr.values()) {\r\n\t\tfor (const ArrObjs of SortEmulationArr(values)) {\r\n\t\t\tconst pears = GetPears(ArrObjs)\r\n\r\n\t\t\tfor (const o of ArrObjs) {\r\n\t\t\t\tif (!o?.targetNode) {\r\n\t\t\t\t\tcontinue\r\n\t\t\t\t}\r\n\r\n\t\t\t\tAssembleTimestampElms(o, pears, getDuration)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction AssembleTimestampElms(\r\n\to: IArrObj,\r\n\tpears: TPears,\r\n\tgetDuration: Awaited<ReturnType<typeof durationObj>>['getDuration']\r\n) {\r\n\tconst check = Checks(o, pears)\r\n\tcheck.tryToCollapse()\r\n\r\n\tconst duration = GetDuration(getDuration(o.blockID))\r\n\tconst callbacks = Callbacks(o, duration, check, pears)\r\n\tcallbacks.tryValidateSelf(duration)\r\n\r\n\tAssignCallbacks(o, callbacks)\r\n}\r\n","import { SetupRerenderedComponents } from './setup'\r\nimport { TryToDeployTimestampElms } from './deploy'\r\n\r\nexport async function cleanAndSetUp_TimestampEmulation(found: El[]) {\r\n\tconst map_successfulEmulationArr = await SetupRerenderedComponents(found)\r\n\r\n\tawait TryToDeployTimestampElms(map_successfulEmulationArr)\r\n}\r\n","import { ChangeElementType, toggleClasses } from '$lib/utils'\r\nimport { getOption } from '../../../../lib/backend-frontend/option'\r\nimport { cssData } from '../../../config/paths'\r\nimport { UI } from '../../../config/yt-gif-init'\r\nimport { ToggleTimestampShortcuts } from '../shortcut'\r\nimport { cleanAndSetUp_TimestampEmulation } from '../emulation/index'\r\nimport { timestampObj } from '../types'\r\n\r\n//#region 6. Emulate slash menu & timestamps\r\nexport async function toggleTimestampEmulation(\r\n\tbol: b,\r\n\tobserver: MutationObserver,\r\n\tkeyupEventHandler: Function\r\n) {\r\n\tif (bol) await RunEmulation()\r\n\telse await StopEmulation()\r\n\r\n\ttoggleClasses(\r\n\t\t!bol,\r\n\t\t[`${cssData.dropdown__hidden}`],\r\n\t\tdocument.querySelector('.dropdown_timestamp-style')!\r\n\t)\r\n\r\n\tasync function RunEmulation() {\r\n\t\tawait StopEmulation()\r\n\t\tawait ToogleTimestampSetUp(true, observer)\r\n\t\tToggleTimestampShortcuts(\r\n\t\t\tgetOption(UI.timestamps.tm_options, 'shortcuts').selected,\r\n\t\t\tkeyupEventHandler\r\n\t\t)\r\n\t}\r\n\tasync function StopEmulation() {\r\n\t\tawait ToogleTimestampSetUp(false, observer)\r\n\t\tToggleTimestampShortcuts(false, keyupEventHandler)\r\n\t}\r\n}\r\nasync function ToogleTimestampSetUp(bol: b, observer: MutationObserver) {\r\n\tobserver.disconnect()\r\n\tconst targetNode = document.body\r\n\r\n\tif (bol) {\r\n\t\tconst found = Array<El>()\r\n\t\tfound.push(\r\n\t\t\t...Array.from(\r\n\t\t\t\ttargetNode.getElementsByClassName(\r\n\t\t\t\t\ttimestampObj.start.targetClass\r\n\t\t\t\t)\r\n\t\t\t)\r\n\t\t)\r\n\t\tfound.push(\r\n\t\t\t...Array.from(\r\n\t\t\t\ttargetNode.getElementsByClassName(timestampObj.end.targetClass)\r\n\t\t\t)\r\n\t\t)\r\n\t\tawait cleanAndSetUp_TimestampEmulation(found)\r\n\t\tobserver!.observe(targetNode, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t})\r\n\t} else {\r\n\t\tconst foundToRemove = targetNode.queryAllasArr(\r\n\t\t\t`[${timestampObj.attr.emulation}]`\r\n\t\t)\r\n\r\n\t\tfor (const tm of foundToRemove) {\r\n\t\t\tconst key = (tm.getAttribute(timestampObj.attr.timestampStyle) ||\r\n\t\t\t\t'timestamp') as startEnd | 'timestamp' // I don't know how I feel about this one\r\n\t\t\tlet toReplace = tm.parentElement?.classList.contains(\r\n\t\t\t\t'yt-gif-timestamp-parent'\r\n\t\t\t)\r\n\t\t\t\t? tm.parentElement\r\n\t\t\t\t: tm // yikes\r\n\t\t\ttoReplace.innerHTML = key\r\n\t\t\ttoReplace = ChangeElementType(toReplace, 'button')\r\n\t\t\ttoReplace.className = timestampObj[key].buttonClass\r\n\t\t}\r\n\t\t// already disconnected\r\n\t}\r\n}\r\n","import { fmtTimestamp } from '../../timestamp/utils'\r\n\r\n// 7.0 display\r\nexport function ChangeTimestampsDisplay(value: keyof Itime) {\r\n\tconst fmt = fmtTimestamp(value)\r\n\r\n\tdocument\r\n\t\t.queryAllasArr<HTMLElement>('[yt-gif-timestamp-emulation]')\r\n\t\t.forEach(_tms => {\r\n\t\t\tconst tms = _tms as IBtn\r\n\t\t\tif (!value)\r\n\t\t\t\t// Default?\r\n\t\t\t\treturn (tms.a.textContent =\r\n\t\t\t\t\ttms.getAttribute('timestamp') ?? tms.a.textContent)\r\n\t\t\ttms.a.textContent = fmt(tms.a.textContent as s)\r\n\t\t})\r\n}\r\n","import { cleanAndSetUp_TimestampEmulation } from '../emulation/index'\r\nimport { timestampObj } from '../types'\r\n\r\n// 6.0 observe added/removed nodes and act accordingly\r\nexport async function TimestampBtnsMutation_cb(\r\n\tmutationsList: MutationRecord[]\r\n) {\r\n\tconst found = Array<El>()\r\n\r\n\tfor (const { addedNodes } of mutationsList) {\r\n\t\tArray.from(addedNodes)\r\n\t\t\t.map(nd => nd as HTMLElement)\r\n\t\t\t.forEach(el => {\r\n\t\t\t\tif (!el.tagName) return // not an element\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tel.classList.contains(timestampObj.start.targetClass) ||\r\n\t\t\t\t\tel.classList.contains(timestampObj.end.targetClass)\r\n\t\t\t\t) {\r\n\t\t\t\t\tfound.push(el)\r\n\t\t\t\t} else if (el.firstElementChild) {\r\n\t\t\t\t\tfound.push(\r\n\t\t\t\t\t\t...Array.from(\r\n\t\t\t\t\t\t\tel.getElementsByClassName(\r\n\t\t\t\t\t\t\t\ttimestampObj.start.targetClass\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t\tfound.push(\r\n\t\t\t\t\t\t...Array.from(\r\n\t\t\t\t\t\t\tel.getElementsByClassName(\r\n\t\t\t\t\t\t\t\ttimestampObj.end.targetClass\r\n\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t)\r\n\t\t\t\t\t)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}\r\n\r\n\tawait cleanAndSetUp_TimestampEmulation(found)\r\n}\r\n","import { getOption } from '../../../lib/backend-frontend/option'\r\nimport { UI } from '../../config/yt-gif-init'\r\nimport { toggleTimestampEmulation } from '../../observer/timestamp/mutation/toggle'\r\nimport { ChangeTimestampsDisplay } from '../../observer/timestamp/display'\r\nimport { ToggleTimestampShortcuts } from '../../observer/timestamp/shortcut'\r\nimport { TimestampBtnsMutation_cb } from '../../observer/timestamp/mutation'\r\nimport { addCustomChangeListener } from '$v3/lib/dom/options'\r\n\r\nexport function ClearTimestampObserver(\r\n\t{ timestampObserver } = window.YT_GIF_OBSERVERS\r\n) {\r\n\ttimestampObserver?.disconnect()\r\n\ttimestampObserver = new MutationObserver(TimestampBtnsMutation_cb)\r\n\treturn timestampObserver\r\n}\r\n\r\nexport async function KickstartTimestampObserver(\r\n\t{ timestampObserver, keyupEventHandler } = window.YT_GIF_OBSERVERS\r\n) {\r\n\tawait toggleTimestampEmulation(\r\n\t\tUI.display.simulate_roam_research_timestamps.checked,\r\n\t\ttimestampObserver!,\r\n\t\tkeyupEventHandler\r\n\t)\r\n\tUI.display.simulate_roam_research_timestamps.addEventListener(\r\n\t\t'change',\r\n\t\tasync e =>\r\n\t\t\ttoggleTimestampEmulation(\r\n\t\t\t\t(e.currentTarget as HTMLInputElement).checked,\r\n\t\t\t\ttimestampObserver!,\r\n\t\t\t\tkeyupEventHandler\r\n\t\t\t)\r\n\t)\r\n\taddCustomChangeListener(\r\n\t\tgetOption(UI.timestamps.tm_options, 'shortcuts'),\r\n\t\te => ToggleTimestampShortcuts(e.detail.currentValue, keyupEventHandler)\r\n\t)\r\n\tUI.timestamps.tm_workflow_display.addEventListener('change', e =>\r\n\t\tChangeTimestampsDisplay(\r\n\t\t\t(e.currentTarget as HTMLSelectElement).value as keyof Itime\r\n\t\t)\r\n\t)\r\n}\r\n","import { UI } from '../../config/yt-gif-init'\r\nimport { rm_components } from '../../config/driver'\r\n\r\nexport function KickStartMasterObserver() {\r\n\trm_components.state.initialKey = rm_components.assertCurrentKey(\r\n\t\tUI.defaultValues.override_roam_video_component as s\r\n\t)\r\n\tconst { initialKey } = rm_components.state\r\n\trm_components.checkSubDeploymentStyle(initialKey, true) // start with some value\r\n\trm_components.RunMasterObserverWithKey(initialKey)\r\n}\r\n","import { fetchTextTrimed } from '$lib/utils'\r\nimport { links } from '../config/paths'\r\nimport {\r\n\tsmart_LoadCSS,\r\n\tsmart_CssPlayer_UCS,\r\n\tsmart_Load_DDM_onTopbar,\r\n} from '../dom/fetch'\r\n\r\nexport async function LoadHTML() {\r\n\tlinks.html.fetched.playerControls = await fetchTextTrimed(\r\n\t\tlinks.html.playerControls\r\n\t)\r\n\tlinks.html.fetched.urlBtn = await fetchTextTrimed(links.html.urlBtn)\r\n\tlinks.html.fetched.insertOptions = await fetchTextTrimed(\r\n\t\tlinks.html.insertOptions\r\n\t)\r\n\tlinks.html.fetched.anchor = await fetchTextTrimed(links.html.anchor)\r\n\r\n\tawait smart_Load_DDM_onTopbar(links.html.dropDownMenu)\r\n}\r\nexport async function LoadCSS() {\r\n\tawait smart_LoadCSS(links.css.dropDownMenuStyle, `yt-gif-dropDownMenuStyle`)\r\n\tawait smart_LoadCSS(links.css.playerStyle, `yt-gif-playerStyle`)\r\n\r\n\t//await smart_LoadCSS(themes.get(ddm_css_theme_stt.sessionValue), ddm_main_theme_id);\r\n\tsmart_CssPlayer_UCS(\r\n\t\twindow.YT_GIF_DIRECT_SETTINGS.get('player_span')?.sessionValue as s\r\n\t)\r\n}\r\n","import { RemoveAllChildren } from '$lib/utils'\r\n\r\n//#region Focus and close mainDDM\r\ninterface IDDMInput {\r\n\tmainDDM: HTMLElement\r\n\tddm_focus: s\r\n\tmainMenu: HTMLElement\r\n\tinitialDisplay?: s\r\n}\r\nexport function DDMAction({\r\n\tmainDDM,\r\n\tmainMenu,\r\n\tddm_focus,\r\n\tinitialDisplay = 'none',\r\n}: IDDMInput) {\r\n\tlet previousValue = mainDDM.style.display // changes inside style_cb\r\n\r\n\tfunction display(d: s) {\r\n\t\treturn (mainDDM.style.display = d)\r\n\t}\r\n\tfunction canClose() {\r\n\t\treturn (\r\n\t\t\t!mainDDM.classList.contains(ddm_focus) &&\r\n\t\t\t!mainMenu.matches(':hover')\r\n\t\t)\r\n\t}\r\n\tfunction tryClose() {\r\n\t\tif (canClose())\r\n\t\t\tmainDDM\r\n\t\t\t\t.queryAllasArr('.dropdown-focus')\r\n\t\t\t\t.forEach(el => el.classList.remove('dropdown-focus'))\r\n\t\treturn canClose() ? display('none') : null\r\n\t}\r\n\tfunction open() {\r\n\t\treturn display('flex')\r\n\t}\r\n\t// function iconIsPulsing(bol: b) {\r\n\t// \treturn UTILS.toggleClasses(bol, [cssData.dwn_pulse_anim], icon)\r\n\t// }\r\n\tfunction mutationCallback(mutationList: MutationRecord[]) {\r\n\t\t//https://stackoverflow.com/questions/37168158/javascript-jquery-how-to-trigger-an-event-when-display-none-is-removed#:~:text=11-,Here%20we%20go,-var%20blocker%20%20%3D%20document\r\n\t\t// observers for computed styles... -it needs to be a thing... 🙃\r\n\t\tmutationList.forEach(function (record) {\r\n\t\t\tif (record.attributeName !== 'style') {\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tconst { newValue, displayWas, el } = StyleQuery(\r\n\t\t\t\trecord,\r\n\t\t\t\tpreviousValue\r\n\t\t\t)\r\n\r\n\t\t\tif (newValue) {\r\n\t\t\t\tif (displayWas('flex')) {\r\n\t\t\t\t\tResetWrappers(mainDDM)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpreviousValue = el.style.display\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\tdisplay(initialDisplay)\r\n\treturn <const>{ mutationCallback, tryClose, open, close }\r\n}\r\nfunction StyleQuery(record: MutationRecord, previousValue: string) {\r\n\tconst el = record.target as HTMLElement\r\n\tconst currentValue = el.style.display\r\n\tconst displayWas = (d: s) => previousValue === d && currentValue !== d\r\n\tconst newValue = currentValue !== previousValue\r\n\treturn { newValue, displayWas, el }\r\n}\r\n\r\nfunction ResetWrappers(mainDDM: HTMLElement) {\r\n\treturn mainDDM\r\n\t\t.queryAllasArr('iframe')\r\n\t\t.map(el => el.closest('[data-target]'))\r\n\t\t.filter(el => el != null)\r\n\t\t.forEach(el => {\r\n\t\t\tel?.removeAttribute('class') // target classes\r\n\t\t\tel = RemoveAllChildren(el!)\r\n\t\t})\r\n}\r\n","import { cssData } from '../../config/paths'\r\nimport { GetMainYTGIFicon } from '../../dom/drop-down-menu/hover/query'\r\nimport { DDMAction } from '../../dom/drop-down-menu/open-close'\r\n\r\nexport function RunTutorialsObserver() {\r\n\tconst { mainDDM, mainMenu, icon } = GetMainYTGIFicon()\r\n\t// if the user entered/initialized/played the tutorial,\r\n\t// the ddm won't be closed until it losses focus,\r\n\t// conventionally clicking anything but the ddm/ddm-children\r\n\tconst menu = DDMAction({ mainDDM, mainMenu, ...cssData })\r\n\tmainMenu.addEventListener('mouseenter', menu.open)\r\n\tmainMenu.addEventListener('mouseleave', menu.tryClose)\r\n\ticon.addEventListener('blur', menu.tryClose)\r\n\r\n\tnew MutationObserver(menu.mutationCallback)\r\n\t\t// when closed, clean tutorials -> wrappers\r\n\t\t.observe(mainDDM, { attributes: true })\r\n\treturn <const>{ icon, mainDDM }\r\n}\r\n","import { getOption } from '../../lib/backend-frontend/option'\r\nimport { cssData, links } from '../config/paths'\r\nimport { UI } from '../config/yt-gif-init'\r\nimport { SaveSettingsOnChanges } from '../dom/ui/change'\r\nimport { DDM_to_UI_variables } from '../dom/ui/transform'\r\nimport {\r\n\tinitialize_modes_synergy,\r\n\ttogglePlayPauseStyles,\r\n} from '../dom/listener'\r\nimport { navigateToSettingsPageInSidebar } from '../dom/sidebar'\r\nimport { ToggleTheme } from '../dom/theme'\r\nimport { FlipBindAttr } from '../dom/attribute/bind'\r\nimport { ToggleThumbnails } from '../dom/thumbnail'\r\nimport { UpdateOnScroll_RTM } from '../dom/scroll'\r\nimport { DDMHover } from '../dom/drop-down-menu/hover'\r\nimport { SetUpSelectTutorials } from '../tutorial'\r\nimport { assignFirstAnchorWave, SetupAnchorObserver } from '../observer/anchor'\r\nimport { InlineUrlBtnMutations_cb } from '../observer/formatter'\r\nimport { MasterObserver_UCS_RTM } from '../observer/switch'\r\nimport { SetUpTutorials_smartNotification } from '$v3/init/tutorial/notification/index'\r\nimport { ResetMasterObservers } from './reset'\r\nimport { ListenForUrlOptions } from './observer/formatter'\r\nimport {\r\n\tKickstartTimestampObserver,\r\n\tClearTimestampObserver,\r\n} from './observer/timestamp'\r\nimport { KickStartMasterObserver } from './observer/ytgif'\r\nimport { LoadCSS, LoadHTML } from './fetch'\r\nimport { RunTutorialsObserver } from './observer/tutorial'\r\n\r\nexport async function Ready() {\r\n\t// TODO: set timestampRecovery.seekTo.currentTime\r\n\t// TODO: set experience.inputType.clicks\r\n\t// 0. the objects \"UI\", \"links\", \"attrData\" and \"cssData\" are linked to all of these functions\r\n\tResetMasterObservers()\r\n\r\n\t// 1. fetch\r\n\tawait LoadCSS() // UCS - user customizations\r\n\tawait LoadHTML() // DDM - drop down menu\r\n\r\n\t// 2. assign direct values to the main object | UI - user inputs\r\n\tDDM_to_UI_variables() // filtering baseKey & prompts and transforming them from objs to values or dom els - it is not generic and only serves for the first indent level (from parent to child keys)\r\n\tSaveSettingsOnChanges() // the settings page script is responsible for everything, these are just events\r\n\r\n\t// 3. set up events\r\n\tDDMHover()\r\n\r\n\tFlipBindAttr() // RTM runtime\r\n\r\n\tUpdateOnScroll_RTM(UI.range.timestamp_display_scroll_offset)\r\n\tUpdateOnScroll_RTM(UI.range.end_loop_sound_volume)\r\n\tUpdateOnScroll_RTM(UI.range.iframe_buffer_slider)\r\n\r\n\tToggleThumbnails(getOption(UI.experience.xp_options, 'thumbnail_as_bg'))\r\n\r\n\tnavigateToSettingsPageInSidebar()\r\n\tToggleTheme()\r\n\r\n\tinitialize_modes_synergy()\r\n\r\n\t// 3.1 pre startup - anchors\r\n\tassignFirstAnchorWave()\r\n\tSetupAnchorObserver()\r\n\r\n\t// 3.2 pre startup - iframes\r\n\ttogglePlayPauseStyles()\r\n\r\n\t// 4. run extension and events - set up\r\n\tawait MasterObserver_UCS_RTM() // listening for changes | change the behavior RTM // BIG BOI FUNCTION\r\n\tKickStartMasterObserver()\r\n\r\n\t// 5. Setting up tutorials\r\n\tconst ddmElmWithListeners = RunTutorialsObserver()\r\n\tSetUpSelectTutorials({ ...ddmElmWithListeners, ...cssData })\r\n\tSetUpTutorials_smartNotification()\r\n\r\n\t// 6. Emulate -> slash menu, timestamps + shortcuts\r\n\twindow.YT_GIF_OBSERVERS.timestampObserver = ClearTimestampObserver()\r\n\t// 6.1 cleanAndSetUp_TimestampEmulation -> PlayPauseOnClicks\r\n\t// 6.2 run timestampObserver\r\n\t// 6.3 registerKeyCombinations (keyupEventHandler)\r\n\t//      6.3.1 addBlockTimestamps\r\n\tawait KickstartTimestampObserver()\r\n\r\n\t// 7. simulate inline url btn\r\n\tconst urlObserver = new MutationObserver(InlineUrlBtnMutations_cb)\r\n\tListenForUrlOptions(urlObserver)\r\n\r\n\tconsole.log('YT GIF extension activated')\r\n}\r\n","import '$lib/window'\r\nimport { init as settingsPageInit } from '$v3/settings-page'\r\nimport { links } from './init/config/paths'\r\nimport { Ready } from './init/index'\r\nimport { CreateXload } from '$v3/lib/helpers'\r\nimport { TryCreateUserInputObject } from '$v3/init/config/yt-gif-init'\r\n\r\ninit()\r\nasync function init() {\r\n\tawait CreateXload('https://www.youtube.com/player_api')\r\n\r\n\t// prettier-ignore\r\n\tif (typeof window.YT == 'undefined')\r\n        return console.warn(`The YT GIF Extension won't be installed, major scripts are missing... submit your issue here: ${links.help.github_isuues}`);\r\n\r\n\tawait settingsPageInit().then(TryCreateUserInputObject)\r\n\tawait Ready()\r\n}\r\n"],"names":["sleep","url","uid","m","sel","str","bol","isRendered","el","element","span","thumbnail","isAnObjectWith","validNestFromThePast","init","UI","YT_GIF_SETTINGS_PAGE","onRenderedCmpt_cb","condition","string","btnNames","Format","selector","script","src","ExamineResObj","base","isKey","OnYtGifUrlBtn","deploy","mainAnimation","observer","getBlockID","key","targets","NodesRecord","timestampObj","target","grandParentBlock","blockID","Local","toggleClasses","s","e","fromObj","visualFeedback","check","obj","tm","getBoundaryObj","DispatchPlayPause","Event","settingsPageInit"],"mappings":"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"}