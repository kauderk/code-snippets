var __defProp=Object.defineProperty,__defNormalProp=(t,e,n)=>e in t?__defProp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,__publicField=(t,e,n)=>(__defNormalProp(t,"symbol"!=typeof e?e+"":e,n),n);!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";window.kauderk={},window.AvoidCircularDependency={},Element.prototype.queryAllasArr=Document.prototype.queryAllasArr=function(t){return Array.from(this.querySelectorAll(t)).map((t=>t))};const t=["mouseover"],e=async(t,e)=>{let n=await s(t);return n||(n=await c(t),e&&await l(n,0,e,o())),n},n=async(t,e=!1,n=!1)=>{try{const r=`[:find (pull ?page\n\t\t\t\t\t [:node/title :block/string :block/uid :block/heading :block/props \n\t\t\t\t\t  :entity/attrs :block/open :block/text-align :children/view-type\n\t\t\t\t\t  :block/order\n\t\t\t\t\t  ${e?"{:block/children ...}":""}\n\t\t\t\t\t  ${n?"{:block/parents ...}":""}\n\t\t\t\t\t ])\n\t\t\t\t  :where [?page :block/uid "${t}"]  ]`,i=await window.roamAlphaAPI.q(r);return 0==i.length?null:i}catch(r){return null}},r=async(t,e,n=!0)=>(t=t.replace("((","").replace("))",""),await window.roamAlphaAPI.updateBlock({block:{uid:t,string:e.toString(),open:n}})),i=t=>new Promise((e=>setTimeout(e,t))),a=async(t,e,n)=>window.roamAlphaAPI.moveBlock({location:{"parent-uid":t,order:e},block:{uid:n}}),o=()=>window.roamAlphaAPI.util.generateUID(),s=async t=>{const e=await window.roamAlphaAPI.q(`[:find (pull ?page [:block/uid])\n\t:where [?page :node/title "${t}"]]`);return e.length?e[0][0].uid:null},c=async t=>{let e=o();return await window.roamAlphaAPI.createPage({page:{title:t,uid:e}}),e},l=async(t,e,n,r)=>await window.roamAlphaAPI.createBlock({location:{"parent-uid":t,order:e},block:{string:n.toString(),uid:r}}),u=async t=>{let e=await window.roamAlphaAPI.q(`[:find (pull ?parent [* {:block/children [:block/string :block/uid :block/order]}]) :where [?parent :block/uid "${t}"]]`);return 0==e.length?void 0:e},d=t=>t.sort(((t,e)=>t.order-e.order)),p=async(t,e)=>await window.roamAlphaAPI.updateBlock({block:{uid:t,open:e}}),m=async t=>await window.roamAlphaAPI.q("[:find  (pull ?block [:block/uid :block/string])(pull ?page [:node/title :block/uid])\n\t\t\t\t\t\t\t\t\t :in $ [?block_uid_list ...] %\n\t\t\t\t\t\t\t\t\t :where\n\t\t\t\t\t\t\t\t\t  [?block :block/uid ?block_uid_list]\n\t\t\t\t\t\t\t\t\t [?page :node/title]\n\t\t\t\t\t\t\t\t\t (ancestor ?block ?page)]",t,"[[(ancestor ?b ?a)[?a :block/children ?b]][(ancestor ?b ?a)[?parent :block/children ?b ](ancestor ?parent ?a) ]]"),f=async t=>{try{t.startsWith("((")&&(t=(t=t.slice(2,t.length)).slice(0,-2));const e=await window.roamAlphaAPI.q(`\n\t\t  [:find (pull ?e [:block/string])\n\t\t\t  :where [?e :block/uid "${t}"]]`);return e.length>0&&null!=e[0][0]}catch(e){return""}},g=e=>{t.forEach((t=>e.dispatchEvent(new MouseEvent(t,{view:window,bubbles:!0,cancelable:!0,buttons:1}))))},y=async t=>{switch(t){case 1:document.querySelector(".rm-open-left-sidebar-btn")&&(g(document.getElementsByClassName("rm-open-left-sidebar-btn")[0]),setTimeout((async()=>{document.getElementsByClassName("rm-open-left-sidebar-btn")[0].click()}),100));break;case 2:if(!document.querySelector(".rm-open-left-sidebar-btn")){document.querySelector(".roam-sidebar-content .bp3-icon-menu-closed").click(),g(document.getElementsByClassName("roam-article")[0])}break;case 3:await window.roamAlphaAPI.ui.rightSidebar.open();break;case 4:await window.roamAlphaAPI.ui.rightSidebar.close()}},h=async t=>(await window.roamAlphaAPI.q(`[:find (pull ?b [:block/string]):where [?b :block/uid "${t}"]]`))[0]?.[0]?.string,b=" : ",_=" / ",w="checkbox",v="string",k="string",S="integer",A="boolean";function E(t=""){return{...I(),inlineObj:!0,string:t}}function I(t=""){return{...D(),join:_,inputType:"prompt",string:t}}function T(t){return D(t)}function O(t="",e){return{...F(),domEl:"",baseValue:t,inputType:e,inlineObj:!1}}function C(t="",e=""){return{...F(),domEl:"",baseValue:t,inputType:e}}function x(t="",e){return{...F(),baseValue:t,inputType:e,inlineObj:!1}}function F(t="",e){return{...D(e),baseValue:t,sessionValue:void 0,caputuredValue:"<>",join:b,inlineObj:!0,UpdateSettingsBlockValue:async function(){console.warn(`Update block not implemented... ${this.uid} ${this.string}`)}}}function D(t="",e=""){return{examined:!1,uid:"",parentKey:"",string:e,inputType:t,indent:0,child:0,order:0,inlineObj:!1}}const R={Workflow:{baseKey:I("BIP BOP . . ."),joins:E('either "ﾠ:ﾠ" for actual settings or "ﾠ/ﾠ" for prompt guidelines'),parameters:{baseKey:I("\n`(xxxuidxxx)` : `yt_gif_settings_key` : `<value>`"),uid:E("\n`(xxxuidxxx)`\nunique per user data base, without it the settings can't be written on this page"),key:E("\n`yt_gif_settings_key`\nsecond way to know which setting to change"),value:E("\n`<value>`\nin many cases optional and most of the time a binary switch, on - off")}},display:{baseKey:T(w),simulate_roam_research_timestamps:C(),ms_options:C("clip_lifespan_format",v),fmt_options:C("avoid_redundancy",v),yt_playback_speed:C("Default",v)},timestamps:{baseKey:T(v),tm_recovery:C("1",w),tm_seek_to:C("strict"),tm_restore:C("match"),tm_reset_on_removal:C("container"),tm_loop_hierarchy:C("disabled"),tm_loop_to:C("start"),tm_loop_options:C("skip,include_player"),tm_seek_action:C("disabled"),tm_workflow_display:C("default"),tm_workflow_grab:C("HMS"),tm_options:C("")},experience:{baseKey:T(v),initialize_mode:C("buffer"),awaiting_input_type:C("mouseenter"),xp_options:C("thumbnail_as_bg")},playerSettings:{baseKey:T(v),play_style:C("strict"),mute_style:C("strict"),fullscreen_style:C("disabled"),url_boundaries:C("strict"),url_volume:C("strict"),ps_options:C("mantain_last_active_player")},range:{baseKey:T("range"),timestamp_display_scroll_offset:{baseKey:O("5",S),tdso_opt:E("seconds up to 60")},end_loop_sound_volume:{baseKey:O("50",S),elsv_opt:E("integers from 0 to 100")},iframe_buffer_slider:{baseKey:O("10",S),ibs_opt:E("integers from 1 to 30")}},defaultPlayerValues:{baseKey:T(),player_span:{baseKey:x("50%",k),ps_opt:E("empty means 50% - only valid css units like px  %  vw"),pv_opt_2:E("each block's url parameter `&sp=` has priority over this")},player_volume:{baseKey:x(40,S),vv_opt:E("integers from 0 to 100"),pv_opt:E("each block's url parameter `&vl=` has priority over this")},player_interface_language:{baseKey:x("en",k),pil_opt:E("each block's url parameter `&hl=` has priority over this"),pli_guide:E("https://developers.google.com/youtube/player_parameters#:~:text=Sets%20the%20player%27s%20interface%20language.%20The%20parameter%20value%20is%20an%20ISO%20639-1%20two-letter%20language%20code%20or%20a%20fully%20specified%20locale.%20For%20example%2C%20fr%20and%20fr-ca%20are%20both%20valid%20values.%20Other%20language%20input%20codes%2C%20such%20as%20IETF%20language%20tags%20(BCP%2047)%20might%20also%20be%20handled%20properly.")},player_captions_language:{baseKey:x("en",k),pcl_opt:E("each block's url parameter `&cc=` has priority over this"),pcl_guide:E("https://developers.google.com/youtube/player_parameters#:~:text=This%20parameter%20specifies%20the%20default%20language%20that%20the%20player%20will%20use%20to%20display%20captions.%20Set%20the%20parameter%27s%20value%20to%20an%20ISO%20639-1%20two-letter%20language%20code.")},player_captions_on_load:{baseKey:x("true",A),pcol_guide:E("Browsers love to cash data... if set to -true- most certently you'll get caption on load, but it's hard to tell otherwise... Also, the mix and match of diferent `&hl=` and `&cc=` can cause to not show the captions on load")}},defaultValues:{baseKey:T(),override_roam_video_component:{baseKey:x("",[A,k]),orvc_opt:E('distinguish between `{{[[video]]:}}` from `{{[[yt-gif]]:}}` or "both" which is also valid')},end_loop_sound_src:{baseKey:x("https://freesound.org/data/previews/256/256113_3263906-lq.mp3","url"),elss_opt:E("src sound when yt gif makes a loop, empty if unwanted")},override_simulate_url_to_video_component:{baseKey:x("",A),orsuvc_opt:E("Because of browsers' external problems, I'd like to set this as the \"usage key\" replacement")},YT_API_KEY_V3:{baseKey:x("",k),yakv_opt:E("")},InAndOutKeys:{baseKey:x("ctrlKey",k),iaok_opt:E('Any permutation of: altKey, shiftKey, ctrlKey \nfollowed by a "," coma\n\nMiddle mouse button is on by default')}},dropdownMenu:{baseKey:T(),ddm_css_theme_input:{baseKey:x("",w),ct_opt:E('"dark" == "true" or "light" == "false"')}},LogStatus:{baseKey:I("Everything looks alright :D"),DisplacedBlocks:{baseKey:I("invalid -> settings block - deleted - deprecated\n**__If you encounter any nested blocks, it's extremely advisable that you delete them__**")},UnknownBlocks:{baseKey:I("... to the YT GIF SETTINGS PAGE script algorithm-functions")},ls_:E("End of settings")}};R.Workflow.baseKey.string=`The ${Object.keys(R).length} blocks will be -added on updates- and -removed if deprecated- automatically. The last parameters "<>" are customizable. 🐕 👋`;const B="roam/js/kauderk/yt-gif/other";let P=(t=>{const e=window.roamAlphaAPI.q(`[:find (pull ?page [:block/uid])\n\t:where [?page :node/title "${t}"]]`);return e.length?e[0][0].uid:null})(B);const M=t=>Object.keys(t);function L(t,e){if("object"!=typeof t)return t;"object"==typeof e&&null!==e||(e=new WeakMap);let n=e.get(t);if(void 0!==n)return n;let r=Object.getPrototypeOf(t).constructor;switch(r){case Boolean:case Error:case Function:case Number:case Promise:case String:case Symbol:case WeakMap:case WeakSet:n=t;break;case Array:e.set(t,n=t.slice(0)),n.forEach((function(t,r){"object"==typeof t&&(n[r]=L(t,e))}));break;case ArrayBuffer:e.set(t,n=t.slice(0));break;case DataView:e.set(t,n=new r(L(t.buffer,e),t.byteOffset,t.byteLength));break;case Map:case Set:e.set(t,n=new r(L(Array.from(t.entries()),e)));break;case Int8Array:case Uint8Array:case Uint8ClampedArray:case Int16Array:case Uint16Array:case Int32Array:case Uint32Array:case Float32Array:case Float64Array:e.set(t,n=new r(L(t.buffer,e),t.byteOffset,t.length));break;case Date:case RegExp:e.set(t,n=new r(t));break;default:for(r in e.set(t,n=Object.assign(new r,t)),n)"object"==typeof n[r]&&(n[r]=L(n[r],e))}return n}const U=t=>{if(!t.el)return null;const e=new MutationObserver((async function(e,n){for(const r of e){const e=Array.from(r.removedNodes),i=e.indexOf(t.el)>-1,a=e.some((e=>e.contains(t.el)));i?(n.disconnect(),t.directMatch?await t.OnRemovedFromDom_cb(n):console.log(`node ${t.el} was directly removed!`)):a&&(await t.OnRemovedFromDom_cb(n),n.disconnect())}}));return e.observe(document.body,{subtree:!0,childList:!0}),e},j=t=>{if(t.includes("@")){let e=t.split(" > ");for(let t=0;t<e.length;t++){if(!e[t].includes("@"))continue;const n=new RegExp(/(@.*)\.com/,"gm"),r=n.exec(e[t])?.[1];e[t]=e[t].replace(n,`\\${r}\\.com`)}t=e.join(" > ")}return t},V=(t,e)=>{let n=document.createElement(e);for(;t.firstChild;)n.appendChild(t.firstChild);for(let r=0,i=t.attributes,a=i.length;r<a;r++)n.attributes[i[r].name]=i[r].value;return t.parentNode?.replaceChild(n,t),n},q=t=>{if(/:/.test(t)){let e=t.split(":"),n=0,r=1;for(;e.length>0;)n+=r*parseInt(e.pop(),10),r*=60;return n}if(/h|m|s/.test(t)){return t.split(/(?<=h)|(?<=m)|(?<=s)/).reduce(((t,e)=>{let n=parseInt(e)||0;return/s/.test(e)?n+t:/m/.test(e)?60*n+t:/h/.test(e)?3600*n+t:t}),0)}return parseFloat(t)},K=(t,e,n)=>{t?n.classList.add(...e):n.classList.remove(...e)},N=t=>{t.style.backgroundImage="none"},G=()=>ct("mouseenter"),Y=(t,e)=>{t.style.backgroundImage=`url(${yt(e)})`},H=t=>{switch("string"==typeof t&&(t=t.trim().toLowerCase()),t){case!0:case"true":case 1:case"1":case"on":case"yes":return!0;default:return!1}};function W(t,e){return[...t].sort(((t,n)=>Math.abs(t-e)-Math.abs(n-e)))[0]}const z=t=>new Promise((e=>setTimeout(e,t))),Q=t=>{const e=getComputedStyle(t);if("none"===e.display)return!1;if("visible"!==e.visibility)return!1;if(0===e.opacity)return!1;if(t.offsetWidth+t.offsetHeight+t.getBoundingClientRect().height+t.getBoundingClientRect().width===0)return!1;let n={center:{x:t.getBoundingClientRect().left+t.offsetWidth/2,y:t.getBoundingClientRect().top+t.offsetHeight/2},"top-left":{x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().top},"top-right":{x:t.getBoundingClientRect().right,y:t.getBoundingClientRect().top},"bottom-left":{x:t.getBoundingClientRect().left,y:t.getBoundingClientRect().bottom},"bottom-right":{x:t.getBoundingClientRect().right,y:t.getBoundingClientRect().bottom}};for(let r in n){let e=n[r];if(e.x<0)return!1;if(e.x>(document.documentElement.clientWidth||window.innerWidth))return!1;if(e.y<0)return!1;if(e.y>(document.documentElement.clientHeight||window.innerHeight))return!1;let i=document.elementFromPoint(e.x,e.y);if(null!==i)do{if(i===t)return!0}while(i=i.parentNode)}return!1},J=(t,e,n,r="")=>{t?n.setAttribute(e,r):n.removeAttribute(e)},X=t=>t?.closest(".rm-block__input")?.id,Z=t=>{const e=rt(t);return j(e)};const tt=(t=Array(),e)=>(t.push(e),t),et=t=>{const e=parseInt(t.toString(),10);let n=Math.floor(e/3600),r=Math.floor((e-3600*n)/60),i=e-3600*n-60*r;return n<10&&(n="0"+n),r<10&&(r="0"+r),i<10&&(i="0"+i),n+":"+r+":"+i},nt=(t,e)=>{const n=Math.floor(t/3600);let r=Math.floor((t-3600*n)/60);const i=t-3600*n-60*r;let a="";const o=e?"m":":",s=e?"s":"",c=e?"":"0";if(0!=n&&(a=n+(e?"h":":")),!e||r>0){a+=(r<10?c+r:String(r))+o}return""===a?a=i+s:(!e||i>0)&&(a+=i<10?c+i:String(i),a+=s),a},rt=t=>{let e,n=["name","value","title","placeholder","data-*"],r=[],i=function(t){if(t.id)return r.unshift("#"+t.id),!0;if(r.unshift(e=t.nodeName.toLowerCase()),t.className&&(r[0]=e+="."+t.className.trim().replace(/ +/g,"."),a()))return!0;for(const s of n)if("data-*"===s){const n=[].filter.call(t.attributes,(function(t){return 0===t.name.indexOf("data-")}));for(const t of n)if(r[0]=e+="["+t.name+'="'+t.value+'"]',a())return!0}else if(t[s]&&(r[0]=e+="["+s+'="'+t[s]+'"]',a()))return!0;let i=t,o=1;for(;i=i.previousElementSibling;)i.nodeName===t.nodeName&&++o;if(r[0]=e+=":nth-of-type("+o+")",a())return!0;for(i=t,o=1;i=i.previousElementSibling;)++o;return r[0]=e=e.replace(/:nth-of-type\(\d+\)/,o>1?":nth-child("+o+")":":first-child"),!!a()},a=function(){return 1===document.querySelectorAll(r.join(">")).length};for(;t.parentNode;){if(i(t))return r.join(" > ");t=t.parentNode}},it=t=>{const e=t.split(/(vi\/|v=|\/v\/|youtu\.be\/|\/embed\/)/);return void 0!==e[2]?e[2].split(/[^0-9a-z_\-]/i)[0]:e[0]},at=async t=>{const e=await gt(t);return ot(e)},ot=t=>{const e=new RegExp(">[\ts\n ]*<","g");return t.replace(e,"><")},st=t=>!t.closest("[class*='rm-zoom']"),ct=t=>new MouseEvent(t,{view:window,bubbles:!0,cancelable:!0}),lt=()=>ct("mouseleave"),ut=(t=Array())=>dt(t,"div"),dt=(t=Array(),e)=>{const n=document.createElement(e);return n.classList.add(...t),n},pt=t=>{for(const e of t)e.replaceWith(e.cloneNode(!0))},mt=t=>t+"?"+(new Date).getTime(),ft=async t=>{try{const e=await fetch(t,{cache:"no-store"});if(!e.ok)throw new Error("Request failed.");return[e,null]}catch(e){return console.log(`Your custom link ${t} is corrupt. ;c`),[null,e]}},gt=async t=>{const[e,n]=await ft(mt(t));if(e)return await e.text()},yt=(t,e)=>{if(t){let n,r;if(((r=t.match(/youtube\.com.*(\?v=|\/embed\/)(.{11})/))||(r=t.match(/youtu.be\/(.{11})/)))&&(n=r.pop()),n){void 0===e&&(e="high");let t="maxresdefault";return"low"==e?t="sddefault":"medium"==e?t="mqdefault":"high"==e&&(t="hqdefault"),"https://img.youtube.com/vi/"+n+"/"+t+".jpg"}}return!1};class ht{constructor(){__publicField(this,"parentKey",""),__publicField(this,"indent",-1),__publicField(this,"accStr",""),__publicField(this,"nextStr",""),__publicField(this,"inputTypeFromBaseKey",""),__publicField(this,"accKeys",[])}}async function bt(t,e,n){let{accStr:r}=e,i=-1;const{nextStr:a,indent:o}=e;r=r+"\n"+"\t".repeat(o<0?0:o)+a;for(const s in t){const a=t[s];if(!kt(t,a,s))continue;const c={parentKey:s,indent:o+1,inputTypeFromBaseKey:a?.baseKey?.inputType,accStr:r,nextStr:a.string||""};"baseKey"!=s&&n.set(s,vt(a,e)),r=await bt(t[s],c,n);const l=()=>({indent:c.indent,order:Number(++i)});null!=a.baseKey?wt(a,l()):1==a.inlineObj&&_t(a,{...l(),inputTypeFromBaseKey:e.inputTypeFromBaseKey})}return r}function _t(t,e){t.order=e.order,t.indent=e.indent,t.inputType=t.inputType?t.inputType:e.inputTypeFromBaseKey}function wt(t,e){t.baseKey.order=e.order,t.baseKey.indent=e.indent}function vt(t,e){const n=t?.baseKey?t.baseKey:t;return n.parentKey=e.parentKey||B,n.UpdateSettingsBlockValue&&(n.UpdateSettingsBlockValue=function(t){return async function(e){const n=new RegExp(/<(.*?)>/,"gm"),i=t.string.replace(n,`<${e}>`);i!=t.string&&(t.string=i,t.sessionValue=e,await r(t.uid,t.string))}}(n)),n}function kt(t,e,n){return t.hasOwnProperty(n)&&e&&"object"==typeof e&&!(e instanceof Array)}function St(t,e,n){return Object.assign(t,{examined:!0,uid:n,string:e})}Array.prototype.Last=function(){return this[this.length-1]};class At{constructor(){__publicField(this,"accStr",""),__publicField(this,"nextStr",""),__publicField(this,"accKeys",[]),__publicField(this,"accHierarchyUids",[]),__publicField(this,"parentKey",""),__publicField(this,"tab",""),__publicField(this,"appenAccStr",Dt)}}async function Et(t){const e=new At;return await It(t,e)}async function It(t,e){let{accStr:n}=e;n=e.appenAccStr();let r=Array();for(const i in t){let a=t[i];if(!Ot(a,i,t))continue;"baseKey"==i&&(0==a.examined&&(a=await Tt(a,e)),r=[...r,a?.uid]);const o={parentKey:i,accKeys:[...e.accKeys,i],accHierarchyUids:[...e.accHierarchyUids,...r],accStr:n,nextStr:a.string||"",appenAccStr:Dt,tab:""};n=await It(t[i],o),0==a.examined&&(a=await Ct(o,a,r.Last()))}return n}async function Tt(t,e){let n;const r=e.parentKey;n=null!=t.baseValue?Ft(t):t.string;const i={m_uid:e.accHierarchyUids.Last()||P,m_strArr:n?[r,n]:[r],m_order:t.order};return t=await xt(t,i)}function Ot(t,e,n){return n.hasOwnProperty(e)&&"object"==typeof n[e]&&null!=n[e]&&!(t instanceof Array)}async function Ct(t,e,n){const r={m_uid:n,m_strArr:[t.accKeys.Last(),Ft(e)],m_order:e.order};return e=await xt(e,r)}async function xt(t,e){const{m_order:n,m_uid:r,m_join:s,m_strArr:c}=e,{uid:l,string:u}=function(t,e=" : "){const n=o(),r=[`(${n})`,...t].join(e);return{uid:n,string:r}}(c,s||t.join),{order:d}=t;return await(async(t,e,n,r=!1)=>{t=t.replace("((","").replace("))","");let a=r||await window.roamAlphaAPI.util.generateUID();return await window.roamAlphaAPI.createBlock({location:{"parent-uid":t,order:e},block:{string:n.toString(),uid:a}}),await i(10),{uid:a,parentUid:t,order:e,string:n}})(r||P,n||d||1e4,u,l),await async function(t,e,n){const r=n.order,i=n.uid;try{if(t==i)throw new Error(`STOP! Don't move block to itself =>         ${t} ${n.string}`);e!=r&&await a(t,r,i)}catch(o){}}(r,n,t),St(t,u,l)}function Ft(t){if(t.join==b){const e=t.sessionValue=t.baseValue;return t.caputuredValue=`<${e}>`}return t.string}function Dt(){return this.accStr+"\n"+this.nextStr}class Rt{constructor(){__publicField(this,"keyFromLevel0",""),__publicField(this,"selfOrder",0)}}class Bt{constructor(){__publicField(this,"accStr",""),__publicField(this,"keyObjMap",new Map),__publicField(this,"pendingBLocks2Displace",[]),__publicField(this,"singleKeyEntries",[])}}async function Pt(t,e=new Map){e.set(B,{uid:P});const r=await n(t,!0),i=new Rt;let a={...new Bt,keyObjMap:e};return r?(a=await $t(r[0][0],i,a),a.pendingBLocks2Displace):(console.error(`No ChildrenHierarchy for uid: ${t}`),a.pendingBLocks2Displace)}async function $t(t,e,n){const r=t.string||t.title||"";let i={displaced:!1,overrideKey:null};const a=function(t){const e=new RegExp(/\(([^\)]+)\)/,"gm"),n=function(t,e){const n=e.filter((e=>t.includes(e)));return n.length>0?n[0]:b}(t,[_,b]),r=t.split(n),i=r.map((t=>t.split(" ")[0])),a=e.exec(i[0])?.[1],{value:o,caputureValueOk:s}=function(t){const e=t.substring(0,1),n=t.substring(t.length-1,t.length);if("<"==e&&">"==n)return{value:t.substring(1,t.length-1),caputureValueOk:!0};return{value:t,caputureValueOk:!1}}(i[2]||"");return{uid:a,key:i[1],caputuredValue:i[2],value:o,caputureValueOk:s,splitedStrArr:r,join:n}}(r),o={...a,nextStr:r,crrUID:t.uid},s={...a},c={uid:()=>a.uid,indent:()=>u.indent,get:()=>i,accObj:()=>e},l={key:a.key,map:n.keyObjMap,has:t=>n.keyObjMap.has(t??l.key),get:t=>n.keyObjMap.get(t??l.key),crrUID:t.uid},u=await async function(t){const e="\t";let n={indent:0,parentUid:""};if(t.has()){const e=t.get();n=t.map.has(e.parentKey)?function(t,e){return{indent:t.indent,parentUid:e.get(t.parentKey)?.uid??""}}(e,t):await Mt(t.crrUID)}n.parentUid||(n=await Mt(t.crrUID));return{tab:e.repeat(n.indent),...n}}(l),d=await async function(t,e,n,r,i){const a={success:!1,outKey:t.key,outUid:t.crrUID};if(t.key&&e.includes(t.key)&&t.has()){const e=`${t.key}`.concat("_InvalidDuplicate"),o=await Lt(e,n);return r.string=o,i.overrideKey=e,r.overrideKey=e,{block:null,credentials:{...a,outKey:e}}}e.push(t.key);const o=t.get();return o&&t.key!=B?{block:o,credentials:null}:{block:null,credentials:a}}(l,n.singleKeyEntries,o,t,i),p=d.credentials??await async function(t,e,n){const{key:r,nextStr:i,uid:a,crrUID:o,join:s,splitedStrArr:c}=t;let l=i;const{v_uid:u,uidOk:d}=await async function(t,e){const n=t==e;return{uidOk:n,v_uid:n?t:e}}(a,o),{v_string:p,stringOK:m}=await async function(t,e){const n=e[2]||"";let r=n,i=!0;if(t.string!=n&&t.join==_){if(""!=t.uid||t.string.includes(" / ")||null!=e[3])throw new Error("YT GIF Settings Page: STOP! the string is invalid or was already set...");r=t.string,i=!1}return{v_string:r,stringOK:i}}(n,c);d&&m||(l=await Lt(r,t,p));St(n,l,u),s==b&&n.hasOwnProperty("sessionValue")&&Object.assign(n,function(t,e){e.sessionValue=t.value,e.caputuredValue=t.caputuredValue,e.inputType==S&&(e.sessionValue=parseInt(e.sessionValue,10));return e}(e,n));return{success:!0,outKey:r,outUid:u}}(o,s,d.block);if(d.block){const t=function(t,e){const n=function(t,e){return t.indent==e.indent()&&e.accObj().selfOrder==t.order&&e.accObj().keyFromLevel0==t.parentKey}(t,e);n&&(e.get().displaced=!0);return n}(d.block,c);n.pendingBLocks2Displace.push((async()=>async function(t,e,n,r){const i=t?n.uid():r.get(e.parentKey)?.uid;0==n.get().displaced&&(await Ut(i,e.order,e.uid),n.accObj().keyFromLevel0!=e.parentKey&&await Ut(r.get(e.parentKey)?.uid,e.order,e.uid))}(t,d.block,c,l)))}if(p.success)n.accStr=n.accStr+"\n"+u.tab+r;else if((m=p).outUid!=P&&m.outKey!=B){const t=function(t,e,n,r){if(!t)throw new Error("YT GIF Settings Page: STOP! a future block will try to move to an undefined place");let i=null;if("LogStatus"==e.accObj().keyFromLevel0)return null;"DisplacedBlocks"!=e.accObj().keyFromLevel0&&r.key?i=async()=>Ut(r.get("DisplacedBlocks")?.uid,0,t):"UnknownBlocks"==e.accObj().keyFromLevel0||n.nextStr.includes(n.join)||(i=async()=>Ut(r.get("UnknownBlocks")?.uid,0,t));return e.get().displaced=!0,i}(p.outUid,c,o,l);t&&n.pendingBLocks2Displace.push(t)}var m;for(const f of t.children??[]){const e={keyFromLevel0:t.overrideKey||a.key||B,selfOrder:f.order};n=await $t(f,e,n)}return n}async function Mt(t){let e=await(async t=>{try{const e=(await window.roamAlphaAPI.q("[:find (pull ?block [{:block/parents [:block/uid]}]) :in $ [?block-uid ...] :where [?block :block/uid ?block-uid]]",[t])[0][0]).parents.map((t=>t.uid));return e.shift(),m(e)}catch(e){return null}})(t);return{indent:e?.length??0,parentUid:e?e[0]?.[0].uid:P}}async function Lt(t,e,n){const{nextStr:a,uid:o,crrUID:s,join:c,splitedStrArr:l}=e;l.splice(0,1,`(${s})`),l.splice(1,1,t),n&&l.splice(2,1,n);const u=l.join(c||_);return await r(s,u),await i(50),console.log(`Updating block  ((${o})) -> \n ${a} \n\nto ((${s})) -> \nﾠ\n${u}`),u}async function Ut(t,e,n){try{if(t&&n&&t==n)throw new Error(`YT GIF Settings Page: STOP! Don't move block to itself =>         ${t} ${n}`);if(!t)return;a(t,e,n)}catch(r){}}async function jt(){const t=await async function(t){const e=new Map,n=new ht,r=L(t);return{pageAsText:await bt(r,n,e),keyObjMap:e,page:r}}(R);if(P){const e=await Pt(P,t.keyObjMap);await Et(t.page);for(const t of e)await t()}else await async function(){P=await e(B)}(),await Et(t.page),await(async t=>{await window.roamAlphaAPI.updateBlock({block:{uid:t,"children-view-type":"numbered"}})})(P),await(async(t,e)=>{const n=await u(t),r=d(n[0][0].children);for(const i of r)await p(i.uid,e)})(P,!1);return window.YT_GIF_DIRECT_SETTINGS=t.keyObjMap,t.page}window.YT_GIF_DIRECT_SETTINGS=new Map;const Vt=t=>`https://kauderk.github.io/yt-gif-extension/resources/${t}`,qt=t=>`https://kauderk.github.io/yt-gif-extension/v0.2.0/${t}`,Kt=t=>Vt(`css/${t}`),Nt=t=>Vt(`js/${t}`),Gt={css:{dropDownMenuStyle:Kt("drop-down-menu.css"),playerStyle:Kt("player.css"),themes:{dark:Kt("themes/dark-drop-down-menu.css"),light:Kt("themes/light-drop-down-menu.css"),get:function(t){return this.toogle(!H(t))},toogle:function(t){return H(t)?this.dark:this.light}}},html:{dropDownMenu:qt("html/drop-down-menu.html"),playerControls:qt("html/player-controls.html"),urlBtn:qt("html/url-btn.html"),anchor:qt("html/yt-gif-anchor.html"),insertOptions:qt("html/insert-options.html"),fetched:{playerControls:"",urlBtn:"",anchor:"",insertOptions:""}},js:{utils:Nt("js"),roamAlphaApi:Nt("utils-roam-alpha-api.js"),settingsPage:qt("js/settings-page.js"),main:qt("js/yt-gif-main.js")},help:{github_isuues:"https://github.com/kauderk/kauderk.github.io/issues"}},Yt={yt_gif:"yt-gif",yt_gif_wrapper:"yt-gif-wrapper",yg_wrapper_p:"yt-gif-wrapper-parent",yt_gif_iframe_wrapper:"yt-gif-iframe-wrapper",yt_gif_timestamp:"yt-gif-timestamp",yt_gif_audio:"yt-gif-audio",yt_gif_custom_player_span_first_usage:"ty-gif-custom-player-span-first-usage",awiting_player_pulse_anim:"yt-gif-awaiting-palyer--pulse-animation",awaitng_player_user_input:"yt-gif-awaiting-for-user-input",awaitng_input_with_thumbnail:"yt-gif-awaiting-for-user-input-with-thumbnail",ddm_icon:"ty-gif-icon",dwn_no_input:"dropdown_not-allowed_input",dropdown_fadeIt_bg_animation:"dropdown_fadeIt-bg_animation",dropdown_forbidden_input:"dropdown_forbidden-input",dropdown_allright_input:"dropdown_allright-input",dropdown__hidden:"dropdown--hidden",dropdown_deployment_style:"dropdown_deployment-style",dwp_message:"dropdown-info-message",ddm_info_message_selector:".dropdown .dropdown-info-message",dwn_pulse_anim:"drodown_item-pulse-animation",ddm_exist:"yt-gif-drop-down-menu-toolbar",ddm_focus:"dropdown-focus",stt_allow:"settings-not-allowed",ditem_allow:"dropdown-item_not-allowed_input",p_controls:"yt-gif-controls",ddn_tut_awaiting:"ddm-tut-awaiting-input",id:{navigate_btn:"#navigate-to-yt-gif-settings-page",toogle_theme:"#yt-gif-ddm-theme",ddm_main_theme:"#yt-gif-ddm-main-theme"},raw_anchorSel:"rm-xparser-default-anchor"},Ht={"initialize-mode":"","timestamp-experience":"","timestamp-loop-opt":"",ms_options:"",fmt_options:""},Wt={path:"data-video-url",index:"data-video-index"},zt="data-target",Qt={name:"data-creation",forceAwaiting:"force-awaiting",cleaning:"cleaning",displaced:"displaced",buffer:"buffer"},Jt={mute:"yt-mute",unMute:"yt-unmute"},Xt={playing:"yt-playing",paused:"yt-paused"};function Zt(t,...e){return Array.from(t.selectedOptions).find((t=>e.includes(t.value)))}function te(t,e){return Array.from(t.options).find((t=>t.value==e))}class ee{}function ne(t,e){return"_"+[t,e].join("_")}function re(t){return`{{(\\[\\[)?(${t})((?=:):|[^:|\\/]+?(:))(|[^{]+)}}`}function ie(t=ee.componentPage,e){const n=new RegExp(re(t),"gm"),r=ee.targetStringRgx,i=/\[(.*?(?=\]))]\(\(\((.*?(?=\)))\)\)\)/gm,a=/{{=:(.+?)\|([^}]*)/gm,o=/(?<=\(\()([^(].*?[^)])(?=\)\))/gm,s=[a,n,r,i,o];e&&s.push(e);return{blockRgx:s.reduce(((t,e,n,r)=>new RegExp("(?:)"!=t.source?t.source+"|"+e.source:e.source,"gm")),new RegExp),aliasPlusUidsRgx:i,tooltipCardRgx:a,anyPossibleComponentsRgx:r,componentRgx:n,anyUidRgx:o}}function ae(t,e){const n=se(t)?.exec(e)?.[2];return n?oe(n):0}function oe(t){if(/[hms]/.test(t)){return t.split(/(?<=h)|(?<=m)|(?<=s)/).reduce(((t,e)=>{const n=parseInt(e)||0;return/s/.test(e)?n+t:/m/.test(e)?60*n+t:/h/.test(e)?3600*n+t:t}),0)}return parseFloat(t)}function se(t,e="gm"){return new RegExp(`((?:${t})=)(([^&]+))`,e)}function ce(t,e=Qt.name,n=""){const r=t.getAttribute(`${zt}`),i=Z(t.parentNode);t.parentNode?.removeChild(t);const a=ut([r]);return J(!0,e,a,n),document.querySelector(i)?.appendChild(a),a}__publicField(ee,"componentPage","[^:]+"),__publicField(ee,"targetStringRgx",/{{([^}]*)/gm);let le={};let ue;const de=t=>ue=t,pe={masterMutationObservers:Array(),masterIntersectionObservers:Array(),masterIntersectionObservers_buffer:Array(),masterIframeBuffer:Array(),timestampObserver:null,keyupEventHandler:t=>{},creationCounter:-1,CleanMasterObservers:function(){const t=r(this.masterMutationObservers);this.masterMutationObservers=t.observer;const e=r(this.masterIntersectionObservers);this.masterIntersectionObservers=e.observer;const n=r(this.masterIntersectionObservers_buffer);function r(t){let e=0;for(let n=t.length-1;n>=0;n--)t[n].disconnect(),t.splice(n,1),e++;return{observer:t,counter:e}}this.masterIntersectionObservers_buffer=e.observer,console.log(`${t.counter} mutation, ${e.counter} intersection and ${n.counter} iframe buffer master observers cleaned`)},CleanLoadedWrappers:function(){const t=document.queryAllasArr(`[${zt}]`);for(let e=t.length-1;e>=0;e--)ce(document.querySelector(Z(t[e])),Qt.name,Qt.cleaning)},dmm_html:window.ddm_html};function me(t){return le=JSON.parse(JSON.stringify(Object.assign(t,{deploymentStyle:{suspend_yt_gif_deployment:"",deployment_style_yt_gif:"1",deployment_style_video:"",deployment_style_both:"",deploy_yt_gifs:""}})))}function fe(){return window.YT.PlayerState}function ge(t){this.value="function"==typeof t?t(this.value):t}function ye(t){this.value=t,this.default=t}window.YT_GIF_OBSERVERS=window.YT_GIF_OBSERVERS?window.YT_GIF_OBSERVERS:pe;class he{constructor(t,e){__publicField(this,"value"),__publicField(this,"alias"),__publicField(this,"set",ge),this.value=e?.value??t,this.alias=e?.alias??[]}}class be extends he{constructor(t){super(0,t),__publicField(this,"update",this.value),__publicField(this,"history",[])}}class _e extends he{constructor(t){super(0,t),__publicField(this,"default",this.value),__publicField(this,"setDefault",ye)}}class we extends he{constructor(t){super("",t)}}class ve extends he{constructor(t){super(!1,t)}}class ke{constructor(){__publicField(this,"id",new we({value:"---------"})),__publicField(this,"src",new we({value:"https://www.youtube.com/embed/---------?"})),__publicField(this,"speed",new _e({value:1,alias:["s"]})),__publicField(this,"start",new _e({alias:["t"]})),__publicField(this,"end",new _e),__publicField(this,"updateTime",new _e),__publicField(this,"timestamps",new be),__publicField(this,"volume",new be({value:window.YT_GIF_DIRECT_SETTINGS.get("player_volume")?.sessionValue,alias:["vl"]}))}}class Se extends ke{constructor(){super(...arguments),__publicField(this,"hl",new we),__publicField(this,"cc",new we),__publicField(this,"sp",new we),__publicField(this,"mute",new ve),__publicField(this,"playRightAway",new ve)}}const Ae=()=>(console.warn("Not implemented"),{});class Ee{constructor(t){__publicField(this,"wTarget"),__publicField(this,"uid",""),__publicField(this,"seekToUpdatedTime",Ae),__publicField(this,"sameBoundaries",Ae),__publicField(this,"isSoundingFine",Ae),__publicField(this,"togglePlay",Ae),__publicField(this,"bounded",Ae),this.wTarget=t}}class Ie{constructor(t){__publicField(this,"t"),__publicField(this,"ytgif"),__publicField(this,"GetIframeID",(()=>this.t.i?.id||this.t.g?.id||this.t.getIframe()?.id)),__publicField(this,"GetVideoID",(()=>this.t.j.i.videoId)),__publicField(this,"GetVars",(()=>this.t.j.i.playerVars)),__publicField(this,"ApiIsWorking",(()=>this.t.seekTo)),__publicField(this,"WhileApiHolds",(async(t,e=500)=>{for(;n=t,document.body.contains(n)&&isNaN(this.t?.getCurrentTime?.());)await z(e);var n})),__publicField(this,"loadVideoById",(t=>this.t.loadVideoById(t))),__publicField(this,"getDuration",(()=>this.t.getDuration())),__publicField(this,"setVolume",(t=>this.t.setVolume(t))),__publicField(this,"getVolume",(()=>this.t.getVolume())),__publicField(this,"seekTo",(t=>this.t.seekTo(t))),__publicField(this,"getCurrentTime",(()=>this.t.getCurrentTime())),__publicField(this,"getPlayerState",(()=>this.t.getPlayerState())),__publicField(this,"setPlaybackRate",(t=>this.t.setPlaybackRate(t))),__publicField(this,"getPlaybackRate",(()=>this.t.getPlaybackRate())),__publicField(this,"setPlayerState",(t=>this.t.playerInfo.playerState=t)),__publicField(this,"playVideo",(()=>this.t.playVideo())),__publicField(this,"pauseVideo",(()=>this.t.pauseVideo())),__publicField(this,"unMute",(()=>this.t.unMute())),__publicField(this,"mute",(()=>this.t.mute())),__publicField(this,"getIframe",(()=>this.t.getIframe())),__publicField(this,"destroy",(()=>this.t.destroy())),__publicField(this,"getAvailablePlaybackRates",(()=>this.t.getAvailablePlaybackRates())),this.t=t,t.ytgif??(t.ytgif=new Te),this.ytgif=t.ytgif}DestroyTarget(){this.t&&(this.ytgif.enter=()=>{},this.t.destroy())}setOnStateChange(t){this.t.m.i[5]=t}}class Te{constructor(){__publicField(this,"previousTick",0),__publicField(this,"timers",Array()),__publicField(this,"timerID",0),__publicField(this,"globalHumanInteraction",!1)}ClearTimers(){if(window.clearInterval(this.timerID),this.timerID=0,0!=this.timers.length){for(const t of this.timers)clearInterval(t);this.timers=[]}}PushSingleInterval(t,e=1e3){this.ClearTimers(),this.timerID=window.setInterval(t,e),this.timers.push(this.timerID)}enter(){}}const Oe=new Map,Ce=new Map,xe=new Map,Fe=new Map,De=new Map,Re=new Map,Be=new Map,Pe="simulate_url_formatter";class $e{}__publicField($e,"componentPage","yt-gif\\/(start|end)"),__publicField($e,"targetStringRgx",/(\d+h)(\d+m)|(\d+h)?(\d+m)?(\d+s)|(\d+m)|(\d+h)|((\d{1,2}):)?((\d{1,2}):)((\d{1,2}))|(\d+(?:(\.\d{1})|(?=\s|\}|\w+|$)))/);class Me{}__publicField(Me,"componentPage","yt-gif|video"),__publicField(Me,"targetStringRgx",/https\:\/\/(www\.)?(youtu(be.com\/watch|.be\/))?(.*?(?=\s|$|\}|\]|\)))/),__publicField(Me,"minimalRgx",/(?<!\S)\/[^:|\s|}|\]|\)]{11,}/),__publicField(Me,"guardClause",(t=>"string"==typeof t&&!!t.match("https://(www.)?youtube|youtu.be")));class Le{}__publicField(Le,"componentPage",ee.componentPage),__publicField(Le,"scatteredMatch",!0),__publicField(Le,"targetStringRgx",Me.targetStringRgx);const Ue=ie("yt-gif/anchor|yt-gif");class je{}__publicField(je,"componentPage","yt-gif/anchor|yt-gif"),__publicField(je,"componentRgx",Ue.componentRgx),__publicField(je,"uidRefRgx",new RegExp(`\\(\\(${Ue.anyUidRgx.source}\\)\\)`,"gm")),__publicField(je,"targetStringRgx",new RegExp(`${Me.targetStringRgx.source}|${Ue.anyUidRgx.source}`,"gm"));const Ve=new ke,qe=new Ee;async function Ke(t,e,n){const r=[];for(const{addedNodes:i}of t)for(const t of Array.from(i))t.tagName&&(t.classList.contains(e)?r.push(t):t.firstElementChild&&r.push(...t.getElementsByClassName(e)));for(const i of r)st(i)&&n(i)}function Ne(t){return t?t.closest(".rm-block__input"):null}function Ge(t){return document.body.contains(t)}function Ye(t,e=!1){let n=t;return e&&(n=Ne(t)),n?.id?.slice(-9)}function He(t){return Zt(le.timestamps.tm_options,"anchor")?We(t):ze(t)}function We(t){const e=t=>t?.closest("[yt-gif-anchor-container]")??null,n=ze(t),r=e(t);return n?.getAttribute("yt-gif-block-uid")==(t=>t?.getAttribute("yt-gif-anchor-container"))(e(n))?e(n):n||r}function ze(t){return t?.closest(".roam-block-container")??null}function Qe(t){return(Ne(t)||t?.closest(".dwn-yt-gif-player-container"))?.id}function Je(t,e=""){const n=t?.getAttribute(Wt.path),r=t?.getAttribute(Wt.index);return e+ne(n,r)}function Xe(t,e){return t?t.queryAllasArr(e).filter((e=>Ne(e)?.id==t.id)):[]}const Ze={inline:{is:"a.rm-alias.rm-alias--block",from:".rm-alias-tooltip__content"},card:{is:".rm-block__part--equals",from:".bp3-card"}},tn=function(t){return document.querySelector(`.bp3-popover-open > ${t}`)},en=function(t){return function(){return t.closest(`div.bp3-popover-content > ${this.from}`)&&this.uidCondition()}},nn=function(){return Ne(this.el.closest(".bp3-popover-open"))},rn=function(){return Ne(this.el)},an=function(){return this.uid=Ye(this.grandParentBlock())},on={urlComponents:function(){return[...Array.from(this.grandParentBlock().querySelectorAll(this.targetSelector))]},getUrlIndex:function(){return this.urlComponents().indexOf(this.el)}};function sn(t){return{uid:"irrelevant-uid",url:"",el:t,targetSelector:["[data-video-url]"].join(),condition:function(){return this.url=this.el.getAttribute(Wt.path)||""},grandParentBlock:function(){return this.el.closest(".dropdown-content")}}}function cn(t){return{uid:"",url:"",el:tn(Ze.inline.is),targetSelector:[Ze.inline.is].join(),from:Ze.inline.from,grandParentBlock:nn,uidCondition:an,condition:en(t)}}function ln(t){return{uid:"",url:"",el:tn(Ze.card.is),targetSelector:[Ze.card.is].join(),from:Ze.card.from,grandParentBlock:nn,uidCondition:an,condition:en(t)}}function un(t){return{uid:"",url:"",targetSelector:[[...window.AvoidCircularDependency.getCurrentClassesToObserver()].map((t=>"."+t)),".yt-gif-wrapper"].join(),el:t,condition:an,grandParentBlock:rn,...on}}async function dn(t){return pn(t,Re,mn,t,Me)}async function pn(t,e,n,...r){if(!t)throw new Error("invalid uid|key while trying to call getComponentMap");return e.has(t)||e.set(t,await n(...r)),e.get(t)}async function mn(t,e){let n=Array(),r=0;const{componentPage:i,targetStringRgx:a,scatteredMatch:o}=e;class s{constructor(){__publicField(this,"order",-1),__publicField(this,"incrementIf",(t=>t?Number(++this.order):null)),__publicField(this,"condition",(t=>!1))}}class c{constructor(){__publicField(this,"is tooltip card",new s),__publicField(this,"is substring",new s),__publicField(this,"is component",new s),__publicField(this,"is alias",new s),__publicField(this,"is block reference",new s)}}const l=new c;return async function e(i,a,o){for(const n of i?.targetStringsWithUids){const{value:c,is:l}=n,p=()=>s(i.uid,r,n);if(["is alias","is component","is substring"].some((t=>t===l)))o.set(p(),c);else if("is tooltip card"===l){const{tooltipKey:t,tooltipObj:n}=u(c,i,p),r=await e(n,a,new Map);o.set(t,r)}else if("is block reference"==l){a.uidHierarchy=tt(a.uidHierarchy,c);const n=a?.uid==c,s=a?.blockReferencesAlone?.includes(c)||c==t,u=r>a?.uidHierarchy?.length;if(n||u&&s)continue;r+=1,i.isKey=l,o=await e(await d(c),i,o),r-=1}}return o;function s(t,e,{is:r,order:i,capture:a}){n=function(t,e){const n=[...t]?.pop();n!=e&&(t=tt(t,e));return t}(n,t);const o=n.filter((e=>e===t)).length;return{indent:e,uid:t,similarCount:o,isKey:r,isKeyOrder:function(){for(const[t,e]of Object.entries(l))e.incrementIf(t===r);return l[r].order}(),order:i,capture:a}}}(await d(t),new class{constructor(){__publicField(this,"targetStringsWithUids",Array()),__publicField(this,"blockReferencesAlone",Array()),__publicField(this,"uid",""),__publicField(this,"uidHierarchy",Array()),__publicField(this,"isKey")}},new Map);function u(t,e,n){const r=p(t);r.uid=e.uid+"_t"+(l["is tooltip card"].order<0?0:l["is tooltip card"].order);return{tooltipKey:n(),tooltipObj:r}}async function d(t){const e=p(await h(t));return e.uid=t,e.uidHierarchy=e.uidHierarchy??[],e}function p(t){const{blockRgx:e,aliasPlusUidsRgx:n,tooltipCardRgx:r,componentRgx:s}=ie(i,a),l=fn(t);let u=[];const d=function t(i){const l=[...[...i.matchAll(new RegExp(e,"gm"))].map((t=>t[0]))],d=new c;return l.map((t=>p(t,d)));function p(e,i){function c(){return i[m].incrementIf(!0),{value:f,is:m,order:i[m].order,capture:p}}const l=t=>e.match(t)?.[0],d=t=>[...e.matchAll(t)][0];let p,m="is block reference",f=e;if(p=l(r)){m="is tooltip card",f=d(r)[2];const e=d(r)[1];return[c(),...t(e)]}if(p=l(n))m="is alias",f=d(n)[2];else if(o&&(p=l(a))&&!l(s))m="is substring",f=l(a);else if(!o&&(p=l(s)))m="is component",f=l(a);else{if(9!=f.length)return null;u=tt(u,e)}return c()}}(l);return{targetStringsWithUids:d.flat(1/0).filter((t=>null!=t)),blockReferencesAlone:u}}}function fn(t){return t.replace(/(`.+?`)|(`([\s\S]*?)`)/gm,"used_to_be_an_inline_code_block").replace(new RegExp(re("embed"),"gm"),"used_to_be_an_embed_block")}function gn(t,e,n){const r=hn(t,n)?.[e];return t?.get(r)}function yn(t,e,n){return hn(t,n)?.[e]}function hn(t,e){return t&&0!=t?.size?[...t.keys()].filter((t=>t.isKey.includes(e))):null}async function bn(t){const{key:e,uidResults:n}=function(t){const e={"is component":un(t),"is tooltip card":ln(t),"is alias":cn(t),"is ddm tutorial":sn(t)};return Object.values(e).forEach((t=>Object.assign(t,on))),Object.assign(e["is component"],{urlComponents:function(){return Xe(this.grandParentBlock(),this.targetSelector)}}),{key:M(e).find((t=>e[t].condition())),uidResults:e}}(t);if(!e)return{};const r=await async function(t,e){const n={uid:t[e].uid,preUrlIndex:t[e].getUrlIndex(),accUrlIndex:0,url:t[e].url,grandParentBlock:t[e].grandParentBlock(),nestedComponentMap:{},earlyReturnKey:""};if("is ddm tutorial"==e)return n.accUrlIndex=n.preUrlIndex,n;if("is tooltip card"==e){const i=await dn(t[e].uid);if(n.nestedComponentMap=gn(i,n.preUrlIndex,e),n?.nestedComponentMap&&0!=n?.nestedComponentMap.size||(console.log("yt-gif debugger"),n.nestedComponentMap=[...i.values()][n.preUrlIndex]),!n?.nestedComponentMap||0==n?.nestedComponentMap.size)return n;r()}else if("is alias"==e){const i=await dn(t[e].uid);n.uid=gn(i,n.preUrlIndex,e),n.nestedComponentMap=await dn(n.uid),r()}else n.nestedComponentMap=await dn(n.uid);return n.url=gn(n.nestedComponentMap,n.preUrlIndex,"is component"),n.accUrlIndex+=n.preUrlIndex,n;function r(){n.accUrlIndex+=n.preUrlIndex,n.preUrlIndex=t[e].getUrlIndex()}}(n,e);return Me.guardClause(r?.url)||(r.url=""),r}function _n(t,e){return()=>t.map((t=>e(t))).forEach((t=>{const e=t?.closest(".btn-row")||t?.closest(".yt-gif-url-btn-wrapper");e&&!t.onclick&&(e.style.display="none")}))}function wn(t,e){return n=>t.querySelector(`${e} [yt-gif-url-btn="${n}"]`)}function vn(t,e="formatter"){const n=kn(t,e);K(!0,["vertical"],n)}function kn(t,e="formatter"){const n="yt-gif-url-btns-wrapper",r=t.querySelector(`[${e}]`)??ut([n]),i="formatter"==e?"urlBtn":"insertOptions";return r.querySelector(".yt-gif-url-btns")||r.insertAdjacentHTML("afterbegin",Gt.html.fetched[i]),Ge(r)||t.insertAdjacentElement("afterbegin",r),K(!0,[n],r),t.querySelector(".yt-gif-url-btns")}const Sn=["speed","start","end"];function An(t=le.timestamps.tm_workflow_display.value){const e=t=>q(t.toString());let n=t=>t.toString();return"lessHMS"==t?n=t=>nt(e(t.toString())):"HMS"==t?n=t=>et(e(t.toString())):"hmsSufix"==t?n=t=>nt(e(t.toString()),!0):"S"!=t&&"number"!={}.toString()||(n=t=>e(t.toString())),n}function En({string:t,start:e,end:n,replace:r}){if(e<0||e>t.length)throw new RangeError(`start index ${e} is out of the range 0~${t.length}`);if(n>t.length||n<e)throw new RangeError(`end index ${n} is out of the range ${e}~${t.length}`);return t.substring(0,e)+r+t.substring(n)}function In(t,e,n){return t.substring(0,e)+t.substring(n)}function Tn(t,e,n){const r=Xe(t,e),i=t=>t.closest(".rm-block-ref[data-uid]"),a=i(n),o=(s=e,(c=a)?c.queryAllasArr(s).filter((t=>t.closest(s)==c)):[]);var s,c;return(0!=o.length?o:r).filter((t=>a?i(t):!i(t)))}function On(t){return/\s/g.test(t)}function Cn(t){return On([...t].pop())?"":" "}function xn(t){return new RegExp(t.source,"gm")}function Fn(t){t.preventDefault(),t.stopPropagation()}function Dn({match:t,value:e,p:n,float:r,fmt:i="S"}){let a=t,o=e;if(o=r?Number(o):An(i)(o??"0"),!o||"0"==o||"0s"==o)return a;const s=new RegExp(`(${se(n).source})`);if(s.test(a))return a.replace(s,`${n}=${o}`);{const t="?"==[...a].pop()?"":a.includes("?")?"&":"?";return a+`${t}${n}=${o}`}}function Rn(t,e){const n=(n,r)=>Dn({match:t,value:r,p:n,float:!1,fmt:e??UI.timestamps.tm_workflow_grab.value});return t=n("t",ae("t",t)),t=n("end",ae("end",t))}function Bn(t,e){const n=se(t)?.exec(e)?.[2];return/:/.test(n)?"HMS":/h|m|s/.test(n)?"hmsSufix":/\d+/.test(n)?"S":void 0}function Pn(t,e,n){const r=[t,...e[t].alias],i=e[t].value;return r.reduce(((t,e)=>{const r=n(e)??i;return r||t}),i)}function $n(t,e,n){const r=[...e.matchAll(t)],i=[];for(const a of r){const t=a.index??0;i.push({type:n,start:t,end:t+a[0].length,match:a[0],groups:a})}return i}class Mn{constructor(){__publicField(this,"type",""),__publicField(this,"start",0),__publicField(this,"end",0),__publicField(this,"match"),__publicField(this,"groups",[])}}function Ln(t){return[...t.matchAll(ie().componentRgx)][0]?.[5]||t}function Un(t){const{targetStringRgx:e,minimalRgx:n}=Me;return t&&($n(xn(e),t,"url")?.[0]||$n(xn(n),t,"minimal")?.[0])||new Mn}function jn(t){const e=new Se,n={};if(Me.guardClause(t)){for(const e of[...t.matchAll(/(\w+)=([^&]+)/gm)])n[e[1]]=e[2];return e.id.set(it(t)),e.src.set(t),e.start.setDefault(r("start")),e.end.setDefault(r("end")),e.volume.set(i("volume")),e.speed.setDefault(i("speed")),e.hl.set(a("hl")),e.cc.set(a("cc")),e.sp.set(a("sp")),e}return{};function r(t){return Pn(t,e,(t=>oe(n[t])))}function i(t){return Pn(t,e,(t=>parseFloat(n[t])))}function a(t){return Pn(t,e,(t=>n[t]))}}function Vn(t,e=Un){const n=Ln(t),r=e(n),i=r?.start,a=r?.end;let o=r?.match?In(n,i,a):"";return o&&r?.match&&On(o[i-1])&&On(o[i])&&(o=In(o,i-1,i)),o=o.trim(),{hiddenObj:e(o),matchObj:r,contentObj:{match:r?.match,hidden:o,content:n}}}async function qn(t){const e=Vn(t.capture,Un);let n=e.matchObj.match,r=Bn("t",i=n)||Bn("end",i);var i;return r="S"==r?"hmsSufix":"S",e.matchObj.match=Rn(n,r),Kn(e)}function Kn(t){return{url:t.matchObj.match,hidden:t.contentObj.hidden}}function Nn(t,e=".yt-gif-url-btns"){const n=wn(t,e),{getters:r,trim:i}=function(){let t="",e="";return{getters:{get u(){return t},get h(){return e}},trim(n){t=n.url,e=n.hidden??"",e=e.trim()?e.trim()+" ":""}}}();return{urlBtn:n,confirmBtns:_n(Sn,n),instParam:async t=>(await async function(t){const e=Vn(t.capture,Un);return e.matchObj.match=Dn({match:e.matchObj.match,value:t.from.value??se(t.from.param)?.exec(e.matchObj.match)?.[2],p:t.from.param,fmt:le.timestamps.tm_workflow_grab.value,float:t.from.float??!1}),Kn(e)}(t).then(i),`{{[[yt-gif]]: ${r.u} ${r.h}}}`),updUrl:async t=>(t.to=["url"],await qn(t).then(i),`${r.u}${r.h}`)}}const Gn=["yt-gif","format","url","start","end","start|end"];function Yn(t,e){return An(le.timestamps.tm_workflow_grab.value)(ae(t,e)||"0")}function Hn(t){return Yn("t|start",t)}function Wn(t){return Yn("end",t)}function zn(t){const e=/(`.+?`)|(`([\s\S]*?)`)/gm;return[...t].filter((t=>!e.test(t.match)))}function Qn(t,e){let n,r;try{1!=t.length||t[e]||(e=0),n=t[e].start,r=t[e].end}catch(i){throw console.log("yt-gif debugger"),new Error("YT GIF Formatter: Crashed because of out of bounds target...")}return{start:n,end:r,replaceIndex:e}}function Jn(t){const e={...t};return e.start=t.start+4,e.end=t.end-(1+t.groups[2]?.length+2),e.match=t.groups[1],e}async function Xn(t,e,r,i){const{info:a,blockReq:o}=await async function(t,e){const r=t??await n(e),i=r?.[0]?.[0];return{info:i,blockReq:r}}(i,t);if(!a||-1==e)return{success:!1,open:!1};const s=(t,e)=>$n(t,a.string,e),c=function(t,e){const n=[...t(/(`.+?`)|(`([\s\S]*?)`)/gm,"codeBlocks"),...zn(t(/{{=:(.+?)\|(.+)}}/gm,"tooltipPrompt")).map(Jn)],r=ee.targetStringRgx;return e.match(r)?.[0]||n.push(...t(r,"components")),n}(s,r),l=function(t,e){return t(new RegExp(`(${e.replace(/(?=[.\\+*?[^\]$(){}\|])/g,"\\")})`,"gm"),"urlsMatch")}(s,r),u=l.filter((t=>function(t,e){let n=!1;const r=t.some((t=>{const r=e.start>=t.start&&e.end<=t.end;return n="tooltipPrompt"==t.type,r}));return!!n||!r}(c,t)));return{success:!0,uid:t,...Qn(u,e),open:a.open,string:a.string,recycledRequest:o}}const Zn={default:"",ok:t=>t?.length>0},tr={default:0,ok:t=>t>0},er=[.25,.5,.75,1,1.25,1.5,1.75,2],nr={speed:{default:1,ok:function(t){return W(er,t)!=this.default}},start:tr,end:tr,volume:{default:40,ok:function(t){return t!=this.default&&t>=0}},hl:Zn,cc:Zn,sp:Zn};function rr({page:t,value:e,match:n}){return Dn({match:n,value:e,p:"end"==t?"end":"t",fmt:"S"!=le.timestamps.tm_workflow_grab.value?"hmsSufix":"S",float:!1})}function ir(t,e){const n=Rn(M(nr).filter((n=>!t.includes(n)&&nr[n].ok(e[n].value))).reduce(((t,n)=>t+`&${e[n].alias[0]||n}=${e[n].value}`),"").slice(1),"S"!=le.timestamps.tm_workflow_grab.value?"hmsSufix":"S"),r=Zt(le.display.fmt_options,"avoid_redundancy")?"/":"https://youtu.be/",i=t=>t+e.id.value;return{minimal:`${i("/")}?${n}`,full:`${i("https://youtu.be/")}?${n}`,fmtUrl:n.slice(1)?`${i(r)}?${n}`:i(r)}}function ar(t,e="self"){return{timestamp:t.tmSetObj?.[e]?.timestamp,pear:e}}function or(t,{timestamp:e,pear:n}){if(!e)return t.hidden;const r=An()(e);return An()(t.content?.match($e.targetStringRgx)?.[0]??"-1")===r&&Zt(le.display.fmt_options,"avoid_redundancy")?("self"==n&&(t.content=t.content.trim().replace(e.toString(),"")),t.hidden.replace(e.toString(),"")):t.hidden}class sr{constructor(){__publicField(this,"blockID"),__publicField(this,"start",0),__publicField(this,"end",0),__publicField(this,"HMS",0),__publicField(this,"crrTime"),__publicField(this,"condition",(t=>!1))}}function cr(t,e,n,r){const{match:i,index:a,componentMap:o}=e,s=t.uid+ne(i,a),c=(l=n,Object.values(l)).find((t=>t.condition(s)));var l;const u=lr(ae("t|start",i).toString()),d=lr(ae("end",i).toString());return{formats:lr(c?.crrTime?.toString()||""),foundBlock:{...t,lastUrl:i,lastIndex:a,componentMap:o,blockID:c?.blockID,possibleBlockIDSufix:s},targetBlock:{...r,start:u,end:d},ok:!0}}function lr(t){return{lessHMS:nt(parseInt(t)),HMS:et(t),hmsSufix:nt(parseInt(t),!0),S:t}}async function ur(t,e=!0){const n=function(){return{targets:{...new sr,condition:function(n){const r=t(this,n,Oe)?.wTarget?.getCurrentTime();return e.call(this,r)}},lastParams:{...new sr,condition:function(n){const r=t(this,n,xe)?.updateTime?.value;return e.call(this,r)}}};function t(t,e,n){return t.blockID=((t,e)=>[...e.keys()].find((e=>e?.endsWith(t))))(e,n),n.get(t.blockID)}function e(t){return this.crrTime=t??this.crrTime,!!t}}(),{blockStrings:r,originBlockObj:i}=await async function(t,e){const n=await(async t=>{try{const e=(await window.roamAlphaAPI.q("[:find (pull ?block [{:block/parents [:block/uid]}]) :in $ [?block-uid ...] :where [?block :block/uid ?block-uid]]",[t])[0][0])?.parents?.map((t=>t.uid));return m(e)}catch(e){return[]}})(t);let r,i="";e?(i=await h(t)||"",r=[...n,[{uid:t,string:i},{title:"made-up",uid:"invalid"}]]):r=n;return{blockStrings:r.map((t=>t[0])).map((t=>({string:fn(t.string),uid:t.uid}))),originBlockObj:{string:i,uid:t}}}(t,e);for(let a of r?.reverse()){const t=await pn(a.uid,De,mn,a.uid,je),e=[...t.entries()].reverse(),r=await dr(e,t);if(r&&r.match)return"yt-gif"==r.from&&(a=Object.assign(a,r.ObjAsKey)),cr(a,r,n,i)}return{ok:!1}}async function dr(t,e){const n=(n,r)=>({match:n,index:t.indexOf(r),componentMap:e,from:"anchor",ObjAsKey:{}});for(const r of t){const[t,e]=r,i=t?.capture?[...t?.capture.matchAll(je.componentRgx)][0]:[],a=i?.[2],o=i?.[5];if("yt-gif"==a&&Me.guardClause(e))return n(e,r);if("yt-gif/anchor"==a&&o){if(Me.guardClause(e))return n(e,r);if(e&&9==e.length)return pr(e)}}return null}async function pr(t){const e=await dn(t),n=[...e.values()].reverse(),r=n.find((t=>Me.guardClause(t))),i=n.indexOf(r);return{match:r,index:i,componentMap:e,from:"yt-gif",ObjAsKey:[...e.keys()].reverse()[i]}}async function mr(t){const{capture:e,from:n,to:r}=t,{contentObj:i,matchObj:a,hiddenObj:o}=Vn(e),{lastUrl:s,url:c}=await async function(t,e){let n=e.match;const r=await async function({uid:t}){const{foundBlock:e}=await ur(t,!1);return e?.lastUrl?e.lastUrl:""}(t);!n&&Zt(le.display.fmt_options,"rely_on_hierarchy")&&(n=r);if(!n)throw new Error("YT GIF URL Formatter: Missing video url...");return{lastUrl:r,url:fr(e,n)}}(t,a);if(a.match=c,i.hidden=function(t){if(void 0===t.match)return t.content;return t.hidden}(i),i.hidden=or(i,ar(n,"self")),a.match=rr({page:n.page,value:ar(n).timestamp,match:a.match}),["start","end"].some((t=>t==r[0]))){const t=function(t,e){return ir(t,jn(e)).fmtUrl}(r,c),e=function(t,e){return(e?ir(t,jn(e)):{fmtUrl:null}).fmtUrl}(r,s);if(function(t,e,n){return!t?.match?.includes?.(e)&&e!=n}(o,t,e)){const e=Cn(i.hidden);i.hidden+=`${e+t} `}}else if(["start","end"].some((t=>t==n.page))&&Zt(le.display.fmt_options,"lift_pears")){const e=await async function(t,e){if(!t.tmSetObj?.pear)return null;const{ObjAsKey:n,block:r,targetNode:i,timestamp:a,page:o}=t.tmSetObj.pear,s=Tn(r,t.sel(a,o),i).indexOf(i),{uid:c,capture:l}=n??{};if(!c||!l||-1==s)throw new Error("YT GIF URL Formatter: Missing pear uid or capture...");const u=await Xn(c,s,l,e.recycledRequest);if(!u.success)throw new Error("YT GIF URL Formatter: Failed to update pear...");return e.string=En({...u,replace:""}),e.start+e.end>u.start+u.end?(On(e.string[u.start])&&On(e.string[u.end+1])&&(e.string=En(Object.assign({...u},{end:u.start+1}))),e.start-=l.length,e.end-=l.length):On(e.string[u.start-1])&&On(e.string[u.start])&&(e.string=In(e.string,u.start-1,u.start)),Vn(l,(function(t){return $n(xn($e.targetStringRgx),t,"timestamp")?.[0]}))}(n,t);a.match=await async function(t,e,n){const r=t;if(!r)return e;const i=n.tmSetObj?.pear?.page;return rr({page:i,value:r,match:e})}(e?.matchObj?.match,a.match,n),i.hidden+=function(t,e){const n=t?.contentObj?.hidden;return n?(e.content??(e.content=""),Cn(e.content)+t.contentObj?.content?.trim()+" "):""}(e,i),i.hidden=or(i,ar(n,"pear"))}return["url","yt-gif"].some((t=>t==r[0]))&&(a.match=function(t,e){const n="start|t",r=(t=(t=t??n).includes("t")?n:"end").includes("t")?"end":n,i=new RegExp(`(${se(r).source})(.*&)(${se(t).source})`);return i.test(e)&&(e=e.replace(i,"$6$5$1")),e}(n.page,a.match)),{url:a.match,hidden:i.hidden,space:t.string[t.end]}}function fr({type:t},e){return"minimal"==t?"https://youtu.be"+e:e}function gr(t,e=".yt-gif-url-btns"){const n=wn(t,e);!function(t,e,n=".yt-gif-url-btns"){const r=e.querySelector(n);r&&(r.onmousedown=Fn),Gn.map((e=>t(e))).forEach((t=>t.onmousedown=Fn))}(n,t);const{getters:r,trim:i,concatNoCmpt:a}=function(){let t="",e="";return{getters:{get u(){return t},get h(){return e}},concatNoCmpt(t){e=e.trim();const n=e?" ":"",r=On(t.space)?"":n;e=n+e+r},trim:n=>(t=n.url,e=n.hidden??"",e=e.trim()?e.trim()+" ":"",n)}}();return{startTm:Hn,endTm:Wn,urlBtn:n,confirmBtns:_n(Gn,n),ytGifCmpt:async t=>(t.to=["yt-gif"],await mr(t).then(i),`{{[[yt-gif]]: ${r.u} ${r.h}}}`),startCmpt:async t=>(t.to=["start"],await mr(t).then(i),`{{[[yt-gif/start]]: ${Hn(r.u)} ${r.h}}}`),endCmpt:async t=>(t.to=["end"],await mr(t).then(i),`{{[[yt-gif/end]]: ${Wn(r.u)} ${r.h}}}`),startEndCmpt:async t=>(t.to=["start","end"],await mr(t).then(i),`{{[[yt-gif/start]]: ${Hn(r.u)} ${r.h}}} {{[[yt-gif/end]]: ${Wn(r.u)} }}`),compt2Url:async t=>(t.to=["url"],await mr(t).then(i).then(a),`${r.u}${r.h}`)}}async function yr({block:t,targetNode:e,siblingSel:n,selfSel:i,getMap:a,isKey:o,fmtCmpnt_cb:s,tempUID:c,from:l}){const u=Xe(t,n).indexOf(e),d=Tn(t,i,e).indexOf(e),p=yn(await a(),u,o),{uid:m,capture:f}=p??{};if(!f||!m||-1==d)return;const g=await Xn(m,d,f,null);if(g?.success){try{const t={...g,capture:f,from:l,replace:""};t.replace=await s(t),await r(m,En(t),g.open),Re.delete(m),Re.delete(c)}catch(y){const t=l?.urlBtn?.closest("[data-tooltip]"),e=`${y?.message} ((${c}))`;return console.error(e),t?.setAttribute("data-tooltip",e)}return{success:!0}}}async function hr(t,e,n){t.preventDefault(),t.stopPropagation(),await yr(br(t,e,n,{}))}function br(t,e,n,r={}){return{block:n.grandParentBlock,targetNode:n.wrapper,siblingSel:".yt-gif-wrapper",selfSel:`[data-video-url="${n.url}"]`,getMap:async()=>dn(n.uid),isKey:"is component",tempUID:n.uid,from:{caster:"player",page:"yt-gif",urlBtn:t.target,...r},fmtCmpnt_cb:e}}function _r(){const t=Pe,e=t=>H(window.YT_GIF_DIRECT_SETTINGS?.get("ms_options")?.sessionValue?.includes?.(t));return(e("override_"+t)||H(localStorage.getItem(t)))&&e(t)}function wr(){return Zt(le.display.ms_options,Pe)&&_r()}function vr(t,e){const{wrapper:n}=t;vn(n.querySelector("[insertOptions]"),"insertOptions");const r=Nn(n,"[insertOptions]");if(!wr())return r?.confirmBtns();!function(t,e){vn(t.querySelector("[formatter]"));const{startCmpt:n,endCmpt:r,startEndCmpt:i,compt2Url:a,urlBtn:o,confirmBtns:s}=gr(t,"[formatter]");o("url").onclick=async t=>hr(t,a,e),o("start").onclick=async t=>hr(t,n,e),o("end").onclick=async t=>hr(t,r,e),o("start|end").onclick=async t=>hr(t,i,e),s()}(n,t),function(t,e,n){const{instParam:r,urlBtn:i}=t,a=()=>e?.wTarget,o=()=>parseInt(a()?.getCurrentTime()?.toString())||0,s=()=>a()?.getPlaybackRate()||1,c=(t,e)=>async function(t,e,n,r={}){t.preventDefault(),t.stopPropagation(),await yr(br(t,e,n,r))}(t,r,n,e);i("start").onclick=async t=>c(t,{param:"t",value:o()}),i("end").onclick=async t=>c(t,{param:"end",value:o()}),i("speed").onclick=async t=>c(t,{param:"s",value:s(),float:!0})}(r,e,t)}async function kr(t,e={}){const n="soft"==le.timestamps.tm_seek_to.value?"seekTo-soft":"seekTo-strict",r={currentTarget:t,which:1,mute:"mute"==le.timestamps.tm_seek_action.value,simMessage:e.simMessage||"",seekToMessage:e.seekToMessage||n};await(t?.OnClicks?.(r))}async function Sr(t,e,n={}){if(!e)return void console.warn("Passed null common object");await z(10);const r=t();let i=(a=".roam-block",o?[r,...r?.queryAllasArr(a)]:r?.queryAllasArr(a))[e.blockIndex];var a,o;const s=document.getElementById(e.blockID);if(s!=i&&"strict"==e.workflow){if(!r.contains(s))return;i=s}const c=Xe(i,"[yt-gif-timestamp-emulation]")||[],l=c[e.target.index]||c[e.start.index]||c[e.end.index]||c[c.length-1];await kr(l,n)}async function Ar({getCrrContainer:t,getObsTimestamp:e},n){const r=e();if(!le.display.simulate_roam_research_timestamps.checked||!le.timestamps.tm_recovery.checked||!r)return;await Sr(t,r),await z(10);const i=e=>n[e].set((n=>{const r=function(t,e){return t()?.querySelector(`.rm-video-timestamp[timestamp-style="${e}"][active-timestamp]`)?.getAttribute("timestamp")||""}(t,e);return q(r)||n}));i("start"),i("end")}function Er({getLocalBlockID:t,setObsTimestamp:e,getCrrContainer:n,getObsTimestamp:r},i){const{wrapper:a,url:o,configParams:s,deploy:c}=i,l=function(){const{awiting_player_pulse_anim:t,awaitng_player_user_input:e,awaitng_input_with_thumbnail:n}=Yt,r=[t,e,n];Zt(le.experience.xp_options,"thumbnail_as_bg")&&Y(a,o);return K(!0,r,a),r}(),{awaiting_input_type:u}=le.experience;let d="mousedown"==u.value?"mousedown":"mouseenter";function p(t){return f(t,y)}function m(t){return f(t,g)}async function f(t,e){t.preventDefault(),t.stopPropagation(),K(!1,l,a),N(a),h(),await e(t),c()}async function g(){await Ar({getCrrContainer:n,getObsTimestamp:r},s),a.dispatchEvent(G())}function y(n){var r;n.detail&&"object"==typeof n.detail&&(a("start"),a("end"),xe.delete(t()),a("updateTime"),a("mute"),a("playRightAway"),e({...n.detail.obsTimestamp,workflow:"soft"}),s.updateTime.set((r=i("updateTime"))>=i("start")&&r<=i("end")?i("updateTime"):i(n.detail.page)));function i(t){return s[t].value}function a(t){s[t].set((e=>n.detail[t]??e))}}function h(){_(),a.removeEventListener("customPlayerReady",p),u.removeEventListener("change",w)}function b(t=d){a.addEventListener(t,m)}function _(){a.removeEventListener(d,m)}function w(){if(!Ge(a))return h();!function(t=d){_(),b(d=t)}(this.value)}b(),a.addEventListener("customPlayerReady",p),u.addEventListener("change",w)}function Ir(){return Zt(le.experience.initialize_mode,"input")}function Tr(){return Zt(le.experience.xp_options,"intersection")}function Or(){return Zt(le.experience.initialize_mode,"input_x_buffer")}function Cr(t,e,n){let r=!1,i=null,a=t.length+0,o=0;for(;t.length>e;){if(a<0)throw new Error("index out of bounds");i=t[o];const e=document.querySelector(i);if(e){const t=Q(e)?Qt.forceAwaiting:n;ce(e,Qt.name,t)}else o++;t.shift(),r=!0,a--}return{shiftedArr:t=(t=[...new Set(t)]).filter((t=>null!=document.querySelector(t))),atLeastOne:r,lastOne:i}}function xr(t){const e=le.experience.initialize_mode,n=te(e,"input_x_buffer");n.disabled=t,t||(n.selected=!1),te(e,"overflow").selected=t,e.dispatchEvent(new Event("customBind"))}function Fr(){if(Ir())return null;let t=window.YT_GIF_OBSERVERS.masterIframeBuffer;const e=parseInt(le.range.iframe_buffer_slider.value,10),{displaced:n,buffer:r}=Qt;if(Tr()&&Or())t=function(t,e,n){const r=document.queryAllasArr(".yt-gif-wrapper");if(r.length<e)return t;for(const i of r)return new window.IntersectionObserver((([r],i)=>{if(r.isIntersecting)return t;const{shiftedArr:a}=Cr(t,e,n);return t=a,i.disconnect(),window.YT_GIF_OBSERVERS.masterIframeBuffer=t}),{root:null,threshold:.1}).observe(i),t;return t}(t,e,n);else{const{shiftedArr:n,atLeastOne:i}=Cr(t,e,r);t=n,i||e<=t.length?xr(!0):!i&&e>t.length&&xr(!1)}return window.YT_GIF_OBSERVERS.masterIframeBuffer=t}function Dr(t,e){if(!t)return;Rr(t,e,"[yt-gif-timestamp-emulation]").forEach((t=>{J(!1,"active-timestamp",t),J(!1,"last-active-timestamp",t)}))}function Rr(t,e,n){const r=t.queryAllasArr(".yt-gif-wrapper").filter((t=>t!=e)).map((t=>He(t)?.queryAllasArr(n))).flat(1/0);return Array.from(t.querySelectorAll(n)).filter((t=>!r.includes(t)))}function Br(t){return le.playerSettings.mute_style.value==t}function Pr(t){return le.playerSettings.play_style.value==t}function $r(){return Pr("soft")||Pr("strict")}function Mr(t){return{stop(e){t.parent.others.toggleActive(),t.target.others.StrictFlow(),t.UpdateLocalVolume(),t.UpdateHumanInteraction(!1),!function(t){return 4==t.buttons||le.defaultValues.InAndOutKeys.split(",").map((t=>t.trim())).filter((t=>!!t)).some((e=>t[e]))}(e)||Br("all_muted")?(t.parent.toggleActive(!1),t.togglePlay(!$r()&&t.isPlaying()),t.isSoundingFine(!1)):(t.parent.toggleActive(!0),t.videoIsPlayingWithSound())},play(){Zt(le.playerSettings.ps_options,"mantain_last_active_player")&&t.parent.others.toggleActive(),t.target.others.StrictFlow(),t.UpdateHumanInteraction(!0),t.togglePlay(!0),Br("soft")||Br("all_muted")?Br("soft")&&t.isSoundingFine(!1):t.isSoundingFine()}}}function Lr(t,e){const n=xe.get(t.entry.blockID);if(!n)return;const{url_boundaries:r,url_volume:i}=le.playerSettings,a=function(t,e,n,r){if("strict"==e){const e=t.timestamps.history;return e[e.length-1]!=n?(e.push(n),n):t.updateTime.value}if("soft"==e&&r(t.updateTime.value))return t.updateTime.value}(n,r.value,t.entry.start,e.isBounded);null!=a&&e.seekToUpdatedTime(a);const o=function(t,e,n){if("strict"==e){const e=t.volume.history;return e[e.length-1]!=n?(e.push(n),n):t.volume.update}if("soft"==e)return t.volume.update}(n,i.value,t.entry.volume);null!=o&&(t.update.volume=o)}function Ur(t,e){return function(){Q(t)&&(Pr("all_visible")?(e.togglePlay(!0),e.isSoundingFine(!1)):$r()&&e.togglePlay(!$r()))}}function jr(t,e){return function(){Q(t)&&(Br("strict")||Br("all_muted"))&&e.isSoundingFine(!1)}}function Vr(t,e,n){return function(){const r=le.display.yt_playback_speed.value,i="Default"==r?e.speed.value:Number(r);n.update.tickOffset=1e3/i,t.setPlaybackRate(i)}}function qr(t,e=!1,n=(()=>{})){return t?.tagName&&(e?t.addEventListener("change",n):t.removeEventListener("change",n)),t}function Kr(t){const e=t/3600,n=t%3600/60;return(e<1?[n,t%60]:[e,n,t%60]).map((t=>`0${Math.floor(t)}`.slice(-2))).join(":")}async function Nr({t:t,start:e,end:n}){if(!t)return;const r=t.GetVars(),i=Ce.get(t.GetIframeID());i||console.warn(`YT GIF: ReloadYTVideo: Couldn't find VideoConfigParameters for ${t.GetIframeID()}`);const a=t.getIframe();if(e=e||0,n=n||t.getDuration(),i?.start.value==e&&i?.end.value==n){for(;Ge(a)&&!t.ApiIsWorking();)await z(50);return t.seekTo(e)}i?.start.set(r.start=e),i?.end.set(r.end=n);const o=t.getVolume();for(;Ge(a)&&!t.ApiIsWorking();)await z(50);t.getPlayerState()&&t.setPlayerState("F");try{t.setOnStateChange((async()=>{}))}catch(s){console.warn("YT GIF: ReloadYTVideo | onStateChange assignment to undefined")}for(await t.loadVideoById({videoId:t.GetVideoID(),startSeconds:e,endSeconds:n});Ge(a)&&!t.getCurrentTime();)await z(50);t.setVolume(o);try{t.setOnStateChange(window.AvoidCircularDependency.getOnStateChange())}catch(s){console.error("YT GIF: ReloadYTVideo | onStateChange assignment to undefined")}}function Gr(t,e){return J(t,"awaiting",e)}function Yr(t){return Qe(t)+Je(Hr(t))}function Hr(t){return t.closest("."+Yt.yt_gif_wrapper)||t.parentElement}function Wr(t,e,n,r,i,a){return async()=>{const{iframe:o,parent:s}=a,{blockID:c,blcokID_prfx:l,volume:u,canBeCleanedByBuffer:d,key:p}=i;pt(a.withEventListeners),t.next(!1);const m=L(xe.get(c)??Ve);m.src.set(Je(s)),m.id.set(r.id.value),m.updateTime.set(n.isBounded(n.tick())?n.tick():r.start.value),m.volume.update=e.getVolume()??r.volume.update,0==m.timestamps.history.length&&m.timestamps.history.push(r.start.value),0==m.volume.history.length&&m.volume.history.push(u),e.ytgif.ClearTimers(),Oe.delete(c),Ce.delete(p);const g=Qe(o)??l,y=s.getAttribute(Wt.index);for(const t of xe.keys()){const e=()=>xe.delete(t),n=t?.endsWith(y)&&t?.includes(m.id.value),r=t.startsWith(g);if(n&&r){e();continue}if(!n)continue;d&&await f(g.slice(-9))&&(console.log("yt-gif debugger"),e())}null!=c&&xe.set(c,m),d&&Fr();const h=document.querySelector("#"+p)==o;if(h)return console.log(`${p} is displaced, not removed, thus is not destroyed.`);setTimeout((()=>{if(h)return;e.DestroyTarget();const t=function(t){const e=document.querySelector("#"+t);if(!Ge(e))return null;const n=Hr(e);if(!Ge(n))return null;const r=ut([window.AvoidCircularDependency.getCurrentClassesToObserver()[0]]);return{previousParent:n,observerTarget:r}}(p);if(!t)return;const{previousParent:n,observerTarget:r}=t;n.parentNode?.replaceChild(r,n)}),1e3)}}function zr(t,e,n){return(r,i)=>{if(r[0]&&Ge(r[0].target)){if(t.tick()>n.update.start+1&&!e.ytgif.globalHumanInteraction){if(!Pr("all_visible"))return Qr(t);r[0].isIntersecting?t.togglePlay(!0):Qr(t)}}else i.disconnect()}}function Qr(t){if(!t.parent.isActive()||!Zt(le.playerSettings.ps_options,"mantain_last_active_player"))return t.togglePlay(!1);t.parent.others.toggleActive(),t.target.others.Mute(),t.target.others.Pause()}function Jr(t,e,n){try{t.setVolume(e.update.volume)}catch(r){console.log(r)}n.playback()}async function Xr(t,e,n){const r=function(t){return t.closest(".rm-alias-tooltip__content")||t.closest(".bp3-card")||t.closest(".myPortal")}(t),i=t=>n.videoIsPlayingWithSound(t);if(r)r.dispatchEvent(G());else if(n.parent.Hover())i(!0),function(t,e){setTimeout((()=>{t.parent.isActive()||t.parent.Hover()||e(!1)}),1e3)}(n,i);else{await e.WhileApiHolds(t,200);const r=e.ytgif.globalHumanInteraction;r?i(!0):Q(t)&&!r?function(t,e){const n=Pr("all_visible");e(n),n&&!t.parent.Hover()&&t.isPlaying()&&e(!1)}(n,i):n.parent.Hover()||i(!1)}}function Zr(t,e){ei(Jt,t,e)}function ti(t,e){ei(Xt,t,e)}function ei(t,e,n){M(t).forEach((e=>n.removeAttribute(t[e]))),n.setAttribute(e,"")}function ni(t){return{StrictFlow(){Pr("strict")?n():Br("strict")&&e()},Mute:e,Pause:n};function e(){r(ii)}function n(){r(ai)}function r(e=oi){const n=document.queryAllasArr(`[${e.styleQuery}]`);for(const r of n){const n={el:r,id:Yr(r)};r!=t?e.others_callback(n):e.self_callback&&e.self_callback(n)}}}const ri=t=>{},ii={styleQuery:"yt-unmute",others_callback:t=>{Zr("yt-unmute",t.el),Oe.get(t.id)?.wTarget?.mute()},self_callback:ri},ai={styleQuery:"yt-playing",others_callback:t=>{ti("yt-paused",t.el),Oe.get(t.id)?.wTarget?.pauseVideo()},self_callback:ri},oi={styleQuery:"",others_callback:ri,self_callback:ri};function si(t,e,n,r){const i="yt-active";return{parent:{others:{toggleActive(e=!1){document.queryAllasArr("[yt-active]").filter((e=>e!=t)).forEach((t=>J(e,i,t)))}},toggleActive:e=>J(e,i,t),Hover:()=>t.matches(":hover"),isActive:()=>t.hasAttribute(i)},timeDisplay:{Hover:()=>n.matches(":hover"),OnCustomVideoEnded(){n.classList.contains("yt-gif-timestamp-update")&&(n.onmousemove=null,this.visible(!1),r.ytgif.ClearTimers())},visible(t){K(t,["yt-gif-timestamp-update"],n),K(!t,["yt-gif-invisible-element"],n)}},whole:{anyHover:()=>t.matches(":hover")||n.matches(":hover")},target:{others:ni(e)}}}function ci(t){return{tick:(e=t)=>e?.getCurrentTime(),closestRate:e=>W(t.getAvailablePlaybackRates()||[],e)||1,UpdateHumanInteraction(e){t.ytgif.globalHumanInteraction=e},isPlaying:()=>1===t.getPlayerState()}}function li(t){return{clipSpan:()=>t.end.value-t.start.value,isBounded:e=>t.start.value<e&&e<t.end.value,getMapVolume:()=>Ve.volume.value||40}}async function ui(t){const e=new Ie(t.target),n=e.GetIframeID(),r=function(t,e){const n=document.getElementById(t)||e.getIframe(),r=Hr(n),i=r.querySelector("div."+Yt.yt_gif_timestamp),a=i.querySelector(".yt-gif-timestamp-start"),o=i.querySelector(".yt-gif-timestamp-end"),s=r.querySelector('[yt-gif-url-btn="reset"]'),c=[r,r.parentNode,i,n];return{blockID:Yr(n),iframe:n,parent:r,timeDisplay:i,resetBtn:s,withEventListeners:c,timeDisplayStart:a,timeDisplayEnd:o}}(n,e),{iframe:i,parent:a,timeDisplay:o,resetBtn:s}=r,c=Ce.get(n);c.start.set(c.start.value||0),c.end.set(c.end.value||e.getDuration());const l=function(t,e,n){const r={start:t.start.value,volume:t.volume.value,end:t.end.value};return{entry:{...r,blockID:e.blockID,blcokID_prfx:Qe(n),canBeCleanedByBuffer:!!X(n),key:n.id},update:{...r,tickOffset:0}}}(c,r,i),u=function(t){const{parent:e,timeDisplay:n,iframe:r}=t,{map:i,t:a,local:o}=t;return{...si(e,r,n,a),...li(i),...ci(a),videoIsPlayingWithSound(t=!0){this.isSoundingFine(t),this.togglePlay(t)},togglePlay(t,e=r){t?(ti("yt-playing",e),a.playVideo()):(ti("yt-paused",e),a.pauseVideo())},isSoundingFine(t=!0,e=r){t?(Zr("yt-unmute",e),a.unMute(),a.setVolume(o.update.volume)):(Zr("yt-mute",e),a.mute())},UpdateLocalVolume(t){t=t??a.getVolume(),o.update.volume=t},seekToUpdatedTime(t){o.update.start=t,a.seekTo(o.update.start)}}}({map:c,parent:a,timeDisplay:o,t:e,iframe:i,local:l});c.speed.set(u.closestRate(c.speed.value||1)),function(t,e,n){t&&(t.wTarget=e,t.sameBoundaries=function(t=e){if(!t)return!1;const n=t.GetIframeID(),{start:r,end:i}=Ce.get(n),{start:a,end:o}=t.GetVars();return r.value==a&&i.value==o},t.seekToUpdatedTime=n.seekToUpdatedTime,t.isSoundingFine=n.isSoundingFine,t.togglePlay=n.togglePlay,t.bounded=function(t){const n=e.getDuration()??0;return t>=0&&t<=n})}(Oe.get(l.entry.blockID),e,u);const d=function(t,e,n,r,i){return{play:Ur(t,e),mute:jr(t,e),playback:Vr(n,r,i)}}(i,u,e,c,l);if(a.hasAttribute("loaded"))return await async function(t,e,n,r){const i=xe.get(t.entry.blockID);i&&i.updateTime.set(e.ytgif.previousTick),Lr(t,n),await Xr(r,e,n)}(l,e,u,i),void Jr(e,l,d);i.removeAttribute("title"),Lr(l,u);const p=function*(t){let e=!0;for(;;)le.playerSettings.play_style=qr(le.playerSettings.play_style,e,t.play),le.playerSettings.mute_style=qr(le.playerSettings.mute_style,e,t.mute),le.display.yt_playback_speed=qr(le.display.yt_playback_speed,e,t.playback),e=yield e}(d);p.next();const m=Mr(u);a.addEventListener("mouseenter",m.play),a.addEventListener("mouseleave",m.stop),a.addEventListener("customVideoEnded",u.timeDisplay.OnCustomVideoEnded);const f=function(t,e,n,r,i,a){function o(){const e=t.clipSpan(),r=e<0,i=t.tick()>n.end.value;if(J(i,"tick-offset",a.timeDisplayStart),J(r,"offset",a.timeDisplayEnd),Zt(le.display.ms_options,"clip_lifespan_format")){const i=Math.abs(e-(n.end.value-t.tick())),o=r?n.end.value:e;a.timeDisplayStart.textContent=Kr(i),a.timeDisplayEnd.textContent=Kr(o)}else a.timeDisplayStart.textContent=Kr(t.tick()),a.timeDisplayEnd.textContent=Kr(n.end.value)}return{NewIntervalUpdate:function(){if(!Ge(e))return i.DestroyTarget();t.whole.anyHover()&&(o(),i.ytgif.PushSingleInterval((()=>{t.whole.anyHover()&&o()}),r.update.tickOffset))},UpdateTimeDisplay:o,SeekToScroll(e){t.videoIsPlayingWithSound(!1);let a=t.tick()+Math.sign(e.deltaY)*Math.round(Number(le.range.timestamp_display_scroll_offset.value))*-1;Zt(le.display.ms_options,"clip_lifespan_format")&&(a<=n.start.value&&(a=n.end.value-1),a>=n.end.value&&(a=n.start.value)),i.seekTo(a),o(),setTimeout((()=>{t.whole.anyHover()&&t.videoIsPlayingWithSound()}),r.update.tickOffset)}}}(u,i,c,l,e,r);e.ytgif.enter=f.NewIntervalUpdate,o.addEventListener("wheel",f.SeekToScroll),o.addEventListener("mouseenter",f.NewIntervalUpdate),o.addEventListener("mouseleave",(()=>e.ytgif.ClearTimers()));const g=function(t,e){return{default(){de(e.GetIframeID()),document.fullscreenElement||(t.parent.Hover()?"mute"==le.playerSettings.fullscreen_style.value?t.isSoundingFine(!1):"pause"==le.playerSettings.fullscreen_style.value&&t.togglePlay(!1):"play"==le.playerSettings.fullscreen_style.value&&t.togglePlay(!0))},autoplaySynergy(){document.fullscreenElement?t.parent.others.toggleActive():Pr("all_visible")&&le.playerSettings.play_style.dispatchEvent(new Event("change"))}}}(u,e);i.addEventListener("fullscreenchange",g.default),i.addEventListener("fullscreenchange",g.autoplaySynergy);const y=function(t,e,n,r,i,a){return async function(s){const c=s?.currentTarget??n.resetBtn,l=t=>Gr(t,c);if(!c.hasAttribute("awaiting")){if(e.timeDisplay.visible(!0),l(!0),Dr(We(c),n.parent),await Nr({t:t,start:r.start.default,end:r.end.default}),e.seekToUpdatedTime(r.start.default??0),i.UpdateTimeDisplay(),l(!1),"update-timestamp"!=s?.message)return e.timeDisplay.visible(!1);i.UpdateTimeDisplay(),t.ytgif.timerID=window.setInterval((()=>i.UpdateTimeDisplay()),a.update.tickOffset),t.ytgif.timers.push(t.ytgif.timerID),n.timeDisplay.onmousemove=o}};function o(t){t.stopPropagation(),t.preventDefault(),e.timeDisplay.visible(!1),t.currentTarget.onmousemove=null}}(e,u,r,c,f,l);if(s.addEventListener("click",y),s.ResetBoundaries_smart=y,U({el:i,OnRemovedFromDom_cb:Wr(p,e,u,c,l.entry,r)}),l.entry.canBeCleanedByBuffer&&a){!function(t){t&&(window.YT_GIF_OBSERVERS.masterIframeBuffer=tt(window.YT_GIF_OBSERVERS.masterIframeBuffer,t)),Fr()}(Z(a))}new IntersectionObserver(zr(u,e,l),{threshold:[0]}).observe(i),c.playRightAway?.value&&c.hasOwnProperty("updateTime")?await async function(t,e,n,r){await e.WhileApiHolds(t),n.seekToUpdatedTime(r.updateTime.value??r.start.value),n.togglePlay(!0),n.isSoundingFine(!r.mute.value),r.playRightAway.set(!1)}(i,e,u,c):await Xr(i,e,u),Jr(e,l,d),a.setAttribute("loaded",""),i.addEventListener("load",(()=>e.ytgif.previousTick=u.tick())),function(t,e){const n=e.GetVideoID();Be.set(n,e.getDuration?.());const r=Be.get(n),i=We(t);i&&"number"==typeof r&&Rr(i,t,"[yt-gif-timestamp-emulation]").forEach((t=>t.validateSelf?.(r)))}(a,e)}async function di(t,e=null){if(!t)return;const n=t.querySelector('[yt-gif-url-btn="reset"]');e&&"delete-obs-tm"in e&&n.dispatchEvent(new CustomEvent("customDelObsTimestmp",{bubbles:!0,cancelBubble:!0,cancelable:!0,detail:{blockID:e.blockID}})),await(n?.ResetBoundaries_smart?.(e))}async function pi(t,e){await z(10);const n=await async function(t){if(!t)return{};const e=He(t);return e?{rm_container:e}:{}}(t);if(!n.rm_container)return e();const{query:r,wrapper:i}=function(t,e){const n=Array.from(le.timestamps.tm_loop_options.selectedOptions).map((t=>t.value)),r=`[timestamp-set][timestamp-style="${le.timestamps.tm_loop_to.value||"start"}"]`,i=`${r}:not([out-of-bounds])`,a=n.includes("skip")?i:r,o=t.closest(".yt-gif-wrapper"),s=Rr(e,o,"[last-active-timestamp]")?.[0],c=Xe(Ne(s),a)?.[0],l=Rr(e,o,a);return{query:{activeIdx:l.indexOf(c),targets:l,includesPlayerOpt:n.includes("include_player")},wrapper:o}}(t,n.rm_container),{message:a,target:o}=function(t){if(-1===t.activeIdx&&("active"==le.timestamps.tm_loop_hierarchy.value||0==t.targets.length))return{message:"reload-this"};let e=(t.activeIdx+1)%t.targets.length;if(t.includesPlayerOpt){if(t.activeIdx==t.targets.length-1)return{message:"update-timestamp"};-1==t.activeIdx&&(e=0)}const n=t.targets[e];return Ge(n)?{message:"seekTo-strict",target:n}:{message:"reload-this"}}(r);return"reload-this"==a?e():"update-timestamp"==a?di(i,{message:a}):"seekTo-strict"==a&&o?kr(o,{seekToMessage:a}):void console.error("Unknown Reload Message",a)}function mi(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),de("")}async function fi(t){t.iframe.closest(".yt-gif-wrapper")?.dispatchEvent(new CustomEvent("customVideoEnded")),"disabled"!=le.timestamps.tm_loop_hierarchy.value?await pi(t.iframe,t.Reload):await t.Reload(),"0"!=le.range.end_loop_sound_volume.value&&function(){const t=window.YT_GIF_DIRECT_SETTINGS.get("end_loop_sound_src")?.sessionValue;/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(t)?new Promise((function(e,n){const r=new Audio;var i,a,o;r.preload="auto",r.volume=(i=Number(le.range.end_loop_sound_volume.value),(o=0)+(i=(i-(a=0))/(100-a))*(1-o)),r.autoplay=!0,r.onerror=n,r.onended=e,r.src=t})):Promise.resolve()}(),Zt(le.playerSettings.ps_options,"minimize_on_video_ended")&&ue===t.id&&document.fullscreenElement&&mi()}async function gi(t){const e=new Ie(t.target),n=e.GetIframeID(),r=Ce.get(n),i=e.getIframe();if(!Ge(i))return e.DestroyTarget();t.data===fe().ENDED&&await fi({Reload:async()=>Nr({t:e,start:r?.start.value??0,end:r?.end.value??0}),iframe:i,id:n}),t.data===fe().PLAYING&&null===e.ytgif.timerID&&e.ytgif.enter(),t.data===fe().PAUSED&&e.ytgif.ClearTimers()}function yi(){return document.querySelector(".rm-block__input--active.rm-block-text")}async function hi(t){let e=Ne(t);const n=e?.id;for(;e?.contains?.(t);){if(e=e.parentElement,r(e?.parentElement,"roam-app"))return{ok:!1};let t=a();if(!t&&!r(e,"roam-block-container"))continue;for(;Ge(t)&&!t?.hasAttribute("invalid-yt-gif")&&r(t,"rm-xparser-default-yt-gif");)await z(10);t=a();const i=Ne(t),o=Xe(i,".yt-gif-wrapper").pop();if(o)return{lastWrapper:o,container:e,block:i,id:i?.id,originalId:n,ok:!0}}return{ok:!1};function r(t,e){return!!t&&t.classList.contains(e)}function i(t,e){return t?t.querySelector(e):null}function a(){return i(e?.firstElementChild,".yt-gif-wrapper")??i(e?.firstElementChild,".rm-xparser-default-yt-gif")}}function bi(t,e,n,r){if(!e||0==e.length)return[];const i=(e instanceof NodeList?Array.from(e):[e]).map((t=>t)).filter((t=>!!t.tagName)),a=r,o=t(),s=(t,e)=>Array.from(t).flat(1/0).indexOf(e),c=t=>o.queryAllasArr(t),l=(t,e)=>e?[o,...c(t)]:c(t);function u(t,e){return d(e.find((e=>e.getAttribute("timestamp-style")==t)),t,e)}function d(t,e,n){return{el:t,timestamp:t?.getAttribute("timestamp"),index:n.indexOf(t),page:e,otherPage:"start"==e?"end":"start"}}return i.map((t=>t.hasAttribute(n)?t:t.queryAllasArr(`[${n}]`))).flat(1/0).map((t=>Ne(t))).filter(((t,e,n)=>!!t&&n.indexOf(t)===e)).map((t=>{const e=(Xe(t,"[yt-gif-timestamp-emulation]")||[]).filter((t=>t.hasAttribute(n)))||[],r=e.find((t=>t.hasAttribute("last-active-timestamp")||t.hasAttribute(n)));return{blockID:t.id,blockIndex:s(l(".rm-block__input"),t),containerIndex:s(l(".roam-block-container",!0),o),workflow:"strict",node:a.querySelector("[yt-gif-timestamp-emulation]"),start:u("start",e),end:u("end",e),target:(i=r,c=e,d(i,i.getAttribute("timestamp-style"),c))};var i,c}))}async function _i(t,e){const n=!!e.removed.find((t=>t?.target?.timestamp&&function(t){if("block"==le.timestamps.tm_reset_on_removal.value){if(t=j(t),!document.querySelector("div.rm-block__input#"+t))return!0}else if("container"==le.timestamps.tm_reset_on_removal.value&&!document.getElementById(t))return!0}(t.blockID)))&&"disabled"!=le.timestamps.tm_reset_on_removal.value;return n&&(e.removed.length=0,await di(t())),n}async function wi({getObsTimestamp:t,delObsTimestmp:e,getCrrContainer:n},r){const i=r.find((e=>function(t,e){return!!e.blockID&&e.blockID==t()?.blockID}(t,e)));if(!(!!i&&le.timestamps.tm_recovery.checked))return!1;const a=document.getElementById(i.blockID);if(function(t){const e=Xe(t,".rm-xparser-default-start, .rm-xparser-default-end");return e.length>0}(a))return!0;const o=function(t,e){const n=e=>t()?.target[e];return(t="timestamp")=>n(t)?.toString()==Xe(e,`[${t}]`)?.[Number(n("index"))]?.getAttribute?.(t)}(t,a);return"match"!=le.timestamps.tm_restore.value||o()?(await Sr(n,t(),{simMessage:o()?"visuals":""}),!0):(e(),!0)}function vi(t){return t.target.timestamp}async function ki(t,e,n){const{lastActive:r,added:i}=function(t,e,n){let r=Array(),i=Array();const a=t();for(const c of e){const e=c.target;if(e==a||!s())continue;if("attributes"==c.type){i=[...i,...bi(t,c.target,"last-active-timestamp",e)];continue}if(!c.target.hasAttribute("class"))continue;const{removedNodes:o,addedNodes:l}=c;n.removed=[...n.removed,...bi(t,o,"active-timestamp",e)],r=[...r,...bi(t,l,"yt-gif-timestamp-emulation",e)]}function o(t){return t.flat(1/0).filter((t=>!!t))}return n.removed=o(n.removed),r=o(r),i=o(i),{lastActive:i,added:r};function s(){const t=(t,e)=>function(t,e){const n=t?.closest(`[${e}]`);return{found:n,value:n?.getAttribute(e)}}(t,e).found;return e=>[t(e,"yt-gif-block-uid"),t(e,"yt-gif-anchor-container")].some((t=>t==a))}}(t.getCrrContainer,e,n);!function(t,e){t(e.find((t=>t?.target?.timestamp&&t.blockID)))}(t.setObsTimestamp,r),await _i(t.getTargetWrapper,n)||await wi(t,i)||function(t,e){if(!le.timestamps.tm_recovery.checked||t.length>0||e.removed.length>0)return;const n=e.removed.find((e=>vi(e)&&t.some((t=>vi(t)&&function(t,e){return t.blockID.includes(e.blockID)}(t,e)))));if(n){const t=e.removed.indexOf(n);e.removed.splice(t,1)}}(i,n)}function Si(t,e){if(!e||e?.hasAttribute("timestamp-observer"))return{getCrrContainer:()=>e,switchTimestampObsOnAchor:t=>{}};const{delObsTimestmp:n,getTargetWrapper:r,getObsTimestamp:i}=t;e.setAttribute("timestamp-observer",""),e.addEventListener("customDelObsTimestmp",n);const a=[i()],o={removed:a,lastActive:a};let s=!1;const c=new MutationObserver((async e=>{!s&&le.display.simulate_roam_research_timestamps.checked&&(s=!0,await ki(t,e,o),s=!1)})),l={attributes:!0,childList:!0,subtree:!0},u=te(le.timestamps.tm_options,"anchor"),d=f(u.selected);let p=()=>d;c.observe(d,l);const m=t=>{const e=t.target.selected;Dr(f(!0),r()),f(!e)?.removeEventListener("customDelObsTimestmp",n),c.disconnect();const i=f(e);i.addEventListener("customDelObsTimestmp",n),c.observe(i,l),p=()=>i};function f(t){return t?We(e)??e:e}return u.addEventListener("customChange",m),{getCrrContainer:p,switchTimestampObsOnAchor:m}}function Ai(t){const{rm_container:e,grandParentBlock:n,blockID:r}=t,i={getCrrContainer:()=>e,getTargetWrapper:()=>{const t=document.getElementById(n.id)??n;return t?t.queryAllasArr(".yt-gif-wrapper")?.pop()??null:null},getLocalBlockID:()=>{return((t=i.getTargetWrapper())?Qe(t)+Je(t):null)??r;var t},getObsTimestamp:()=>{const t=Fe.get(i.getLocalBlockID())?.lastActiveTimestamp;return t&&le.timestamps.tm_recovery.checked?t:null},delObsTimestmp:()=>{Fe.delete(i.getLocalBlockID())},setObsTimestamp:t=>{if(!t||!t.blockID)return;const e=i.getLocalBlockID(),n=Fe.get(e)?.lastActiveTimestamp,r=t.target?.timestamp===n?.target?.timestamp,a=t.target?.timestamp;!a||r&&n||Fe.set(e,{lastActiveTimestamp:t})},switchTimestampObsOnAchor:t=>{}};return{...i,...Si(i,e)}}function Ei(t){return t==Qt.forceAwaiting||Ir()||!Tr()&&Or()||Zt(le.experience.initialize_mode,"overflow")}async function Ii(t){let{wrapper:e}=t;if(!e||!e.parentNode)return null;let n=!1;const r=await bn(e),{url:i,uid:a,grandParentBlock:o}=r;if((!(s={...r,wrapper:e}).url||s.accUrlIndex<0||!s.uid)&&(Re.delete(s.uid),s.wrapper.setAttribute("invalid-yt-gif",""),console.log(`YT GIF: Couldn't find yt-gif component number ${s.accUrlIndex+1} within the block ((${s.uid}))`),1))return null;var s;const c="player_"+Number(++window.YT_GIF_OBSERVERS.creationCounter),l=function(t,e){return Ce.set(t,jn(e)),Ce.get(t)}(c,i),{blockID:u,record:d}=function(t){const e=new Ee;qe.uid=t.uid;const n=t.grandParentBlock.id+ne(t.url,t.accUrlIndex);return null!=n&&Oe.set(n,e),{blockID:n,record:e}}(r);e=function(t){let e=t.wrapper;return"DIV"!=e.tagName&&(e=V(e,"div")),e.parentElement?.classList.add(`${Yt.yt_gif_wrapper}-parent`),e.className=`${Yt.yt_gif_wrapper} dont-focus-block`,t.customSpan&&e.style.setProperty("--yt-gif-player-span",parseFloat(t.customSpan)+"%"),e.setAttribute(zt,t.targetClass),e.setAttribute(Qt.name,t.dataCreation),e.setAttribute(Wt.path,t.url),e.setAttribute(Wt.index,t.accUrlIndex.toString()),e.innerHTML="",e.insertAdjacentHTML("afterbegin",Gt.html.fetched.playerControls),e.querySelector(".yt-gif-player").id=t.newId,e}({...t,...r,customSpan:l.sp.value,newId:c});const p=function(t,e){const n=ze(t);return n?.setAttribute("yt-gif-block-uid",e),n}(o,a),m={rm_container:p,grandParentBlock:o,blockID:u},f=Ai(m),g={wrapper:e,...m,...r};return vr(g,d),U({el:o?.querySelector("span"),OnRemovedFromDom_cb:()=>function(t){const e=t.that.getCrrContainer();Re.delete(t.uid),t.deployed()||(Oe.delete(t.blockID),Ce.delete(t.newId)),le.timestamps.tm_recovery.checked||Dr(e,t.wrapper),!Ge(e)&&e?.closest(".rm-sidebar-outline")&&t.that.delObsTimestmp(),Ge(e)||te(le.timestamps.tm_options,"anchor").removeEventListener("customChange",t.that.switchTimestampObsOnAchor)}({...g,deployed:()=>n,that:f,blockID:u,newId:c})}),Ei(t.dataCreation)?Er(f,{wrapper:e,url:i,configParams:l,deploy:y}):(await Ar(f,l),y()),e;function y(){n=!0,d.wTarget=new window.YT.Player(c,function(t){const{player_interface_language:e,player_captions_language:n,player_captions_on_load:r}=Object.fromEntries(window.YT_GIF_DIRECT_SETTINGS),i={autoplay:1,controls:1,mute:1,start:t?.start.value,end:t?.end.value,hl:t?.hl.value||e.sessionValue,cc_lang_pref:t?.cc.value||n.sessionValue,cc_load_policy:H(r.sessionValue)?1:3,iv_load_policy:3,vq:"hd1080",autohide:1,showinfo:0,modestbranding:1,fs:1,rel:0,version:3,feature:"oembed",enablejsapi:1,origin:"https://www.roamresearch.com"};return{height:"100%",width:"100%",videoId:t?.id.value,playerVars:i,events:{onReady:ui,onStateChange:gi}}}(l))}}function Ti({wrapper:t,targetClass:e,message:n}){Ii({wrapper:t,targetClass:e,dataCreation:t.getAttribute(Qt.name),message:n||"YScrollerObserver"})}function Oi(t){const e=new IntersectionObserver((n=>{n[0]||e.disconnect();for(const r of n)if(r.isIntersecting){Ti(t),e.disconnect();break}}),{threshold:[0]});return e.observe(t.wrapper),e}function Ci(t){const e=function(t){return{async OnRendered(e){window.YT_GIF_OBSERVERS.masterIntersectionObservers.push(Oi({wrapper:e,message:"valid entries MutationObserver",targetClass:t}))},validTemplates:()=>document.queryAllasArr("."+t).filter((t=>st(t)))}}(t);(t=>{let e=[];for(const n of t)Q(n)&&e.push(n);return e})(e.validTemplates()).forEach((e=>Ti({wrapper:e,message:"first wave",targetClass:t}))),e.validTemplates().forEach((e=>window.YT_GIF_OBSERVERS.masterIntersectionObservers.push(Oi({wrapper:e,message:"second wave",targetClass:t}))));const n=new MutationObserver((async n=>Ke(n,t,e.OnRendered)));return n.observe(document.body,{childList:!0,subtree:!0}),n}function xi(t){window.YT_GIF_OBSERVERS.masterMutationObservers.push(Ci(t))}window.AvoidCircularDependency.getOnStateChange=()=>gi;const Fi={deploymentStyle:function(){return this.BinaryDomUI().checked},checkSubDeploymentStyle:function(t){this.BinaryDomUI().checked=t}},Di={...Fi,runMasterObservers:function(){xi(this.classToObserve)}},Ri={video:{description:"{{[[video]]}}",classToObserve:"rm-video-player__spacing-wrapper"},yt_gif:{description:"{{[[yt-gif]]}}",classToObserve:`rm-xparser-default-${Yt.yt_gif}`}},Bi={video:{...Di,...Ri.video,page:"video",BinaryDomUI:()=>le.deploymentStyle.deployment_style_video},yt_gif:{...Di,...Ri.yt_gif,page:"yt-gif",BinaryDomUI:()=>le.deploymentStyle.deployment_style_yt_gif},both:{...Fi,description:`${Ri.video.description} and ${Ri.yt_gif.description}`,classToObserve:null,classesToObserve:[Ri.video.classToObserve,Ri.yt_gif.classToObserve],BinaryDomUI:()=>le.deploymentStyle.deployment_style_both,runMasterObservers:function(){this.classesToObserve.forEach((t=>xi(t)))}},yt_gif_tut:{classToObserve:"yt-gif-ddm-tutorial"}};const Pi=function(t=Bi){const e={currentKey:"yt_gif",initialKey:"",currentClassesToObserver:Array()};return{state:e,checkSubDeploymentStyle(e,n){t[e].checkSubDeploymentStyle(n)},RunMasterObserverWithKey(n){e.currentKey=n,t[n].runMasterObservers()},assertCurrentKey(n){const r=function(t){let e="yt_gif";H(t)?e="video":"both"===t&&(e="both");return e}(n);return e.currentClassesToObserver=function(e){return"both"==e?t[e].classesToObserve:[t[e].classToObserve]}(r),Me.componentPage=function(e){return"both"==e?"yt-gif|video":t[e].page}(r),e.currentKey=r},ChargeMasterObserversWithValidDeploymentStyle(){M(t).filter((e=>t[e].hasOwnProperty("deploymentStyle"))).some((e=>{if(H(t[e].deploymentStyle()))return this.RunMasterObserverWithKey(e),!0}))}}}();async function $i(t,e,n){const{type:r,checked:i,value:a}=t;let o=a.toString();"checkbox"!=r&&"radio"!=r||(o=i.toString()),"radio"==r&&[...n].map((t=>window.YT_GIF_DIRECT_SETTINGS.get(t))).filter((t=>"radio"==t.inputType)).forEach((t=>t.UpdateSettingsBlockValue(""))),"select-multiple"==r&&(o=Array.from(t.selectedOptions).map((t=>t.value)).toString()),await(window.YT_GIF_DIRECT_SETTINGS.get(e)?.UpdateSettingsBlockValue?.(o.toString()))}async function Mi(t){const e=function(t){const e=t=>`deployment_style_${t}`;let n=null;switch(t.id){case e("yt_gif"):n="false";break;case e("video"):n="true";break;case e("both"):n="both"}return n}(t);e&&(Pi.assertCurrentKey(e),await(window.YT_GIF_DIRECT_SETTINGS.get("override_roam_video_component")?.UpdateSettingsBlockValue(e)))}window.AvoidCircularDependency.getCurrentClassesToObserver=function(){return Pi.state.currentClassesToObserver};class Li{constructor(t){__publicField(this,"classes"),__publicField(this,"fakeSel"),__publicField(this,"customSelect"),this.fakeSel=t.fakeSel,this.classes=t.classes||{selected:"selected"},this.customSelect=document.createElement("select"),this.fakeSel.hasAttribute("multiple")&&this.customSelect.setAttribute("multiple",""),this._removeFakeSibling();for(const e of this._getArrayChildrenOptions()){const t=document.createElement("option");t.setAttribute("value",e.getAttribute("value")),t.textContent=e.textContent,this.customSelect.appendChild(t),e.hasAttribute("selected")&&this._select(e);const n=()=>{if(e.hasAttribute("disabled")||t.disabled)return;const n=t.selected;this.fakeSel.hasAttribute("multiple")&&(e.hasAttribute("selected")||t.selected)?(this._deselect(e),this._fireCustomChange(t,!1,n)):(this._select(e),this._fireCustomChange(t,!0,n)),this.customSelect.dispatchEvent(new Event("change"))},r=t=>{t?this._select(e):this._deselect(e),this.customSelect.dispatchEvent(new Event("customBind"))};e.addEventListener("click",n.bind(this)),t.customSelect=r.bind(this),t.customHandleSelect=n.bind(this),t.fake=e}this.fakeSel.insertAdjacentElement("afterend",this.customSelect),this.customSelect.style.display="none",this.customSelect.setAttribute("hidden-fake-select","")}_output(){return{select:this.customSelect,originalSelect:this.fakeSel}}_removeFakeSibling(){this.fakeSel.nextElementSibling?.hasAttribute("hidden-fake-select")&&this.fakeSel.parentNode?.removeChild(this.fakeSel.nextElementSibling)}_getArrayChildrenOptions(){return Array.from(this.fakeSel.children)}_select(t){this.fakeSel.hasAttribute("multiple")||this._getArrayChildrenOptions().forEach((t=>this._vsSelected(!1,t))),this._isSelected(!0,t),this._vsSelected(!0,t)}_deselect(t){this._isSelected(!1,t),this._vsSelected(!1,t)}_vsSelected(t,e){J(t,"selected",e),this.classes.selected&&K(t,[this.classes.selected],e)}_isSelected(t,e){const n=this._getArrayChildrenOptions().indexOf(e);this.customSelect.children[n].selected=t}_fireCustomChange(t,e,n=!1){n!=e&&t.dispatchEvent(new CustomEvent("customChange",{bubbles:!1,cancelBubble:!0,cancelable:!0,detail:{previousValue:n,currentValue:e}}))}}function Ui(){const t=le.playerSettings.mute_style,e=le.playerSettings.play_style,n=()=>te(e,"soft").disabled="soft"==t.value&&"soft"==e.value;n(),t.addEventListener("change",n),e.addEventListener("change",n)}function ji(t){const e=Array.from(t.classList)?.reverse().find((t=>t.includes("bp3-icon-")));return{falseVal:e,trueVal:"bp3-icon-"+t.getAttribute("flip-icon"),el:t}}function Vi(t){const e=t.getAttribute("flip-tooltip");return{falseVal:t.getAttribute("data-tooltip"),trueVal:e,el:t}}function qi(t,{falseVal:e,trueVal:n,el:r}){return t=H(t),K(!1,[n,e],r),K(!0,[t?n:e],r),t}function Ki(t,{falseVal:e,trueVal:n,el:r}){return t=H(t),J(!0,"data-tooltip",r,t?n:e),t}function Ni(t,e,n){e.addEventListener("click",(()=>t.Gain(e,n))),e.addEventListener("blur",(()=>t.Lost(n)))}function Gi(t){const e=document.queryAllasArr(t),n=new Map;for(const r of e){const t=r.nextElementSibling;t?.classList.contains("dropdown-content")&&(Hi(r),n.set(r,t))}return n}function Yi({ddm_icon:t}=Yt){const e=document.querySelector("span.yt-gif-drop-down-menu-toolbar .dropdown"),n=document.querySelector("span.yt-gif-drop-down-menu-toolbar .dropdown > .dropdown-content"),r=document.querySelector("."+t);return Hi(r),{icon:r,mainDDM:n,mainMenu:e}}function Hi(t){t.tagName&&t.setAttribute("tabindex","-1")}async function Wi(){const t=()=>zi().length>=1,{tooltip:e,icon:n}=function(){const t=document.querySelector("#navigate-to-yt-gif-settings-page"),e=Vi(t.querySelector("[data-tooltip]")),n=ji(t.querySelector("input"));return{tooltip:e,icon:n}}(),r=t=>{Ki(t,e),qi(t,n)},i=()=>r(t());e.el.addEventListener("click",(async function(){await y(3),await z(50),t()||(r(!0),await((t,e="outline")=>window.roamAlphaAPI.ui.rightSidebar.addWindow({window:{type:e,"block-uid":t}}))(P)),await z(50),zi()?.[0]?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})})),e.el.addEventListener("mouseenter",i);const{icon:a}=Yi();a.addEventListener("blur",i,!0),a.addEventListener("mouseenter",i,!0),a.addEventListener("mouseleave",i,!0)}function zi(){return((t,e)=>{let n=document.querySelectorAll(t);return Array.prototype.filter.call(n,(function(t){return RegExp(e).test(t.textContent)}))})(".rm-sidebar-outline .rm-title-display span",B)}async function Qi(t,e){if(await ft(t))return new Promise((function(n,r){!function(t,e){const n=document.queryAllasArr(`[id='${t}']`);if(n?.length>0){!function(t){console.log(`The stylesheet ${t} already exist.`)}(e);for(const t of n)t.parentElement?.removeChild(t)}}(e,t);const i=document.createElement("link");i.rel="stylesheet",i.href=mt(t),i.id=e,document.head.appendChild(i),i.onload=()=>n()}))}function Ji(t){var e;e=t,void 0!==["em","ex","ch","rem","vw","vh","vmin","vmax","%","cm","mm","in","px","pt","pc"].map((t=>new RegExp(`^[0-9]+${t}$|^[0-9]+\\.[0-9]+${t}$`,"i"))).find((t=>t.test(e)))&&document.documentElement.style.setProperty("--yt-gif-player-span",t)}function Xi(){const{ddm_exist:t}=Yt;return document.queryAllasArr("."+t)}function Zi(t,e){e(),t.addEventListener("change",e),t.addEventListener("customBind",e)}function ta(t,e){const n=document.querySelector(`[data-main='${t}']`),r=()=>document.queryAllasArr(`[data-bind*='${t}']`);return{check:()=>r().forEach((t=>K(!n.checked,e,t))),select:()=>r().forEach((t=>{const{on:r,not:i}=function(t){const e=t.getAttribute("on"),n=t.getAttribute("not");return{on:e,not:n}}(t),{equals:a,any:o}=function(t){const e="select-multiple"==t.type?[...t.selectedOptions].map((t=>t.value)):[t.value],n=t=>e.includes(t);return{equals:t=>t.split(",").map((t=>t.trim())).some((t=>n(t))),any:t=>!n("disabled")&&"any"==t}}(n);r?K(!(a(r)||o(r)),e,t):i&&K(a(i)||o(i),e,t)})),main:n}}function ea(t){const e=t.nextElementSibling;function n(t){e.textContent=t.value,t.dispatchEvent(new Event("change"))}e.textContent=t.value,t.addEventListener("click",(t=>n(t.currentTarget)),!0),t.addEventListener("wheel",(t=>n(function(t){const e=t.currentTarget,n=-1*Math.sign(t.deltaY),r=parseInt(e.value,10);return e.value=Number(n+r).toString(),e}(t))),!0)}function na({ddm_focus:t,ddm_info_message_selector:e}=Yt){const{icon:n,mainDDM:r}=Yi(),i=(a=[t],{Gain:function(t,e){t.focus(),K(!0,a,e)},Lost:function(t){K(!1,a,t)}});var a;Ni(i,n,r),[...Gi(e).entries()].forEach((([t,e])=>Ni(i,t,e)))}function ra(t,e){K(e,[Yt.ddn_tut_awaiting],t)}async function ia(t,e){if(!t||t.querySelector(".yt-gif-wrapper"))return;const n=t.querySelector("[data-video-url]");Array.from(n.attributes).filter((t=>"data-video-url"!=t.name)).forEach((t=>n.removeAttribute(t.name)));const r=await Ii({wrapper:n,targetClass:"yt-gif-ddm-tutorial",dataCreation:"force-awaiting",message:"testing manual ty gif tutorial"}),i=function(t,e,n){const{icon:r,mainDDM:i,ddm_focus:a}=t,o=()=>n?.closest(".dropdown-content");function s(t=!0){[o(),i].forEach((e=>K(t,[a],e))),t&&r.dispatchEvent(new Event("click"))}return{blur:function t(){Ge(e)?s(!1):r.removeEventListener("blur",t)},FocusParents:s,UnfocusOthers:function(t){document.queryAllasArr(".dropdown-item.yt-gif-wrapper-parent").map((t=>t.closest(".dropdown-info-box.dropdown-focus"))).filter(((t,e,n)=>!!t&&t!=o()&&n.indexOf(t)===e)).forEach((e=>K(!t,[a],e)))}}}(e,r,t);e.icon.addEventListener("blur",i.blur),r&&function(t,e,n){t.addEventListener("mouseenter",(function(){e.dispatchEvent(new Event("click")),n.UnfocusOthers(!0),ra(this,!1)})),t.addEventListener("mouseleave",(function(){n.FocusParents(!0),ra(this,!0)}))}(r,e.icon,i)}function aa(t,e){K(!t,["absolute"],e),K(t,["w-full"],e)}function oa(t,e){const n=t.closest(".ddm-tut"),r=n.querySelector(".yt-gifs-tuts"),i=Array.from(t.options).map((t=>t.value)),a=[...i].reduce(((t,e)=>{const{item:n,itemHtmml:i}=function(t){const e=ut(["dropdown-item"]);e.setAttribute("select",t);const n=ut();return n.setAttribute("data-video-url",`https://youtu.be/${t}`),e.appendChild(n),{item:e,itemHtmml:e.innerHTML}}(e);return r?.appendChild(n),t[e]=i,t}),{}),o=t=>n.querySelector(`[select="${t}"]`);return{select:t,ddm:n,container:t.closest(".dropdown"),resetOptions:async function(){for(const t of i){const e=o(t);e instanceof HTMLElement&&(e.style.display="none",e.innerHTML=a[t])}},ShowOption:async function(){if("disabled"==t.value)return aa(!1,n);aa(!0,n);const r=o(t.value);r.style.display="block",await ia(r,e)}}}function sa(t){aa(!1,t.ddm),t.select.addEventListener("change",(async()=>{t.resetOptions(),await t.ShowOption()})),t.container?.addEventListener("mouseenter",(async()=>t.ShowOption()));const e=t.select.querySelector("[selected]")?.value;e&&t.select.dispatchEvent(new Event("change"))}async function ca(t){if(!Ge(t))return;const e=((t=Array())=>dt(t,"span"))(["yt-gif-anchor-wrapper"]);e.insertAdjacentHTML("afterbegin",Gt.html.fetched.anchor);const n=Ye(t,!0);if(!n)return;const r=await async function(t){return pn(t,De,mn,t,je)}(n),i=[...r.values()]?.[0],a=e.querySelector(".yt-gif-anchor"),o=function(t,e){const n=Vi(t);return{...n,trueVal:n.falseVal?.replace(je.uidRefRgx,`((${e}))`)}}(a,i);Ki(!0,o),t.parentElement?.replaceChild(e,t),i?ze(a)?.setAttribute("yt-gif-anchor-container",i):a.setAttribute("disabled",""),U({el:e,OnRemovedFromDom_cb:()=>De.delete(n)})}function la(t){const e=t?.nextSibling;let n=e?.href;return Me.guardClause(n)||(n=""),{url:n,ytUrlEl:e}}function ua(t,e){if(!t||0==t.length)return[];return Array.from(t).map((t=>t)).filter((t=>!!t.tagName)).map((t=>t.classList.contains(e)?t:Array.from(t.querySelectorAll(`.${e}`)))).flat(1/0).filter(((t,n,r)=>!!t&&la(t).url&&!pa(t)&&!da(t)&&t.classList.contains(e)&&r.indexOf(t)===n&&Ge(t)))}function da(t){return Array.from(t.classList).some((t=>t.includes("yt-gif")))}function pa(t){return Array.from(t.attributes).map((t=>t.name)).some((t=>t.includes("yt-gif")))}async function ma(t,e,n={}){const r=t.currentTarget,i=e.target;t.stopPropagation(),t.preventDefault();const a=Ne(i),o=Ye(a),{url:s,ytUrlEl:c}=la(i);if(!_r())return console.warn("YT GIF Url Button: Invalid Simulation keys");if(!o||!s)return console.warn(`YT GIF Url Button: Couldn't find any url within the block: ((${o}))`);const l=t=>{Gr(t,i),Gr(t,r)};var u,d,p;i.hasAttribute("awaiting")||(l(!0),await yr((u=t,d=e,p=n,{block:a,targetNode:c,siblingSel:'.bp3-icon-video + a[href*="youtu"]',selfSel:`.bp3-icon-video + a[href*="${s}"]`,getMap:async()=>mn(o,Le),isKey:"is substring",tempUID:o,from:{caster:"rm-btn",urlBtn:u.target,...p},...d})),l(!1))}function fa(t){for(const n of t){K(!0,["yt-gif"],n),kn(n);const t=t=>({target:n,fmtCmpnt_cb:t});if(ae("t",e=la(n).url)??ae("end",e)){const e=Nn(n);e.urlBtn("format").onclick=async n=>ma(n,t(e.updUrl),{param:"t",float:!1})}const r=gr(n),{urlBtn:i}=r;i("yt-gif").onclick=async e=>ma(e,t(r.ytGifCmpt)),i("start").onclick=async e=>ma(e,t(r.startCmpt)),i("end").onclick=async e=>ma(e,t(r.endCmpt)),i("start|end").onclick=async e=>ma(e,t(r.startEndCmpt)),r.confirmBtns()}var e}async function ga(t){let e=[];for(const{addedNodes:n}of t)e=[...e,...ua(n,"bp3-icon-video")];fa(e)}const ya={suspend:"Suspend Observers",deploy:"Deploy Observers",discharging:"** Disconecting Observers **",loading:"** Setting up Observers **"},{dwn_no_input:ha}=Yt,ba=[ha];function _a(t,{setText:e,sameLabel:n,visualFeedback:r,HoldInputFor10Secs:i}){const{dropdown_fadeIt_bg_animation:a,dropdown_forbidden_input:o,dropdown_allright_input:s}=Yt,c=[a,...ba],l=[...c,o],u=[...c,s];async function d(){Pi.ChargeMasterObserversWithValidDeploymentStyle(),e(ya.loading),r(!0),await i(u),e(ya.suspend)}return{OnInputFlow:async function(){t.menu.checked&&(n(ya.suspend)?await async function(){e(ya.discharging),r(!1),window.YT_GIF_OBSERVERS.CleanMasterObservers(),await i(l),e(ya.deploy)}():n(ya.deploy)&&await d())},OnSubmit:async function(){t.sub.checked&&n(ya.deploy)&&await d()}}}function wa(){const{dropdown__hidden:t,dropdown_deployment_style:e,dwp_message:n}=Yt,r=document.querySelector(`.${t}.${e}`),i=r.querySelector(`.${n}`);return{visualFeedback:function(t){!function(t){K(t,[`${Yt.dropdown__hidden}`],r)}(t),function(t){K(t,[Yt.dwn_pulse_anim],i)}(!t)},subHiddenDDM:r}}async function va(){const t={menu:le.deploymentStyle.suspend_yt_gif_deployment,sub:le.deploymentStyle.deploy_yt_gifs},e=t.menu.previousElementSibling;var n;const r=_a(t,{...((n=e).textContent=ya.suspend,{sameLabel:function(t){return n.textContent==t},setText:function(t){return n.textContent=t}}),...wa(),...function(t){function e(e){Object.values(t).forEach((t=>t.disabled=e))}function n(e){Object.values(t).forEach((t=>t.checked=e))}function r(e,n){K(e,n,t.menu.parentElement),K(e,ba,t.menu.parentElement)}return{HoldInputFor10Secs:function(t,i=1e4){return new Promise((function(a){e(!0),n(!1),r(!0,t),setTimeout((()=>{e(!1),n(!1),r(!1,t),a()}),i)}))}}}(t)});t.menu.addEventListener("change",r.OnInputFlow),t.sub.addEventListener("change",r.OnSubmit)}function ka(){["tut_update_ver"].map((t=>document.querySelector(`[id="${t}"]`))).filter((t=>null!=t)).map((t=>function(t){const e=t.querySelector("input[class*=bp3-icon-]"),n=t.querySelector(".drodown_item-pulse-animation"),r=ji(e),i=rt(t.querySelector("[data-video-url]")?.parentElement);return{iconObj:r,btn:e,pulseElm:n,id:t.id,target:()=>t.querySelector(i),ok:r.falseVal&&r.trueVal&&e}}(t))).filter((t=>t.ok)).forEach(Sa)}function Sa(t){const{btn:e}=t,n=function(t){return function(e){e=qi(e,t.iconObj),K(!e,[Yt.dwn_pulse_anim],t.pulseElm)}}(t);e.addEventListener("change",(()=>n(e.checked))),function({btn:t,id:e},n){if((t=>{let e=(new Date).toLocaleDateString();return localStorage[t]!=e&&(localStorage[t]=e,!0)})(e))t.checked=!0,t.dispatchEvent(new Event("change"));else{const r=window.YT_GIF_DIRECT_SETTINGS.get(e)?.sessionValue,i=void 0===r||H(r);t.checked=i,n(i)}}(t,n)}function Aa(t,e){if(e.disconnect(),t){fa(document.queryAllasArr(".bp3-icon-video").filter((t=>!pa(t)&&!da(t)&&la(t).url))),document.queryAllasArr(".yt-gif-controls :is([formatter],[insertOptions]), [yt-gif-timestamp-emulation]").forEach((t=>t?.tryToAppendUrlBtns?.())),e.observe(document.body,{childList:!0,subtree:!0})}else document.queryAllasArr(".yt-gif-url-btns-wrapper").forEach((t=>t.remove())),document.queryAllasArr(".bp3-icon-video").forEach((t=>t.classList.remove("yt-gif")))}function Ea(t){document.queryAllasArr(".yt-gif-url-btns-wrapper[no-url]").forEach((e=>J(!t,"style",e,"display: none")))}function Ia(t,e){t.addEventListener("customChange",e)}function Ta(t){const e=te(le.display.ms_options,Pe),n=te(le.display.fmt_options,"rely_on_hierarchy"),r=wr();e.customSelect?.(r),Aa(r,t),Ea(n.selected),Ia(e,(t=>function(t,e){const n=_r();if(!t||n)return;const r=confirm(`YT GIF Url Button: Simulation Request\n\nYES: ${n?"Simulate because I have both graph and localStorage keys":"Simulate, but first take me to the caution prompt - localStorage key is missing"} \n   -  https://github.com/kauderk/kauderk.github.io/blob/main/yt-gif-extension/install/faq/README.md#simulate-url-button-to-video-component \n\nNO: Don't simulate`);return r?(localStorage.setItem(Pe,"true"),n||window.open("https://github.com/kauderk/kauderk.github.io/tree/main/yt-gif-extension/install/faq#caution-prompt","_blank")?.focus()):(e&&(e.stopPropagation(),e.preventDefault(),e.currentTarget.customSelect?.(!1),e.currentTarget.parentElement?.dispatchEvent(new Event("customChange"))),localStorage.removeItem(Pe)),r}(t.detail.currentValue,t))),Ia(e,(e=>Aa(e.target.selected,t))),Ia(n,(t=>Ea(t.target.selected)))}async function Oa(t){const e=yi(),n=Ye(e),r={};if(!t||!n||!e)return r;const{ok:i,formats:a,targetBlock:o}=await ur(n);if(!i)return r;const{lessHMS:s,HMS:c,hmsSufix:l,S:u}=a,d=e=>({value:e,fmt:`{{[[yt-gif/${t}]]: ${e} }}`});return{lessHMS:d(p({lessHMS:s})),HMS:d(p({HMS:c})),hmsSufix:d(p({hmsSufix:l})),S:d(parseInt(u||o[t].S)),uid:o?.uid};function p(e){const n=Object.keys(e)[0],r=e[n];return!r||r?.includes?.("NaN")?o[t][n]:r}}async function Ca(t){const e=await Oa(t),n=e.uid,a=e[le.timestamps.tm_workflow_grab.value]?.fmt??"";if(!n)return console.warn(`YT GIF Timestamps: couldn't find YT GIFs within the Hierarchy: ((${n}))`);if(!a)return console.warn(`YT GIF Timestamps: couldn't find values with the keyword "${le.timestamps.tm_workflow_grab.value}" from ((${n}))`);const{updatedString:o,el:s}=function(t,e){const n=t.selectionStart??0,r=t.selectionEnd??0,i=t.value,a=i.substring(0,n),o=i.substring(r,i.length);return t.value=a+e+o,xa(t,r+e.length),{updatedString:t.value,el:t}}(yi(),a);await r(n,o),await i(50),xa(yi(),s.selectionEnd??0)}function xa(t,e=0,n=!1){n?t.selectionStart=t.selectionEnd=e:t.selectionEnd=t.selectionStart=e,t.focus()}async function Fa(t){if(!t.ctrlKey&&!t.metaKey||!t.altKey)return;let e=null;"s"==t.key?e="start":"d"==t.key&&(e="end"),e&&await Ca(e)}function Da(t,e){document.removeEventListener("keydown",e),t&&(e=Fa,document.addEventListener("keydown",e))}window.YTGIF={getTimestampObj:Oa};const Ra=t=>`bp3-button bp3-small dont-focus-block rm-xparser-default-${t}`,Ba={roamClassName:"rm-video-timestamp dont-focus-block",start:{targetClass:"rm-xparser-default-start",buttonClass:Ra("start")},end:{targetClass:"rm-xparser-default-end",buttonClass:Ra("end")},attr:{emulation:"yt-gif-timestamp-emulation",timestampStyle:"timestamp-style",timestamp:"timestamp"},timestamp:{buttonClass:Ra("timestamp")},parent:{className:"yt-gif-timestamp-parent"}},Pa="is component";function $a(t,e,n){return!t||t.size!==e.length&&!gn(t,e.indexOf(n),Pa)}function Ma(t){const e=new Map;let n=new Map;return{componentMapMap:e,siblingsArr:Array(),get startEndMap(){return n},map_successfulEmulationArr:new Map,renderedComponents:t.filter((t=>Ge(t)&&st(t))),TryUpdateAgain:r,update_startEndComponentMap:i,TryUpdateMap:async function(t,e,a){await i(t),$a(n,e,a)&&await r(t)}};async function r(t){await z(800),await async function({mapsKEY:t,tempUID:n}){e.set(t,await mn(n,$e))}(t),await i(t)}async function i({mapsKEY:t,tempUID:r}){n=await pn(t,e,mn,r,$e)}}function La(t){return{mapsKEY:t.id,tempUID:Ye(t)}}async function Ua(t,e){return await pn(t,e,(()=>Array()))}function ja(t,e,n){const r=t.find((t=>t===e)),i=t.indexOf(e);if(a=r,-1==i||!a||!a?.parentNode)return null;var a;const o=gn(n,i,Pa);return o?{index:i,defaultParent:r,content:o}:null}function Va(t,e,n,r){const{index:i,content:a}=t,o=yn(e,i,Pa),s=function(t,e){const{indent:n,similarCount:r,uid:i}=t;return{indent:n,similarCount:r,fromUid:i,fromUniqueUid:i+(0==n?0:r),page:["start","end"].find((t=>e?.classList.contains(Ba[t]?.targetClass)))||"timestamp"}}(o,t.defaultParent),c=(l=t.defaultParent,Array.from(l.attributes)?.forEach?.((t=>l?.removeAttribute(t.name))),(l=V(l,"div")).className=Ba.parent.className,l.innerHTML="",l);var l;const u=function(t,e){const n=dt([],"a");n.setAttribute(Ba.attr.timestampStyle,t.page),n.setAttribute(Ba.attr.emulation,""),n.setAttribute(Ba.attr.timestamp,e),n.className=Ba.roamClassName;const r=dt([],"a");return n.appendChild(r),n.a=r,n.a.textContent=e,n.a.textContent=An()(n.a.textContent),n}(s,a),{tempUID:d,mapsKEY:p}=r;var m;return{...s,targetIndex:i,tempUID:d,targetNode:u,appendToParent:()=>c?.appendChild(u),targetNodeParent:c,timestamp:a,hasAnyVideoUrl:(m=o.capture,Un(Ln(m))?.match),color:window.getComputedStyle(u).color,ObjAsKey:o,blockUid:d,block:n,blockID:p,startEndComponentMap:e}}const qa=`.${Ba.end.targetClass}, .${Ba.start.targetClass}, .${Ba.parent.className}`;async function Ka(t){const e=window.YT_GIF_DIRECT_SETTINGS.get("YT_API_KEY_V3")?.sessionValue;if(!e)return null;try{const n=`https://www.googleapis.com/youtube/v3/videos?id=${t}&key=${e}&part=snippet,contentDetails`,r=await function(t){return new Promise((function(e,n){$.ajax({url:t,type:"GET",dataType:"json",beforeSend:function(){},success:t=>e(t),error:t=>n(t)})}))}(n),i=r.items[0].contentDetails.duration;return console.log(`youtube_time: ${i}, id: ${t}`),function(t){return(t.match(/(\d+)(?=[MHS])/gi)||[]).map((t=>t.length<2?"0"+t:t)).join(":")}(i)}catch(n){}return null}function Na(t){return function(t,e){var n;const r=(n=t,t=>t.reduce(((t,e)=>{const r=e[n];return t[r]=(t[r]||[]).concat(e),t}),{}))(e);return Object.entries(r).map((([t,e])=>({title:t,data:e})))}("fromUniqueUid",[...t].sort(((t,e)=>t.indent-e.indent))).map((t=>t.data))}function Ga(t){const e=e=>[...t].reverse().find((t=>t.page==e)),n=[e("start"),e("end")],r=n.every((t=>!!t));return{lastArr:n,completePears:r}}async function Ya(t,e){const{foundBlock:n}=await ur(t);n?.uid||console.warn(`YT GIF Timestamps: couldn't find YT GIFs within the Hierarchy: ((${t}))`);const{uid:r}=n||{uid:""};return Ha(r,e)}async function Ha(t,e){const n={tEl:e,condition:function(){return!!this.tEl?.closest(`.${this.root}`)}},r={main:{root:"roam-article",crossRoot:"rm-sidebar-outline",...n},side:{root:"rm-sidebar-outline",crossRoot:"roam-article",...n},pageRef:{root:"rm-reference-main",crossRoot:"rm-sidebar-outline",...n}},i=M(r).find((t=>r[t].condition())),{root:a,crossRoot:o}=r[i],s=document.querySelector(`.${a} [id$="${t}"]`),c=n=>{const i=document.queryAllasArr(`.${n} [id$="${t}"] .yt-gif-wrapper`);return n==r.main.crossRoot?i:i.map((t=>He(t))).filter((t=>t?.contains(e))).map((e=>e?.queryAllasArr(`[id$="${t}"] .yt-gif-wrapper`))).flat(1/0)},l=(t=a)=>[...c(t)]?.pop()??null;return{lastWrapperInBlock:l,WrappersInBlock:c,f_uid:t,blockExist:!!s&&l(a),root:a,crossRoot:o,mainRoot:r.main.root}}async function Wa(t){if(!function({pulse:t,boundaryObj:e,seekToMessage:n,simMessage:r}){if(!e.success)return!1;t("visuals"==r?"purple":"green");const{ok:i}=e.timestampObj;return"visuals"!=r||!i||"seekTo-strict"==n}(t))return;const{boundaryObj:e}=t,{record:n,timestampObj:r}=e;await Nr({t:n?.wTarget,...r}),function({seekToMessage:t,record:e,timestampObj:n}){const{ok:r,currentTime:i,seekTo:a,start:o}=n;"seekTo-soft"==t&&r?e?.wTarget?.seekTo(i):a!=o&&e?.wTarget?.seekTo(a)}({...t,...e}),function(t){t?.isSoundingFine("mute"!=le.timestamps.tm_seek_action.value),t?.togglePlay("pause"!=le.timestamps.tm_seek_action.value)}(n),function({timestampObj:t,obsTimestamp:e,targetWrapper:n}){const r={...t,updateTime:t.currentTime??t.seekTo,playRightAway:"play"==le.timestamps.tm_seek_action.value,mute:"mute"==le.timestamps.tm_seek_action.value,obsTimestamp:e};n?.dispatchEvent(new CustomEvent("customPlayerReady",{detail:r,cancelBubble:!0}))}(e)}function za(t,e,n,r){const i=p("start")?t:m()||0,a=p("end")?t:m()||e?.wTarget?.getDuration?.()||0,o=p("end")?t+1:t,s=e?.wTarget?.getCurrentTime?.(),c=xe.get(n)?.updateTime,l=s??c?.value??i,u=((t=l)=>t>=i&&t<=a)(),d=((t=l)=>t+1>o)();return{start:i,end:a,page:p("end")?"end":"start",seekTo:o,currentTime:l,ok:u&&d};function p(t){return r.self.page==t}function m(){return q(r.pear?.timestamp||"")}}function Qa(t,e,n,r,i){var a;if(a=t,document.queryAllasArr(".yt-gif-wrapper").filter((t=>!t.closest(".ddm-tut"))).forEach((t=>{J(!1,"yt-active",t),t!=a&&t?.dispatchEvent(lt())})),!e)return{success:!1};const{record:o,timestamp:s,blockID:c}=function(t,e){const n=[...Oe.keys()].reverse().find((e=>e.startsWith(Qe(t)))),r=Oe.get(n),i=[...Fe.keys()].reverse().find((n=>n.endsWith(Je(t,e)))),a=Fe.get(i)?.lastActiveTimestamp;return{record:r,timestamp:{...a},blockID:n}}(t,n);Dr(We(t),t),r(!0,t);return{sameBoundaries:o?.sameBoundaries(),success:!0,record:o,obsTimestamp:s,targetWrapper:t,timestampObj:za(q(e),o,c,i)}}async function Ja({WrappersInBlock:t,crossRoot:n,f_uid:r,root:i,mainRoot:a}){0==t(n).length&&await(async(t,n=!1,r="outline")=>{const i=t.substring(0,2),a=t.substring(t.length-2,t.length);"outline"==r&&"(("==i&&"))"==a&&(r="block"),("[["==i&&"]]"==a||"(("==i&&"))"==a)&&(t=t.substring(2,t.length-2));let o=await s(t);var c;return null==o&&(o=await async function(t){const e=await window.roamAlphaAPI.q(`[:find (pull ?e [ :node/title :block/string :block/children :block/uid :block/order { :block/children ... } ] ) :where [ ?e :block/uid "${t}" ] ]`);return 0==e.length?void 0:e}(t),null==o?(t.length>255&&(t=t.substring(0,254)),await e(t),await(c=50,new Promise((t=>setTimeout(t,c)))),o=await s(t)):o=t),0==n?document.location.href=function(){const t=new URL(window.location.href),e=t.hash.split("/");return t.hash=e.slice(0,3).concat(["page"]).join("/"),t}().href+"/"+o:await window.roamAlphaAPI.ui.rightSidebar.addWindow({window:{"block-uid":o,type:r}}),o})(r,i==a,"block")}function Xa(t,e,n,r){const{lastWrapperInBlock:i}=n;async function a(n){await Wa({pulse:t,boundaryObj:s(n),...e.detail}),e.ScrollKey()&&o(n)}function o(t){i(t)?.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}function s(t){return Qa(i(t),e.tEl.a.textContent?.match($e.targetStringRgx)?.[0],n.f_uid,c,r.tmSetObj)}function c(t,e){!function(t,e,n){function r(t,e){e&&J(t,"active-timestamp",e)}r(t,e.self.targetNode),e.pear&&r(t,e.pear.targetNode),J(t,"last-active-timestamp",e.self.targetNode),n&&J(t,"yt-active",n)}(t,r.tmSetObj,e)}return{tryPlayLastBlock_SimHover:a,PlayPause_SimHover:async function(e){!function(t,e){t("blueViolet");const n=e?.querySelector("iframe");n?.hasAttribute("yt-playing")?e?.dispatchEvent(lt()):n&&e?.dispatchEvent(G())}(t,i(e))},OpenBlockOnCrossRoot:async function(){await y(3),await z(50),t("blue"),await Ja(n),await async function({lastWrapperInBlock:t,crossRoot:e}){const n=t(e),r=n instanceof Element&&Q(n);await z(r?50:500)}(n),o(n.crossRoot),await a(n.crossRoot)},TryToDeactivateSet:function(){t("red"),c(!1,i(n.root))}}}async function Za(t,e){const n=function(t){const{currentTarget:e}=t;return{tEl:e,resolve:()=>e.removeAttribute("awaiting"),isPending:()=>e.hasAttribute("awaiting"),pending:()=>e.setAttribute("awaiting","true"),ScrollKey:()=>t.ctrlKey,detail:"object"==typeof t.detail?t.detail:t}}(t);if(n.isPending())return;n.pending();const{resolve:r}=n,i=function(t){const e=["yt-timestamp-pulse-text-anim"],n={green:[...e,"yt-timestamp-success"],red:[...e,"yt-timestamp-warn"],blue:[...e,"yt-timestamp-opening"],purple:[...e,"yt-timestamp-reset"],blueViolet:[...e,"yt-timestamp-pause"],all:Array()};return n.all=Object.values(n).flat(1/0).filter(((t,e,n)=>n.indexOf(t)===e)),function(e="green"){K(!1,n.all,t),K(!0,n[e],t),setTimeout((()=>K(!1,n[e],t)),500)}}(n.tEl),a={left:1==(o=n.detail.which),right:3==o,middle:2==o};var o;const s=await async function(t,{tmSetObj:e,uid:n}){let r;var i;Zt(le.timestamps.tm_options,"anchor")&&(i=t?.closest("[yt-gif-block-uid]"),r=i?.getAttribute("yt-gif-block-uid")||(t=>t?.getAttribute("yt-gif-anchor-container"))(We(e.self.targetNode)));const a=r||n;return(a!=n?Ha:Ya)(a,t)}(n.tEl,e),{lastWrapperInBlock:c,f_uid:l,blockExist:u,root:d}=s,p=Xa(i,n,s,e);return u?a.left||a.right?(t.altKey?await di(c(d),{"delete-obs-tm":!0}):a.left?await p.tryPlayLastBlock_SimHover(d):a.right&&await p.PlayPause_SimHover(d),r()):(a.right&&await p.OpenBlockOnCrossRoot(),r()):(a.left||a.right||!l?p.TryToDeactivateSet():a.right&&await p.OpenBlockOnCrossRoot(),r())}function to(t,e,{validPear:n},{lastArr:r}){const i={self:t,pear:n?r.find((e=>e!=t))??null:null};return{async OnClicks(e){await Za(e,{uid:t.tempUID,tmSetObj:i})},tryValidateSelf(n){if(e<0)return;if(e==n&&t.targetNode.hasAttribute("out-of-bounds"))return;const r=parseInt(An("S")(t.timestamp));J(!(r>=0&&r<=e),"out-of-bounds",t.targetNode)},tryToAppendUrlBtns(){if(wr()&&(vn(t.targetNode),function({block:t,targetNode:e,page:n,timestamp:r,startEndComponentMap:i,blockUid:a},o){const{ytGifCmpt:s,compt2Url:c,urlBtn:l,confirmBtns:u}=gr(e);async function d(s,c){s.preventDefault(),s.stopPropagation();const l=(t,e)=>`[timestamp="${t}"][timestamp-style="${e}"]`,u={block:t,targetNode:e,siblingSel:"[timestamp-style]",selfSel:l(r,n),getMap:async()=>i,isKey:"is component",fmtCmpnt_cb:c,tempUID:a,from:{caster:"timestamp",page:n,tmSetObj:o,urlBtn:s.target,sel:l}};await yr(u)}l("url").onclick=async t=>await d(t,c),l("yt-gif").onclick=async t=>await d(t,s),u()}({...t},{pear:i.pear,self:{...t}}),!t.hasAnyVideoUrl)){const e=t.targetNode.querySelector(".yt-gif-url-btns-wrapper"),n=Zt(le.display.fmt_options,"rely_on_hierarchy");return J(!n,"style",e,"display: none"),J(!0,"no-url",e)}}}}async function eo(t){if(0===t.size)return;const{getDuration:e}=await async function(t){const e={getDuration:()=>-1};if(!Zt(le.timestamps.tm_options,"YT_API_KEY_V3"))return e;let n=Array();const r=[...t.values()].map((t=>t[0]?.targetNodeParent));if(0==r.length)return e;for(const a of r){const t=await hi(a);n.find((e=>e.id==t.id))||n.push(t)}const i=new Map;for(const a of n){const t=a.lastWrapper?.getAttribute("data-video-url"),e=it(t??"")||"invalid";i.has(a.id)&&!i.get(a.id)&&Be.delete(e),i.set(a.id,await pn(e,Be,Ka,e))}return{getDuration(t){const e=n.find((e=>e.container?.contains(document.getElementById(t))))?.id;return i.get(e)}}}(t);for(const n of t.values())for(const t of Na(n)){const n=Ga(t);for(const r of t)r?.targetNode&&no(r,n,e)}}function no(t,e,n){const r=function(t,{lastArr:e,completePears:n}){const r=e.includes(t);return{validPear:r&&n,tryToCollapse(){r&&t.targetNode.setAttribute("timestamp-set",n?"pears":"single")}}}(t,e);r.tryToCollapse();const i=function(t){return t?An("S")(t+""):t}(n(t.blockID)),a=to(t,i,r,e);a.tryValidateSelf(i),function(t,e){t.targetNode.oncontextmenu=t=>t.preventDefault();const{OnClicks:n}=e;t.targetNode.addEventListener("customMousedown",n),t.targetNode.onmousedown=n,t.targetNode.OnClicks=n,t.targetNode.validateSelf=e.tryValidateSelf,t.targetNode.tryToAppendUrlBtns=e.tryToAppendUrlBtns,e.tryToAppendUrlBtns(),t.appendToParent()}(t,a)}async function ro(t){const e=await async function(t){const e=Ma(t);let n=[];for(const r of e.renderedComponents){const t=Ne(r);if(!t)continue;n=Xe(t,`:is(${qa})`);const i=La(t);await e.TryUpdateMap(i,n,r);const a=ja(n,r,e.startEndMap);if(!a)continue;const o=Va(a,e.startEndMap,t,i);(await Ua(o.blockID,e.map_successfulEmulationArr)).push(o)}return e.map_successfulEmulationArr}(t);await eo(e)}async function io(t,e,n){async function r(){await ao(!1,e),Da(!1,n)}t?await async function(){await r(),await ao(!0,e),Da(te(le.timestamps.tm_options,"shortcuts").selected,n)}():await r(),K(!t,[`${Yt.dropdown__hidden}`],document.querySelector(".dropdown_timestamp-style"))}async function ao(t,e){e.disconnect();const n=document.body;if(t){const t=Array();t.push(...Array.from(n.getElementsByClassName(Ba.start.targetClass))),t.push(...Array.from(n.getElementsByClassName(Ba.end.targetClass))),await ro(t),e.observe(n,{childList:!0,subtree:!0})}else{const t=n.queryAllasArr(`[${Ba.attr.emulation}]`);for(const e of t){const t=e.getAttribute(Ba.attr.timestampStyle)||"timestamp";let n=e.parentElement?.classList.contains("yt-gif-timestamp-parent")?e.parentElement:e;n.innerHTML=t,n=V(n,"button"),n.className=Ba[t].buttonClass}}}async function oo(t){const e=Array();for(const{addedNodes:n}of t)Array.from(n).map((t=>t)).forEach((t=>{t.tagName&&(t.classList.contains(Ba.start.targetClass)||t.classList.contains(Ba.end.targetClass)?e.push(t):t.firstElementChild&&(e.push(...Array.from(t.getElementsByClassName(Ba.start.targetClass))),e.push(...Array.from(t.getElementsByClassName(Ba.end.targetClass)))))}));await ro(e)}async function so({timestampObserver:t,keyupEventHandler:e}=window.YT_GIF_OBSERVERS){await io(le.display.simulate_roam_research_timestamps.checked,t,e),le.display.simulate_roam_research_timestamps.addEventListener("change",(async n=>io(n.currentTarget.checked,t,e))),Ia(te(le.timestamps.tm_options,"shortcuts"),(t=>Da(t.detail.currentValue,e))),le.timestamps.tm_workflow_display.addEventListener("change",(t=>function(t){const e=An(t);document.queryAllasArr("[yt-gif-timestamp-emulation]").forEach((n=>{const r=n;if(!t)return r.a.textContent=r.getAttribute("timestamp")??r.a.textContent;r.a.textContent=e(r.a.textContent)}))}(t.currentTarget.value)))}async function co(){Gt.html.fetched.playerControls=await at(Gt.html.playerControls),Gt.html.fetched.urlBtn=await at(Gt.html.urlBtn),Gt.html.fetched.insertOptions=await at(Gt.html.insertOptions),Gt.html.fetched.anchor=await at(Gt.html.anchor),await async function(t){const e=document.querySelector(".bp3-icon-more")?.closest(".rm-topbar .rm-topbar__spacer-sm + .bp3-popover-wrapper"),n=window.YT_GIF_OBSERVERS.dmm_html??await gt(t),r=Xi();if(r?.length>0){for(const t of r)t.parentElement?.removeChild(t);pt(r)}e?.insertAdjacentHTML("afterend",n)}(Gt.html.dropDownMenu)}function lo({mainDDM:t,mainMenu:e,ddm_focus:n,initialDisplay:r="none"}){let i=t.style.display;function a(e){return t.style.display=e}function o(){return!t.classList.contains(n)&&!e.matches(":hover")}return a(r),{mutationCallback:function(e){e.forEach((function(e){if("style"!==e.attributeName)return;const{newValue:n,displayWas:r,el:a}=function(t,e){const n=t.target,r=n.style.display;return{newValue:r!==e,displayWas:t=>e===t&&r!==t,el:n}}(e,i);n&&(r("flex")&&function(t){t.queryAllasArr("iframe").map((t=>t.closest("[data-target]"))).filter((t=>null!=t)).forEach((t=>{t?.removeAttribute("class"),t=(t=>{const e=t.cloneNode(!1);return t.parentNode?.replaceChild(e,t),t})(t)}))}(t),i=a.style.display)}))},tryClose:function(){return o()&&t.queryAllasArr(".dropdown-focus").forEach((t=>t.classList.remove("dropdown-focus"))),o()?a("none"):null},open:function(){return a("flex")},close:close}}async function uo(){!function(){if(Xi().length>0){try{window.YT_GIF_OBSERVERS.CleanMasterObservers(),window.YT_GIF_OBSERVERS.CleanLoadedWrappers(),window.YT_GIF_OBSERVERS.masterIframeBuffer=new Array}catch(t){console.warn("YT GIF's Masters observers are not defined.")}console.log("Reinstalling the YT GIF Extension")}}(),await async function(){await Qi(Gt.css.dropDownMenuStyle,"yt-gif-dropDownMenuStyle"),await Qi(Gt.css.playerStyle,"yt-gif-playerStyle"),Ji(window.YT_GIF_DIRECT_SETTINGS.get("player_span")?.sessionValue)}(),await co(),function(){document.queryAllasArr(".select").forEach((t=>{if(!t)return;const{select:e,originalSelect:n}=new Li({fakeSel:t})._output(),r=Array.from(n.attributes).map((t=>({name:t.name,value:t.value}))),i=["class","multiple"];for(const{name:a,value:o}of r)i.includes(a)||(e.setAttribute(a,o),n.removeAttribute(a))}));for(const t of M(le)){const e=le[t];if("prompt"!=e.baseKey?.inputType)for(const n of M(e)){const r=e[n],i=r?.baseKey?r.baseKey:r,a=i.sessionValue,o=()=>document.getElementById(n),s=o();if(s){e[n]=s;const r=o();switch(t){case"range":r.value=a;break;case"label":s.textContent=a;break;default:if("SELECT"==s.tagName){const t=a.toString().split(",").filter((t=>!!t)),e=o();Array.from(e.options).forEach((n=>{const r=t.includes(n.value);n.selected=r,r&&"select-one"==e.type&&(e.value=n.value),n.customSelect?.(n.selected)}))}else r.checked=H(a);s.previousElementSibling?.setAttribute("for",n)}}else i.hasOwnProperty("baseValue")?e[n]=a||i.baseValue:"baseKey"!=n&&"prompt"!=i.inputType||delete e[n]}else delete le[t]}}(),function(){for(const t of M(le)){let e=Array();const n=le[t];for(const r of M(n)){const i=n[r];switch(e=tt(e,r),t){case"defaultPlayerValues":case"defaultValues":continue;case"deploymentStyle":i.addEventListener("change",(async function(t){await Mi(t.target)}),!0);continue;case"range":i.addEventListener("wheel",(function(){i.dispatchEvent(new Event("change"))}),!0)}async function a(t){return $i(t.currentTarget,r,e)}i?.addEventListener?(i.addEventListener("change",a,!0),i.addEventListener("customChange",a,!0)):console.log("yt-gif debugger")}}}(),na(),function(t=[Yt.dropdown__hidden],e=Ht){for(const n in e){const{check:e,select:r,main:i}=ta(n,t);i?"INPUT"==i.tagName?Zi(i,e):"SELECT"==i.tagName&&Zi(i,r):console.log("yt-gif debugger")}}(),ea(le.range.timestamp_display_scroll_offset),ea(le.range.end_loop_sound_volume),ea(le.range.iframe_buffer_slider),function(t,{awaitng_player_user_input:e}=Yt){t.addEventListener("customChange",(function(t){document.queryAllasArr(`.${e}`).forEach((e=>{t.target.selected?Y(e,e.getAttribute("data-video-url")):N(e)}))}))}(te(le.experience.xp_options,"thumbnail_as_bg")),Wi(),function(t=le.dropdownMenu.ddm_css_theme_input,e=Gt.css.themes,n=window.YT_GIF_DIRECT_SETTINGS.get("ddm_css_theme_input"),r=Yt.id.ddm_main_theme){const i=["bp3-icon-flash","bp3-icon-moon"];async function a(t){const a=Array.from(t?.classList)?.filter((t=>t.startsWith("bp3-icon-")));K(!1,a,t),K(!0,[t.checked?i[1]:i[0]],t),await Qi(e.toogle(H(n.sessionValue)),r)}a(t),t.addEventListener("change",a.bind(null,t))}(),function(t=le.range.iframe_buffer_slider,e=te(le.experience.initialize_mode,"input_x_buffer"),n=le.experience.initialize_mode){n.addEventListener("change",(()=>e.disabled=!1)),e.addEventListener("customChange",Fr),t.addEventListener("click",Fr),t.addEventListener("wheel",Fr)}(),function({raw_anchorSel:t}=Yt){document.queryAllasArr(`.${t}`).forEach(ca)}(),new MutationObserver((async t=>Ke(t,Yt.raw_anchorSel,ca))).observe(document.body,{childList:!0,subtree:!0}),Ui(),await va(),function(){Pi.state.initialKey=Pi.assertCurrentKey(le.defaultValues.override_roam_video_component);const{initialKey:t}=Pi.state;Pi.checkSubDeploymentStyle(t,!0),Pi.RunMasterObserverWithKey(t)}();const t=function(){const{mainDDM:t,mainMenu:e,icon:n}=Yi(),r=lo({mainDDM:t,mainMenu:e,...Yt});return e.addEventListener("mouseenter",r.open),e.addEventListener("mouseleave",r.tryClose),n.addEventListener("blur",r.tryClose),new MutationObserver(r.mutationCallback).observe(t,{attributes:!0}),{icon:n,mainDDM:t}}();var e;e={...t,...Yt},document.queryAllasArr(".ddm-tut select").filter((t=>!!t)).map((t=>oa(t,e))).forEach(sa),ka(),window.YT_GIF_OBSERVERS.timestampObserver=function({timestampObserver:t}=window.YT_GIF_OBSERVERS){return t?.disconnect(),new MutationObserver(oo)}(),await so();Ta(new MutationObserver(ga)),console.log("YT GIF extension activated")}!async function(){if(await async function(t){const e={src:t,id:`script-yt_gif-${t}`};var n;n=e.id,document.queryAllasArr(`[id='${n}']`).forEach((t=>t.parentElement.removeChild(t)));const r=function({src:t,id:n}=e){const r=document.createElement("script");return r.src=t+"?"+(new Date).getTime(),r.id=n,r.async=!1,r.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(r),r}(e);return await async function(t){return new Promise((e=>{t.addEventListener("load",(()=>e(t)))}))}(r)}("https://www.youtube.com/player_api"),void 0===window.YT)return console.warn(`The YT GIF Extension won't be installed, major scripts are missing... submit your issue here: ${Gt.help.github_isuues}`);await jt().then(me),await uo()}()}));
